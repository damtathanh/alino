This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
migrations/
  001_cleanup_profiles.sql
public/
  logo/
    logo.png
src/
  app/
    AppGate.tsx
    brandRoutes.tsx
    creatorRoutes.tsx
    dashboardRoutes.tsx
    router.tsx
  components/
    brand/
      BrandDashboardLayout.tsx
    creator/
      CreatorDashboardLayout.tsx
    dashboard/
      DashboardHeader.tsx
    layout/
      Footer.tsx
      Header.tsx
      UserMenu.tsx
    shared/
      NotificationModal.tsx
      ScrollToTop.tsx
      Toast.tsx
      UpgradePlanModal.tsx
    AvatarUpload.tsx
  contexts/
    AuthContext.tsx
  hooks/
    useAuth.ts
    useProfile.ts
  lib/
    supabase.ts
  pages/
    brand/
      campaigns/
        CampaignWorkspacePage.tsx
        CreateCampaignPage.tsx
      dashboard/
        BrandCampaignAnalyticsPage.tsx
        BrandDashboard.tsx
      deals/
        ProposalInboxPage.tsx
      discovery/
        CreatorDiscoveryPage.tsx
    creator/
      dashboard/
        AnalyticsPage.tsx
        DashboardHome.tsx
        NotificationsPage.tsx
      discovery/
        OpportunitiesPage.tsx
      profile/
        ProfilePage.tsx
        SettingsPage.tsx
      proposals/
        DealWorkspacePage.tsx
        SubmitProposalPage.tsx
      services/
        ServicesPage.tsx
    onboarding/
      OnboardingPage.tsx
      RolePage.tsx
    public/
      LandingPage.tsx
      LoginPage.tsx
      PrivacyPage.tsx
      SignupPage.tsx
      TermsPage.tsx
      VerifyEmailPage.tsx
    shared/
      ComingSoonPage.tsx
  types/
    profile.ts
  utils/
    cropImage.ts
  App.tsx
  index.css
  main.tsx
  vite-env.d.ts
.env.example
.gitignore
index.html
package.json
postcss.config.cjs
src.zip
tailwind.config.js
tsconfig.json
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="src/contexts/AuthContext.tsx">
import { createContext, useContext, useEffect, useState, ReactNode } from 'react'
import type { Session } from '@supabase/supabase-js'
import { getSupabase } from '../lib/supabase'

interface AuthContextType {
  session: Session | null
  user: Session['user'] | null
  loading: boolean
  isAuthenticated: boolean
  signOut: () => Promise<void>
}

const AuthContext = createContext<AuthContextType | undefined>(undefined)

/**
 * AuthProvider: Single source of truth for authentication state
 * 
 * Responsibilities:
 * - Fetches initial session on mount
 * - Listens to auth state changes from Supabase
 * - Provides stable session state to all components
 * - Does NOT handle routing/navigation (that's handled by components)
 */
export function AuthProvider({ children }: { children: ReactNode }) {
  const [session, setSession] = useState<Session | null>(null)
  const [loading, setLoading] = useState(true)
  const supabase = getSupabase()

  useEffect(() => {
    let mounted = true

    // Get initial session
    supabase.auth.getSession().then(({ data: { session } }) => {
      if (!mounted) return
      setSession(session)
      setLoading(false)
    })

    // Listen for auth state changes
    const {
      data: { subscription },
    } = supabase.auth.onAuthStateChange((event, session) => {
      if (!mounted) return
      setSession(session)
      setLoading(false)
    })

    return () => {
      mounted = false
      subscription.unsubscribe()
    }
  }, [supabase])

  const signOut = async () => {
    await supabase.auth.signOut()
    // Session will be cleared by onAuthStateChange listener
  }

  const value: AuthContextType = {
    session,
    user: session?.user ?? null,
    loading,
    isAuthenticated: !!session,
    signOut,
  }

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>
}

/**
 * useAuth: Hook to access auth context
 * 
 * Rules:
 * - ONLY reads from AuthContext
 * - NEVER manages its own state
 * - NEVER calls useNavigate() or handles routing
 * - Returns stable session state from context
 */
export function useAuth() {
  const context = useContext(AuthContext)
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider')
  }
  return context
}
</file>

<file path="migrations/001_cleanup_profiles.sql">
-- Migration: Clean up profiles table structure
-- Remove unused columns and ensure proper schema

-- Step 1: Remove unused columns
ALTER TABLE public.profiles
  DROP COLUMN IF EXISTS role_selected_at,
  DROP COLUMN IF EXISTS onboarding_completed_at;

-- Step 2: Ensure all required columns exist with correct types
-- Core fields
ALTER TABLE public.profiles
  ADD COLUMN IF NOT EXISTS display_name TEXT,
  ADD COLUMN IF NOT EXISTS avatar_url TEXT,
  ADD COLUMN IF NOT EXISTS country TEXT,
  ADD COLUMN IF NOT EXISTS city TEXT,
  ADD COLUMN IF NOT EXISTS birth_year INTEGER,
  ADD COLUMN IF NOT EXISTS updated_at TIMESTAMPTZ DEFAULT NOW();

-- Creator fields
ALTER TABLE public.profiles
  ADD COLUMN IF NOT EXISTS bio TEXT,
  ADD COLUMN IF NOT EXISTS creator_platforms JSONB DEFAULT '[]'::jsonb,
  ADD COLUMN IF NOT EXISTS followers_count INTEGER,
  ADD COLUMN IF NOT EXISTS avg_views INTEGER,
  ADD COLUMN IF NOT EXISTS content_categories JSONB DEFAULT '[]'::jsonb,
  ADD COLUMN IF NOT EXISTS success_collaboration_rate INTEGER CHECK (success_collaboration_rate >= 0 AND success_collaboration_rate <= 100),
  ADD COLUMN IF NOT EXISTS preferred_collaboration_type JSONB DEFAULT '[]'::jsonb;

-- Brand fields
ALTER TABLE public.profiles
  ADD COLUMN IF NOT EXISTS company_name TEXT,
  ADD COLUMN IF NOT EXISTS website TEXT,
  ADD COLUMN IF NOT EXISTS industry TEXT,
  ADD COLUMN IF NOT EXISTS company_size TEXT,
  ADD COLUMN IF NOT EXISTS campaign_budget_range TEXT,
  ADD COLUMN IF NOT EXISTS campaign_goal TEXT,
  ADD COLUMN IF NOT EXISTS target_platforms JSONB DEFAULT '[]'::jsonb,
  ADD COLUMN IF NOT EXISTS target_creator_size TEXT,
  ADD COLUMN IF NOT EXISTS contact_person_name TEXT,
  ADD COLUMN IF NOT EXISTS contact_person_phone TEXT;

-- Step 3: Remove old columns that are no longer needed
ALTER TABLE public.profiles
  DROP COLUMN IF EXISTS collaboration_expectation,
  DROP COLUMN IF EXISTS collaboration_success_rate,
  DROP COLUMN IF EXISTS budget,
  DROP COLUMN IF EXISTS contact_person_email;

-- Step 4: Create function to upsert profile on first login
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.profiles (id, role, onboarding_completed)
  VALUES (NEW.id, NULL, false)
  ON CONFLICT (id) DO NOTHING;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- Step 5: Create trigger (if not exists)
DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW
  EXECUTE FUNCTION public.handle_new_user();

-- Step 6: Update RLS policies
-- Users can read their own profile
DROP POLICY IF EXISTS "Users can read own profile" ON public.profiles;
CREATE POLICY "Users can read own profile"
  ON public.profiles
  FOR SELECT
  USING (auth.uid() = id);

-- Users can update their own profile
DROP POLICY IF EXISTS "Users can update own profile" ON public.profiles;
CREATE POLICY "Users can update own profile"
  ON public.profiles
  FOR UPDATE
  USING (auth.uid() = id);

-- Users can insert their own profile
DROP POLICY IF EXISTS "Users can insert own profile" ON public.profiles;
CREATE POLICY "Users can insert own profile"
  ON public.profiles
  FOR INSERT
  WITH CHECK (auth.uid() = id);

-- Step 7: Ensure updated_at is updated on change
CREATE OR REPLACE FUNCTION public.update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS update_profiles_updated_at ON public.profiles;
CREATE TRIGGER update_profiles_updated_at
  BEFORE UPDATE ON public.profiles
  FOR EACH ROW
  EXECUTE FUNCTION public.update_updated_at_column();
</file>

<file path="src/app/brandRoutes.tsx">
import { useLocation, Navigate } from 'react-router-dom'
import BrandDashboardLayout from '../components/brand/BrandDashboardLayout'
import BrandDashboard from '../pages/brand/dashboard/BrandDashboard'
import BrandCampaignAnalyticsPage from '../pages/brand/dashboard/BrandCampaignAnalyticsPage'
import CreatorDiscoveryPage from '../pages/brand/discovery/CreatorDiscoveryPage'
import CreateCampaignPage from '../pages/brand/campaigns/CreateCampaignPage'
import CampaignWorkspacePage from '../pages/brand/campaigns/CampaignWorkspacePage'
import ProposalInboxPage from '../pages/brand/deals/ProposalInboxPage'
import ComingSoonPage from '../pages/shared/ComingSoonPage'

export function BrandRoutes() {
  const location = useLocation()
  
  // Guard: All old /brand/* routes must go through AppGate
  return <Navigate to="/app" replace />

  if (location.pathname === '/brand/dashboard') {
    return (
      <BrandDashboardLayout>
        <BrandDashboard />
      </BrandDashboardLayout>
    )
  }

  if (location.pathname === '/brand/analytics') {
    return (
      <BrandDashboardLayout>
        <BrandCampaignAnalyticsPage />
      </BrandDashboardLayout>
    )
  }

  if (location.pathname === '/brand/discovery') {
    return (
      <BrandDashboardLayout>
        <CreatorDiscoveryPage />
      </BrandDashboardLayout>
    )
  }

  if (location.pathname === '/brand/campaigns/new') {
    return (
      <BrandDashboardLayout>
        <CreateCampaignPage />
      </BrandDashboardLayout>
    )
  }

  if (location.pathname.startsWith('/brand/campaigns')) {
    return (
      <BrandDashboardLayout>
        <CampaignWorkspacePage />
      </BrandDashboardLayout>
    )
  }

  if (location.pathname === '/brand/proposals' || location.pathname.startsWith('/brand/proposals')) {
    return (
      <BrandDashboardLayout>
        <ProposalInboxPage />
      </BrandDashboardLayout>
    )
  }

  if (location.pathname === '/brand/workspace') {
    return (
      <BrandDashboardLayout>
        <ComingSoonPage />
      </BrandDashboardLayout>
    )
  }

  if (location.pathname === '/brand/settings') {
    return (
      <BrandDashboardLayout>
        <ComingSoonPage />
      </BrandDashboardLayout>
    )
  }

  return (
    <BrandDashboardLayout>
      <ComingSoonPage />
    </BrandDashboardLayout>
  )
}
</file>

<file path="src/app/creatorRoutes.tsx">
import { useLocation, Navigate } from 'react-router-dom'
import CreatorDashboardLayout from '../components/creator/CreatorDashboardLayout'
import DashboardHome from '../pages/creator/dashboard/DashboardHome'
import AnalyticsPage from '../pages/creator/dashboard/AnalyticsPage'
import ProfilePage from '../pages/creator/profile/ProfilePage'
import SettingsPage from '../pages/creator/profile/SettingsPage'
import ServicesPage from '../pages/creator/services/ServicesPage'
import OpportunitiesPage from '../pages/creator/discovery/OpportunitiesPage'
import SubmitProposalPage from '../pages/creator/proposals/SubmitProposalPage'
import DealWorkspacePage from '../pages/creator/proposals/DealWorkspacePage'
import ComingSoonPage from '../pages/shared/ComingSoonPage'

export function CreatorRoutes() {
  const location = useLocation()
  
  // Guard: All old /creator/* routes must go through AppGate
  return <Navigate to="/app" replace />

  if (location.pathname === '/creator/dashboard') {
    return (
      <CreatorDashboardLayout>
        <DashboardHome />
      </CreatorDashboardLayout>
    )
  }

  if (location.pathname === '/creator/profile') {
    return (
      <CreatorDashboardLayout>
        <ProfilePage />
      </CreatorDashboardLayout>
    )
  }

  if (location.pathname === '/creator/settings') {
    return (
      <CreatorDashboardLayout>
        <SettingsPage />
      </CreatorDashboardLayout>
    )
  }

  if (location.pathname === '/creator/services') {
    return (
      <CreatorDashboardLayout>
        <ServicesPage />
      </CreatorDashboardLayout>
    )
  }

  if (location.pathname === '/creator/discovery') {
    return (
      <CreatorDashboardLayout>
        <OpportunitiesPage />
      </CreatorDashboardLayout>
    )
  }

  if (location.pathname === '/creator/proposals/new') {
    return (
      <CreatorDashboardLayout>
        <SubmitProposalPage />
      </CreatorDashboardLayout>
    )
  }

  if (location.pathname.startsWith('/creator/proposals')) {
    return (
      <CreatorDashboardLayout>
        <ComingSoonPage />
      </CreatorDashboardLayout>
    )
  }

  if (location.pathname === '/creator/workspace') {
    return (
      <CreatorDashboardLayout>
        <DealWorkspacePage />
      </CreatorDashboardLayout>
    )
  }

  if (location.pathname === '/creator/analytics') {
    return (
      <CreatorDashboardLayout>
        <AnalyticsPage />
      </CreatorDashboardLayout>
    )
  }

  return (
    <CreatorDashboardLayout>
      <ComingSoonPage />
    </CreatorDashboardLayout>
  )
}
</file>

<file path="src/app/dashboardRoutes.tsx">
import { Routes, Route, useParams, Navigate } from 'react-router-dom'
import { useAuth } from '../hooks/useAuth'
import { useProfile } from '../hooks/useProfile'
import CreatorDashboardLayout from '../components/creator/CreatorDashboardLayout'
import BrandDashboardLayout from '../components/brand/BrandDashboardLayout'
import DashboardHome from '../pages/creator/dashboard/DashboardHome'
import BrandDashboard from '../pages/brand/dashboard/BrandDashboard'
import AnalyticsPage from '../pages/creator/dashboard/AnalyticsPage'
import BrandCampaignAnalyticsPage from '../pages/brand/dashboard/BrandCampaignAnalyticsPage'
import ProfilePage from '../pages/creator/profile/ProfilePage'
import SettingsPage from '../pages/creator/profile/SettingsPage'
import ServicesPage from '../pages/creator/services/ServicesPage'
import OpportunitiesPage from '../pages/creator/discovery/OpportunitiesPage'
import SubmitProposalPage from '../pages/creator/proposals/SubmitProposalPage'
import DealWorkspacePage from '../pages/creator/proposals/DealWorkspacePage'
import CreatorDiscoveryPage from '../pages/brand/discovery/CreatorDiscoveryPage'
import CreateCampaignPage from '../pages/brand/campaigns/CreateCampaignPage'
import CampaignWorkspacePage from '../pages/brand/campaigns/CampaignWorkspacePage'
import ProposalInboxPage from '../pages/brand/deals/ProposalInboxPage'
import ComingSoonPage from '../pages/shared/ComingSoonPage'

/**
 * DashboardRoutes: Stable final destination routes
 * 
 * IMPORTANT: These routes are OUTSIDE AppGate and should NEVER redirect.
 * They are the final destination after onboarding is completed.
 * 
 * If user needs to complete onboarding or select role, they should go through /app
 * (which is handled by AppGate), not through dashboard redirects.
 * 
 * This component only:
 * 1. Checks authentication (redirects to login if not authenticated)
 * 2. Validates role matches URL
 * 3. Renders the appropriate dashboard
 * 
 * No onboarding checks, no role selection redirects - those are handled by AppGate at /app
 */
function DashboardRoutes() {
  const { role } = useParams<{ role: 'creator' | 'brand' }>()
  const { session, loading: authLoading } = useAuth()
  const { profile, loading: profileLoading } = useProfile(
    session?.user?.id,
    !!(session && session.access_token && session.user.email_confirmed_at)
  )

  if (authLoading || profileLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-[#6B7280]">Đang tải...</div>
      </div>
    )
  }

  // Basic auth check - if not authenticated, redirect to login
  if (!session || !profile) {
    return <Navigate to="/login" replace />
  }

  // Validate role in URL matches profile role
  // If mismatch, redirect to /app (AppGate will handle routing to correct dashboard)
  if (!role || (role !== 'creator' && role !== 'brand') || profile.role !== role) {
    return <Navigate to="/app" replace />
  }

  if (role === 'creator') {
    return (
      <Routes>
        <Route element={<CreatorDashboardLayout />}>
          <Route index element={<DashboardHome />} />
          <Route path="profile" element={<ProfilePage />} />
          <Route path="settings" element={<SettingsPage />} />
          <Route path="services" element={<ServicesPage />} />
          <Route path="discovery" element={<OpportunitiesPage />} />
          <Route path="proposals/new" element={<SubmitProposalPage />} />
          <Route path="proposals/*" element={<ComingSoonPage />} />
          <Route path="workspace" element={<DealWorkspacePage />} />
          <Route path="analytics" element={<AnalyticsPage />} />
          <Route path="*" element={<ComingSoonPage />} />
        </Route>
      </Routes>
    )
  }

  // Brand routes
  return (
    <Routes>
      <Route element={<BrandDashboardLayout />}>
        <Route index element={<BrandDashboard />} />
        <Route path="analytics" element={<BrandCampaignAnalyticsPage />} />
        <Route path="discovery" element={<CreatorDiscoveryPage />} />
        <Route path="campaigns/new" element={<CreateCampaignPage />} />
        <Route path="campaigns/*" element={<CampaignWorkspacePage />} />
        <Route path="proposals/*" element={<ProposalInboxPage />} />
        <Route path="workspace" element={<ComingSoonPage />} />
        <Route path="settings" element={<ComingSoonPage />} />
        <Route path="*" element={<ComingSoonPage />} />
      </Route>
    </Routes>
  )
}

export default DashboardRoutes
</file>

<file path="src/components/brand/BrandDashboardLayout.tsx">
import { Link, useLocation, useNavigate, Outlet } from 'react-router-dom'
import { 
  FaTh, 
  FaUser, 
  FaSearch,
  FaBullhorn,
  FaEnvelope,
  FaBriefcase,
  FaChartBar,
  FaCog,
  FaSignOutAlt,
} from 'react-icons/fa'
import { useAuth } from '../../hooks/useAuth'
import DashboardHeader from '../dashboard/DashboardHeader'

export default function BrandDashboardLayout() {
  const location = useLocation()
  const navigate = useNavigate()
  const { signOut } = useAuth()

  const mainNavItems = [
    { path: '', label: 'Bảng điều khiển', icon: FaTh },
    { path: 'discovery', label: 'Tìm kiếm Creator', icon: FaSearch },
    { path: 'campaigns', label: 'Chiến dịch', icon: FaBullhorn },
    { path: 'proposals', label: 'Hộp thư đề xuất', icon: FaEnvelope },
    { path: 'workspace', label: 'Không gian làm việc', icon: FaBriefcase },
    { path: 'analytics', label: 'Phân tích', icon: FaChartBar },
  ]

  const accountItems = [
    { path: 'settings', label: 'Cài đặt', icon: FaCog },
  ]

  const isActive = (path: string) => {
    if (path === '') {
      // Index route - only active when exactly at /dashboard/brand
      return location.pathname === '/dashboard/brand'
    }
    // For other paths, check if current pathname starts with the route
    return location.pathname === `/dashboard/brand/${path}` || location.pathname.startsWith(`/dashboard/brand/${path}/`)
  }

  return (
    <>
      <DashboardHeader />
      <div className="min-h-screen bg-gray-50 pt-16">
        <div className="flex">
          <aside className="fixed left-0 top-16 bottom-0 w-64 bg-white border-r border-gray-200 overflow-y-auto">
            <div className="p-4 h-full flex flex-col">
              <nav className="space-y-1">
                {mainNavItems.map((item) => {
                  const Icon = item.icon
                  const active = isActive(item.path)

                  return (
                    <Link
                      key={item.path}
                      to={item.path}
                      className={`
                        flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors
                        ${active 
                          ? 'bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white' 
                          : 'text-gray-700 hover:bg-gray-100'
                        }
                      `}
                    >
                      <Icon className="w-5 h-5" />
                      <span>{item.label}</span>
                    </Link>
                  )
                })}
              </nav>

              <div className="mt-auto pt-4 border-t border-gray-200">
                <nav className="space-y-1">
                  {accountItems.map((item) => {
                    const Icon = item.icon
                    const active = isActive(item.path)

                    return (
                      <Link
                        key={item.path}
                        to={item.path}
                        className={`
                          flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors
                          ${active
                            ? 'bg-gray-100 text-[#6366F1]'
                            : 'text-gray-700 hover:bg-gray-100'
                          }
                        `}
                      >
                        <Icon className="w-5 h-5" />
                        <span>{item.label}</span>
                      </Link>
                    )})}
                  <button
                    onClick={async () => {
                      await signOut()
                      // Redirect to landing page after sign out
                      navigate('/')
                    }}
                    className="flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-red-600 hover:bg-red-50 hover:text-red-700 transition-colors w-full text-left"
                  >
                    <FaSignOutAlt className="w-5 h-5 text-red-600" />
                    <span>Đăng xuất</span>
                  </button>
                </nav>
              </div>
            </div>
          </aside>

          <main className="flex-1 ml-64">
            <Outlet />
          </main>
        </div>
      </div>
    </>
  )
}
</file>

<file path="src/components/creator/CreatorDashboardLayout.tsx">
import { Link, useLocation, useNavigate, Outlet } from 'react-router-dom'
import { 
  FaTh, 
  FaUser, 
  FaDollarSign, 
  FaLightbulb, 
  FaFileAlt, 
  FaCheckCircle, 
  FaChartBar,
  FaCog,
  FaSignOutAlt,
} from 'react-icons/fa'
import { useAuth } from '../../hooks/useAuth'
import DashboardHeader from '../dashboard/DashboardHeader'

export default function CreatorDashboardLayout() {
  const location = useLocation()
  const navigate = useNavigate()
  const { signOut } = useAuth()

  const mainNavItems = [
    { path: '', label: 'Bảng điều khiển', icon: FaTh },
    { path: 'profile', label: 'Hồ sơ cá nhân', icon: FaUser },
    { path: 'services', label: 'Dịch vụ & Bảng giá', icon: FaDollarSign },
    { path: 'discovery', label: 'Cơ hội', icon: FaLightbulb },
    { path: 'proposals', label: 'Đề xuất', icon: FaFileAlt },
    { path: 'workspace', label: 'Trung tâm làm việc', icon: FaCheckCircle },
    { path: 'analytics', label: 'Phân tích', icon: FaChartBar },
  ]

  const accountItems = [
    { path: 'settings', label: 'Cài đặt', icon: FaCog },
  ]

  const isActive = (path: string) => {
    if (path === '') {
      // Index route - only active when exactly at /dashboard/creator
      return location.pathname === '/dashboard/creator'
    }
    // For other paths, check if current pathname starts with the route
    return location.pathname === `/dashboard/creator/${path}` || location.pathname.startsWith(`/dashboard/creator/${path}/`)
  }

  return (
    <>
      <DashboardHeader />
      <div className="min-h-screen bg-gray-50 pt-16">
        <div className="flex">
          <aside className="fixed left-0 top-16 bottom-0 w-64 bg-white border-r border-gray-200 overflow-y-auto">
            <div className="p-4 h-full flex flex-col">
              <nav className="space-y-1">
                {mainNavItems.map((item) => {
                  const Icon = item.icon
                  const active = isActive(item.path)

                  return (
                    <Link
                      key={item.path}
                      to={item.path}
                      className={`
                        flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors
                        ${active 
                          ? 'bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white' 
                          : 'text-gray-700 hover:bg-gray-100'
                        }
                      `}
                    >
                      <Icon className="w-5 h-5" />
                      <span>{item.label}</span>
                    </Link>
                  )
                })}
              </nav>

              <div className="mt-auto pt-4 border-t border-gray-200">
                <nav className="space-y-1">
                  {accountItems.map((item) => {
                    const Icon = item.icon
                    const active = isActive(item.path)

                    return (
                      <Link
                        key={item.path}
                        to={item.path}
                        className={`
                          flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors
                          ${active
                            ? 'bg-gray-100 text-[#6366F1]'
                            : 'text-gray-700 hover:bg-gray-100'
                          }
                        `}
                      >
                        <Icon className="w-5 h-5" />
                        <span>{item.label}</span>
                      </Link>
                    )})}
                  <button
                    onClick={async () => {
                      await signOut()
                      // Redirect to landing page after sign out
                      navigate('/')
                    }}
                    className="flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-red-600 hover:bg-red-50 hover:text-red-700 transition-colors w-full text-left"
                  >
                    <FaSignOutAlt className="w-5 h-5 text-red-600" />
                    <span>Đăng xuất</span>
                  </button>
                </nav>
              </div>
            </div>
          </aside>

          <main className="flex-1 ml-64">
            <Outlet />
          </main>
        </div>
      </div>
    </>
  )
}
</file>

<file path="src/components/shared/NotificationModal.tsx">
import { useState, useEffect } from 'react'
import { FaCheck, FaCheckCircle, FaTimes } from 'react-icons/fa'

// Mock notification data - replace with real API data later
interface Notification {
  id: string
  type: 'proposal' | 'booking' | 'approval' | 'comment' | 'campaign' | 'profile' | 'collaboration'
  avatar: string
  content: string
  time: string
  timeAgo: string
  read: boolean
  ctaLabel: string
  ctaAction?: () => void
  section: 'new' | 'thisWeek' | 'earlier'
}

const MOCK_NOTIFICATIONS: Notification[] = [
  {
    id: '1',
    type: 'proposal',
    avatar: 'https://ui-avatars.com/api/?name=Brand+X&background=6366F1&color=fff',
    content: 'Brand X đã gửi cho bạn một đề xuất mới cho đề xuất Winter Car của họ',
    time: '2025-01-20T10:00:00Z',
    timeAgo: '5 phút trước',
    read: false,
    ctaLabel: 'Xem đề xuất',
    section: 'new'
  },
  {
    id: '2',
    type: 'booking',
    avatar: 'https://ui-avatars.com/api/?name=Sarah+Chen&background=EC4899&color=fff',
    content: 'Sarah Chen đã chấp nhận yêu cầu đặt lịch của bạn cho buổi chụp ảnh',
    time: '2025-01-20T09:00:00Z',
    timeAgo: '1 giờ trước',
    read: false,
    ctaLabel: 'Quản lý lịch',
    section: 'new'
  },
  {
    id: '3',
    type: 'profile',
    avatar: 'https://ui-avatars.com/api/?name=Profile&background=8B5CF6&color=fff',
    content: 'Hồ sơ của bạn đã đạt 1000 lượt xem trong tuần này! Hãy tiếp tục phát huy.',
    time: '2025-01-20T07:00:00Z',
    timeAgo: '3 giờ trước',
    read: false,
    ctaLabel: '',
    section: 'new'
  },
  {
    id: '4',
    type: 'approval',
    avatar: 'https://ui-avatars.com/api/?name=Alpha+Corp&background=6366F1&color=fff',
    content: 'Alpha Corp cần bạn phê duyệt bản nháp mới nhất cho "Project Zenith"',
    time: '2025-01-19T15:00:00Z',
    timeAgo: 'Hôm qua',
    read: true,
    ctaLabel: 'Phê duyệt bản nháp',
    section: 'thisWeek'
  },
  {
    id: '5',
    type: 'comment',
    avatar: 'https://ui-avatars.com/api/?name=Emily+White&background=EC4899&color=fff',
    content: 'Emily White đã bình luận về bản nháp bạn vừa tải lên',
    time: '2025-01-19T10:00:00Z',
    timeAgo: 'Hôm qua',
    read: true,
    ctaLabel: 'Xem bình luận',
    section: 'thisWeek'
  },
  {
    id: '6',
    type: 'campaign',
    avatar: 'https://ui-avatars.com/api/?name=Global+Brands&background=6366F1&color=fff',
    content: 'Global Brands Inc. đã đăng cơ hội chiến dịch mới: "Summer Collec Campaign"',
    time: '2025-01-18T14:00:00Z',
    timeAgo: '2 ngày trước',
    read: true,
    ctaLabel: 'Xem chiến dịch',
    section: 'thisWeek'
  },
  {
    id: '7',
    type: 'approval',
    avatar: 'https://ui-avatars.com/api/?name=Creative+Studio&background=8B5CF6&color=fff',
    content: 'Creative Studio đã phê duyệt sản phẩm của bạn cho "Animated Explainer Project"',
    time: '2025-01-17T11:00:00Z',
    timeAgo: '3 ngày trước',
    read: true,
    ctaLabel: 'Xem thỏa thuận',
    section: 'thisWeek'
  },
  {
    id: '8',
    type: 'collaboration',
    avatar: 'https://ui-avatars.com/api/?name=Jessica+Lee&background=EC4899&color=fff',
    content: 'Jessica Lee đã mời bạn cộng tác trong "Brand Launch Event"',
    time: '2025-01-13T09:00:00Z',
    timeAgo: '1 tuần trước',
    read: true,
    ctaLabel: 'Chấp nhận lời mời',
    section: 'earlier'
  },
]

const FILTER_TABS = [
  { id: 'all', label: 'Tất cả' },
  { id: 'unread', label: 'Chưa đọc' },
  { id: 'proposals', label: 'Đề xuất' },
  { id: 'bookings', label: 'Đặt lịch' },
  { id: 'drafts', label: 'Bản nháp' },
  { id: 'approvals', label: 'Phê duyệt' },
] as const

type FilterTab = typeof FILTER_TABS[number]['id']

interface NotificationModalProps {
  isOpen: boolean
  onClose: () => void
}

export default function NotificationModal({ isOpen, onClose }: NotificationModalProps) {
  const [activeFilter, setActiveFilter] = useState<FilterTab>('all')
  const [notifications, setNotifications] = useState<Notification[]>(MOCK_NOTIFICATIONS)

  // Handle Esc key to close modal
  useEffect(() => {
    if (!isOpen) return

    const handleEscKey = (event: KeyboardEvent) => {
      if (event.key === 'Escape') {
        onClose()
      }
    }

    document.addEventListener('keydown', handleEscKey)
    return () => {
      document.removeEventListener('keydown', handleEscKey)
    }
  }, [isOpen, onClose])

  const unreadCount = notifications.filter(n => !n.read).length

  const filteredNotifications = notifications.filter((notification) => {
    if (activeFilter === 'all') return true
    if (activeFilter === 'unread') return !notification.read
    if (activeFilter === 'proposals') return notification.type === 'proposal'
    if (activeFilter === 'bookings') return notification.type === 'booking'
    if (activeFilter === 'drafts') return notification.type === 'comment'
    if (activeFilter === 'approvals') return notification.type === 'approval'
    return true
  })

  const markAllAsRead = () => {
    setNotifications(prev => prev.map(n => ({ ...n, read: true })))
  }

  const markAsRead = (id: string) => {
    setNotifications(prev => prev.map(n => n.id === id ? { ...n, read: true } : n))
  }

  const newNotifications = filteredNotifications.filter(n => n.section === 'new')
  const thisWeekNotifications = filteredNotifications.filter(n => n.section === 'thisWeek')
  const earlierNotifications = filteredNotifications.filter(n => n.section === 'earlier')

  if (!isOpen) return null

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50" onClick={onClose}>
      <div 
        className="bg-white rounded-xl shadow-2xl w-[1000px] h-[80vh] flex flex-col mx-4"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Modal Header - Sticky */}
        <div className="flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0">
          <h2 className="text-xl font-bold text-gray-900">Thông báo</h2>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
          >
            <FaTimes className="w-5 h-5 text-gray-500" />
          </button>
        </div>

        {/* Filter Tabs - Sticky */}
        <div className="flex items-center gap-2 p-4 border-b border-gray-200 flex-shrink-0 overflow-x-auto">
          {FILTER_TABS.map((tab) => (
            <button
              key={tab.id}
              onClick={() => setActiveFilter(tab.id)}
              className={`
                px-4 py-2 rounded-full text-sm font-medium transition-colors whitespace-nowrap flex items-center gap-2
                ${activeFilter === tab.id
                  ? 'bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white'
                  : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50'
                }
              `}
            >
              <span>{tab.label}</span>
              {tab.id === 'unread' && unreadCount > 0 && (
                <span className={`
                  w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold
                  ${activeFilter === tab.id 
                    ? 'bg-white text-[#6366F1]' 
                    : 'bg-[#6366F1] text-white'
                  }
                `}>
                  {unreadCount}
                </span>
              )}
            </button>
          ))}

          {/* Mark all as read button */}
          <button
            onClick={markAllAsRead}
            className="ml-auto flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:text-[#6366F1] transition-colors border-2 border-gray-300 rounded-lg hover:border-[#6366F1] hover:bg-gray-50 active:bg-gray-100 whitespace-nowrap"
          >
            <FaCheckCircle className="w-4 h-4" />
            <span>Đánh dấu tất cả là đã đọc</span>
          </button>
        </div>

        {/* Scrollable Notification List */}
        <div className="flex-1 overflow-y-auto p-4">
          <div className="space-y-6">
            {/* New Section */}
            {newNotifications.length > 0 && (
              <div>
                <h3 className="text-xs font-semibold text-gray-500 mb-3 uppercase tracking-wide">Mới</h3>
                <div className="space-y-3">
                  {newNotifications.map((notification) => (
                    <NotificationCard
                      key={notification.id}
                      notification={notification}
                      onMarkAsRead={() => markAsRead(notification.id)}
                    />
                  ))}
                </div>
              </div>
            )}

            {/* This Week Section */}
            {thisWeekNotifications.length > 0 && (
              <div>
                <h3 className="text-xs font-semibold text-gray-500 mb-3 uppercase tracking-wide">Tuần này</h3>
                <div className="space-y-3">
                  {thisWeekNotifications.map((notification) => (
                    <NotificationCard
                      key={notification.id}
                      notification={notification}
                      onMarkAsRead={() => markAsRead(notification.id)}
                    />
                  ))}
                </div>
              </div>
            )}

            {/* Earlier Section */}
            {earlierNotifications.length > 0 && (
              <div>
                <h3 className="text-xs font-semibold text-gray-500 mb-3 uppercase tracking-wide">Trước đó</h3>
                <div className="space-y-3">
                  {earlierNotifications.map((notification) => (
                    <NotificationCard
                      key={notification.id}
                      notification={notification}
                      onMarkAsRead={() => markAsRead(notification.id)}
                    />
                  ))}
                </div>
              </div>
            )}

            {/* Empty State */}
            {filteredNotifications.length === 0 && (
              <div className="text-center py-12">
                <p className="text-gray-500">Không có thông báo nào</p>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  )
}

interface NotificationCardProps {
  notification: Notification
  onMarkAsRead: () => void
}

function NotificationCard({ notification, onMarkAsRead }: NotificationCardProps) {
  return (
    <div
      className={`
        flex items-start gap-4 p-4 rounded-xl border transition-colors
        ${notification.read 
          ? 'bg-white border-gray-200' 
          : 'bg-blue-50 border-blue-200'
        }
        hover:shadow-md
      `}
    >
      {/* Avatar */}
      <img
        src={notification.avatar}
        alt=""
        className="w-12 h-12 rounded-full flex-shrink-0"
      />

      {/* Content */}
      <div className="flex-1 min-w-0">
        <p className={`text-sm ${notification.read ? 'text-gray-700' : 'text-gray-900 font-medium'}`}>
          {notification.content}
        </p>
        <p className="text-xs text-gray-500 mt-1">{notification.timeAgo}</p>
      </div>

      {/* Actions */}
      <div className="flex items-start gap-3 flex-shrink-0">
        {notification.ctaLabel && (
          <button
            onClick={onMarkAsRead}
            className="px-4 py-2 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white text-sm font-medium rounded-lg hover:opacity-90 transition-opacity whitespace-nowrap"
          >
            {notification.ctaLabel}
          </button>
        )}
        <button
          onClick={onMarkAsRead}
          className={`
            p-2 rounded-lg transition-colors
            ${notification.read 
              ? 'text-gray-400 hover:bg-gray-100' 
              : 'text-[#6366F1] hover:bg-blue-100'
            }
          `}
          title={notification.read ? 'Đã đọc' : 'Đánh dấu là đã đọc'}
        >
          <FaCheck className="w-4 h-4" />
        </button>
      </div>
    </div>
  )
}
</file>

<file path="src/components/shared/ScrollToTop.tsx">
import { useEffect } from 'react'
import { useLocation } from 'react-router-dom'

/**
 * ScrollToTop component that scrolls to top on every route change.
 * This ensures that navigating between pages always starts at the top.
 */
export default function ScrollToTop() {
  const { pathname } = useLocation()

  useEffect(() => {
    window.scrollTo(0, 0)
  }, [pathname])

  return null
}
</file>

<file path="src/components/shared/Toast.tsx">
import { useEffect } from 'react'

interface ToastProps {
  message: string
  type: 'success' | 'error'
  onClose: () => void
  duration?: number
}

export default function Toast({ message, type, onClose, duration = 3000 }: ToastProps) {
  useEffect(() => {
    const timer = setTimeout(() => {
      onClose()
    }, duration)

    return () => clearTimeout(timer)
  }, [duration, onClose])

  return (
    <div className="fixed top-4 right-4 z-50" style={{ animation: 'slideIn 0.3s ease-out' }}>
      <div
        className={`px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 min-w-[300px] ${
          type === 'success'
            ? 'bg-green-50 border border-green-200 text-green-800'
            : 'bg-red-50 border border-red-200 text-red-800'
        }`}
      >
        {type === 'success' ? (
          <svg className="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        ) : (
          <svg className="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        )}
        <span className="text-sm font-medium">{message}</span>
      </div>
    </div>
  )
}
</file>

<file path="src/components/shared/UpgradePlanModal.tsx">
import { useState, useEffect } from 'react'
import { FaTimes, FaCheck } from 'react-icons/fa'

interface UpgradePlanModalProps {
  isOpen: boolean
  onClose: () => void
  currentPlan?: 'free' | 'pro' | 'business'
}

interface Plan {
  id: 'free' | 'pro' | 'business'
  name: string
  monthlyPrice: number
  yearlyPrice: number
  features: string[]
  ctaText: string
  isCurrent?: boolean
}

const PLANS: Plan[] = [
  {
    id: 'free',
    name: 'Miễn phí',
    monthlyPrice: 0,
    yearlyPrice: 0,
    features: [
      'Tạo chiến dịch cơ bản',
      'Tối đa 1 hợp tác đang diễn ra',
      'Hiển thị hồ sơ công khai',
      'Phân tích cơ bản',
      'Nhắn tin trực tiếp với thương hiệu',
      'Hỗ trợ tiêu chuẩn',
    ],
    ctaText: 'Gói hiện tại',
  },
  {
    id: 'pro',
    name: 'Pro',
    monthlyPrice: 20,
    yearlyPrice: 192,
    features: [
      'Tạo chiến dịch không giới hạn',
      'Tối đa 10 hợp tác đang diễn ra',
      'Tùy chỉnh hồ sơ nâng cao',
      'Phân tích & báo cáo nâng cao',
      'Nhắn tin trực tiếp với thương hiệu',
      'Ưu tiên hỗ trợ qua email',
    ],
    ctaText: 'Nâng cấp lên Pro',
  },
  {
    id: 'business',
    name: 'Business',
    monthlyPrice: 79,
    yearlyPrice: 758,
    features: [
      'Tạo chiến dịch không giới hạn',
      'Hợp tác đang diễn ra không giới hạn',
      'Quản lý tài khoản chuyên dụng',
      'Truy cập API & tích hợp',
      'Công cụ cộng tác nhóm',
      'Hỗ trợ 24/7 qua điện thoại & chat',
    ],
    ctaText: 'Nâng cấp lên Business',
  },
]

export default function UpgradePlanModal({ isOpen, onClose, currentPlan = 'free' }: UpgradePlanModalProps) {
  const [billingCycle, setBillingCycle] = useState<'monthly' | 'yearly'>('monthly')

  useEffect(() => {
    if (!isOpen) return

    const handleEscKey = (event: KeyboardEvent) => {
      if (event.key === 'Escape') {
        onClose()
      }
    }

    document.addEventListener('keydown', handleEscKey)
    return () => {
      document.removeEventListener('keydown', handleEscKey)
    }
  }, [isOpen, onClose])

  const handleUpgrade = (planId: 'pro' | 'business') => {
    // TODO: Implement upgrade flow
    console.log(`Upgrade to ${planId} - ${billingCycle}`)
    onClose()
  }

  const formatPrice = (price: number) => {
    if (price === 0) return '0₫'
    return `${price.toLocaleString('vi-VN')}$`
  }

  const getYearlySavings = (monthlyPrice: number) => {
    if (monthlyPrice === 0) return 0
    const yearlyTotal = monthlyPrice * 12
    const yearlyPrice = yearlyTotal * 0.8
    return Math.round(yearlyTotal - yearlyPrice)
  }

  const getYearlySavingsText = (monthlyPrice: number) => {
    const savings = getYearlySavings(monthlyPrice)
    if (savings === 0) return ''
    return `Tiết kiệm ${savings.toLocaleString('vi-VN')}$`
  }

  if (!isOpen) return null

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50" onClick={onClose}>
      <div
        className="bg-white rounded-xl shadow-2xl w-full max-w-5xl mx-4 max-h-[90vh] overflow-y-auto"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Modal Header */}
        <div className="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
          <div>
            <h2 className="text-2xl font-bold text-gray-900">Nâng cấp gói đăng ký</h2>
            <p className="text-sm text-gray-600 mt-1">
              Mở khóa các tính năng mạnh mẽ và mở rộng cơ hội hợp tác với ALINO.
            </p>
          </div>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
          >
            <FaTimes className="w-5 h-5 text-gray-500" />
          </button>
        </div>

        {/* Billing Toggle */}
        <div className="px-6 py-4 border-b border-gray-200">
          <div className="flex items-center gap-4">
            <span className="text-sm font-medium text-gray-700">Thanh toán:</span>
            <div className="flex items-center gap-2 bg-gray-100 rounded-lg p-1">
              <button
                onClick={() => setBillingCycle('monthly')}
                className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${
                  billingCycle === 'monthly'
                    ? 'bg-white text-gray-900 shadow-sm'
                    : 'text-gray-600 hover:text-gray-900'
                }`}
              >
                Theo tháng
              </button>
              <button
                onClick={() => setBillingCycle('yearly')}
                className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${
                  billingCycle === 'yearly'
                    ? 'bg-white text-gray-900 shadow-sm'
                    : 'text-gray-600 hover:text-gray-900'
                }`}
              >
                Theo năm
                {billingCycle === 'yearly' && (
                  <span className="ml-1 text-xs text-green-600">(Tiết kiệm 20%)</span>
                )}
              </button>
            </div>
          </div>
        </div>

        {/* Plans Grid */}
        <div className="p-6">
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            {PLANS.map((plan) => {
              const isCurrent = plan.id === currentPlan
              const price = billingCycle === 'monthly' ? plan.monthlyPrice : plan.yearlyPrice
              const savings = billingCycle === 'yearly' && plan.monthlyPrice > 0
                ? getYearlySavings(plan.monthlyPrice)
                : 0

              return (
                <div
                  key={plan.id}
                  className={`relative bg-white rounded-xl border-2 p-6 ${
                    isCurrent
                      ? 'border-[#6366F1] bg-purple-50/30'
                      : 'border-gray-200 hover:border-gray-300'
                  }`}
                >
                  {/* Current Plan Badge */}
                  {isCurrent && (
                    <div className="absolute -top-3 left-1/2 transform -translate-x-1/2">
                      <span className="bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white text-xs font-semibold px-3 py-1 rounded-full">
                        Gói hiện tại
                      </span>
                    </div>
                  )}

                  {/* Plan Name & Price Header */}
                  <div className="flex items-start justify-between mb-4">
                    <h3 className="text-xl font-bold text-gray-900">{plan.name}</h3>
                    <div className="text-right">
                      <div className="flex items-baseline gap-1">
                        <span className="text-2xl font-bold text-gray-900">
                          {formatPrice(price)}
                        </span>
                        <span className="text-xs text-gray-600">
                          / {billingCycle === 'monthly' ? 'tháng' : 'năm'}
                        </span>
                      </div>
                      {billingCycle === 'yearly' && savings > 0 && (
                        <p className="text-xs text-green-600 mt-0.5">
                          {getYearlySavingsText(plan.monthlyPrice)}
                        </p>
                      )}
                    </div>
                  </div>

                  {/* Features List */}
                  <ul className="space-y-3 mb-6">
                    {plan.features.map((feature, index) => (
                      <li key={index} className="flex items-start gap-2">
                        <FaCheck className="w-4 h-4 text-green-600 flex-shrink-0 mt-0.5" />
                        <span className="text-sm text-gray-700">{feature}</span>
                      </li>
                    ))}
                  </ul>

                  {/* CTA Button */}
                  {isCurrent ? (
                    <button
                      disabled
                      className="w-full px-4 py-2.5 rounded-lg font-medium text-[#6366F1] border-2 border-[#6366F1] bg-white opacity-50 cursor-not-allowed"
                    >
                      {plan.ctaText}
                    </button>
                  ) : (
                    <button
                      onClick={() => handleUpgrade(plan.id as 'pro' | 'business')}
                      className="w-full px-4 py-2.5 rounded-lg font-medium text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] hover:opacity-90 transition-opacity"
                    >
                      {plan.ctaText}
                    </button>
                  )}
                </div>
              )
            })}
          </div>
        </div>

        {/* Footer Note */}
        <div className="px-6 py-4 border-t border-gray-200 bg-gray-50">
          <p className="text-xs text-gray-600 text-center">
            Tất cả gói đều có thể hủy bất cứ lúc nào. Thanh toán được xử lý an toàn.
          </p>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/lib/supabase.ts">
import { createClient } from '@supabase/supabase-js'
import type { SupabaseClient } from '@supabase/supabase-js'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables')
}

let supabaseClient: SupabaseClient | null = null

export function getSupabase() {
  if (!supabaseClient) {
    supabaseClient = createClient(supabaseUrl, supabaseAnonKey, {
      auth: {
        persistSession: true,
        autoRefreshToken: true,
        detectSessionInUrl: true,
      },
    })
  }

  return supabaseClient
}
</file>

<file path="src/pages/brand/campaigns/CampaignWorkspacePage.tsx">
import { useState } from 'react'
import { FaEdit, FaCheck, FaRedo, FaFileAlt, FaDownload, FaPaperPlane, FaEllipsisV } from 'react-icons/fa'
import BrandDashboardLayout from '../../../components/brand/BrandDashboardLayout'

interface Creator {
  id: string
  name: string
  avatar: string
  status: string
  progress: number
}

interface FeedbackMessage {
  id: string
  sender: string
  senderAvatar: string
  message: string
  timestamp: string
}

const MOCK_CREATORS: Creator[] = [
  {
    id: '1',
    name: 'Ella Creative',
    avatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop&crop=face',
    status: 'Final Review',
    progress: 100,
  },
  {
    id: '2',
    name: 'Mark Media',
    avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face',
    status: 'Drafting Content',
    progress: 75,
  },
  {
    id: '3',
    name: 'Sophia Social',
    avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop&crop=face',
    status: 'Awaiting Feedback',
    progress: 50,
  },
  {
    id: '4',
    name: 'Liam Lens',
    avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face',
    status: 'Planning Phase',
    progress: 25,
  },
]

const MOCK_FEEDBACK: FeedbackMessage[] = [
  {
    id: '1',
    sender: 'Jane Smith',
    senderAvatar: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=100&h=100&fit=crop&crop=face',
    message: 'Great work on the visuals! Just a small tweak needed: could we adjust the color palette slightly to better align with our brand guidelines? Also, the call-to-action buttons could be more prominent.',
    timestamp: '2 hours ago',
  },
  {
    id: '2',
    sender: 'Ella Creative',
    senderAvatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop&crop=face',
    message: 'Thanks for the feedback! I can definitely adjust the colors. For the CTA buttons, would you prefer a lighter blue variant for the primary actions?',
    timestamp: '1 hour ago',
  },
  {
    id: '3',
    sender: 'Jane Smith',
    senderAvatar: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=100&h=100&fit=crop&crop=face',
    message: 'Yes, the lighter blue variant would be perfect! Also, let\'s make sure the text contrast is strong enough for accessibility.',
    timestamp: '30 minutes ago',
  },
]

export default function CampaignWorkspacePage() {
  const [feedbackMessage, setFeedbackMessage] = useState('')
  const [feedback, setFeedback] = useState<FeedbackMessage[]>(MOCK_FEEDBACK)

  const handleSendFeedback = () => {
    if (feedbackMessage.trim()) {
      const newMessage: FeedbackMessage = {
        id: Date.now().toString(),
        sender: 'Jane Smith',
        senderAvatar: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=100&h=100&fit=crop&crop=face',
        message: feedbackMessage,
        timestamp: 'Just now',
      }
      setFeedback([...feedback, newMessage])
      setFeedbackMessage('')
    }
  }

  return (
    <BrandDashboardLayout>
      <div className="bg-gray-50 min-h-screen py-8 px-6">
        <div className="max-w-7xl mx-auto">
          <div className="flex items-center justify-between mb-8">
            <h1 className="text-3xl font-bold text-gray-900">Summer Influencer Outreach 2024</h1>
            <div className="flex items-center gap-4">
              <span className="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">
                Active
              </span>
              <button className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                <FaEdit className="w-4 h-4" />
                <span>Edit Campaign</span>
              </button>
              <button className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white rounded-lg hover:opacity-90 transition-opacity">
                <span>Invite Creator</span>
              </button>
              <button className="p-2 text-gray-600 hover:text-gray-900">
                <FaEllipsisV className="w-5 h-5" />
              </button>
            </div>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <div className="lg:col-span-2 space-y-6">
              <div className="bg-white rounded-xl border border-gray-200 p-6">
                <h2 className="text-lg font-semibold text-gray-900 mb-4">Campaign Timeline</h2>
                <div className="flex items-center gap-4">
                  {MOCK_CREATORS.slice(0, 2).map((creator) => (
                    <div key={creator.id} className="flex flex-col items-center">
                      <div className="relative">
                        <img
                          src={creator.avatar}
                          alt={creator.name}
                          className="w-16 h-16 rounded-full object-cover"
                        />
                        {creator.progress === 100 && (
                          <div className="absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                            <FaCheck className="w-3 h-3 text-white" />
                          </div>
                        )}
                      </div>
                      <p className="text-sm font-medium text-gray-900 mt-2">{creator.name}</p>
                      <p className="text-xs text-gray-500">{creator.progress}%</p>
                    </div>
                  ))}
                </div>
              </div>

              <div className="bg-white rounded-xl border border-gray-200 p-6">
                <h2 className="text-lg font-semibold text-gray-900 mb-4">Creator Progress</h2>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                  {MOCK_CREATORS.map((creator) => (
                    <div key={creator.id} className="border border-gray-200 rounded-lg p-4">
                      <div className="flex flex-col items-center text-center">
                        <img
                          src={creator.avatar}
                          alt={creator.name}
                          className="w-12 h-12 rounded-full object-cover mb-2"
                        />
                        <h3 className="font-medium text-gray-900 text-sm mb-1">{creator.name}</h3>
                        <p className="text-xs text-gray-600 mb-2">{creator.status}</p>
                        <div className="w-full bg-gray-200 rounded-full h-2 mb-2">
                          <div
                            className="bg-gradient-to-r from-[#6366F1] to-[#EC4899] h-2 rounded-full"
                            style={{ width: `${creator.progress}%` }}
                          />
                        </div>
                        <button className="text-xs text-[#6366F1] hover:text-[#EC4899] transition-colors">
                          View Deal Details
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              <div className="bg-white rounded-xl border border-gray-200 p-6">
                <h2 className="text-lg font-semibold text-gray-900 mb-4">Current Draft from Ella Creative</h2>
                <div className="border border-gray-200 rounded-lg overflow-hidden mb-3">
                  <img
                    src="https://images.unsplash.com/photo-1505142468610-359e7d316be0?w=800&h=600&fit=crop"
                    alt="Draft preview"
                    className="w-full h-64 object-cover"
                  />
                </div>
                <div className="flex items-center justify-between">
                  <span className="text-sm text-gray-700">Summer_Campaign_Visuals_v3.png</span>
                  <button className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                    <FaDownload className="w-4 h-4" />
                    <span>Download</span>
                  </button>
                </div>
              </div>
            </div>

            <div className="lg:col-span-1">
              <div className="bg-white rounded-xl border border-gray-200 p-6 sticky top-24">
                <h2 className="text-lg font-semibold text-gray-900 mb-4">Campaign Details</h2>
                <div className="space-y-3 mb-6">
                  <div>
                    <span className="text-sm text-gray-600">Status:</span>
                    <p className="text-sm font-medium text-gray-900">Active</p>
                  </div>
                  <div>
                    <span className="text-sm text-gray-600">Brand:</span>
                    <p className="text-sm font-medium text-gray-900">ForgeCo Brands</p>
                  </div>
                  <div>
                    <span className="text-sm text-gray-600">Campaign ID:</span>
                    <p className="text-sm font-medium text-gray-900">CAMP-7890</p>
                  </div>
                  <div>
                    <span className="text-sm text-gray-600">Budget:</span>
                    <p className="text-sm font-medium text-gray-900">$15,000</p>
                  </div>
                  <div>
                    <span className="text-sm text-gray-600">Deadline:</span>
                    <p className="text-sm font-medium text-gray-900">2024-08-31</p>
                  </div>
                </div>
                <div className="space-y-2">
                  <button className="w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white rounded-lg hover:opacity-90 transition-opacity">
                    <FaCheck className="w-4 h-4" />
                    <span>Approve Final Deliverables</span>
                  </button>
                  <button className="w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                    <FaRedo className="w-4 h-4" />
                    <span>Request Revisions</span>
                  </button>
                  <button className="w-full flex items-center justify-center gap-2 px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                    <FaFileAlt className="w-4 h-4" />
                    <span>View Campaign Brief</span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div className="bg-white rounded-xl border border-gray-200 p-6">
            <h2 className="text-lg font-semibold text-gray-900 mb-4">Feedback Thread</h2>
            <div className="space-y-4 mb-6 max-h-96 overflow-y-auto">
              {feedback.map((message) => (
                <div key={message.id} className="flex gap-3">
                  <img
                    src={message.senderAvatar}
                    alt={message.sender}
                    className="w-10 h-10 rounded-full object-cover flex-shrink-0"
                  />
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-1">
                      <span className="font-medium text-gray-900 text-sm">{message.sender}</span>
                      <span className="text-xs text-gray-500">{message.timestamp}</span>
                    </div>
                    <p className="text-sm text-gray-700">{message.message}</p>
                  </div>
                </div>
              ))}
            </div>
            <div className="flex gap-2">
              <input
                type="text"
                value={feedbackMessage}
                onChange={(e) => setFeedbackMessage(e.target.value)}
                onKeyPress={(e) => {
                  if (e.key === 'Enter') {
                    handleSendFeedback()
                  }
                }}
                placeholder="Write your feedback..."
                className="flex-1 px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#6366F1] focus:border-transparent"
              />
              <button
                onClick={handleSendFeedback}
                className="px-4 py-2.5 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white rounded-lg hover:opacity-90 transition-opacity"
              >
                <FaPaperPlane className="w-5 h-5" />
              </button>
            </div>
          </div>
        </div>
      </div>
    </BrandDashboardLayout>
  )
}
</file>

<file path="src/pages/brand/campaigns/CreateCampaignPage.tsx">
import { useState } from 'react'
import { useNavigate } from 'react-router-dom'
import BrandDashboardLayout from '../../../components/brand/BrandDashboardLayout'

export default function CreateCampaignPage() {
  const navigate = useNavigate()
  const [formData, setFormData] = useState({
    campaignName: 'Influencer Marketing Initiative',
    campaignGoal: 'Increase brand awareness by 20% over 3 months',
    budgetRange: '',
    deadline: '',
    visibility: 'open',
    collaborators: ['collaborator@example.com'],
  })
  const [newCollaborator, setNewCollaborator] = useState('')
  const [errors, setErrors] = useState<Record<string, string>>({})

  const validate = () => {
    const newErrors: Record<string, string> = {}
    if (!formData.campaignName.trim()) {
      newErrors.campaignName = 'Campaign name is required'
    }
    if (!formData.campaignGoal.trim()) {
      newErrors.campaignGoal = 'Campaign goal is required'
    }
    if (!formData.budgetRange.trim()) {
      newErrors.budgetRange = 'Budget range is required'
    }
    if (!formData.deadline) {
      newErrors.deadline = 'Deadline is required'
    }
    setErrors(newErrors)
    return Object.keys(newErrors).length === 0
  }

  const handleAddCollaborator = () => {
    if (newCollaborator.trim() && !formData.collaborators.includes(newCollaborator.trim())) {
      setFormData({
        ...formData,
        collaborators: [...formData.collaborators, newCollaborator.trim()],
      })
      setNewCollaborator('')
    }
  }

  const handleRemoveCollaborator = (email: string) => {
    setFormData({
      ...formData,
      collaborators: formData.collaborators.filter(c => c !== email),
    })
  }

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault()
    if (validate()) {
      setTimeout(() => {
        navigate('/brand/dashboard')
      }, 500)
    }
  }

  return (
    <BrandDashboardLayout>
      <div className="bg-gray-50 min-h-screen py-8 px-6">
        <div className="max-w-4xl mx-auto">
          <div className="mb-8">
            <h1 className="text-3xl font-bold text-gray-900 mb-2">Create New Campaign</h1>
            <p className="text-gray-600">
              Define your campaign details, budget, and target audience to launch a successful initiative.
            </p>
          </div>

          <form onSubmit={handleSubmit}>
            <div className="space-y-6">
              <div className="bg-white rounded-xl border border-gray-200 p-6">
                <h2 className="text-xl font-semibold text-gray-900 mb-6">Campaign Details</h2>
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Campaign Name *
                    </label>
                    <input
                      type="text"
                      value={formData.campaignName}
                      onChange={(e) => setFormData({ ...formData, campaignName: e.target.value })}
                      className={`w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-[#6366F1] focus:border-transparent ${
                        errors.campaignName ? 'border-red-300' : 'border-gray-300'
                      }`}
                    />
                    {errors.campaignName && (
                      <p className="mt-1 text-sm text-red-600">{errors.campaignName}</p>
                    )}
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Campaign Goal *
                    </label>
                    <textarea
                      value={formData.campaignGoal}
                      onChange={(e) => setFormData({ ...formData, campaignGoal: e.target.value })}
                      rows={4}
                      className={`w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-[#6366F1] focus:border-transparent resize-y ${
                        errors.campaignGoal ? 'border-red-300' : 'border-gray-300'
                      }`}
                    />
                    {errors.campaignGoal && (
                      <p className="mt-1 text-sm text-red-600">{errors.campaignGoal}</p>
                    )}
                  </div>
                </div>
              </div>

              <div className="bg-white rounded-xl border border-gray-200 p-6">
                <h2 className="text-xl font-semibold text-gray-900 mb-6">Budget & Schedule</h2>
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Budget Range *
                    </label>
                    <input
                      type="text"
                      value={formData.budgetRange}
                      onChange={(e) => setFormData({ ...formData, budgetRange: e.target.value })}
                      placeholder="$ e.g., $1,000 - $5,000"
                      className={`w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-[#6366F1] focus:border-transparent ${
                        errors.budgetRange ? 'border-red-300' : 'border-gray-300'
                      }`}
                    />
                    {errors.budgetRange && (
                      <p className="mt-1 text-sm text-red-600">{errors.budgetRange}</p>
                    )}
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Deadline *
                    </label>
                    <input
                      type="date"
                      value={formData.deadline}
                      onChange={(e) => setFormData({ ...formData, deadline: e.target.value })}
                      className={`w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-[#6366F1] focus:border-transparent ${
                        errors.deadline ? 'border-red-300' : 'border-gray-300'
                      }`}
                    />
                    {errors.deadline && (
                      <p className="mt-1 text-sm text-red-600">{errors.deadline}</p>
                    )}
                  </div>
                </div>
              </div>

              <div className="bg-white rounded-xl border border-gray-200 p-6">
                <h2 className="text-xl font-semibold text-gray-900 mb-6">Visibility & Collaborators</h2>
                <div className="space-y-6">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-3">
                      Campaign Visibility
                    </label>
                    <div className="space-y-3">
                      <label className="flex items-center gap-3 cursor-pointer">
                        <input
                          type="radio"
                          name="visibility"
                          value="open"
                          checked={formData.visibility === 'open'}
                          onChange={(e) => setFormData({ ...formData, visibility: e.target.value })}
                          className="w-4 h-4 text-[#6366F1] border-gray-300 focus:ring-[#6366F1]"
                        />
                        <span className="text-sm text-gray-700">Open for Proposal (visible to all creators)</span>
                      </label>
                      <label className="flex items-center gap-3 cursor-pointer">
                        <input
                          type="radio"
                          name="visibility"
                          value="private"
                          checked={formData.visibility === 'private'}
                          onChange={(e) => setFormData({ ...formData, visibility: e.target.value })}
                          className="w-4 h-4 text-[#6366F1] border-gray-300 focus:ring-[#6366F1]"
                        />
                        <span className="text-sm text-gray-700">Private Campaign (invite-only)</span>
                      </label>
                    </div>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Invite Collaborators
                    </label>
                    <div className="flex gap-2 mb-3">
                      <input
                        type="email"
                        value={newCollaborator}
                        onChange={(e) => setNewCollaborator(e.target.value)}
                        onKeyPress={(e) => {
                          if (e.key === 'Enter') {
                            e.preventDefault()
                            handleAddCollaborator()
                          }
                        }}
                        placeholder="Enter email address"
                        className="flex-1 px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#6366F1] focus:border-transparent"
                      />
                      <button
                        type="button"
                        onClick={handleAddCollaborator}
                        className="px-4 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
                      >
                        + Add
                      </button>
                    </div>
                    {formData.collaborators.length > 0 && (
                      <div className="flex flex-wrap gap-2">
                        {formData.collaborators.map((email) => (
                          <div
                            key={email}
                            className="flex items-center gap-2 px-3 py-1.5 bg-gray-100 rounded-lg"
                          >
                            <span className="text-sm text-gray-700">{email}</span>
                            <button
                              type="button"
                              onClick={() => handleRemoveCollaborator(email)}
                              className="text-gray-500 hover:text-gray-700"
                            >
                              ×
                            </button>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </div>

            <div className="flex items-center justify-end gap-4 mt-8">
              <button
                type="button"
                onClick={() => navigate('/brand/dashboard')}
                className="px-6 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
              >
                Cancel
              </button>
              <button
                type="submit"
                className="px-6 py-2.5 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white rounded-lg hover:opacity-90 transition-opacity"
              >
                Create Campaign
              </button>
            </div>
          </form>
        </div>
      </div>
    </BrandDashboardLayout>
  )
}
</file>

<file path="src/pages/brand/dashboard/BrandCampaignAnalyticsPage.tsx">
import { useState, useRef, useEffect } from 'react'
import { FaDownload, FaCalendarAlt, FaChevronDown, FaArrowDown, FaArrowUp } from 'react-icons/fa'
import { LineChart, Line, BarChart, Bar, PieChart, Pie, Cell, AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts'
import BrandDashboardLayout from '../../../components/brand/BrandDashboardLayout'

const MOCK_CAMPAIGN_PROGRESS = [
  { month: 'Jan', progress: 65 },
  { month: 'Feb', progress: 70 },
  { month: 'Mar', progress: 75 },
  { month: 'Apr', progress: 82 },
  { month: 'May', progress: 88 },
  { month: 'Jun', progress: 92 },
]

const MOCK_RESPONSE_TIME = [
  { creator: 'Creator A', time: 22 },
  { creator: 'Creator B', time: 18 },
  { creator: 'Creator C', time: 15 },
  { creator: 'Creator D', time: 12 },
  { creator: 'Creator E', time: 20 },
]

const MOCK_APPROVAL_CYCLE = [
  { name: 'Draft Review', value: 50, color: '#1F2937' },
  { name: 'Feedback Rounds', value: 30, color: '#4B5563' },
  { name: 'Final Approval', value: 20, color: '#6B7280' },
]

const MOCK_COMPLETION_TREND = [
  { date: 'Jan 01', rate: 78 },
  { date: 'Feb 01', rate: 80 },
  { date: 'Mar 01', rate: 83 },
  { date: 'Apr 01', rate: 86 },
  { date: 'May 01', rate: 89 },
  { date: 'Jun 01', rate: 92 },
]

export default function BrandCampaignAnalyticsPage() {
  const [dateRange, setDateRange] = useState('Nov 29, 2025 - Dec 29, 2025')
  const [datePickerOpen, setDatePickerOpen] = useState(false)
  const datePickerRef = useRef<HTMLDivElement>(null)

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (datePickerRef.current && !datePickerRef.current.contains(event.target as Node)) {
        setDatePickerOpen(false)
      }
    }
    document.addEventListener('mousedown', handleClickOutside)
    return () => document.removeEventListener('mousedown', handleClickOutside)
  }, [])

  const handleExport = () => {
    const csvContent = `Metric,Value
Active Campaigns,4
Avg Creator Response Time,18 hours
Approval Rate,85%
Campaign Completion Rate,92%`
    const blob = new Blob([csvContent], { type: 'text/csv' })
    const url = window.URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = 'campaign-analytics-report.csv'
    a.click()
    window.URL.revokeObjectURL(url)
  }

  return (
    <BrandDashboardLayout>
      <div className="bg-gray-50 min-h-screen py-8 px-6">
        <div className="max-w-7xl mx-auto">
          <div className="mb-8">
            <div className="flex items-center justify-between">
              <div>
                <h1 className="text-3xl font-bold text-gray-900 mb-2">Campaign Analytics</h1>
                <p className="text-gray-600">Overview of your campaign performance and creator engagement.</p>
              </div>
              <div className="flex items-center gap-4">
                <div className="relative" ref={datePickerRef}>
                  <button
                    onClick={() => setDatePickerOpen(!datePickerOpen)}
                    className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                  >
                    <FaCalendarAlt className="w-4 h-4" />
                    <span>{dateRange}</span>
                    <FaChevronDown className="w-3 h-3" />
                  </button>
                  {datePickerOpen && (
                    <div className="absolute right-0 mt-2 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-10 p-4">
                      <input
                        type="date"
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg mb-2"
                        onChange={(e) => {
                          const startDate = e.target.value
                          setDateRange(`${startDate} - ${dateRange.split(' - ')[1]}`)
                        }}
                      />
                      <input
                        type="date"
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                        onChange={(e) => {
                          const endDate = e.target.value
                          setDateRange(`${dateRange.split(' - ')[0]} - ${endDate}`)
                        }}
                      />
                    </div>
                  )}
                </div>
                <button
                  onClick={handleExport}
                  className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white rounded-lg hover:opacity-90 transition-opacity"
                >
                  <FaDownload className="w-4 h-4" />
                  <span>Export Report</span>
                </button>
              </div>
            </div>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="text-sm text-gray-600 mb-2">Active Campaigns</div>
              <div className="text-3xl font-bold text-gray-900 mb-1">4</div>
              <div className="text-sm text-green-600 flex items-center gap-1">
                <FaArrowUp className="w-3 h-3" />
                <span>+2 since last month</span>
              </div>
            </div>

            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="text-sm text-gray-600 mb-2">Avg. Creator Response Time</div>
              <div className="text-3xl font-bold text-gray-900 mb-1">18 hours</div>
              <div className="text-sm text-red-600 flex items-center gap-1">
                <FaArrowDown className="w-3 h-3" />
                <span>↓10% from previous period</span>
              </div>
            </div>

            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="text-sm text-gray-600 mb-2">Approval Rate</div>
              <div className="text-3xl font-bold text-gray-900 mb-1">85%</div>
              <div className="text-sm text-gray-600">Steady over last 30 days</div>
            </div>

            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="text-sm text-gray-600 mb-2">Campaign Completion Rate</div>
              <div className="text-3xl font-bold text-gray-900 mb-1">92%</div>
              <div className="text-sm text-green-600 flex items-center gap-1">
                <FaArrowUp className="w-3 h-3" />
                <span>↑5% this quarter</span>
              </div>
            </div>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <h2 className="text-xl font-semibold text-gray-900 mb-6">Campaign Progress Over Time</h2>
              <ResponsiveContainer width="100%" height={300}>
                <LineChart data={MOCK_CAMPAIGN_PROGRESS}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                  <XAxis dataKey="month" stroke="#6b7280" />
                  <YAxis domain={[64, 96]} stroke="#6b7280" />
                  <Tooltip />
                  <Legend />
                  <Line type="monotone" dataKey="progress" stroke="#3B82F6" strokeWidth={2} name="Progress" dot={{ fill: '#3B82F6' }} />
                </LineChart>
              </ResponsiveContainer>
            </div>

            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <h2 className="text-xl font-semibold text-gray-900 mb-6">Average Creator Response Time</h2>
              <ResponsiveContainer width="100%" height={300}>
                <BarChart data={MOCK_RESPONSE_TIME}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                  <XAxis dataKey="creator" stroke="#6b7280" />
                  <YAxis domain={[0, 24]} stroke="#6b7280" />
                  <Tooltip />
                  <Legend />
                  <Bar dataKey="time" fill="#EC4899" name="Avg. Time" />
                </BarChart>
              </ResponsiveContainer>
            </div>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <h2 className="text-xl font-semibold text-gray-900 mb-6">Approval Cycle Breakdown</h2>
              <ResponsiveContainer width="100%" height={300}>
                <PieChart>
                  <Pie
                    data={MOCK_APPROVAL_CYCLE}
                    cx="50%"
                    cy="50%"
                    innerRadius={60}
                    outerRadius={100}
                    paddingAngle={5}
                    dataKey="value"
                  >
                    {MOCK_APPROVAL_CYCLE.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={entry.color} />
                    ))}
                  </Pie>
                  <Tooltip />
                  <Legend />
                </PieChart>
              </ResponsiveContainer>
              <div className="mt-4 space-y-2">
                {MOCK_APPROVAL_CYCLE.map((item, index) => (
                  <div key={index} className="flex items-center justify-between text-sm">
                    <div className="flex items-center gap-2">
                      <div className="w-4 h-4 rounded" style={{ backgroundColor: item.color }} />
                      <span className="text-gray-700">{item.name}</span>
                    </div>
                    <span className="font-medium text-gray-900">{item.value}%</span>
                  </div>
                ))}
              </div>
            </div>

            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <h2 className="text-xl font-semibold text-gray-900 mb-6">Campaign Completion Rate Trend</h2>
              <ResponsiveContainer width="100%" height={300}>
                <AreaChart data={MOCK_COMPLETION_TREND}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                  <XAxis dataKey="date" stroke="#6b7280" />
                  <YAxis domain={[0, 100]} stroke="#6b7280" />
                  <Tooltip />
                  <Legend />
                  <Area type="monotone" dataKey="rate" stroke="#EF4444" fill="#EC4899" fillOpacity={0.6} name="Completion Rate" />
                </AreaChart>
              </ResponsiveContainer>
            </div>
          </div>
        </div>
      </div>
    </BrandDashboardLayout>
  )
}
</file>

<file path="src/pages/brand/dashboard/BrandDashboard.tsx">
import { FaPlus, FaEnvelope, FaBullhorn, FaUser, FaClock, FaDollarSign, FaArrowRight } from 'react-icons/fa'
import BrandDashboardLayout from '../../../components/brand/BrandDashboardLayout'

const MOCK_ACTIVE_CAMPAIGNS = [
  {
    id: '1',
    name: 'Summer Collection Launch',
    brand: 'Fashion Nova',
    thumbnail: 'https://images.unsplash.com/photo-1490481651871-ab68de25d43d?w=400&h=300&fit=crop',
    progress: 75,
    status: 'active',
  },
  {
    id: '2',
    name: 'Tech Gadget Review',
    brand: 'Innovate Corp',
    thumbnail: 'https://images.unsplash.com/photo-1498049794561-7780e7231661?w=400&h=300&fit=crop',
    progress: 40,
    status: 'pending',
  },
  {
    id: '3',
    name: 'Healthy Snack Promotion',
    brand: 'NutriBoost',
    thumbnail: 'https://images.unsplash.com/photo-1490645935967-10de6ba17061?w=400&h=300&fit=crop',
    progress: 90,
    status: 'active',
  },
  {
    id: '4',
    name: 'Gaming Hardware Unboxing',
    brand: 'GamerTech',
    thumbnail: 'https://images.unsplash.com/photo-1527864550417-7fd91fc51a46?w=400&h=300&fit=crop',
    progress: 100,
    status: 'completed',
  },
]

const MOCK_TOP_CREATORS = [
  {
    id: '1',
    name: 'Emily Studios',
    avatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop&crop=face',
    role: 'Lifestyle Vlogger',
    activeDeals: 5,
  },
  {
    id: '2',
    name: 'Mark Digital',
    avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face',
    role: 'Tech Reviewer',
    activeDeals: 3,
  },
  {
    id: '3',
    name: 'Chef Chloe',
    avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop&crop=face',
    role: 'Food Blogger',
    activeDeals: 2,
  },
]

const MOCK_PENDING_APPROVALS = [
  {
    id: '1',
    description: 'Proposal from Emily Studios for Summer Collection.',
    campaign: 'Summer Collection Launch',
    timestamp: '2 hours ago',
  },
  {
    id: '2',
    description: 'Draft submission for Tech Gadget Review campaign.',
    campaign: 'Tech Gadget Review',
    timestamp: 'Yesterday',
  },
  {
    id: '3',
    description: 'Final deliverable pending for Healthy Snack Promotion.',
    campaign: 'Healthy Snack Promotion',
    timestamp: '3 days ago',
  },
  {
    id: '4',
    description: 'Budget increase request for Gaming Hardware Unboxing.',
    campaign: 'Gaming Hardware Unboxing',
    timestamp: 'Last week',
  },
]

const MOCK_NOTIFICATIONS = [
  {
    id: '1',
    message: "Your campaign 'Winter Wonderland' is now live!",
    timestamp: '5 mins ago',
  },
  {
    id: '2',
    message: 'New message from Mark Digital regarding collaboration.',
    timestamp: '15 mins ago',
  },
  {
    id: '3',
    message: "Reminder: 'Influencer Spotlight' campaign deadline in 2 days.",
    timestamp: '1 hour ago',
  },
]

export default function BrandDashboard() {
  const getStatusBadge = (status: string) => {
    switch (status) {
      case 'active':
        return <span className="px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">Active</span>
      case 'pending':
        return <span className="px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">Pending Review</span>
      case 'completed':
        return <span className="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">Completed</span>
      default:
        return null
    }
  }

  return (
    <BrandDashboardLayout>
      <div className="bg-gray-50 min-h-screen py-8 px-6">
        <div className="max-w-7xl mx-auto">
          <div className="flex items-center justify-between mb-8">
            <h1 className="text-3xl font-bold text-gray-900">Brand Dashboard</h1>
            <div className="flex items-center gap-4">
              <button className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white rounded-lg hover:opacity-90 transition-opacity">
                <FaPlus className="w-4 h-4" />
                <span>Create New Campaign</span>
              </button>
              <button className="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                <FaEnvelope className="w-4 h-4" />
                <span>Review Proposals</span>
              </button>
            </div>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-center justify-between mb-2">
                <div className="w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center">
                  <FaBullhorn className="w-5 h-5 text-purple-600" />
                </div>
              </div>
              <div className="text-3xl font-bold text-gray-900 mb-1">7</div>
              <div className="text-sm text-gray-600">Active Campaigns</div>
              <div className="text-xs text-green-600 mt-1">+2 this week</div>
            </div>

            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-center justify-between mb-2">
                <div className="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center">
                  <FaUser className="w-5 h-5 text-blue-600" />
                </div>
              </div>
              <div className="text-3xl font-bold text-gray-900 mb-1">23</div>
              <div className="text-sm text-gray-600">Active Creators</div>
              <div className="text-xs text-green-600 mt-1">+5 new this month</div>
            </div>

            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-center justify-between mb-2">
                <div className="w-10 h-10 rounded-lg bg-yellow-100 flex items-center justify-center">
                  <FaClock className="w-5 h-5 text-yellow-600" />
                </div>
              </div>
              <div className="text-3xl font-bold text-gray-900 mb-1">4</div>
              <div className="text-sm text-gray-600">Pending Approvals</div>
              <div className="text-xs text-gray-500 mt-1">3 for proposals</div>
            </div>

            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-center justify-between mb-2">
                <div className="w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center">
                  <FaDollarSign className="w-5 h-5 text-green-600" />
                </div>
              </div>
              <div className="text-3xl font-bold text-gray-900 mb-1">$12,345</div>
              <div className="text-sm text-gray-600">Total Spend</div>
              <div className="text-xs text-green-600 mt-1">+8% from last month</div>
            </div>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
            <div className="lg:col-span-2">
              <div className="bg-white rounded-xl border border-gray-200 p-6">
                <div className="flex items-center justify-between mb-6">
                  <h2 className="text-xl font-semibold text-gray-900">Active Campaigns</h2>
                  <button className="flex items-center gap-1 text-sm text-[#6366F1] hover:text-[#EC4899] transition-colors">
                    <span>View All</span>
                    <FaArrowRight className="w-3 h-3" />
                  </button>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {MOCK_ACTIVE_CAMPAIGNS.map((campaign) => (
                    <div key={campaign.id} className="border border-gray-200 rounded-lg overflow-hidden">
                      <div className="relative h-40 bg-gray-100">
                        <img
                          src={campaign.thumbnail}
                          alt={campaign.name}
                          className="w-full h-full object-cover"
                        />
                        <div className="absolute top-2 right-2">
                          {getStatusBadge(campaign.status)}
                        </div>
                      </div>
                      <div className="p-4">
                        <h3 className="font-semibold text-gray-900 mb-1">{campaign.name}</h3>
                        <p className="text-sm text-gray-600 mb-3">{campaign.brand}</p>
                        <div className="mb-3">
                          <div className="flex items-center justify-between text-xs text-gray-600 mb-1">
                            <span>Progress</span>
                            <span>{campaign.progress}%</span>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-2">
                            <div
                              className="bg-gradient-to-r from-[#6366F1] to-[#EC4899] h-2 rounded-full"
                              style={{ width: `${campaign.progress}%` }}
                            />
                          </div>
                        </div>
                        <button className="flex items-center gap-1 text-sm text-[#6366F1] hover:text-[#EC4899] transition-colors">
                          <span>View Details</span>
                          <FaArrowRight className="w-3 h-3" />
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>

            <div className="lg:col-span-1">
              <div className="bg-white rounded-xl border border-gray-200 p-6">
                <div className="flex items-center justify-between mb-6">
                  <h2 className="text-xl font-semibold text-gray-900">Top Engaged Creators</h2>
                  <button className="flex items-center gap-1 text-sm text-[#6366F1] hover:text-[#EC4899] transition-colors">
                    <span>View All</span>
                    <FaArrowRight className="w-3 h-3" />
                  </button>
                </div>
                <div className="space-y-4">
                  {MOCK_TOP_CREATORS.map((creator) => (
                    <div key={creator.id} className="flex items-center gap-4">
                      <img
                        src={creator.avatar}
                        alt={creator.name}
                        className="w-12 h-12 rounded-full object-cover"
                      />
                      <div className="flex-1">
                        <h3 className="font-medium text-gray-900">{creator.name}</h3>
                        <p className="text-sm text-gray-600">{creator.role}</p>
                        <p className="text-xs text-gray-500 mt-1">{creator.activeDeals} active deals</p>
                      </div>
                      <button className="flex items-center gap-1 text-sm text-[#6366F1] hover:text-[#EC4899] transition-colors">
                        <span>View</span>
                        <FaArrowRight className="w-3 h-3" />
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-xl font-semibold text-gray-900">Pending Approvals</h2>
                <button className="flex items-center gap-1 text-sm text-[#6366F1] hover:text-[#EC4899] transition-colors">
                  <span>View All</span>
                  <FaArrowRight className="w-3 h-3" />
                </button>
              </div>
              <div className="space-y-4">
                {MOCK_PENDING_APPROVALS.map((approval) => (
                  <div key={approval.id} className="border-b border-gray-200 pb-4 last:border-b-0 last:pb-0">
                    <p className="text-sm text-gray-900 mb-1">{approval.description}</p>
                    <p className="text-xs text-gray-500">{approval.timestamp}</p>
                  </div>
                ))}
              </div>
            </div>

            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-xl font-semibold text-gray-900">Recent Notifications</h2>
                <button className="flex items-center gap-1 text-sm text-[#6366F1] hover:text-[#EC4899] transition-colors">
                  <span>View All</span>
                  <FaArrowRight className="w-3 h-3" />
                </button>
              </div>
              <div className="space-y-4">
                {MOCK_NOTIFICATIONS.map((notification) => (
                  <div key={notification.id} className="border-b border-gray-200 pb-4 last:border-b-0 last:pb-0">
                    <p className="text-sm text-gray-900 mb-1">{notification.message}</p>
                    <p className="text-xs text-gray-500">{notification.timestamp}</p>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      </div>
    </BrandDashboardLayout>
  )
}
</file>

<file path="src/pages/brand/deals/ProposalInboxPage.tsx">
import { useState, useMemo } from 'react'
import { FaSearch, FaFilter, FaCheck, FaTimes } from 'react-icons/fa'
import BrandDashboardLayout from '../../../components/brand/BrandDashboardLayout'

interface Proposal {
  id: string
  creatorName: string
  creatorAvatar: string
  submittedDate: string
  proposalTitle: string
  campaignName: string
  budgetRange: string
  status: 'pending' | 'accepted' | 'rejected'
}

const MOCK_PROPOSALS: Proposal[] = [
  {
    id: '1',
    creatorName: 'Alice Johnson',
    creatorAvatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop&crop=face',
    submittedDate: '2024-07-28',
    proposalTitle: 'Engaging Content Series for "EcoLife"',
    campaignName: 'EcoLife Launch Campaign',
    budgetRange: '$1,500 - $2,000',
    status: 'pending',
  },
  {
    id: '2',
    creatorName: 'Bob Williams',
    creatorAvatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face',
    submittedDate: '2024-07-27',
    proposalTitle: 'Innovative Ad Concepts for "Quantum Leap"',
    campaignName: 'Quantum Leap Brand Refresh',
    budgetRange: '$2,500 - $3,000',
    status: 'pending',
  },
  {
    id: '3',
    creatorName: 'Carol White',
    creatorAvatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop&crop=face',
    submittedDate: '2024-07-25',
    proposalTitle: 'Lifestyle Photography for "Urban Chic"',
    campaignName: 'Urban Chic Summer Collection',
    budgetRange: '$1,200 - $1,800',
    status: 'accepted',
  },
  {
    id: '4',
    creatorName: 'David Green',
    creatorAvatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face',
    submittedDate: '2024-07-24',
    proposalTitle: 'Influencer Collaboration for "Fitness First"',
    campaignName: 'Fitness First Expansion',
    budgetRange: '$3,000 - $3,500',
    status: 'rejected',
  },
  {
    id: '5',
    creatorName: 'Eve Brown',
    creatorAvatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=100&h=100&fit=crop&crop=face',
    submittedDate: '2024-07-23',
    proposalTitle: 'Podcast Sponsorship for "Tech Insights"',
    campaignName: 'Tech Insights Season 3',
    budgetRange: '$2,000 - $2,500',
    status: 'pending',
  },
  {
    id: '6',
    creatorName: 'Frank Davis',
    creatorAvatar: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&h=100&fit=crop&crop=face',
    submittedDate: '2024-07-22',
    proposalTitle: 'SEO-Optimized Blog Content for "Home Decor Hub"',
    campaignName: 'Home Decor Hub Content Boost',
    budgetRange: '$1,000 - $1,400',
    status: 'pending',
  },
]

export default function ProposalInboxPage() {
  const [proposals, setProposals] = useState<Proposal[]>(MOCK_PROPOSALS)
  const [selectedProposals, setSelectedProposals] = useState<string[]>([])
  const [searchQuery, setSearchQuery] = useState('')

  const pendingCount = proposals.filter(p => p.status === 'pending').length

  const filteredProposals = useMemo(() => {
    if (!searchQuery) return proposals
    const query = searchQuery.toLowerCase()
    return proposals.filter(p =>
      p.creatorName.toLowerCase().includes(query) ||
      p.proposalTitle.toLowerCase().includes(query) ||
      p.campaignName.toLowerCase().includes(query)
    )
  }, [proposals, searchQuery])

  const handleSelectProposal = (proposalId: string) => {
    setSelectedProposals(prev =>
      prev.includes(proposalId)
        ? prev.filter(id => id !== proposalId)
        : [...prev, proposalId]
    )
  }

  const handleAccept = (proposalId: string) => {
    setProposals(prev =>
      prev.map(p => p.id === proposalId ? { ...p, status: 'accepted' as const } : p)
    )
    setSelectedProposals(prev => prev.filter(id => id !== proposalId))
  }

  const handleReject = (proposalId: string) => {
    setProposals(prev =>
      prev.map(p => p.id === proposalId ? { ...p, status: 'rejected' as const } : p)
    )
    setSelectedProposals(prev => prev.filter(id => id !== proposalId))
  }

  const handleAcceptSelected = () => {
    selectedProposals.forEach(id => handleAccept(id))
    setSelectedProposals([])
  }

  const handleRejectSelected = () => {
    selectedProposals.forEach(id => handleReject(id))
    setSelectedProposals([])
  }

  const getStatusBadge = (status: string) => {
    switch (status) {
      case 'pending':
        return <span className="px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full">Pending</span>
      case 'accepted':
        return <span className="px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">Accepted</span>
      case 'rejected':
        return <span className="px-2 py-1 text-xs font-medium bg-red-100 text-red-800 rounded-full">Rejected</span>
      default:
        return null
    }
  }

  return (
    <BrandDashboardLayout>
      <div className="bg-gray-50 min-h-screen py-8 px-6">
        <div className="max-w-7xl mx-auto">
          <div className="mb-6">
            <h1 className="text-3xl font-bold text-gray-900">
              Proposal Inbox ({pendingCount} New)
            </h1>
          </div>

          <div className="bg-white rounded-xl border border-gray-200 p-4 mb-6">
            <div className="flex items-center gap-4 flex-wrap">
              <div className="flex-1 min-w-[200px]">
                <div className="relative">
                  <FaSearch className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4" />
                  <input
                    type="text"
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    placeholder="Search proposals..."
                    className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#6366F1] focus:border-transparent"
                  />
                </div>
              </div>
              <button className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                <FaFilter className="w-4 h-4" />
                <span>Filter</span>
              </button>
              <button
                disabled={selectedProposals.length === 0}
                className="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                Compare Selected ({selectedProposals.length})
              </button>
              <button
                onClick={handleAcceptSelected}
                disabled={selectedProposals.length === 0}
                className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <FaCheck className="w-4 h-4" />
                <span>Accept Selected</span>
              </button>
              <button
                onClick={handleRejectSelected}
                disabled={selectedProposals.length === 0}
                className="flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <FaTimes className="w-4 h-4" />
                <span>Reject Selected</span>
              </button>
            </div>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredProposals.map((proposal) => (
              <div key={proposal.id} className="bg-white rounded-xl border border-gray-200 p-6 relative">
                <input
                  type="checkbox"
                  checked={selectedProposals.includes(proposal.id)}
                  onChange={() => handleSelectProposal(proposal.id)}
                  className="absolute top-4 right-4 w-5 h-5 text-[#6366F1] border-gray-300 rounded focus:ring-[#6366F1]"
                />
                <div className="flex items-center gap-3 mb-4">
                  <img
                    src={proposal.creatorAvatar}
                    alt={proposal.creatorName}
                    className="w-12 h-12 rounded-full object-cover"
                  />
                  <div className="flex-1">
                    <h3 className="font-semibold text-gray-900">{proposal.creatorName}</h3>
                    <p className="text-sm text-gray-500">{proposal.submittedDate}</p>
                  </div>
                </div>
                <div className="mb-4">
                  <h4 className="font-medium text-gray-900 mb-1">{proposal.proposalTitle}</h4>
                  <p className="text-sm text-gray-600 mb-2">{proposal.campaignName}</p>
                  <p className="text-sm font-medium text-gray-900 mb-2">{proposal.budgetRange}</p>
                  <div className="flex items-center justify-between">
                    {getStatusBadge(proposal.status)}
                  </div>
                </div>
                <div className="flex flex-col gap-2">
                  <button className="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                    Quick Preview
                  </button>
                  {proposal.status === 'pending' && (
                    <div className="flex gap-2">
                      <button
                        onClick={() => handleAccept(proposal.id)}
                        className="flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"
                      >
                        <FaCheck className="w-4 h-4" />
                        <span>Accept</span>
                      </button>
                      <button
                        onClick={() => handleReject(proposal.id)}
                        className="flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm"
                      >
                        <FaTimes className="w-4 h-4" />
                        <span>Reject</span>
                      </button>
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </BrandDashboardLayout>
  )
}
</file>

<file path="src/pages/brand/discovery/CreatorDiscoveryPage.tsx">
import { useState, useMemo } from 'react'
import { FaSearch, FaYoutube, FaInstagram, FaFilter, FaTh, FaList, FaUser } from 'react-icons/fa'
import { SiTiktok, SiTwitch } from 'react-icons/si'
import BrandDashboardLayout from '../../../components/brand/BrandDashboardLayout'

interface Creator {
  id: string
  name: string
  niche: string
  followers: number
  avgPrice: number
  platforms: string[]
  avatar: string
  location: string
  shortlisted: boolean
}

const MOCK_CREATORS: Creator[] = [
  {
    id: '1',
    name: 'Alice Wonderland',
    niche: 'Gaming & Tech',
    followers: 1200000,
    avgPrice: 1500,
    platforms: ['youtube', 'instagram', 'tiktok'],
    avatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop&crop=face',
    location: 'New York, USA',
    shortlisted: true,
  },
  {
    id: '2',
    name: 'Bob The Builder',
    niche: 'DIY & Home',
    followers: 500000,
    avgPrice: 800,
    platforms: ['youtube', 'instagram'],
    avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face',
    location: 'Los Angeles, USA',
    shortlisted: false,
  },
  {
    id: '3',
    name: 'Charlie Chef',
    niche: 'Food & Cooking',
    followers: 750000,
    avgPrice: 1200,
    platforms: ['youtube', 'instagram', 'tiktok'],
    avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop&crop=face',
    location: 'Chicago, USA',
    shortlisted: true,
  },
  {
    id: '4',
    name: 'Diana Designer',
    niche: 'Fashion & Lifestyle',
    followers: 2100000,
    avgPrice: 2000,
    platforms: ['instagram', 'tiktok'],
    avatar: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=100&h=100&fit=crop&crop=face',
    location: 'Miami, USA',
    shortlisted: false,
  },
  {
    id: '5',
    name: 'Eve Explorer',
    niche: 'Travel & Adventure',
    followers: 900000,
    avgPrice: 1000,
    platforms: ['youtube', 'instagram'],
    avatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=100&h=100&fit=crop&crop=face',
    location: 'Seattle, USA',
    shortlisted: false,
  },
  {
    id: '6',
    name: 'Frank Fitness',
    niche: 'Health & Fitness',
    followers: 1500000,
    avgPrice: 1800,
    platforms: ['youtube', 'instagram', 'tiktok', 'twitch'],
    avatar: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&h=100&fit=crop&crop=face',
    location: 'Austin, USA',
    shortlisted: false,
  },
  {
    id: '7',
    name: 'Grace Green',
    niche: 'Sustainability',
    followers: 300000,
    avgPrice: 700,
    platforms: ['instagram', 'blog'],
    avatar: 'https://images.unsplash.com/photo-1488426862026-3ee34a7d66df?w=100&h=100&fit=crop&crop=face',
    location: 'Portland, USA',
    shortlisted: false,
  },
  {
    id: '8',
    name: 'Henry History',
    niche: 'Education & History',
    followers: 600000,
    avgPrice: 950,
    platforms: ['youtube', 'blog'],
    avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face',
    location: 'Boston, USA',
    shortlisted: false,
  },
]

const NICHE_OPTIONS = [
  'All Niches',
  'Gaming & Tech',
  'DIY & Home',
  'Food & Cooking',
  'Fashion & Lifestyle',
  'Travel & Adventure',
  'Health & Fitness',
  'Sustainability',
  'Education & History',
]

const PLATFORM_ICONS: Record<string, React.ReactNode> = {
  youtube: <FaYoutube className="w-4 h-4 text-red-600" />,
  instagram: <FaInstagram className="w-4 h-4 text-pink-600" />,
  tiktok: <SiTiktok className="w-4 h-4 text-black" />,
  twitch: <SiTwitch className="w-4 h-4 text-purple-600" />,
  blog: <span className="text-xs font-semibold text-gray-600">Blog</span>,
}

export default function CreatorDiscoveryPage() {
  const [searchQuery, setSearchQuery] = useState('')
  const [selectedPlatforms, setSelectedPlatforms] = useState<string[]>(['youtube', 'instagram'])
  const [selectedNiche, setSelectedNiche] = useState('All Niches')
  const [priceRange, setPriceRange] = useState([500, 5000])
  const [followerRange, setFollowerRange] = useState([10000, 500000])
  const [location, setLocation] = useState('')
  const [selectedCreators, setSelectedCreators] = useState<string[]>([])
  const [shortlistedIds, setShortlistedIds] = useState<string[]>(MOCK_CREATORS.filter(c => c.shortlisted).map(c => c.id))
  const [sortBy, setSortBy] = useState('Most Relevant')
  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid')

  const handlePlatformToggle = (platform: string) => {
    setSelectedPlatforms(prev =>
      prev.includes(platform)
        ? prev.filter(p => p !== platform)
        : [...prev, platform]
    )
  }

  const handleCreatorSelect = (creatorId: string) => {
    setSelectedCreators(prev =>
      prev.includes(creatorId)
        ? prev.filter(id => id !== creatorId)
        : [...prev, creatorId]
    )
  }

  const handleShortlist = (creatorId: string) => {
    setShortlistedIds(prev =>
      prev.includes(creatorId)
        ? prev.filter(id => id !== creatorId)
        : [...prev, creatorId]
    )
  }

  const clearFilters = () => {
    setSearchQuery('')
    setSelectedPlatforms(['youtube', 'instagram'])
    setSelectedNiche('All Niches')
    setPriceRange([500, 5000])
    setFollowerRange([10000, 500000])
    setLocation('')
  }

  const filteredCreators = useMemo(() => {
    let filtered = MOCK_CREATORS.filter(creator => {
      if (searchQuery && !creator.name.toLowerCase().includes(searchQuery.toLowerCase()) && !creator.niche.toLowerCase().includes(searchQuery.toLowerCase())) {
        return false
      }
      if (selectedPlatforms.length > 0 && !selectedPlatforms.some(platform => creator.platforms.includes(platform))) {
        return false
      }
      if (selectedNiche !== 'All Niches' && creator.niche !== selectedNiche) {
        return false
      }
      if (creator.avgPrice < priceRange[0] || creator.avgPrice > priceRange[1]) {
        return false
      }
      if (creator.followers < followerRange[0] || creator.followers > followerRange[1]) {
        return false
      }
      if (location && !creator.location.toLowerCase().includes(location.toLowerCase())) {
        return false
      }
      return true
    })

    if (sortBy === 'Most Relevant') {
      filtered = filtered.sort((a, b) => b.followers - a.followers)
    } else if (sortBy === 'Price: Low to High') {
      filtered = filtered.sort((a, b) => a.avgPrice - b.avgPrice)
    } else if (sortBy === 'Price: High to Low') {
      filtered = filtered.sort((a, b) => b.avgPrice - a.avgPrice)
    } else if (sortBy === 'Followers: High to Low') {
      filtered = filtered.sort((a, b) => b.followers - a.followers)
    }

    return filtered
  }, [searchQuery, selectedPlatforms, selectedNiche, priceRange, followerRange, location, sortBy])

  const formatFollowers = (count: number) => {
    if (count >= 1000000) {
      return `${(count / 1000000).toFixed(1)}M`
    }
    if (count >= 1000) {
      return `${(count / 1000).toFixed(0)}K`
    }
    return count.toString()
  }

  return (
    <BrandDashboardLayout>
      <div className="bg-gray-50 min-h-screen py-8 px-6">
        <div className="max-w-7xl mx-auto">
          <div className="flex items-center justify-between mb-6">
            <h1 className="text-3xl font-bold text-gray-900">Creator Discovery</h1>
            <div className="flex items-center gap-4">
              <select
                value={sortBy}
                onChange={(e) => setSortBy(e.target.value)}
                className="px-4 py-2 border border-gray-300 rounded-lg bg-white text-sm"
              >
                <option>Most Relevant</option>
                <option>Price: Low to High</option>
                <option>Price: High to Low</option>
                <option>Followers: High to Low</option>
              </select>
              <button
                disabled={selectedCreators.length < 2}
                className="px-4 py-2 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed"
              >
                Compare Selected ({selectedCreators.length})
              </button>
              <button
                onClick={() => setViewMode('grid')}
                className={`p-2 rounded-lg ${viewMode === 'grid' ? 'bg-gray-200' : 'bg-white border border-gray-300'}`}
              >
                <FaTh className="w-4 h-4" />
              </button>
              <button
                onClick={() => setViewMode('list')}
                className={`p-2 rounded-lg ${viewMode === 'list' ? 'bg-gray-200' : 'bg-white border border-gray-300'}`}
              >
                <FaList className="w-4 h-4" />
              </button>
              <button className="p-2 rounded-lg bg-white border border-gray-300">
                <FaFilter className="w-4 h-4" />
              </button>
            </div>
          </div>

          <div className="flex gap-6">
            <div className="w-80 flex-shrink-0">
              <div className="bg-white rounded-xl border border-gray-200 p-6 sticky top-24">
                <div className="flex items-center justify-between mb-6">
                  <h2 className="text-lg font-semibold text-gray-900">Filters</h2>
                  <button
                    onClick={clearFilters}
                    className="text-sm text-[#6366F1] hover:text-[#EC4899] transition-colors"
                  >
                    Clear Filters
                  </button>
                </div>

                <div className="space-y-6">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Search Creator</label>
                    <div className="relative">
                      <FaSearch className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4" />
                      <input
                        type="text"
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        placeholder="Search by name or key"
                        className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#6366F1] focus:border-transparent"
                      />
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Platforms</label>
                    <div className="space-y-2">
                      {['youtube', 'instagram', 'tiktok', 'twitch', 'blog'].map((platform) => (
                        <label key={platform} className="flex items-center gap-2 cursor-pointer">
                          <input
                            type="checkbox"
                            checked={selectedPlatforms.includes(platform)}
                            onChange={() => handlePlatformToggle(platform)}
                            className="w-4 h-4 text-[#6366F1] border-gray-300 rounded focus:ring-[#6366F1]"
                          />
                          <span className="text-sm text-gray-700 capitalize">{platform}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Niche</label>
                    <select
                      value={selectedNiche}
                      onChange={(e) => setSelectedNiche(e.target.value)}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#6366F1] focus:border-transparent"
                    >
                      {NICHE_OPTIONS.map((niche) => (
                        <option key={niche} value={niche}>{niche}</option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Price Range: ${priceRange[0]} - ${priceRange[1]}
                    </label>
                    <div className="flex items-center gap-2">
                      <input
                        type="range"
                        min="0"
                        max="10000"
                        step="100"
                        value={priceRange[0]}
                        onChange={(e) => setPriceRange([parseInt(e.target.value), priceRange[1]])}
                        className="flex-1"
                      />
                      <input
                        type="range"
                        min="0"
                        max="10000"
                        step="100"
                        value={priceRange[1]}
                        onChange={(e) => setPriceRange([priceRange[0], parseInt(e.target.value)])}
                        className="flex-1"
                      />
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Follower Count: {formatFollowers(followerRange[0])} - {formatFollowers(followerRange[1])}
                    </label>
                    <div className="flex items-center gap-2">
                      <input
                        type="range"
                        min="0"
                        max="5000000"
                        step="10000"
                        value={followerRange[0]}
                        onChange={(e) => setFollowerRange([parseInt(e.target.value), followerRange[1]])}
                        className="flex-1"
                      />
                      <input
                        type="range"
                        min="0"
                        max="5000000"
                        step="10000"
                        value={followerRange[1]}
                        onChange={(e) => setFollowerRange([followerRange[0], parseInt(e.target.value)])}
                        className="flex-1"
                      />
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Location</label>
                    <input
                      type="text"
                      value={location}
                      onChange={(e) => setLocation(e.target.value)}
                      placeholder="e.g., New York, USA"
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#6366F1] focus:border-transparent"
                    />
                  </div>
                </div>
              </div>
            </div>

            <div className="flex-1">
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {filteredCreators.map((creator) => (
                  <div key={creator.id} className="bg-white rounded-xl border border-gray-200 p-6 relative">
                    <input
                      type="checkbox"
                      checked={selectedCreators.includes(creator.id)}
                      onChange={() => handleCreatorSelect(creator.id)}
                      className="absolute top-4 right-4 w-5 h-5 text-[#6366F1] border-gray-300 rounded focus:ring-[#6366F1]"
                    />
                    <div className="flex flex-col items-center text-center mb-4">
                      <img
                        src={creator.avatar}
                        alt={creator.name}
                        className="w-20 h-20 rounded-full object-cover mb-3"
                      />
                      <h3 className="font-semibold text-gray-900 mb-1">{creator.name}</h3>
                      <p className="text-sm text-gray-600 mb-3">{creator.niche}</p>
                      <div className="flex items-center gap-4 text-sm text-gray-600 mb-3">
                        <div className="flex items-center gap-1">
                          <FaUser className="w-4 h-4" />
                          <span>{formatFollowers(creator.followers)} Followers</span>
                        </div>
                        <div className="flex items-center gap-1">
                          <span className="font-semibold">$</span>
                          <span>Avg. ${creator.avgPrice}</span>
                        </div>
                      </div>
                      <div className="flex items-center gap-2 mb-4">
                        {creator.platforms.map((platform) => (
                          <div key={platform}>
                            {PLATFORM_ICONS[platform]}
                          </div>
                        ))}
                      </div>
                    </div>
                    <div className="flex flex-col gap-2">
                      <button
                        onClick={() => handleShortlist(creator.id)}
                        className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                          shortlistedIds.includes(creator.id)
                            ? 'bg-gray-100 text-gray-700'
                            : 'bg-white border border-gray-300 text-gray-700 hover:bg-gray-50'
                        }`}
                      >
                        {shortlistedIds.includes(creator.id) ? 'Shortlisted' : 'Shortlist'}
                      </button>
                      <button className="px-4 py-2 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white rounded-lg hover:opacity-90 transition-opacity text-sm font-medium">
                        View Profile
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      </div>
    </BrandDashboardLayout>
  )
}
</file>

<file path="src/pages/creator/dashboard/AnalyticsPage.tsx">
import { useState, useEffect, useRef } from 'react'
import { FaEye, FaLock, FaSyncAlt, FaCheckCircle, FaDownload, FaChevronDown } from 'react-icons/fa'
import { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts'

interface MetricCard {
  id: string
  label: string
  value: string | number
  change: number
  icon: React.ReactNode
}

type DateRange = '7days' | '30days' | '90days'

const MOCK_DATA_7DAYS = {
  profileViews: { value: 12450, change: 15.2 },
  pricingUnlocks: { value: 2300, change: 8.1 },
  proposalConversion: { value: 65, change: 2.5 },
  dealCompletion: { value: 92, change: -0.5 },
  profileViewsOverTime: [
    { month: 'Jan', views: 10000 },
    { month: 'Feb', views: 10500 },
    { month: 'Mar', views: 9800 },
    { month: 'Apr', views: 10200 },
    { month: 'May', views: 11500 },
    { month: 'Jun', views: 12460 },
  ],
  proposalData: [
    { month: 'Jan', proposals: 60, deals: 40 },
    { month: 'Feb', proposals: 65, deals: 42 },
    { month: 'Mar', proposals: 70, deals: 45 },
    { month: 'Apr', proposals: 68, deals: 44 },
    { month: 'May', proposals: 75, deals: 48 },
    { month: 'Jun', proposals: 72, deals: 50 },
  ],
}

const MOCK_DATA_30DAYS = {
  profileViews: { value: 12450, change: 15.2 },
  pricingUnlocks: { value: 2300, change: 8.1 },
  proposalConversion: { value: 65, change: 2.5 },
  dealCompletion: { value: 92, change: -0.5 },
  profileViewsOverTime: [
    { month: 'Jan', views: 10000 },
    { month: 'Feb', views: 10500 },
    { month: 'Mar', views: 9800 },
    { month: 'Apr', views: 10200 },
    { month: 'May', views: 11500 },
    { month: 'Jun', views: 12460 },
  ],
  proposalData: [
    { month: 'Jan', proposals: 60, deals: 40 },
    { month: 'Feb', proposals: 65, deals: 42 },
    { month: 'Mar', proposals: 70, deals: 45 },
    { month: 'Apr', proposals: 68, deals: 44 },
    { month: 'May', proposals: 75, deals: 48 },
    { month: 'Jun', proposals: 72, deals: 50 },
  ],
}

const MOCK_DATA_90DAYS = {
  profileViews: { value: 12450, change: 15.2 },
  pricingUnlocks: { value: 2300, change: 8.1 },
  proposalConversion: { value: 65, change: 2.5 },
  dealCompletion: { value: 92, change: -0.5 },
  profileViewsOverTime: [
    { month: 'Jan', views: 10000 },
    { month: 'Feb', views: 10500 },
    { month: 'Mar', views: 9800 },
    { month: 'Apr', views: 10200 },
    { month: 'May', views: 11500 },
    { month: 'Jun', views: 12460 },
  ],
  proposalData: [
    { month: 'Jan', proposals: 60, deals: 40 },
    { month: 'Feb', proposals: 65, deals: 42 },
    { month: 'Mar', proposals: 70, deals: 45 },
    { month: 'Apr', proposals: 68, deals: 44 },
    { month: 'May', proposals: 75, deals: 48 },
    { month: 'Jun', proposals: 72, deals: 50 },
  ],
}

export default function AnalyticsPage() {
  const [dateRange, setDateRange] = useState<DateRange>('30days')
  const [dateRangeDropdownOpen, setDateRangeDropdownOpen] = useState(false)
  const dropdownRef = useRef<HTMLDivElement>(null)

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {
        setDateRangeDropdownOpen(false)
      }
    }

    document.addEventListener('mousedown', handleClickOutside)
    return () => document.removeEventListener('mousedown', handleClickOutside)
  }, [])

  const getData = () => {
    switch (dateRange) {
      case '7days':
        return MOCK_DATA_7DAYS
      case '30days':
        return MOCK_DATA_30DAYS
      case '90days':
        return MOCK_DATA_90DAYS
      default:
        return MOCK_DATA_30DAYS
    }
  }

  const data = getData()

  const metrics: MetricCard[] = [
    {
      id: '1',
      label: 'Lượt xem hồ sơ',
      value: data.profileViews.value.toLocaleString('vi-VN'),
      change: data.profileViews.change,
      icon: <FaEye className="w-5 h-5 text-gray-400" />,
    },
    {
      id: '2',
      label: 'Lần mở khóa bảng giá',
      value: data.pricingUnlocks.value.toLocaleString('vi-VN'),
      change: data.pricingUnlocks.change,
      icon: <FaLock className="w-5 h-5 text-gray-400" />,
    },
    {
      id: '3',
      label: 'Tỷ lệ chuyển đổi đề xuất',
      value: `${data.proposalConversion.value}%`,
      change: data.proposalConversion.change,
      icon: <FaSyncAlt className="w-5 h-5 text-gray-400" />,
    },
    {
      id: '4',
      label: 'Tỷ lệ hoàn thành thỏa thuận',
      value: `${data.dealCompletion.value}%`,
      change: data.dealCompletion.change,
      icon: <FaCheckCircle className="w-5 h-5 text-gray-400" />,
    },
  ]

  const handleExport = () => {
    const csvContent = `Metric,Value,Change
Profile Views,${data.profileViews.value},${data.profileViews.change}%
Pricing Unlocks,${data.pricingUnlocks.value},${data.pricingUnlocks.change}%
Proposal Conversion,${data.proposalConversion.value}%,${data.proposalConversion.change}%
Deal Completion,${data.dealCompletion.value}%,${data.dealCompletion.change}%`
    const blob = new Blob([csvContent], { type: 'text/csv' })
    const url = window.URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = `analytics-report-${dateRange}.csv`
    a.click()
    window.URL.revokeObjectURL(url)
  }

  const getDateRangeLabel = () => {
    switch (dateRange) {
      case '7days':
        return '7 ngày qua'
      case '30days':
        return '30 ngày qua'
      case '90days':
        return '90 ngày qua'
      default:
        return '30 ngày qua'
    }
  }

  return (
    <div className="bg-gray-50 min-h-screen py-8 px-6">
      <div className="max-w-7xl mx-auto">
        <div className="mb-8">
          <div className="flex items-center justify-between">
            <h1 className="text-3xl font-bold text-gray-900">Phân tích Creator</h1>
            <div className="flex items-center gap-4">
              <button
                onClick={handleExport}
                className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
              >
                <FaDownload className="w-4 h-4" />
                <span>Xuất báo cáo</span>
              </button>
              <div className="relative" ref={dropdownRef}>
                <button
                  onClick={() => setDateRangeDropdownOpen(!dateRangeDropdownOpen)}
                  className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                >
                  <span>{getDateRangeLabel()}</span>
                  <FaChevronDown className="w-3 h-3" />
                </button>
                {dateRangeDropdownOpen && (
                  <div className="absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-10">
                    <button
                      onClick={() => {
                        setDateRange('7days')
                        setDateRangeDropdownOpen(false)
                      }}
                      className="w-full px-4 py-2 text-left hover:bg-gray-50 transition-colors"
                    >
                      7 ngày qua
                    </button>
                    <button
                      onClick={() => {
                        setDateRange('30days')
                        setDateRangeDropdownOpen(false)
                      }}
                      className="w-full px-4 py-2 text-left hover:bg-gray-50 transition-colors"
                    >
                      30 ngày qua
                    </button>
                    <button
                      onClick={() => {
                        setDateRange('90days')
                        setDateRangeDropdownOpen(false)
                      }}
                      className="w-full px-4 py-2 text-left hover:bg-gray-50 transition-colors"
                    >
                      90 ngày qua
                    </button>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          {metrics.map((metric) => (
            <div key={metric.id} className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-center justify-between mb-4">
                <div className="text-sm text-gray-600">{metric.label}</div>
                {metric.icon}
              </div>
              <div className="text-3xl font-bold text-gray-900 mb-2">{metric.value}</div>
              <div className={`text-sm font-medium ${metric.change >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                {metric.change >= 0 ? '+' : ''}{metric.change}% so với kỳ trước
              </div>
            </div>
          ))}
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div className="bg-white rounded-xl border border-gray-200 p-6">
            <h2 className="text-xl font-semibold text-gray-900 mb-6">Lượt xem hồ sơ theo thời gian</h2>
            <ResponsiveContainer width="100%" height={300}>
              <LineChart data={data.profileViewsOverTime}>
                <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                <XAxis dataKey="month" stroke="#6b7280" />
                <YAxis stroke="#6b7280" />
                <Tooltip />
                <Legend />
                <Line type="monotone" dataKey="views" stroke="#6366F1" strokeWidth={2} name="Lượt xem hồ sơ" />
              </LineChart>
            </ResponsiveContainer>
          </div>

          <div className="bg-white rounded-xl border border-gray-200 p-6">
            <h2 className="text-xl font-semibold text-gray-900 mb-6">Tỷ lệ chuyển đổi đề xuất & Hoàn thành thỏa thuận</h2>
            <ResponsiveContainer width="100%" height={300}>
              <BarChart data={data.proposalData}>
                <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                <XAxis dataKey="month" stroke="#6b7280" />
                <YAxis stroke="#6b7280" />
                <Tooltip />
                <Legend />
                <Bar dataKey="proposals" fill="#EC4899" name="Đề xuất đã gửi" />
                <Bar dataKey="deals" fill="#14B8A6" name="Thỏa thuận đã hoàn thành" />
              </BarChart>
            </ResponsiveContainer>
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/creator/dashboard/DashboardHome.tsx">
import { useState } from 'react'
import { Link } from 'react-router-dom'
import { useAuth } from '../../../hooks/useAuth'
import { useProfile } from '../../../hooks/useProfile'
import UpgradePlanModal from '../../../components/shared/UpgradePlanModal'
import { 
  FaEye, 
  FaLock, 
  FaPaperPlane, 
  FaTrophy,
  FaDollarSign,
  FaTimes,
  FaArrowUp,
  FaArrowDown,
  FaCheckCircle,
  FaExclamationCircle
} from 'react-icons/fa'

// Mock data - replace with real API data later
const MOCK_METRICS = {
  profileViews: 8450,
  pricingUnlocks: 24,
  proposalsSent: 15,
  dealsWon: 5,
  totalRevenue: 120000000,
}

const MOCK_ACTIVE_COLLABORATIONS = [
  {
    id: '1',
    campaignName: "Summer Campaign '24",
    brandName: "Aether Apparel",
    status: 'in_progress',
    statusLabel: 'Đang thực hiện',
  },
  {
    id: '2',
    campaignName: "Product Launch Video",
    brandName: "Zenith Innovations",
    status: 'pending',
    statusLabel: 'Chờ phê duyệt',
  },
  {
    id: '3',
    campaignName: "Holiday Influencer Series",
    brandName: "Glimmer Cosmetics",
    status: 'in_progress',
    statusLabel: 'Đang thực hiện',
  },
  {
    id: '4',
    campaignName: "Brand Story Reels",
    brandName: "Urban Brew Co.",
    status: 'negotiation',
    statusLabel: 'Đang đàm phán',
  },
]

const MOCK_RECENT_ACTIVITIES = [
  {
    id: '1',
    message: "Đề xuất của bạn cho 'Summer Campaign '24' đã được Aether Apparel chấp nhận.",
    timestamp: "2 phút trước",
  },
  {
    id: '2',
    message: "Tin nhắn mới từ Zenith Innovations về 'Product Launch Video'.",
    timestamp: "1 giờ trước",
  },
  {
    id: '3',
    message: "Glimmer Cosmetics đã xem hồ sơ của bạn.",
    timestamp: "Hôm qua",
  },
  {
    id: '4',
    message: "Thỏa thuận 'Holiday Influencer Series' đã chuyển sang trạng thái Đang thực hiện.",
    timestamp: "2 ngày trước",
  },
  {
    id: '5',
    message: "Aether Apparel đã mở khóa bảng giá của bạn.",
    timestamp: "3 ngày trước",
  },
]

const MOCK_OPPORTUNITIES = [
  {
    id: '1',
    campaignTitle: "Fashion Week Collaboration",
    brandName: "Style Co.",
    budgetRange: "5,000,000 - 10,000,000 VNĐ",
    deadline: "Còn 5 ngày",
    matchScore: 95,
  },
  {
    id: '2',
    campaignTitle: "Beauty Product Launch",
    brandName: "Cosmetics Brand",
    budgetRange: "3,000,000 - 5,000,000 VNĐ",
    deadline: "Còn 3 ngày",
    matchScore: 88,
  },
]

const MOCK_INSIGHTS = [
  {
    id: '1',
    metric: "Tăng trưởng lượt xem",
    value: "+25%",
    trend: 'up',
    description: "Hồ sơ của bạn đang được xem nhiều hơn so với tháng trước",
  },
]

export default function DashboardHome() {
  const { session } = useAuth()
  const { profile } = useProfile(
    session?.user?.id,
    !!(session && session.access_token && session.user.email_confirmed_at)
  )
  const [showUpgradeBanner, setShowUpgradeBanner] = useState(true)
  const [isUpgradeModalOpen, setIsUpgradeModalOpen] = useState(false)

  // Check if profile is complete (mock logic)
  const profileComplete = profile?.onboarding_completed || false
  const profileProgress = profileComplete ? 100 : 80

  // Mock current plan - replace with real data later
  const currentPlan: 'free' | 'pro' | 'business' = 'free'

  return (
    <div className="bg-gray-50 min-h-screen py-8 px-6">
      <div className="max-w-7xl mx-auto space-y-8">
        
        {/* Upgrade Banner */}
        {showUpgradeBanner && (
          <div className="bg-pink-50 border border-red-200 rounded-lg p-4 flex items-center justify-between">
            <div className="flex items-center gap-3">
              <FaExclamationCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
              <p className="text-sm text-gray-800">
                Mở khóa phân tích nâng cao và đề xuất không giới hạn. Nâng cấp gói ngay!
              </p>
            </div>
            <div className="flex items-center gap-3">
              <button
                onClick={() => setIsUpgradeModalOpen(true)}
                className="px-4 py-2 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white text-sm font-medium rounded-lg hover:opacity-90 transition-opacity"
              >
                Nâng cấp ngay
              </button>
              <button
                onClick={() => setShowUpgradeBanner(false)}
                className="text-gray-400 hover:text-gray-600 transition-colors"
              >
                <FaTimes className="w-4 h-4" />
              </button>
            </div>
          </div>
        )}

        {/* Key Metrics */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
          {/* Profile Views */}
          <div className="bg-white rounded-xl border border-gray-200 p-4">
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <div className="text-2xl font-bold text-gray-900 mb-1">
                  {MOCK_METRICS.profileViews.toLocaleString('vi-VN')}
                </div>
                <div className="text-xs text-gray-600">Lượt xem hồ sơ</div>
              </div>
              <FaEye className="w-4 h-4 text-gray-400 flex-shrink-0 mt-1" />
            </div>
          </div>

          {/* Pricing Unlocks */}
          <div className="bg-white rounded-xl border border-gray-200 p-4">
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <div className="text-2xl font-bold text-gray-900 mb-1">
                  {MOCK_METRICS.pricingUnlocks}
                </div>
                <div className="text-xs text-gray-600">Lần mở khóa bảng giá</div>
              </div>
              <FaLock className="w-4 h-4 text-gray-400 flex-shrink-0 mt-1" />
            </div>
          </div>

          {/* Proposals Sent */}
          <div className="bg-white rounded-xl border border-gray-200 p-4">
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <div className="text-2xl font-bold text-gray-900 mb-1">
                  {MOCK_METRICS.proposalsSent}
                </div>
                <div className="text-xs text-gray-600">Đề xuất đã gửi</div>
              </div>
              <FaPaperPlane className="w-4 h-4 text-gray-400 flex-shrink-0 mt-1" />
            </div>
          </div>

          {/* Deals Won */}
          <div className="bg-white rounded-xl border border-gray-200 p-4">
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <div className="text-2xl font-bold text-gray-900 mb-1">
                  {MOCK_METRICS.dealsWon}
                </div>
                <div className="text-xs text-gray-600">Thỏa thuận đã ký</div>
              </div>
              <FaTrophy className="w-4 h-4 text-gray-400 flex-shrink-0 mt-1" />
            </div>
          </div>

          {/* Total Revenue */}
          <div className="bg-white rounded-xl border border-gray-200 p-4">
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <div className="text-2xl font-bold text-gray-900 mb-1">
                  {MOCK_METRICS.totalRevenue.toLocaleString('vi-VN')}
                </div>
                <div className="text-xs text-gray-600">Tổng doanh thu đã ký</div>
              </div>
              <FaDollarSign className="w-4 h-4 text-gray-400 flex-shrink-0 mt-1" />
            </div>
          </div>
        </div>

        {/* Main Content Grid */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          
          {/* Left Column - Active Collaborations */}
          <div className="lg:col-span-2 space-y-6">
            
            {/* Active Collaborations */}
            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <h2 className="text-xl font-semibold text-gray-900 mb-2">Hợp tác đang diễn ra</h2>
              <p className="text-sm text-gray-600 mb-4">
                Các chiến dịch hợp tác với thương hiệu của bạn.
              </p>
              
              {MOCK_ACTIVE_COLLABORATIONS.length > 0 ? (
                <div className="space-y-4">
                  {MOCK_ACTIVE_COLLABORATIONS.map((collab) => (
                    <div
                      key={collab.id}
                      className="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors"
                    >
                      <div className="flex items-start justify-between mb-2">
                        <div>
                          <h3 className="font-medium text-gray-900">{collab.campaignName}</h3>
                          <p className="text-sm text-gray-600">{collab.brandName}</p>
                        </div>
                        <span
                          className={`px-3 py-1 rounded-full text-xs font-medium ${
                            collab.status === 'pending'
                              ? 'bg-purple-100 text-purple-700'
                              : 'bg-gray-100 text-gray-700'
                          }`}
                        >
                          {collab.statusLabel}
                        </span>
                      </div>
                      <Link
                        to="/dashboard/workspace"
                        className="text-sm text-[#6366F1] hover:underline"
                      >
                        Xem chi tiết
                      </Link>
                    </div>
                  ))}
                </div>
              ) : (
                <div className="text-center py-8">
                  <p className="text-gray-600 mb-2">Bạn chưa có hợp tác nào đang diễn ra</p>
                  <p className="text-sm text-gray-500 mb-4">
                    Bắt đầu bằng cách gửi đề xuất cho các cơ hội phù hợp
                  </p>
                  <Link
                    to="/dashboard/opportunities"
                    className="inline-block px-4 py-2 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white text-sm font-medium rounded-lg hover:opacity-90 transition-opacity"
                  >
                    Khám phá cơ hội
                  </Link>
                </div>
              )}
            </div>

            {/* Opportunities Overview */}
            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-center justify-between mb-4">
                <div>
                  <h2 className="text-xl font-semibold text-gray-900 mb-2">Cơ hội mới</h2>
                  <p className="text-sm text-gray-600">
                    Các chiến dịch phù hợp với hồ sơ của bạn.
                  </p>
                </div>
                <Link
                  to="/dashboard/opportunities"
                  className="text-sm text-[#6366F1] hover:underline"
                >
                  Xem tất cả
                </Link>
              </div>
              
              {MOCK_OPPORTUNITIES.length > 0 ? (
                <div className="space-y-4">
                  {MOCK_OPPORTUNITIES.map((opp) => (
                    <div
                      key={opp.id}
                      className="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors"
                    >
                      <div className="flex items-start justify-between mb-2">
                        <div>
                          <h3 className="font-medium text-gray-900">{opp.campaignTitle}</h3>
                          <p className="text-sm text-gray-600">{opp.brandName}</p>
                        </div>
                        <span className="px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded">
                          {opp.matchScore}% phù hợp
                        </span>
                      </div>
                      <div className="flex items-center justify-between text-sm text-gray-600 mb-3">
                        <span>{opp.budgetRange}</span>
                        <span>{opp.deadline}</span>
                      </div>
                      <Link
                        to="/dashboard/opportunities"
                        className="inline-block px-4 py-2 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white text-sm font-medium rounded-lg hover:opacity-90 transition-opacity"
                      >
                        Xem chi tiết
                      </Link>
                    </div>
                  ))}
                </div>
              ) : (
                <div className="text-center py-8">
                  <p className="text-gray-600 mb-2">Hiện không có cơ hội mới</p>
                  <p className="text-sm text-gray-500 mb-4">
                    Cơ hội mới sẽ xuất hiện khi có chiến dịch phù hợp
                  </p>
                  <Link
                    to="/dashboard/profile"
                    className="inline-block px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-200 transition-colors"
                  >
                    Cập nhật hồ sơ
                  </Link>
                </div>
              )}
            </div>
          </div>

          {/* Right Column */}
          <div className="space-y-6">
            
            {/* Recent Activity */}
            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="mb-4">
                <h2 className="text-xl font-semibold text-gray-900 mb-2">Hoạt động gần đây</h2>
                <p className="text-sm text-gray-600">
                  Nhật ký hoạt động mới nhất trên tài khoản của bạn.
                </p>
              </div>
              
              {MOCK_RECENT_ACTIVITIES.length > 0 ? (
                <div className="max-h-64 overflow-y-auto space-y-3 pr-2">
                  {MOCK_RECENT_ACTIVITIES.map((activity) => (
                    <div
                      key={activity.id}
                      className="border-l-2 border-[#6366F1] pl-3 py-2"
                    >
                      <p className="text-sm text-gray-700 mb-1">{activity.message}</p>
                      <p className="text-xs text-gray-500">{activity.timestamp}</p>
                    </div>
                  ))}
                </div>
              ) : (
                <div className="text-center py-8">
                  <p className="text-gray-600 text-sm">Chưa có hoạt động nào</p>
                  <p className="text-xs text-gray-500 mt-1">
                    Hoạt động mới sẽ xuất hiện ở đây
                  </p>
                </div>
              )}
            </div>

            {/* Quick Actions */}
            {!profileComplete && (
              <div className="bg-white rounded-xl border border-gray-200 p-6">
                <h2 className="text-xl font-semibold text-gray-900 mb-2">Bắt đầu với ALINO</h2>
                <p className="text-sm text-gray-600 mb-4">
                  Hoàn thiện hồ sơ để nhận nhiều cơ hội hơn.
                </p>
                
                <div className="space-y-3">
                  <div className="border border-gray-200 rounded-lg p-3">
                    <div className="flex items-center justify-between mb-2">
                      <span className="text-sm font-medium text-gray-700">Hoàn thiện hồ sơ</span>
                      <span className="text-xs text-gray-500">{profileProgress}%</span>
                    </div>
                    <Link
                      to="/dashboard/profile"
                      className="text-sm text-[#6366F1] hover:underline"
                    >
                      Hoàn thiện hồ sơ →
                    </Link>
                  </div>

                  <div className="border border-gray-200 rounded-lg p-3">
                    <div className="flex items-center justify-between mb-2">
                      <span className="text-sm font-medium text-gray-700">Thiết lập dịch vụ</span>
                      <span className="text-xs text-gray-500">Chưa thiết lập</span>
                    </div>
                    <Link
                      to="/dashboard/services"
                      className="text-sm text-[#6366F1] hover:underline"
                    >
                      Thiết lập dịch vụ →
                    </Link>
                  </div>
                </div>
              </div>
            )}

            {/* Performance Insights */}
            {MOCK_INSIGHTS.length > 0 && (
              <div className="bg-white rounded-xl border border-gray-200 p-6">
                <div className="flex items-center justify-between mb-4">
                  <h2 className="text-xl font-semibold text-gray-900">Hiểu biết hiệu suất</h2>
                  <Link
                    to="/dashboard/analytics"
                    className="text-sm text-[#6366F1] hover:underline"
                  >
                    Xem chi tiết
                  </Link>
                </div>
                <p className="text-sm text-gray-600 mb-4">
                  Phân tích hiệu suất hồ sơ của bạn.
                </p>
                
                <div className="space-y-3">
                  {MOCK_INSIGHTS.map((insight) => (
                    <div
                      key={insight.id}
                      className="border border-gray-200 rounded-lg p-3"
                    >
                      <div className="flex items-center justify-between mb-1">
                        <span className="text-sm font-medium text-gray-700">{insight.metric}</span>
                        <div className="flex items-center gap-1">
                          {insight.trend === 'up' ? (
                            <FaArrowUp className="w-3 h-3 text-green-600" />
                          ) : (
                            <FaArrowDown className="w-3 h-3 text-red-600" />
                          )}
                          <span
                            className={`text-sm font-medium ${
                              insight.trend === 'up' ? 'text-green-600' : 'text-red-600'
                            }`}
                          >
                            {insight.value}
                          </span>
                        </div>
                      </div>
                      <p className="text-xs text-gray-500">{insight.description}</p>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      </div>

      {/* Upgrade Plan Modal */}
      <UpgradePlanModal
        isOpen={isUpgradeModalOpen}
        onClose={() => setIsUpgradeModalOpen(false)}
        currentPlan={currentPlan}
      />
    </div>
  )
}
</file>

<file path="src/pages/creator/dashboard/NotificationsPage.tsx">
import { useState } from 'react'
import { FaCheck, FaCheckCircle } from 'react-icons/fa'

// Mock notification data - replace with real API data later
interface Notification {
  id: string
  type: 'proposal' | 'booking' | 'approval' | 'comment' | 'campaign' | 'profile' | 'collaboration'
  avatar: string
  content: string
  time: string
  timeAgo: string
  read: boolean
  ctaLabel: string
  ctaAction?: () => void
  section: 'new' | 'thisWeek' | 'earlier'
}

const MOCK_NOTIFICATIONS: Notification[] = [
  {
    id: '1',
    type: 'proposal',
    avatar: 'https://ui-avatars.com/api/?name=Brand+X&background=6366F1&color=fff',
    content: 'Brand X đã gửi cho bạn một đề xuất mới cho đề xuất Winter Car của họ',
    time: '2025-01-20T10:00:00Z',
    timeAgo: '5 phút trước',
    read: false,
    ctaLabel: 'Xem đề xuất',
    section: 'new'
  },
  {
    id: '2',
    type: 'booking',
    avatar: 'https://ui-avatars.com/api/?name=Sarah+Chen&background=EC4899&color=fff',
    content: 'Sarah Chen đã chấp nhận yêu cầu đặt lịch của bạn cho buổi chụp ảnh',
    time: '2025-01-20T09:00:00Z',
    timeAgo: '1 giờ trước',
    read: false,
    ctaLabel: 'Quản lý lịch',
    section: 'new'
  },
  {
    id: '3',
    type: 'profile',
    avatar: 'https://ui-avatars.com/api/?name=Profile&background=8B5CF6&color=fff',
    content: 'Hồ sơ của bạn đã đạt 1000 lượt xem trong tuần này! Hãy tiếp tục phát huy.',
    time: '2025-01-20T07:00:00Z',
    timeAgo: '3 giờ trước',
    read: false,
    ctaLabel: '',
    section: 'new'
  },
  {
    id: '4',
    type: 'approval',
    avatar: 'https://ui-avatars.com/api/?name=Alpha+Corp&background=6366F1&color=fff',
    content: 'Alpha Corp cần bạn phê duyệt bản nháp mới nhất cho "Project Zenith"',
    time: '2025-01-19T15:00:00Z',
    timeAgo: 'Hôm qua',
    read: true,
    ctaLabel: 'Phê duyệt bản nháp',
    section: 'thisWeek'
  },
  {
    id: '5',
    type: 'comment',
    avatar: 'https://ui-avatars.com/api/?name=Emily+White&background=EC4899&color=fff',
    content: 'Emily White đã bình luận về bản nháp bạn vừa tải lên',
    time: '2025-01-19T10:00:00Z',
    timeAgo: 'Hôm qua',
    read: true,
    ctaLabel: 'Xem bình luận',
    section: 'thisWeek'
  },
  {
    id: '6',
    type: 'campaign',
    avatar: 'https://ui-avatars.com/api/?name=Global+Brands&background=6366F1&color=fff',
    content: 'Global Brands Inc. đã đăng cơ hội chiến dịch mới: "Summer Collec Campaign"',
    time: '2025-01-18T14:00:00Z',
    timeAgo: '2 ngày trước',
    read: true,
    ctaLabel: 'Xem chiến dịch',
    section: 'thisWeek'
  },
  {
    id: '7',
    type: 'approval',
    avatar: 'https://ui-avatars.com/api/?name=Creative+Studio&background=8B5CF6&color=fff',
    content: 'Creative Studio đã phê duyệt sản phẩm của bạn cho "Animated Explainer Project"',
    time: '2025-01-17T11:00:00Z',
    timeAgo: '3 ngày trước',
    read: true,
    ctaLabel: 'Xem thỏa thuận',
    section: 'thisWeek'
  },
  {
    id: '8',
    type: 'collaboration',
    avatar: 'https://ui-avatars.com/api/?name=Jessica+Lee&background=EC4899&color=fff',
    content: 'Jessica Lee đã mời bạn cộng tác trong "Brand Launch Event"',
    time: '2025-01-13T09:00:00Z',
    timeAgo: '1 tuần trước',
    read: true,
    ctaLabel: 'Chấp nhận lời mời',
    section: 'earlier'
  },
]

const FILTER_TABS = [
  { id: 'all', label: 'Tất cả' },
  { id: 'unread', label: 'Chưa đọc' },
  { id: 'proposals', label: 'Đề xuất' },
  { id: 'bookings', label: 'Đặt lịch' },
  { id: 'drafts', label: 'Bản nháp' },
  { id: 'approvals', label: 'Phê duyệt' },
] as const

type FilterTab = typeof FILTER_TABS[number]['id']

export default function NotificationsPage() {
  const [activeFilter, setActiveFilter] = useState<FilterTab>('all')
  const [notifications, setNotifications] = useState<Notification[]>(MOCK_NOTIFICATIONS)

  const unreadCount = notifications.filter(n => !n.read).length

  const filteredNotifications = notifications.filter((notification) => {
    if (activeFilter === 'all') return true
    if (activeFilter === 'unread') return !notification.read
    if (activeFilter === 'proposals') return notification.type === 'proposal'
    if (activeFilter === 'bookings') return notification.type === 'booking'
    if (activeFilter === 'drafts') return notification.type === 'comment'
    if (activeFilter === 'approvals') return notification.type === 'approval'
    return true
  })

  const markAllAsRead = () => {
    setNotifications(prev => prev.map(n => ({ ...n, read: true })))
  }

  const markAsRead = (id: string) => {
    setNotifications(prev => prev.map(n => n.id === id ? { ...n, read: true } : n))
  }

  const newNotifications = filteredNotifications.filter(n => n.section === 'new')
  const thisWeekNotifications = filteredNotifications.filter(n => n.section === 'thisWeek')
  const earlierNotifications = filteredNotifications.filter(n => n.section === 'earlier')

  return (
    <div className="min-h-screen bg-white">
      <div className="max-w-6xl mx-auto p-8">
        {/* Header */}
        <div className="mb-6">
          <h1 className="text-3xl font-bold text-gray-900 mb-6">Thông báo</h1>

          {/* Filter Tabs */}
          <div className="flex items-center gap-2 mb-4 flex-wrap">
            {FILTER_TABS.map((tab) => (
              <button
                key={tab.id}
                onClick={() => setActiveFilter(tab.id)}
                className={`
                  px-4 py-2 rounded-full text-sm font-medium transition-colors relative
                  ${activeFilter === tab.id
                    ? 'bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white'
                    : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50'
                  }
                `}
              >
                {tab.label}
                {tab.id === 'unread' && unreadCount > 0 && (
                  <span className="ml-2 w-5 h-5 bg-white text-[#6366F1] rounded-full flex items-center justify-center text-xs font-bold">
                    {unreadCount}
                  </span>
                )}
              </button>
            ))}

            {/* Mark all as read button */}
            <button
              onClick={markAllAsRead}
              className="ml-auto flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:text-[#6366F1] transition-colors"
            >
              <FaCheckCircle className="w-4 h-4" />
              <span>Đánh dấu tất cả là đã đọc</span>
            </button>
          </div>
        </div>

        {/* Notifications List */}
        <div className="space-y-8">
          {/* New Section */}
          {newNotifications.length > 0 && (
            <div>
              <h2 className="text-sm font-semibold text-gray-500 mb-4 uppercase tracking-wide">Mới</h2>
              <div className="space-y-3">
                {newNotifications.map((notification) => (
                  <NotificationCard
                    key={notification.id}
                    notification={notification}
                    onMarkAsRead={() => markAsRead(notification.id)}
                  />
                ))}
              </div>
            </div>
          )}

          {/* This Week Section */}
          {thisWeekNotifications.length > 0 && (
            <div>
              <h2 className="text-sm font-semibold text-gray-500 mb-4 uppercase tracking-wide">Tuần này</h2>
              <div className="space-y-3">
                {thisWeekNotifications.map((notification) => (
                  <NotificationCard
                    key={notification.id}
                    notification={notification}
                    onMarkAsRead={() => markAsRead(notification.id)}
                  />
                ))}
              </div>
            </div>
          )}

          {/* Earlier Section */}
          {earlierNotifications.length > 0 && (
            <div>
              <h2 className="text-sm font-semibold text-gray-500 mb-4 uppercase tracking-wide">Trước đó</h2>
              <div className="space-y-3">
                {earlierNotifications.map((notification) => (
                  <NotificationCard
                    key={notification.id}
                    notification={notification}
                    onMarkAsRead={() => markAsRead(notification.id)}
                  />
                ))}
              </div>
            </div>
          )}

          {/* Empty State */}
          {filteredNotifications.length === 0 && (
            <div className="text-center py-12">
              <p className="text-gray-500">Không có thông báo nào</p>
            </div>
          )}
        </div>
      </div>
    </div>
  )
}

interface NotificationCardProps {
  notification: Notification
  onMarkAsRead: () => void
}

function NotificationCard({ notification, onMarkAsRead }: NotificationCardProps) {
  return (
    <div
      className={`
        flex items-start gap-4 p-4 rounded-xl border transition-colors
        ${notification.read 
          ? 'bg-white border-gray-200' 
          : 'bg-blue-50 border-blue-200'
        }
        hover:shadow-md
      `}
    >
      {/* Avatar */}
      <img
        src={notification.avatar}
        alt=""
        className="w-12 h-12 rounded-full flex-shrink-0"
      />

      {/* Content */}
      <div className="flex-1 min-w-0">
        <p className={`text-sm ${notification.read ? 'text-gray-700' : 'text-gray-900 font-medium'}`}>
          {notification.content}
        </p>
        <p className="text-xs text-gray-500 mt-1">{notification.timeAgo}</p>
      </div>

      {/* Actions */}
      <div className="flex items-start gap-3 flex-shrink-0">
        {notification.ctaLabel && (
          <button
            onClick={onMarkAsRead}
            className="px-4 py-2 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white text-sm font-medium rounded-lg hover:opacity-90 transition-opacity whitespace-nowrap"
          >
            {notification.ctaLabel}
          </button>
        )}
        <button
          onClick={onMarkAsRead}
          className={`
            p-2 rounded-lg transition-colors
            ${notification.read 
              ? 'text-gray-400 hover:bg-gray-100' 
              : 'text-[#6366F1] hover:bg-blue-100'
            }
          `}
          title={notification.read ? 'Đã đọc' : 'Đánh dấu là đã đọc'}
        >
          <FaCheck className="w-4 h-4" />
        </button>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/creator/discovery/OpportunitiesPage.tsx">
import { useNavigate } from 'react-router-dom'
import { FaDollarSign, FaCalendarAlt } from 'react-icons/fa'

interface Opportunity {
  id: string
  brandName: string
  industry: string
  budgetMin: number
  budgetMax: number
  deadline: string
}

const MOCK_OPPORTUNITIES: Opportunity[] = [
  {
    id: '1',
    brandName: 'Echo Marketing',
    industry: 'Digital Marketing',
    budgetMin: 1500,
    budgetMax: 3000,
    deadline: '2024-08-15',
  },
  {
    id: '2',
    brandName: 'Aqua Lifestyle',
    industry: 'Health & Wellness',
    budgetMin: 1000,
    budgetMax: 2500,
    deadline: '2024-08-20',
  },
  {
    id: '3',
    brandName: 'Pixel Studios',
    industry: 'Software & Tech',
    budgetMin: 2000,
    budgetMax: 4000,
    deadline: '2024-08-22',
  },
  {
    id: '4',
    brandName: 'Green Harvest Organics',
    industry: 'Food & Beverage',
    budgetMin: 800,
    budgetMax: 1800,
    deadline: '2024-08-25',
  },
  {
    id: '5',
    brandName: 'Urban Chic Boutique',
    industry: 'Fashion',
    budgetMin: 1200,
    budgetMax: 2800,
    deadline: '2024-08-28',
  },
  {
    id: '6',
    brandName: 'Global Connect Telecom',
    industry: 'Telecommunications',
    budgetMin: 2500,
    budgetMax: 5000,
    deadline: '2024-09-01',
  },
]

export default function OpportunitiesPage() {
  const navigate = useNavigate()

  const handlePropose = (opportunityId: string) => {
    navigate(`/creator/proposals/new?opportunityId=${opportunityId}`)
  }

  const formatBudget = (min: number, max: number) => {
    return `$${min.toLocaleString('en-US')} - $${max.toLocaleString('en-US')}`
  }

  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('en-US', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
    })
  }

  return (
    <div className="bg-gray-50 min-h-screen py-8 px-6">
      <div className="max-w-7xl mx-auto">
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-gray-900 mb-2">Cơ hội hợp tác</h1>
          <p className="text-gray-600">
            Khám phá các chiến dịch thú vị từ các thương hiệu hàng đầu và gửi đề xuất của bạn để mở rộng mạng lưới và thu nhập.
          </p>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {MOCK_OPPORTUNITIES.map((opportunity) => (
            <div
              key={opportunity.id}
              className="bg-white rounded-xl border border-gray-200 p-6 hover:shadow-lg transition-shadow"
            >
              <div className="mb-4">
                <h3 className="text-xl font-bold text-gray-900 mb-1">{opportunity.brandName}</h3>
                <p className="text-sm text-gray-600">{opportunity.industry}</p>
              </div>

              <div className="space-y-3 mb-6">
                <div className="flex items-center gap-2">
                  <FaDollarSign className="w-4 h-4 text-gray-500" />
                  <span className="text-sm text-gray-700">{formatBudget(opportunity.budgetMin, opportunity.budgetMax)}</span>
                </div>
                <div className="flex items-center gap-2">
                  <FaCalendarAlt className="w-4 h-4 text-gray-500" />
                  <span className="text-sm text-gray-700">{formatDate(opportunity.deadline)}</span>
                </div>
              </div>

              <button
                onClick={() => handlePropose(opportunity.id)}
                className="w-full px-4 py-2.5 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white font-medium rounded-lg hover:opacity-90 transition-opacity"
              >
                Gửi đề xuất
              </button>
            </div>
          ))}
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/creator/profile/SettingsPage.tsx">
import { useState } from 'react'
import { Link } from 'react-router-dom'
import { useAuth } from '../../../hooks/useAuth'
import { useProfile } from '../../../hooks/useProfile'
import { getSupabase } from '../../../lib/supabase'
import Toast from '../../../components/shared/Toast'
import { FaGoogle, FaFacebook, FaInstagram, FaTiktok, FaCheckCircle, FaTimesCircle } from 'react-icons/fa'

export default function SettingsPage() {
  const { session } = useAuth()
  const { profile } = useProfile(
    session?.user?.id,
    !!(session && session.access_token && session.user.email_confirmed_at)
  )
  const supabase = getSupabase()
  const [currentPassword, setCurrentPassword] = useState('')
  const [newPassword, setNewPassword] = useState('')
  const [confirmPassword, setConfirmPassword] = useState('')
  const [passwordError, setPasswordError] = useState('')
  const [passwordLoading, setPasswordLoading] = useState(false)
  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null)

  // Check if user is OAuth-only (no email/password)
  // Check if user has email provider or if all providers are OAuth
  const userProviders = session?.user?.app_metadata?.providers || []
  const hasEmailProvider = userProviders.includes('email') || session?.user?.email
  const isOAuthOnly = !hasEmailProvider && userProviders.length > 0

  // Get account created date
  const accountCreatedDate = session?.user?.created_at 
    ? new Date(session.user.created_at).toLocaleDateString('vi-VN', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      })
    : 'N/A'

  // Mock connected accounts - replace with real data later
  const connectedAccounts = [
    { name: 'Google', provider: 'google', connected: true, icon: FaGoogle },
    { name: 'Facebook', provider: 'facebook', connected: false, icon: FaFacebook },
    { name: 'Instagram', provider: 'instagram', connected: false, icon: FaInstagram },
    { name: 'TikTok', provider: 'tiktok', connected: false, icon: FaTiktok },
  ]

  // Clear error when user starts typing
  const handleCurrentPasswordChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setCurrentPassword(e.target.value)
    if (passwordError) setPasswordError('')
  }

  const handleNewPasswordChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setNewPassword(e.target.value)
    if (passwordError) setPasswordError('')
  }

  const handleConfirmPasswordChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setConfirmPassword(e.target.value)
    if (passwordError) setPasswordError('')
  }

  const handleChangePassword = async () => {
    // Clear previous errors
    setPasswordError('')

    // Validation: All fields required
    if (!currentPassword || !newPassword || !confirmPassword) {
      setPasswordError('Vui lòng điền đầy đủ thông tin')
      return
    }

    // Validation: New password must be different from current password
    if (currentPassword === newPassword) {
      setPasswordError('Mật khẩu mới phải khác với mật khẩu hiện tại')
      return
    }

    // Validation: Confirm password must match new password
    if (newPassword !== confirmPassword) {
      setPasswordError('Mật khẩu mới không khớp')
      return
    }

    // Validation: Minimum length
    if (newPassword.length < 6) {
      setPasswordError('Mật khẩu phải có ít nhất 6 ký tự')
      return
    }

    if (!session?.user?.email) {
      setPasswordError('Không tìm thấy thông tin người dùng')
      return
    }

    setPasswordLoading(true)

    try {
      // Step 1: Re-authenticate with current password to verify it's correct
      const { error: signInError } = await supabase.auth.signInWithPassword({
        email: session.user.email,
        password: currentPassword,
      })

      if (signInError) {
        setPasswordError('Mật khẩu hiện tại không đúng')
        setPasswordLoading(false)
        return
      }

      // Step 2: Update password
      const { error: updateError } = await supabase.auth.updateUser({
        password: newPassword,
      })

      if (updateError) {
        setPasswordError(updateError.message || 'Có lỗi xảy ra khi đổi mật khẩu')
        setPasswordLoading(false)
        return
      }

      // Success: Clear form and show toast
      setCurrentPassword('')
      setNewPassword('')
      setConfirmPassword('')
      setPasswordError('')
      setToast({ message: 'Đổi mật khẩu thành công', type: 'success' })
    } catch (error: any) {
      setPasswordError(error.message || 'Có lỗi xảy ra khi đổi mật khẩu')
    } finally {
      setPasswordLoading(false)
    }
  }

  return (
    <div className="bg-gray-50 py-8 px-6">
      <div className="max-w-7xl mx-auto">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          
          {/* CARD 1: Account Information */}
          <div className="bg-white rounded-xl border border-gray-200 p-6">
            <h2 className="text-2xl font-semibold text-[#374151] mb-6">Thông tin tài khoản</h2>
            
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Email
                </label>
                <input
                  type="email"
                  value={session?.user?.email || ''}
                  disabled
                  className="w-full px-4 py-2.5 rounded-lg border border-gray-300 bg-gray-50 text-gray-600 cursor-not-allowed"
                />
                <p className="text-xs text-gray-500 mt-1">Email không thể thay đổi</p>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ngày tạo tài khoản
                </label>
                <p className="text-gray-700">{accountCreatedDate}</p>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-3">
                  Tài khoản đã kết nối
                </label>
                <div className="space-y-2">
                  {connectedAccounts.map((account) => {
                    const Icon = account.icon
                    return (
                      <div
                        key={account.provider}
                        className="flex items-center justify-between p-3 rounded-lg border border-gray-200"
                      >
                        <div className="flex items-center gap-3">
                          <Icon className="w-5 h-5 text-gray-600" />
                          <span className="text-sm font-medium text-gray-700">{account.name}</span>
                        </div>
                        <div className="flex items-center gap-2">
                          {account.connected ? (
                            <>
                              <FaCheckCircle className="w-4 h-4 text-green-600" />
                              <span className="text-sm text-green-600">Đã kết nối</span>
                            </>
                          ) : (
                            <>
                              <FaTimesCircle className="w-4 h-4 text-gray-400" />
                              <span className="text-sm text-gray-500">Chưa kết nối</span>
                            </>
                          )}
                        </div>
                      </div>
                    )
                  })}
                </div>
              </div>
            </div>
          </div>

          {/* CARD 2: Change Password */}
          <div className="bg-white rounded-xl border border-gray-200 p-6">
            <h2 className="text-2xl font-semibold text-[#374151] mb-6">Đổi mật khẩu</h2>
            
            {isOAuthOnly ? (
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <p className="text-sm text-blue-800">
                  Tài khoản của bạn được đăng nhập qua OAuth. Tính năng đổi mật khẩu không khả dụng cho tài khoản này.
                </p>
              </div>
            ) : (
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Mật khẩu hiện tại
                  </label>
                  <input
                    type="password"
                    value={currentPassword}
                    onChange={handleCurrentPasswordChange}
                    className="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#6366F1] focus:border-transparent"
                    placeholder="Nhập mật khẩu hiện tại"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Mật khẩu mới
                  </label>
                  <input
                    type="password"
                    value={newPassword}
                    onChange={handleNewPasswordChange}
                    className="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#6366F1] focus:border-transparent"
                    placeholder="Nhập mật khẩu mới"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Xác nhận mật khẩu mới
                  </label>
                  <input
                    type="password"
                    value={confirmPassword}
                    onChange={handleConfirmPasswordChange}
                    className="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#6366F1] focus:border-transparent"
                    placeholder="Nhập lại mật khẩu mới"
                  />
                </div>

                <button
                  onClick={handleChangePassword}
                  disabled={passwordLoading}
                  className="px-6 py-2.5 rounded-xl font-medium text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] hover:opacity-90 disabled:opacity-50 transition-opacity"
                >
                  {passwordLoading ? 'Đang xử lý...' : 'Đổi mật khẩu'}
                </button>

                {passwordError && (
                  <p className="text-sm text-red-600 mt-2">
                    {passwordError}
                  </p>
                )}
              </div>
            )}
          </div>

          {/* CARD 3: Subscription */}
          <div className="bg-white rounded-xl border border-gray-200 p-6">
            <h2 className="text-2xl font-semibold text-[#374151] mb-6">Gói đăng ký</h2>
            
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Gói hiện tại
                </label>
                <p className="text-gray-700">Miễn phí</p>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ngày hết hạn
                </label>
                <p className="text-gray-700">Không giới hạn</p>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Trạng thái
                </label>
                <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                  Đang hoạt động
                </span>
              </div>

              <button
                disabled
                className="px-6 py-2.5 rounded-xl font-medium text-[#6366F1] border border-[#6366F1] opacity-50 cursor-not-allowed"
              >
                Nâng cấp gói (Coming soon)
              </button>
            </div>
          </div>

          {/* CARD 4: Security & Data Usage (READ-ONLY) */}
          <div className="bg-white rounded-xl border border-gray-200 p-6">
            <h2 className="text-2xl font-semibold text-[#374151] mb-6">Bảo mật & Sử dụng dữ liệu</h2>
            
            <div className="space-y-4 text-gray-700">
              <div>
                <h3 className="font-semibold mb-2">Dữ liệu chúng tôi thu thập</h3>
                <p className="text-sm mb-4">
                  ALINO thu thập thông tin cá nhân của bạn để cung cấp và cải thiện dịch vụ, bao gồm:
                </p>
                <ul className="list-disc pl-6 text-sm space-y-1 mb-4">
                  <li>Thông tin tài khoản (email, tên, ngày sinh, địa chỉ)</li>
                  <li>Thông tin hồ sơ công khai</li>
                  <li>Dữ liệu từ các tài khoản mạng xã hội được kết nối (Google, Facebook, Instagram, TikTok)</li>
                  <li>Thông tin về cách bạn sử dụng nền tảng</li>
                </ul>
              </div>

              <div>
                <h3 className="font-semibold mb-2">Mục đích sử dụng</h3>
                <p className="text-sm mb-4">
                  Chúng tôi sử dụng dữ liệu của bạn để:
                </p>
                <ul className="list-disc pl-6 text-sm space-y-1 mb-4">
                  <li>Kết nối bạn với các đối tác phù hợp (Creators với Brands)</li>
                  <li>Cải thiện trải nghiệm người dùng và tính năng của nền tảng</li>
                  <li>Gửi thông báo và cập nhật về dịch vụ</li>
                  <li>Phân tích và tối ưu hóa hiệu suất</li>
                </ul>
              </div>

              <div>
                <h3 className="font-semibold mb-2">Kết nối mạng xã hội</h3>
                <p className="text-sm mb-4">
                  Khi bạn kết nối tài khoản mạng xã hội với ALINO, chúng tôi có thể truy cập và lưu trữ 
                  thông tin công khai từ các tài khoản đó để cung cấp dịch vụ tốt hơn và tạo điều kiện 
                  cho các tính năng của nền tảng.
                </p>
              </div>

              <div className="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p className="text-sm text-gray-700">
                  Để biết thêm chi tiết về cách chúng tôi xử lý dữ liệu của bạn, vui lòng xem{' '}
                  <Link to="/privacy" className="text-[#6366F1] hover:underline">
                    Chính sách bảo mật
                  </Link>
                  {' '}của chúng tôi.
                </p>
              </div>
            </div>
          </div>

        </div>
      </div>

      {/* Toast Notification */}
      {toast && (
        <Toast
          message={toast.message}
          type={toast.type}
          onClose={() => setToast(null)}
        />
      )}
    </div>
  )
}
</file>

<file path="src/pages/creator/proposals/DealWorkspacePage.tsx">
import { useState } from 'react'
import { FaCloudUploadAlt, FaPaperPlane, FaCheck, FaFile, FaFilePdf, FaFileImage } from 'react-icons/fa'

interface FileItem {
  id: string
  name: string
  size: string
  status: 'draft' | 'submitted' | 'approved' | 'final'
  type: string
}

interface Message {
  id: string
  sender: 'creator' | 'brand'
  senderName: string
  timestamp: string
  content: string
}

interface Milestone {
  id: string
  title: string
  date: string
  completed: boolean
}

interface Task {
  id: string
  name: string
  dueDate: string
  completed: boolean
}

const MOCK_FILES: FileItem[] = [
  { id: '1', name: 'Initial_Moodboard.pdf', size: '2.3 MB', status: 'approved', type: 'pdf' },
  { id: '2', name: 'Draft_Concepts_v1.psd', size: '15.1 MB', status: 'submitted', type: 'psd' },
  { id: '3', name: 'Revised_Concepts_v2.png', size: '7.8 MB', status: 'draft', type: 'image' },
  { id: '4', name: 'Final_Deliverable.zip', size: '32.5 MB', status: 'final', type: 'zip' },
]

const MOCK_MESSAGES: Message[] = [
  { id: '1', sender: 'brand', senderName: 'Brand Contact', timestamp: '10:30 AM', content: 'Hi John, I love the initial concepts! Could we explore a slightly warmer color palette for the key visuals?' },
  { id: '2', sender: 'creator', senderName: 'You', timestamp: '10:45 AM', content: 'Absolutely! I\'ll prepare some revisions with a warmer palette and send them over by tomorrow evening. 😊' },
  { id: '3', sender: 'brand', senderName: 'Brand Contact', timestamp: '10:50 AM', content: 'Great, looking forward to seeing them! Thanks for the quick turnaround.' },
]

const MOCK_MILESTONES: Milestone[] = [
  { id: '1', title: 'Proposal Accepted', date: 'Jan 10, 2024', completed: true },
  { id: '2', title: 'Initial Concepts Submitted', date: 'Jan 15, 2024', completed: true },
  { id: '3', title: 'Feedback Received', date: 'Jan 17, 2024', completed: true },
  { id: '4', title: 'Revised Concepts Submitted', date: 'Jan 18, 2024', completed: true },
  { id: '5', title: 'Final Approval', date: 'Jan 25, 2024', completed: true },
  { id: '6', title: 'Deliverables Finalized', date: 'Jan 28, 2024', completed: true },
]

const MOCK_TASKS: Task[] = [
  { id: '1', name: 'Review brand guidelines', dueDate: 'Jan 12, 2024', completed: true },
  { id: '2', name: 'Develop initial concept drafts', dueDate: 'Jan 14, 2024', completed: true },
  { id: '3', name: 'Incorporate feedback on color palette', dueDate: 'Jan 19, 2024', completed: false },
  { id: '4', name: 'Prepare final high-resolution deliverables', dueDate: 'Jan 24, 2024', completed: false },
  { id: '5', name: 'Submit deliverables for final approval', dueDate: 'Jan 25, 2024', completed: false },
]

export default function DealWorkspacePage() {
  const [files, setFiles] = useState<FileItem[]>(MOCK_FILES)
  const [messages, setMessages] = useState<Message[]>(MOCK_MESSAGES)
  const [newMessage, setNewMessage] = useState('')
  const [tasks, setTasks] = useState<Task[]>(MOCK_TASKS)

  const handleFileUpload = () => {
    const newFile: FileItem = {
      id: Date.now().toString(),
      name: `New_File_${files.length + 1}.pdf`,
      size: '1.2 MB',
      status: 'draft',
      type: 'pdf',
    }
    setFiles([...files, newFile])
  }

  const handleSendMessage = () => {
    if (!newMessage.trim()) return
    const message: Message = {
      id: Date.now().toString(),
      sender: 'creator',
      senderName: 'You',
      timestamp: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }),
      content: newMessage,
    }
    setMessages([...messages, message])
    setNewMessage('')
  }

  const handleTaskToggle = (taskId: string) => {
    setTasks(tasks.map(task => task.id === taskId ? { ...task, completed: !task.completed } : task))
  }

  const getStatusBadgeClass = (status: FileItem['status']) => {
    switch (status) {
      case 'draft':
        return 'bg-gray-100 text-gray-700'
      case 'submitted':
        return 'bg-purple-100 text-purple-700'
      case 'approved':
        return 'bg-green-100 text-green-700'
      case 'final':
        return 'bg-purple-600 text-white'
      default:
        return 'bg-gray-100 text-gray-700'
    }
  }

  const getStatusLabel = (status: FileItem['status']) => {
    switch (status) {
      case 'draft':
        return 'Draft'
      case 'submitted':
        return 'Submitted'
      case 'approved':
        return 'Approved'
      case 'final':
        return 'Final'
      default:
        return status
    }
  }

  const getFileIcon = (type: string) => {
    if (type === 'pdf') return <FaFilePdf className="w-5 h-5 text-red-600" />
    if (type === 'image' || type === 'png' || type === 'psd') return <FaFileImage className="w-5 h-5 text-blue-600" />
    return <FaFile className="w-5 h-5 text-gray-600" />
  }

  return (
    <div className="bg-gray-50 min-h-screen py-8 px-6">
      <div className="max-w-7xl mx-auto">
        <div className="mb-8">
          <div className="flex items-center justify-between mb-4">
            <div>
              <h1 className="text-3xl font-bold text-gray-900 mb-1">Spring Collection Launch</h1>
              <p className="text-lg text-gray-600">FashionNova</p>
            </div>
            <div className="flex items-center gap-4">
              <span className="px-4 py-2 bg-purple-100 text-purple-700 rounded-full text-sm font-medium">
                Đang thực hiện
              </span>
              <button className="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                Xem chi tiết chiến dịch
              </button>
              <button className="px-4 py-2 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white rounded-lg hover:opacity-90 transition-opacity">
                Liên hệ thương hiệu
              </button>
            </div>
          </div>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div className="lg:col-span-2 space-y-6">
            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <h2 className="text-xl font-semibold text-gray-900 mb-2">Quản lý tệp</h2>
              <p className="text-sm text-gray-600 mb-6">
                Tải lên bản nháp và xem các sản phẩm đầu ra.
              </p>

              <div
                onClick={handleFileUpload}
                className="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center mb-6 cursor-pointer hover:border-purple-400 transition-colors"
              >
                <FaCloudUploadAlt className="w-12 h-12 text-gray-400 mx-auto mb-4" />
                <p className="text-gray-700 font-medium mb-2">Kéo thả tệp vào đây hoặc nhấp để duyệt</p>
                <p className="text-sm text-gray-500">Kích thước tệp tối đa: 25MB</p>
              </div>

              <div className="space-y-3 mb-6">
                {files.map((file) => (
                  <div key={file.id} className="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                    <div className="flex items-center gap-3">
                      {getFileIcon(file.type)}
                      <div>
                        <p className="font-medium text-gray-900">{file.name}</p>
                        <p className="text-sm text-gray-500">{file.size}</p>
                      </div>
                    </div>
                    <span className={`px-3 py-1 rounded-full text-xs font-medium ${getStatusBadgeClass(file.status)}`}>
                      {getStatusLabel(file.status)}
                    </span>
                  </div>
                ))}
              </div>

              <div className="flex gap-4">
                <button className="flex-1 px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                  Lưu bản nháp
                </button>
                <button className="flex-1 px-4 py-2.5 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white rounded-lg hover:opacity-90 transition-opacity">
                  Gửi để xem xét
                </button>
              </div>
            </div>

            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <h2 className="text-xl font-semibold text-gray-900 mb-2">Luồng phản hồi</h2>
              <p className="text-sm text-gray-600 mb-6">
                Cộng tác với thương hiệu về thỏa thuận này.
              </p>

              <div className="space-y-4 mb-6 max-h-96 overflow-y-auto">
                {messages.map((message) => (
                  <div
                    key={message.id}
                    className={`flex gap-3 ${message.sender === 'creator' ? 'flex-row-reverse' : ''}`}
                  >
                    <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${
                      message.sender === 'creator'
                        ? 'bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white'
                        : 'bg-gray-200 text-gray-600'
                    }`}>
                      {message.senderName.charAt(0)}
                    </div>
                    <div className={`flex-1 ${message.sender === 'creator' ? 'text-right' : ''}`}>
                      <div className="flex items-center gap-2 mb-1">
                        <span className="font-medium text-gray-900">{message.senderName}</span>
                        <span className="text-xs text-gray-500">{message.timestamp}</span>
                      </div>
                      <div className={`inline-block px-4 py-2 rounded-lg ${
                        message.sender === 'creator'
                          ? 'bg-purple-100 text-gray-900'
                          : 'bg-gray-100 text-gray-900'
                      }`}>
                        {message.content}
                      </div>
                    </div>
                  </div>
                ))}
              </div>

              <div className="flex gap-3">
                <input
                  type="text"
                  value={newMessage}
                  onChange={(e) => setNewMessage(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                  placeholder="Viết tin nhắn của bạn..."
                  className="flex-1 px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
                <button
                  onClick={handleSendMessage}
                  className="px-4 py-2.5 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white rounded-lg hover:opacity-90 transition-opacity"
                >
                  <FaPaperPlane className="w-5 h-5" />
                </button>
              </div>
            </div>
          </div>

          <div className="space-y-6">
            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <h2 className="text-xl font-semibold text-gray-900 mb-2">Lịch sử trạng thái thỏa thuận</h2>
              <p className="text-sm text-gray-600 mb-6">
                Theo dõi các cột mốc quan trọng và tiến độ.
              </p>

              <div className="space-y-4">
                {MOCK_MILESTONES.map((milestone, index) => (
                  <div key={milestone.id} className="flex gap-4">
                    <div className="flex flex-col items-center">
                      <div className={`w-8 h-8 rounded-full flex items-center justify-center ${
                        milestone.completed
                          ? 'bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white'
                          : 'bg-gray-200 text-gray-400'
                      }`}>
                        {milestone.completed && <FaCheck className="w-4 h-4" />}
                      </div>
                      {index < MOCK_MILESTONES.length - 1 && (
                        <div className={`w-0.5 flex-1 ${milestone.completed ? 'bg-purple-300' : 'bg-gray-200'}`} />
                      )}
                    </div>
                    <div className="flex-1 pb-4">
                      <p className={`font-medium ${milestone.completed ? 'text-gray-900' : 'text-gray-400'}`}>
                        {milestone.title}
                      </p>
                      <p className="text-sm text-gray-500">{milestone.date}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            <div className="bg-white rounded-xl border border-gray-200 p-6">
              <h2 className="text-xl font-semibold text-gray-900 mb-2">Danh sách công việc</h2>
              <p className="text-sm text-gray-600 mb-6">
                Các công việc còn lại của bạn cho thỏa thuận này.
              </p>

              <div className="space-y-4">
                {tasks.map((task) => (
                  <div key={task.id} className="flex items-start gap-3">
                    <input
                      type="checkbox"
                      checked={task.completed}
                      onChange={() => handleTaskToggle(task.id)}
                      className="mt-1 w-5 h-5 text-purple-600 rounded focus:ring-purple-500"
                    />
                    <div className="flex-1">
                      <p className={`font-medium ${task.completed ? 'text-gray-400 line-through' : 'text-gray-900'}`}>
                        {task.name}
                      </p>
                      <p className="text-sm text-gray-500">Đến hạn: {task.dueDate}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/creator/proposals/SubmitProposalPage.tsx">
import { useState, useEffect, useRef } from 'react'
import { useNavigate, useSearchParams } from 'react-router-dom'
import { FaPaperPlane, FaEye, FaCheck, FaTimes, FaChevronDown } from 'react-icons/fa'
import CreatorDashboardLayout from '../../../components/creator/CreatorDashboardLayout'

interface ProposalFormData {
  campaignId: string
  campaignName: string
  customMessage: string
  serviceId: string
  serviceName: string
  price: string
  notes: string
  timeline: string
  deliverables: string
  attachments: File[]
}

const MOCK_CAMPAIGNS = [
  { id: '1', name: 'Echo Marketing - Digital Marketing Campaign' },
  { id: '2', name: 'Aqua Lifestyle - Health & Wellness Promotion' },
  { id: '3', name: 'Pixel Studios - Software Launch Campaign' },
  { id: '4', name: 'Green Harvest Organics - Product Launch' },
]

const MOCK_SERVICES = [
  { id: '1', name: 'Basic Social Media Kit', basePrice: 250 },
  { id: '2', name: 'Premium Content Creation', basePrice: 750 },
  { id: '3', name: 'Influencer Campaign Management', basePrice: 1500 },
]

export default function SubmitProposalPage() {
  const navigate = useNavigate()
  const [searchParams] = useSearchParams()
  const opportunityId = searchParams.get('opportunityId')

  const [currentStep, setCurrentStep] = useState(1)
  const [formData, setFormData] = useState<ProposalFormData>({
    campaignId: opportunityId || '',
    campaignName: '',
    customMessage: '',
    serviceId: '',
    serviceName: '',
    price: '',
    notes: '',
    timeline: '',
    deliverables: '',
    attachments: [],
  })

  const [campaignDropdownOpen, setCampaignDropdownOpen] = useState(false)
  const [serviceDropdownOpen, setServiceDropdownOpen] = useState(false)

  const steps = [
    { number: 1, label: 'Chi tiết đề xuất' },
    { number: 2, label: 'Dịch vụ & Giá' },
    { number: 3, label: 'Giao hàng & Đính kèm' },
    { number: 4, label: 'Xem lại & Gửi' },
  ]

  const handleCampaignSelect = (campaign: { id: string; name: string }) => {
    setFormData({ ...formData, campaignId: campaign.id, campaignName: campaign.name })
    setCampaignDropdownOpen(false)
  }

  const handleServiceSelect = (service: { id: string; name: string; basePrice: number }) => {
    setFormData({
      ...formData,
      serviceId: service.id,
      serviceName: service.name,
      price: service.basePrice.toString(),
    })
    setServiceDropdownOpen(false)
  }

  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (e.target.files) {
      const files = Array.from(e.target.files)
      setFormData({ ...formData, attachments: [...formData.attachments, ...files] })
    }
  }

  const handleRemoveFile = (index: number) => {
    setFormData({
      ...formData,
      attachments: formData.attachments.filter((_, i) => i !== index),
    })
  }

  const canProceedToNextStep = () => {
    if (currentStep === 1) {
      return formData.campaignId && formData.customMessage.trim()
    }
    if (currentStep === 2) {
      return formData.serviceId && formData.price.trim()
    }
    if (currentStep === 3) {
      return formData.timeline.trim()
    }
    return true
  }

  const handleNext = () => {
    if (canProceedToNextStep() && currentStep < 4) {
      setCurrentStep(currentStep + 1)
    }
  }

  const handlePrevious = () => {
    if (currentStep > 1) {
      setCurrentStep(currentStep - 1)
    }
  }

  const handleSubmit = () => {
    navigate('/creator/proposals')
  }

  const selectedCampaign = MOCK_CAMPAIGNS.find(c => c.id === formData.campaignId)
  const selectedService = MOCK_SERVICES.find(s => s.id === formData.serviceId)

  const dropdownRef = useRef<HTMLDivElement>(null)
  const serviceDropdownRef = useRef<HTMLDivElement>(null)

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {
        setCampaignDropdownOpen(false)
      }
      if (serviceDropdownRef.current && !serviceDropdownRef.current.contains(event.target as Node)) {
        setServiceDropdownOpen(false)
      }
    }

    document.addEventListener('mousedown', handleClickOutside)
    return () => document.removeEventListener('mousedown', handleClickOutside)
  }, [])

  return (
    <CreatorDashboardLayout>
      <div className="bg-gray-50 min-h-screen py-8 px-6">
        <div className="max-w-7xl mx-auto">
          <div className="mb-8">
            <h1 className="text-3xl font-bold text-gray-900 mb-2">Gửi đề xuất của bạn</h1>
            <p className="text-gray-600 mb-6">
              Tạo một đề xuất chiến thắng để được các thương hiệu chú ý.
            </p>

            <div className="flex items-center gap-6 pb-4 border-b border-gray-200">
              <div className="flex items-center gap-2">
                <div className="w-8 h-8 rounded-full bg-gradient-to-r from-[#6366F1] to-[#EC4899] flex items-center justify-center">
                  <FaPaperPlane className="w-4 h-4 text-white" />
                </div>
                <span className="text-sm font-medium text-gray-900">Đã gửi</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center">
                  <FaEye className="w-4 h-4 text-gray-500" />
                </div>
                <span className="text-sm text-gray-600">Đã xem</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center">
                  <FaCheck className="w-4 h-4 text-gray-500" />
                </div>
                <span className="text-sm text-gray-600">Đã chấp nhận</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center">
                  <FaTimes className="w-4 h-4 text-gray-500" />
                </div>
                <span className="text-sm text-gray-600">Đã từ chối</span>
              </div>
            </div>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <div className="lg:col-span-1">
              <div className="bg-white rounded-xl border border-gray-200 p-6 sticky top-24">
                <h2 className="text-lg font-semibold text-gray-900 mb-2">Các bước đề xuất</h2>
                <p className="text-sm text-gray-600 mb-6">
                  Làm theo các bước để hoàn thành đề xuất của bạn
                </p>
                <div className="space-y-2">
                  {steps.map((step) => (
                    <div
                      key={step.number}
                      className={`px-4 py-3 rounded-lg ${
                        currentStep === step.number
                          ? 'bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white'
                          : 'bg-gray-50 text-gray-700'
                      }`}
                    >
                      <div className="flex items-center gap-3">
                        <span className="font-semibold">{step.number}</span>
                        <span className="text-sm font-medium">{step.label}</span>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>

            <div className="lg:col-span-3">
              <div className="bg-white rounded-xl border border-gray-200 p-8">
                {currentStep === 1 && (
                  <div>
                    <h2 className="text-2xl font-semibold text-gray-900 mb-2">1. Chi tiết đề xuất</h2>
                    <p className="text-gray-600 mb-6">
                      Chọn chiến dịch và thêm thông điệp tùy chỉnh.
                    </p>

                    <div className="space-y-6">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Chiến dịch *
                        </label>
                        <div className="relative" ref={dropdownRef}>
                          <button
                            type="button"
                            onClick={() => setCampaignDropdownOpen(!campaignDropdownOpen)}
                            className="w-full px-4 py-2.5 text-left border border-gray-300 rounded-lg bg-white flex items-center justify-between hover:border-gray-400 transition-colors"
                          >
                            <span className={selectedCampaign ? 'text-gray-900' : 'text-gray-500'}>
                              {selectedCampaign?.name || 'Chọn chiến dịch'}
                            </span>
                            <FaChevronDown className="w-4 h-4 text-gray-500" />
                          </button>
                          {campaignDropdownOpen && (
                            <div className="absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                              {MOCK_CAMPAIGNS.map((campaign) => (
                                <button
                                  key={campaign.id}
                                  type="button"
                                  onClick={() => handleCampaignSelect(campaign)}
                                  className="w-full px-4 py-2.5 text-left hover:bg-gray-50 transition-colors"
                                >
                                  {campaign.name}
                                </button>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Thông điệp tùy chỉnh *
                        </label>
                        <textarea
                          value={formData.customMessage}
                          onChange={(e) => setFormData({ ...formData, customMessage: e.target.value })}
                          placeholder="Giới thiệu bản thân và giải thích tại sao bạn phù hợp với chiến dịch này."
                          rows={8}
                          className="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#6366F1] focus:border-transparent resize-y"
                        />
                      </div>
                    </div>
                  </div>
                )}

                {currentStep === 2 && (
                  <div>
                    <h2 className="text-2xl font-semibold text-gray-900 mb-2">2. Dịch vụ & Giá</h2>
                    <p className="text-gray-600 mb-6">
                      Chọn dịch vụ và đặt giá cho đề xuất này.
                    </p>

                    <div className="space-y-6">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Dịch vụ *
                        </label>
                        <div className="relative" ref={serviceDropdownRef}>
                          <button
                            type="button"
                            onClick={() => setServiceDropdownOpen(!serviceDropdownOpen)}
                            className="w-full px-4 py-2.5 text-left border border-gray-300 rounded-lg bg-white flex items-center justify-between hover:border-gray-400 transition-colors"
                          >
                            <span className={selectedService ? 'text-gray-900' : 'text-gray-500'}>
                              {selectedService?.name || 'Chọn dịch vụ'}
                            </span>
                            <FaChevronDown className="w-4 h-4 text-gray-500" />
                          </button>
                          {serviceDropdownOpen && (
                            <div className="absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                              {MOCK_SERVICES.map((service) => (
                                <button
                                  key={service.id}
                                  type="button"
                                  onClick={() => handleServiceSelect(service)}
                                  className="w-full px-4 py-2.5 text-left hover:bg-gray-50 transition-colors"
                                >
                                  <div className="font-medium text-gray-900">{service.name}</div>
                                  <div className="text-sm text-gray-500">Giá cơ bản: ${service.basePrice}</div>
                                </button>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Giá (USD) *
                        </label>
                        <input
                          type="number"
                          value={formData.price}
                          onChange={(e) => setFormData({ ...formData, price: e.target.value })}
                          placeholder="Nhập giá"
                          min="1"
                          className="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#6366F1] focus:border-transparent"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Ghi chú (tùy chọn)
                        </label>
                        <textarea
                          value={formData.notes}
                          onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                          placeholder="Thêm ghi chú về dịch vụ hoặc giá"
                          rows={4}
                          className="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#6366F1] focus:border-transparent resize-y"
                        />
                      </div>
                    </div>
                  </div>
                )}

                {currentStep === 3 && (
                  <div>
                    <h2 className="text-2xl font-semibold text-gray-900 mb-2">3. Giao hàng & Đính kèm</h2>
                    <p className="text-gray-600 mb-6">
                      Chỉ định thời gian giao hàng và đính kèm các tệp liên quan.
                    </p>

                    <div className="space-y-6">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Thời gian ước tính *
                        </label>
                        <input
                          type="text"
                          value={formData.timeline}
                          onChange={(e) => setFormData({ ...formData, timeline: e.target.value })}
                          placeholder="Ví dụ: 5-7 ngày làm việc"
                          className="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#6366F1] focus:border-transparent"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Đính kèm (tùy chọn)
                        </label>
                        <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                          <input
                            type="file"
                            multiple
                            onChange={handleFileSelect}
                            className="hidden"
                            id="file-upload"
                          />
                          <label
                            htmlFor="file-upload"
                            className="cursor-pointer inline-block px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
                          >
                            Chọn tệp
                          </label>
                          {formData.attachments.length > 0 && (
                            <div className="mt-4 space-y-2">
                              {formData.attachments.map((file, index) => (
                                <div
                                  key={index}
                                  className="flex items-center justify-between px-4 py-2 bg-gray-50 rounded-lg"
                                >
                                  <span className="text-sm text-gray-700">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => handleRemoveFile(index)}
                                    className="text-red-600 hover:text-red-700"
                                  >
                                    <FaTimes className="w-4 h-4" />
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Sản phẩm đầu ra (tùy chọn)
                        </label>
                        <textarea
                          value={formData.deliverables}
                          onChange={(e) => setFormData({ ...formData, deliverables: e.target.value })}
                          placeholder="Mô tả các sản phẩm đầu ra cụ thể"
                          rows={4}
                          className="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#6366F1] focus:border-transparent resize-y"
                        />
                      </div>
                    </div>
                  </div>
                )}

                {currentStep === 4 && (
                  <div>
                    <h2 className="text-2xl font-semibold text-gray-900 mb-2">4. Xem lại & Gửi</h2>
                    <p className="text-gray-600 mb-6">
                      Xem lại thông tin đề xuất của bạn trước khi gửi.
                    </p>

                    <div className="space-y-6">
                      <div className="border border-gray-200 rounded-lg p-6">
                        <h3 className="font-semibold text-gray-900 mb-4">Chi tiết đề xuất</h3>
                        <div className="space-y-3">
                          <div>
                            <span className="text-sm text-gray-600">Chiến dịch:</span>
                            <p className="text-gray-900">{formData.campaignName || '-'}</p>
                          </div>
                          <div>
                            <span className="text-sm text-gray-600">Thông điệp:</span>
                            <p className="text-gray-900 whitespace-pre-wrap">{formData.customMessage || '-'}</p>
                          </div>
                        </div>
                      </div>

                      <div className="border border-gray-200 rounded-lg p-6">
                        <h3 className="font-semibold text-gray-900 mb-4">Dịch vụ & Giá</h3>
                        <div className="space-y-3">
                          <div>
                            <span className="text-sm text-gray-600">Dịch vụ:</span>
                            <p className="text-gray-900">{formData.serviceName || '-'}</p>
                          </div>
                          <div>
                            <span className="text-sm text-gray-600">Giá:</span>
                            <p className="text-gray-900">${formData.price || '-'}</p>
                          </div>
                          {formData.notes && (
                            <div>
                              <span className="text-sm text-gray-600">Ghi chú:</span>
                              <p className="text-gray-900">{formData.notes}</p>
                            </div>
                          )}
                        </div>
                      </div>

                      <div className="border border-gray-200 rounded-lg p-6">
                        <h3 className="font-semibold text-gray-900 mb-4">Giao hàng & Đính kèm</h3>
                        <div className="space-y-3">
                          <div>
                            <span className="text-sm text-gray-600">Thời gian ước tính:</span>
                            <p className="text-gray-900">{formData.timeline || '-'}</p>
                          </div>
                          {formData.deliverables && (
                            <div>
                              <span className="text-sm text-gray-600">Sản phẩm đầu ra:</span>
                              <p className="text-gray-900 whitespace-pre-wrap">{formData.deliverables}</p>
                            </div>
                          )}
                          {formData.attachments.length > 0 && (
                            <div>
                              <span className="text-sm text-gray-600">Tệp đính kèm:</span>
                              <div className="mt-2 space-y-1">
                                {formData.attachments.map((file, index) => (
                                  <p key={index} className="text-gray-900 text-sm">{file.name}</p>
                                ))}
                              </div>
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                <div className="flex items-center justify-end gap-4 mt-8 pt-6 border-t border-gray-200">
                  {currentStep > 1 && (
                    <button
                      onClick={handlePrevious}
                      className="px-6 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                    >
                      Trước
                    </button>
                  )}
                  {currentStep < 4 ? (
                    <button
                      onClick={handleNext}
                      disabled={!canProceedToNextStep()}
                      className="px-6 py-2.5 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white rounded-lg hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      Tiếp theo
                    </button>
                  ) : (
                    <button
                      onClick={handleSubmit}
                      className="px-6 py-2.5 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white rounded-lg hover:opacity-90 transition-opacity"
                    >
                      Gửi đề xuất
                    </button>
                  )}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </CreatorDashboardLayout>
  )
}
</file>

<file path="src/pages/creator/services/ServicesPage.tsx">
import { useState, useEffect } from 'react'
import { useAuth } from '../../../hooks/useAuth'
import { useProfile } from '../../../hooks/useProfile'
import { getSupabase } from '../../../lib/supabase'
import { FaCheck, FaEdit, FaEye, FaTrash, FaTimes, FaExternalLinkAlt } from 'react-icons/fa'
import UpgradePlanModal from '../../../components/shared/UpgradePlanModal'
import Toast from '../../../components/shared/Toast'

interface Service {
  id: string
  user_id: string
  name: string
  price: number
  description: string
  deliverables: string[]
  estimated_timeline: string
  status: 'active' | 'draft' | 'hidden'
  created_at: string
  updated_at: string
}

type ServiceStatus = 'active' | 'draft' | 'hidden'

const FREE_PLAN_MAX_SERVICES = 3
const PRO_PLAN_MAX_SERVICES = 10

export default function ServicesPage() {
  const { session } = useAuth()
  const { profile } = useProfile(
    session?.user?.id,
    !!(session && session.access_token && session.user.email_confirmed_at)
  )
  const supabase = getSupabase()

  const [services, setServices] = useState<Service[]>([])
  const [loading, setLoading] = useState(true)
  const [showForm, setShowForm] = useState(false)
  const [editingService, setEditingService] = useState<Service | null>(null)
  const [showUpgradeModal, setShowUpgradeModal] = useState(false)
  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null)

  // Form state
  const [formData, setFormData] = useState({
    name: '',
    price: '',
    description: '',
    deliverables: '',
    estimated_timeline: '',
  })
  const [formErrors, setFormErrors] = useState<Record<string, string>>({})

  const currentPlan = profile?.is_admin ? 'business' : 'free' // TODO: Get from subscription
  const canShowPricing = currentPlan !== 'free'
  const maxServices = currentPlan === 'free' ? FREE_PLAN_MAX_SERVICES : currentPlan === 'pro' ? PRO_PLAN_MAX_SERVICES : Infinity
  const activeServicesCount = services.filter(s => s.status === 'active').length

  useEffect(() => {
    if (session?.user?.id) {
      loadServices()
    }
  }, [session?.user?.id])

  const loadServices = async () => {
    try {
      setLoading(true)
      const { data, error } = await supabase
        .from('creator_services')
        .select('*')
        .eq('user_id', session?.user?.id)
        .order('created_at', { ascending: false })

      if (error) throw error
      setServices(data || [])
    } catch (error: any) {
      console.error('Error loading services:', error)
      setToast({ message: 'Không thể tải danh sách dịch vụ', type: 'error' })
    } finally {
      setLoading(false)
    }
  }

  const validateForm = (): boolean => {
    const errors: Record<string, string> = {}

    if (!formData.name.trim()) {
      errors.name = 'Tên dịch vụ là bắt buộc'
    } else if (formData.name.trim().length < 3) {
      errors.name = 'Tên dịch vụ phải có ít nhất 3 ký tự'
    } else if (formData.name.trim().length > 100) {
      errors.name = 'Tên dịch vụ không được vượt quá 100 ký tự'
    }

    if (!formData.price.trim()) {
      errors.price = 'Giá là bắt buộc'
    } else {
      const priceNum = parseInt(formData.price)
      if (isNaN(priceNum) || priceNum < 1) {
        errors.price = 'Giá phải là số dương tối thiểu $1'
      } else if (priceNum > 999999) {
        errors.price = 'Giá không được vượt quá $999,999'
      }
    }

    if (!formData.description.trim()) {
      errors.description = 'Mô tả là bắt buộc'
    } else if (formData.description.trim().length < 20) {
      errors.description = 'Mô tả phải có ít nhất 20 ký tự'
    } else if (formData.description.trim().length > 1000) {
      errors.description = 'Mô tả không được vượt quá 1000 ký tự'
    }

    if (!formData.deliverables.trim()) {
      errors.deliverables = 'Sản phẩm đầu ra là bắt buộc'
    } else {
      const deliverablesList = formData.deliverables.split('\n').filter(line => line.trim())
      if (deliverablesList.length === 0) {
        errors.deliverables = 'Phải có ít nhất 1 sản phẩm đầu ra'
      } else if (deliverablesList.length > 15) {
        errors.deliverables = 'Không được vượt quá 15 sản phẩm đầu ra'
      }
      deliverablesList.forEach((item, index) => {
        if (item.length > 200) {
          errors.deliverables = `Sản phẩm đầu ra thứ ${index + 1} không được vượt quá 200 ký tự`
        }
      })
    }

    if (!formData.estimated_timeline.trim()) {
      errors.estimated_timeline = 'Thời gian hoàn thành là bắt buộc'
    } else if (formData.estimated_timeline.trim().length < 2) {
      errors.estimated_timeline = 'Thời gian hoàn thành phải có ít nhất 2 ký tự'
    } else if (formData.estimated_timeline.trim().length > 100) {
      errors.estimated_timeline = 'Thời gian hoàn thành không được vượt quá 100 ký tự'
    }

    setFormErrors(errors)
    return Object.keys(errors).length === 0
  }

  const handleSubmit = async (status: ServiceStatus = 'draft') => {
    if (!validateForm()) {
      return
    }

    // Check service limit
    const totalServicesCount = services.length
    if (!editingService && totalServicesCount >= maxServices) {
      setShowUpgradeModal(true)
      return
    }

    try {
      const deliverablesList = formData.deliverables.split('\n').filter(line => line.trim())
      const serviceData = {
        user_id: session?.user?.id,
        name: formData.name.trim(),
        price: parseInt(formData.price),
        description: formData.description.trim(),
        deliverables: deliverablesList,
        estimated_timeline: formData.estimated_timeline.trim(),
        status,
      }

      if (editingService) {
        const { error } = await supabase
          .from('creator_services')
          .update(serviceData)
          .eq('id', editingService.id)

        if (error) throw error
        setToast({ message: 'Cập nhật dịch vụ thành công', type: 'success' })
      } else {
        const { error } = await supabase
          .from('creator_services')
          .insert([serviceData])

        if (error) throw error
        setToast({ message: 'Tạo dịch vụ thành công', type: 'success' })
      }

      resetForm()
      loadServices()
    } catch (error: any) {
      console.error('Error saving service:', error)
      setToast({ message: error.message || 'Có lỗi xảy ra khi lưu dịch vụ', type: 'error' })
    }
  }

  const handleEdit = (service: Service) => {
    setEditingService(service)
    setFormData({
      name: service.name,
      price: service.price.toString(),
      description: service.description,
      deliverables: service.deliverables.join('\n'),
      estimated_timeline: service.estimated_timeline,
    })
    setShowForm(true)
    setFormErrors({})
  }

  const handleDelete = async (service: Service) => {
    if (!confirm('Bạn có chắc muốn xóa dịch vụ này? Hành động này không thể hoàn tác.')) {
      return
    }

    try {
      const { error } = await supabase
        .from('creator_services')
        .delete()
        .eq('id', service.id)

      if (error) throw error
      setToast({ message: 'Xóa dịch vụ thành công', type: 'success' })
      loadServices()
    } catch (error: any) {
      console.error('Error deleting service:', error)
      setToast({ message: 'Có lỗi xảy ra khi xóa dịch vụ', type: 'error' })
    }
  }

  const handleStatusChange = async (service: Service, newStatus: ServiceStatus) => {
    // Check active limit when publishing
    if (newStatus === 'active' && activeServicesCount >= maxServices && service.status !== 'active') {
      setShowUpgradeModal(true)
      return
    }

    try {
      const { error } = await supabase
        .from('creator_services')
        .update({ status: newStatus })
        .eq('id', service.id)

      if (error) throw error
      setToast({ message: 'Cập nhật trạng thái thành công', type: 'success' })
      loadServices()
    } catch (error: any) {
      console.error('Error updating status:', error)
      setToast({ message: 'Có lỗi xảy ra khi cập nhật trạng thái', type: 'error' })
    }
  }

  const resetForm = () => {
    setFormData({
      name: '',
      price: '',
      description: '',
      deliverables: '',
      estimated_timeline: '',
    })
    setEditingService(null)
    setShowForm(false)
    setFormErrors({})
  }

  const getStatusLabel = (status: ServiceStatus) => {
    switch (status) {
      case 'active':
        return 'Đang hoạt động'
      case 'draft':
        return 'Bản nháp'
      case 'hidden':
        return 'Đã ẩn'
    }
  }

  const getStatusBadgeClass = (status: ServiceStatus) => {
    switch (status) {
      case 'active':
        return 'bg-blue-100 text-blue-700'
      case 'draft':
        return 'bg-gray-100 text-gray-700'
      case 'hidden':
        return 'bg-gray-100 text-gray-500'
    }
  }

  const formatPrice = (price: number) => {
    return `$${price.toLocaleString('vi-VN')}`
  }

  const displayName = (profile?.role === 'creator' ? (profile as any).full_name : null) || session?.user?.email?.split('@')[0] || 'Creator'
  const avatarUrl = (profile?.role === 'creator' ? (profile as any).avatar_url : null) || session?.user?.user_metadata?.avatar_url

  if (loading) {
    return (
      <div className="bg-gray-50 min-h-screen py-8 px-6">
        <div className="max-w-7xl mx-auto">
          <div className="text-center py-20">
            <p className="text-gray-600">Đang tải...</p>
          </div>
        </div>
      </div>
    )
  }

  return (
    <div className="bg-gray-50 min-h-screen py-8 px-6">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="flex items-center justify-between mb-8">
          <div>
            <h1 className="text-3xl font-bold text-gray-900">Dịch vụ & Bảng giá</h1>
            <p className="text-gray-600 mt-2">
              Định nghĩa gói dịch vụ, đặt giá và chỉ định sản phẩm đầu ra. Quản lý cách dịch vụ của bạn hiển thị trên hồ sơ công khai.
            </p>
          </div>
          {!showForm && (
            <button
              onClick={() => setShowForm(true)}
              className="px-6 py-3 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white font-medium rounded-lg hover:opacity-90 transition-opacity"
            >
              Thêm dịch vụ mới
            </button>
          )}
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Left Column - Create/Edit Form */}
          {showForm && (
            <div className="lg:col-span-1">
              <div className="bg-white rounded-xl border border-gray-200 p-6 sticky top-24">
                <div className="flex items-center justify-between mb-4">
                  <div>
                    <h2 className="text-xl font-semibold text-gray-900">
                      {editingService ? 'Chỉnh sửa dịch vụ' : 'Tạo dịch vụ mới'}
                    </h2>
                    <p className="text-sm text-gray-600 mt-1">
                      {editingService ? 'Cập nhật thông tin dịch vụ' : 'Định nghĩa chi tiết dịch vụ của bạn'}
                    </p>
                  </div>
                  <button
                    onClick={resetForm}
                    className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                  >
                    <FaTimes className="w-5 h-5 text-gray-500" />
                  </button>
                </div>

                <div className="space-y-4">
                  {/* Service Name */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Tên dịch vụ *
                    </label>
                    <input
                      type="text"
                      value={formData.name}
                      onChange={(e) => {
                        setFormData({ ...formData, name: e.target.value })
                        setFormErrors({ ...formErrors, name: '' })
                      }}
                      placeholder="Ví dụ: Gói Social Media Cơ bản"
                      className={`w-full px-4 py-2.5 rounded-lg border ${
                        formErrors.name ? 'border-red-300' : 'border-gray-300'
                      } focus:ring-2 focus:ring-[#6366F1] focus:border-transparent`}
                    />
                    {formErrors.name && (
                      <p className="text-sm text-red-600 mt-1">{formErrors.name}</p>
                    )}
                    <p className="text-xs text-gray-500 mt-1">
                      Tên ngắn gọn, rõ ràng giúp thương hiệu dễ hiểu dịch vụ của bạn
                    </p>
                  </div>

                  {/* Price */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Giá (USD) *
                    </label>
                    <input
                      type="number"
                      value={formData.price}
                      onChange={(e) => {
                        setFormData({ ...formData, price: e.target.value })
                        setFormErrors({ ...formErrors, price: '' })
                      }}
                      placeholder="Ví dụ: 250"
                      min="1"
                      max="999999"
                      className={`w-full px-4 py-2.5 rounded-lg border ${
                        formErrors.price ? 'border-red-300' : 'border-gray-300'
                      } focus:ring-2 focus:ring-[#6366F1] focus:border-transparent`}
                    />
                    {formErrors.price && (
                      <p className="text-sm text-red-600 mt-1">{formErrors.price}</p>
                    )}
                    <p className="text-xs text-gray-500 mt-1">
                      Nhập giá bằng USD. Giá này có thể được ẩn trên hồ sơ công khai tùy theo gói đăng ký của bạn.
                    </p>
                  </div>

                  {/* Description */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Mô tả dịch vụ *
                    </label>
                    <textarea
                      value={formData.description}
                      onChange={(e) => {
                        setFormData({ ...formData, description: e.target.value })
                        setFormErrors({ ...formErrors, description: '' })
                      }}
                      placeholder="Mô tả chi tiết về dịch vụ bạn cung cấp..."
                      rows={5}
                      className={`w-full px-4 py-2.5 rounded-lg border ${
                        formErrors.description ? 'border-red-300' : 'border-gray-300'
                      } focus:ring-2 focus:ring-[#6366F1] focus:border-transparent`}
                    />
                    {formErrors.description && (
                      <p className="text-sm text-red-600 mt-1">{formErrors.description}</p>
                    )}
                    <p className="text-xs text-gray-500 mt-1">
                      Giải thích rõ ràng giá trị và lợi ích của dịch vụ để thu hút thương hiệu
                    </p>
                  </div>

                  {/* Deliverables */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Sản phẩm đầu ra (mỗi dòng một mục) *
                    </label>
                    <textarea
                      value={formData.deliverables}
                      onChange={(e) => {
                        setFormData({ ...formData, deliverables: e.target.value })
                        setFormErrors({ ...formErrors, deliverables: '' })
                      }}
                      placeholder="Ví dụ:&#10;- 3 bài đăng Instagram&#10;- 1 Story campaign&#10;- Báo cáo tương tác"
                      rows={6}
                      className={`w-full px-4 py-2.5 rounded-lg border ${
                        formErrors.deliverables ? 'border-red-300' : 'border-gray-300'
                      } focus:ring-2 focus:ring-[#6366F1] focus:border-transparent`}
                    />
                    {formErrors.deliverables && (
                      <p className="text-sm text-red-600 mt-1">{formErrors.deliverables}</p>
                    )}
                    <p className="text-xs text-gray-500 mt-1">
                      Liệt kê cụ thể những gì thương hiệu sẽ nhận được. Mỗi dòng là một mục.
                    </p>
                  </div>

                  {/* Timeline */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Thời gian hoàn thành *
                    </label>
                    <input
                      type="text"
                      value={formData.estimated_timeline}
                      onChange={(e) => {
                        setFormData({ ...formData, estimated_timeline: e.target.value })
                        setFormErrors({ ...formErrors, estimated_timeline: '' })
                      }}
                      placeholder="Ví dụ: 5-7 ngày làm việc"
                      className={`w-full px-4 py-2.5 rounded-lg border ${
                        formErrors.estimated_timeline ? 'border-red-300' : 'border-gray-300'
                      } focus:ring-2 focus:ring-[#6366F1] focus:border-transparent`}
                    />
                    {formErrors.estimated_timeline && (
                      <p className="text-sm text-red-600 mt-1">{formErrors.estimated_timeline}</p>
                    )}
                    <p className="text-xs text-gray-500 mt-1">
                      Thời gian từ khi bắt đầu đến khi hoàn thành dịch vụ
                    </p>
                  </div>

                  {/* Actions */}
                  <div className="flex gap-3 pt-4">
                    <button
                      onClick={resetForm}
                      className="flex-1 px-4 py-2.5 rounded-lg font-medium text-gray-700 bg-white border-2 border-gray-300 hover:bg-gray-50 transition-colors"
                    >
                      Hủy
                    </button>
                    {!editingService && (
                      <button
                        onClick={() => handleSubmit('draft')}
                        className="flex-1 px-4 py-2.5 rounded-lg font-medium text-gray-700 bg-white border-2 border-gray-300 hover:bg-gray-50 transition-colors"
                      >
                        Lưu bản nháp
                      </button>
                    )}
                    <button
                      onClick={() => handleSubmit(editingService?.status || 'active')}
                      className="flex-1 px-4 py-2.5 rounded-lg font-medium text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] hover:opacity-90 transition-opacity"
                    >
                      {editingService ? 'Cập nhật' : 'Thêm dịch vụ'}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Right Column - Services List & Preview */}
          <div className={showForm ? 'lg:col-span-2' : 'lg:col-span-3'}>
            <div className="space-y-6">
              {/* Services Table */}
              <div className="bg-white rounded-xl border border-gray-200 p-6">
                <div className="mb-4">
                  <h2 className="text-xl font-semibold text-gray-900">Gói dịch vụ của tôi</h2>
                  <p className="text-sm text-gray-600 mt-1">
                    Quản lý các dịch vụ đang hoạt động và bản nháp của bạn.
                  </p>
                </div>

                {services.length === 0 ? (
                  <div className="text-center py-12">
                    <p className="text-gray-600 mb-2">Bạn chưa có dịch vụ nào</p>
                    <p className="text-sm text-gray-500 mb-4">
                      Tạo dịch vụ đầu tiên để bắt đầu nhận hợp tác từ thương hiệu.
                    </p>
                    <button
                      onClick={() => setShowForm(true)}
                      className="px-6 py-3 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white font-medium rounded-lg hover:opacity-90 transition-opacity"
                    >
                      Tạo dịch vụ mới
                    </button>
                  </div>
                ) : (
                  <div className="overflow-x-auto">
                    <table className="w-full">
                      <thead>
                        <tr className="border-b border-gray-200">
                          <th className="text-left py-3 px-4 text-sm font-semibold text-gray-700">Tên</th>
                          <th className="text-left py-3 px-4 text-sm font-semibold text-gray-700">Giá</th>
                          <th className="text-left py-3 px-4 text-sm font-semibold text-gray-700">Thời gian</th>
                          <th className="text-left py-3 px-4 text-sm font-semibold text-gray-700">Trạng thái</th>
                          <th className="text-right py-3 px-4 text-sm font-semibold text-gray-700">Thao tác</th>
                        </tr>
                      </thead>
                      <tbody>
                        {services.map((service) => (
                          <tr key={service.id} className="border-b border-gray-100 hover:bg-gray-50">
                            <td className="py-4 px-4">
                              <div className="font-medium text-gray-900">{service.name}</div>
                            </td>
                            <td className="py-4 px-4">
                              <div className="text-gray-700">{formatPrice(service.price)}</div>
                            </td>
                            <td className="py-4 px-4">
                              <div className="text-gray-700">{service.estimated_timeline}</div>
                            </td>
                            <td className="py-4 px-4">
                              <span className={`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${getStatusBadgeClass(service.status)}`}>
                                {getStatusLabel(service.status)}
                              </span>
                            </td>
                            <td className="py-4 px-4">
                              <div className="flex items-center justify-end gap-2">
                                <button
                                  onClick={() => handleEdit(service)}
                                  className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                  title="Sửa"
                                >
                                  <FaEdit className="w-4 h-4 text-gray-600" />
                                </button>
                                {service.status === 'active' && (
                                  <button
                                    onClick={() => handleStatusChange(service, 'hidden')}
                                    className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                    title="Ẩn"
                                  >
                                    <FaEye className="w-4 h-4 text-gray-600" />
                                  </button>
                                )}
                                {(service.status === 'draft' || service.status === 'hidden') && (
                                  <button
                                    onClick={() => handleStatusChange(service, 'active')}
                                    className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                    title="Công khai"
                                  >
                                    <FaCheck className="w-4 h-4 text-green-600" />
                                  </button>
                                )}
                                <button
                                  onClick={() => handleDelete(service)}
                                  className="p-2 hover:bg-red-100 rounded-lg transition-colors"
                                  title="Xóa"
                                >
                                  <FaTrash className="w-4 h-4 text-red-600" />
                                </button>
                              </div>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}
              </div>

              {/* Public Profile Preview */}
              <div className="bg-white rounded-xl border border-gray-200 p-6">
                <div className="mb-4">
                  <h2 className="text-xl font-semibold text-gray-900">Hồ sơ công khai của bạn</h2>
                  <p className="text-sm text-gray-600 mt-1">
                    Đây là cách thương hiệu nhìn thấy dịch vụ của bạn.
                  </p>
                </div>

                <div className="space-y-4">
                  {/* Profile Card */}
                  <div className="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                    {avatarUrl ? (
                      <img src={avatarUrl} alt={displayName} className="w-12 h-12 rounded-full object-cover" />
                    ) : (
                      <div className="w-12 h-12 rounded-full bg-gradient-to-r from-[#6366F1] to-[#EC4899] flex items-center justify-center text-white font-medium">
                        {displayName.charAt(0).toUpperCase()}
                      </div>
                    )}
                    <div>
                      <div className="font-semibold text-gray-900">{displayName}</div>
                      <div className="text-sm text-gray-600">{profile?.bio || 'Creator'}</div>
                    </div>
                  </div>

                  {/* Services List */}
                  <div>
                    <h3 className="font-medium text-gray-900 mb-3">Dịch vụ ({services.filter(s => s.status === 'active').length})</h3>
                    {services.filter(s => s.status === 'active').length === 0 ? (
                      <p className="text-sm text-gray-500">Chưa có dịch vụ công khai</p>
                    ) : (
                      <>
                        <ul className="space-y-4">
                          {services.filter(s => s.status === 'active').map((service) => (
                            <li key={service.id} className="border border-gray-200 rounded-lg p-4">
                              <div className="flex items-start gap-3">
                                <FaCheck className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                                <div className="flex-1">
                                  <div className="font-medium text-gray-900">{service.name}</div>
                                  <div className="text-sm text-gray-600 mt-1">{service.description.substring(0, 150)}...</div>
                                  {canShowPricing && (
                                    <div className="text-sm font-medium text-gray-900 mt-2">{formatPrice(service.price)}</div>
                                  )}
                                </div>
                              </div>
                            </li>
                          ))}
                        </ul>
                        
                        {!canShowPricing && services.filter(s => s.status === 'active').length > 0 && (
                          <div className="mt-4 p-4 bg-gray-100 rounded-lg border border-gray-200">
                            <div className="font-semibold text-gray-900 mb-1">Pricing Hidden</div>
                            <p className="text-sm text-gray-600 mb-3">
                              Nâng cấp gói của bạn để hiển thị giá trên hồ sơ công khai và nhận nhiều cơ hội hợp tác hơn.
                            </p>
                            <button
                              onClick={() => setShowUpgradeModal(true)}
                              className="px-4 py-2 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white text-sm font-medium rounded-lg hover:opacity-90 transition-opacity"
                            >
                              Nâng cấp để mở khóa
                            </button>
                          </div>
                        )}
                      </>
                    )}
                  </div>

                  {/* View Profile Button */}
                  <div className="pt-4 border-t border-gray-200">
                    <p className="text-xs text-gray-500 mb-3">Hiển thị công khai trên hồ sơ của bạn.</p>
                    <button className="flex items-center gap-2 px-4 py-2 text-sm font-medium text-[#6366F1] hover:text-[#EC4899] transition-colors">
                      Xem hồ sơ
                      <FaExternalLinkAlt className="w-3 h-3" />
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      {toast && (
        <Toast
          message={toast.message}
          type={toast.type}
          onClose={() => setToast(null)}
        />
      )}

      <UpgradePlanModal
        isOpen={showUpgradeModal}
        onClose={() => setShowUpgradeModal(false)}
        currentPlan={currentPlan}
      />
    </div>
  )
}
</file>

<file path="src/pages/onboarding/RolePage.tsx">
import { useState } from 'react'
import { useNavigate } from 'react-router-dom'
import { useAuth } from '../../hooks/useAuth'
import { getSupabase } from '../../lib/supabase'
import { FaUserCircle, FaBuilding, FaArrowRight, FaCheck } from 'react-icons/fa'

export default function RolePage() {
  const { session } = useAuth()
  const [loading, setLoading] = useState(false)
  const [selectedRole, setSelectedRole] = useState<'creator' | 'brand' | null>(null)
  const navigate = useNavigate()
  const supabase = getSupabase()

  const handleSelectRole = async (role: 'creator' | 'brand') => {
    if (!session || !session.access_token) return

    setSelectedRole(role)
    setLoading(true)

    try {
      const { error } = await supabase
        .from('profiles')
        .update({
          role,
          updated_at: new Date().toISOString(),
        })
        .eq('id', session.user.id)

      if (error) {
        if (error.code === '42501' || error.code === 'PGRST301') {
          setLoading(false)
          setSelectedRole(null)
          return
        }
        throw error
      }

      // Navigate to /app - AppGate will handle routing to onboarding
      navigate('/app', { replace: true })
    } catch (err: any) {
      setLoading(false)
      setSelectedRole(null)
      alert(err.message || 'Có lỗi xảy ra khi chọn vai trò')
    }
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-[#EEF1FF] via-[#F5F7FF] to-white py-20 px-6 pt-24">
      <div className="w-full max-w-5xl">
        {/* Header Section */}
        <div className="text-center mb-16">
          <h1 className="text-5xl md:text-6xl font-bold tracking-tight mb-4 bg-gradient-to-r from-[#6366F1] to-[#EC4899] bg-clip-text text-transparent">
            Chọn vai trò của bạn
          </h1>
          <p className="text-xl text-[#6B7280] max-w-2xl mx-auto leading-relaxed">
            Chọn vai trò phù hợp với cách bạn mong muốn sử dụng ALINO.
          </p>
        </div>

        {/* Role Cards */}
        <div className="grid md:grid-cols-2 gap-8 mb-8">
          {/* Creator Card */}
          <button
            onClick={() => handleSelectRole('creator')}
            disabled={loading}
            className={`group relative p-10 bg-white/90 backdrop-blur-xl rounded-3xl border-2 transition-all duration-300 text-left disabled:opacity-50 disabled:cursor-not-allowed ${
              selectedRole === 'creator'
                ? 'border-[#6366F1] shadow-2xl shadow-[#6366F1]/20 scale-105'
                : 'border-gray-200 hover:border-[#6366F1]/50 hover:shadow-xl hover:shadow-[#6366F1]/10 hover:scale-[1.02]'
            }`}
          >
            {/* Icon Container */}
            <div className={`mb-6 inline-flex items-center justify-center w-16 h-16 rounded-2xl transition-all duration-300 ${
              selectedRole === 'creator'
                ? 'bg-gradient-to-br from-[#6366F1] to-[#8B5CF6] shadow-lg'
                : 'bg-gradient-to-br from-[#6366F1]/10 to-[#8B5CF6]/10 group-hover:from-[#6366F1]/20 group-hover:to-[#8B5CF6]/20'
            }`}>
              <FaUserCircle className={`w-8 h-8 transition-colors ${
                selectedRole === 'creator' ? 'text-white' : 'text-[#6366F1]'
              }`} />
            </div>

            {/* Content */}
            <h3 className="text-3xl font-bold mb-3 text-gray-900 group-hover:text-[#6366F1] transition-colors">
              Creator
            </h3>
            <p className="text-lg text-[#6B7280] mb-6 leading-relaxed">
              Tôi là Creator muốn hợp tác với các Brand
            </p>

            {/* Features List */}
            <ul className="space-y-3 mb-6">
              <li className="flex items-center text-sm text-[#6B7280]">
                <div className="w-5 h-5 rounded-full bg-[#6366F1]/10 flex items-center justify-center mr-3 flex-shrink-0">
                  <div className="w-2 h-2 rounded-full bg-[#6366F1]" />
                </div>
                Quản lý đề xuất và hợp tác
              </li>
              <li className="flex items-center text-sm text-[#6B7280]">
                <div className="w-5 h-5 rounded-full bg-[#6366F1]/10 flex items-center justify-center mr-3 flex-shrink-0">
                  <div className="w-2 h-2 rounded-full bg-[#6366F1]" />
                </div>
                Theo dõi hiệu suất và phân tích
              </li>
              <li className="flex items-center text-sm text-[#6B7280]">
                <div className="w-5 h-5 rounded-full bg-[#6366F1]/10 flex items-center justify-center mr-3 flex-shrink-0">
                  <div className="w-2 h-2 rounded-full bg-[#6366F1]" />
                </div>
                Kết nối với các Brand phù hợp
              </li>
            </ul>

            {/* Arrow Icon */}
            <div className={`flex items-center text-[#6366F1] font-semibold transition-all ${
              selectedRole === 'creator' ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'
            }`}>
              <span className="text-sm mr-2">Bắt đầu</span>
              <FaArrowRight className="w-4 h-4" />
            </div>

            {/* Selected Indicator */}
            {selectedRole === 'creator' && loading && (
              <div className="absolute top-6 right-6 w-8 h-8 rounded-full bg-gradient-to-br from-[#6366F1] to-[#EC4899] flex items-center justify-center animate-pulse">
                <FaCheck className="w-4 h-4 text-white" />
              </div>
            )}
          </button>

          {/* Brand Card */}
          <button
            onClick={() => handleSelectRole('brand')}
            disabled={loading}
            className={`group relative p-10 bg-white/90 backdrop-blur-xl rounded-3xl border-2 transition-all duration-300 text-left disabled:opacity-50 disabled:cursor-not-allowed ${
              selectedRole === 'brand'
                ? 'border-[#EC4899] shadow-2xl shadow-[#EC4899]/20 scale-105'
                : 'border-gray-200 hover:border-[#EC4899]/50 hover:shadow-xl hover:shadow-[#EC4899]/10 hover:scale-[1.02]'
            }`}
          >
            {/* Icon Container */}
            <div className={`mb-6 inline-flex items-center justify-center w-16 h-16 rounded-2xl transition-all duration-300 ${
              selectedRole === 'brand'
                ? 'bg-gradient-to-br from-[#EC4899] to-[#F472B6] shadow-lg'
                : 'bg-gradient-to-br from-[#EC4899]/10 to-[#F472B6]/10 group-hover:from-[#EC4899]/20 group-hover:to-[#F472B6]/20'
            }`}>
              <FaBuilding className={`w-8 h-8 transition-colors ${
                selectedRole === 'brand' ? 'text-white' : 'text-[#EC4899]'
              }`} />
            </div>

            {/* Content */}
            <h3 className="text-3xl font-bold mb-3 text-gray-900 group-hover:text-[#EC4899] transition-colors">
              Brand
            </h3>
            <p className="text-lg text-[#6B7280] mb-6 leading-relaxed">
              Tôi là Brand muốn hợp tác với các Creator
            </p>

            {/* Features List */}
            <ul className="space-y-3 mb-6">
              <li className="flex items-center text-sm text-[#6B7280]">
                <div className="w-5 h-5 rounded-full bg-[#EC4899]/10 flex items-center justify-center mr-3 flex-shrink-0">
                  <div className="w-2 h-2 rounded-full bg-[#EC4899]" />
                </div>
                Tạo và quản lý chiến dịch
              </li>
              <li className="flex items-center text-sm text-[#6B7280]">
                <div className="w-5 h-5 rounded-full bg-[#EC4899]/10 flex items-center justify-center mr-3 flex-shrink-0">
                  <div className="w-2 h-2 rounded-full bg-[#EC4899]" />
                </div>
                Khám phá và kết nối Creator
              </li>
              <li className="flex items-center text-sm text-[#6B7280]">
                <div className="w-5 h-5 rounded-full bg-[#EC4899]/10 flex items-center justify-center mr-3 flex-shrink-0">
                  <div className="w-2 h-2 rounded-full bg-[#EC4899]" />
                </div>
                Theo dõi ROI và hiệu suất
              </li>
            </ul>

            {/* Arrow Icon */}
            <div className={`flex items-center text-[#EC4899] font-semibold transition-all ${
              selectedRole === 'brand' ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'
            }`}>
              <span className="text-sm mr-2">Bắt đầu</span>
              <FaArrowRight className="w-4 h-4" />
            </div>

            {/* Selected Indicator */}
            {selectedRole === 'brand' && loading && (
              <div className="absolute top-6 right-6 w-8 h-8 rounded-full bg-gradient-to-br from-[#6366F1] to-[#EC4899] flex items-center justify-center animate-pulse">
                <FaCheck className="w-4 h-4 text-white" />
              </div>
            )}
          </button>
        </div>

        {/* Loading State */}
        {loading && (
          <div className="text-center">
            <div className="inline-flex items-center gap-3 px-6 py-3 bg-white/80 backdrop-blur-xl rounded-full shadow-lg">
              <div className="w-5 h-5 border-2 border-[#6366F1] border-t-transparent rounded-full animate-spin" />
              <span className="text-sm font-medium text-[#6B7280]">
                Đang xử lý...
              </span>
            </div>
          </div>
        )}

        {/* Footer Note */}
        <p className="text-center text-sm text-[#6B7280] mt-8">
          Bạn có thể thay đổi vai trò bất cứ lúc nào trong cài đặt
        </p>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/public/LandingPage.tsx">
import { useEffect, useState } from 'react'
import { Link, useSearchParams } from 'react-router-dom'

export default function LandingPage() {
  const [searchParams, setSearchParams] = useSearchParams()
  const [showMessage, setShowMessage] = useState(false)

  useEffect(() => {
    if (searchParams.get('signup') === 'success') {
      setShowMessage(true)
      // Remove query param from URL
      setSearchParams({}, { replace: true })
    }
  }, [searchParams, setSearchParams])

  return (
    <div className="relative overflow-x-hidden bg-white pt-16">
      <div className="min-h-screen">
        <section className="max-w-7xl mx-auto px-6 py-20">
          <div className="text-center">
            {showMessage && (
              <div className="mb-8 max-w-2xl mx-auto">
                <div className="bg-green-50 border border-green-200 rounded-xl p-4 text-green-700">
                  <p className="font-medium">
                    Vui lòng kiểm tra email để xác thực tài khoản.
                  </p>
                </div>
              </div>
            )}
            <h1 className="text-5xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-[#6366F1] to-[#EC4899] bg-clip-text text-transparent">
              Quản lý hợp tác Creator - Brand
            </h1>
            <p className="text-xl text-[#6B7280] mb-8 max-w-2xl mx-auto">
              Nền tảng quản lý hợp tác chuyên nghiệp giữa Creator và Brand
            </p>
            <div className="flex gap-4 justify-center">
              <Link
                to="/signup"
                className="px-8 py-3 rounded-full font-semibold text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] hover:scale-105 transition-transform shadow-lg shadow-[#6366F1]/25"
              >
                Bắt đầu ngay
              </Link>
              <Link
                to="/login"
                className="px-8 py-3 rounded-full font-semibold text-[#6366F1] border-2 border-[#6366F1] hover:bg-[#6366F1] hover:text-white transition-colors"
              >
                Đăng nhập
              </Link>
            </div>
          </div>
        </section>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/public/LoginPage.tsx">
import { useState } from 'react'
import { Link, useNavigate } from 'react-router-dom'
import { getSupabase } from '../../lib/supabase'

export default function LoginPage() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [error, setError] = useState('')
  const [loading, setLoading] = useState(false)
  const navigate = useNavigate()
  const supabase = getSupabase()

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')
    setLoading(true)

    try {
      const { data, error } = await supabase.auth.signInWithPassword({
        email,
        password,
      })
      
      if (error) {
        if (error.message === 'Email not confirmed') {
          setError('Tài khoản chưa được xác thực. Vui lòng kiểm tra email.')
        } else {
          setError('Email hoặc mật khẩu không đúng')
        }
        setLoading(false)
        return
      }
      
      if (!data.user?.email_confirmed_at) {
        setError('Tài khoản chưa được xác thực. Vui lòng kiểm tra email.')
        await supabase.auth.signOut()
        setLoading(false)
        return
      }
      
      // After login, redirect to landing page
      // User must explicitly click "Quản lý dự án" to go to /app
      navigate('/')      
    } catch (err) {
      setError('Có lỗi xảy ra')
      setLoading(false)
    }
  }

  const handleGoogleLogin = async () => {
    const { data, error } = await supabase.auth.signInWithOAuth({
      provider: 'google',
      options: {
        // Redirect to landing page after OAuth - user must click "Quản lý dự án" to go to /app
        redirectTo: `${window.location.origin}/`,
      },
    })

    if (error) {
      setError(error.message)
      return
    }

    if (data.url) {
      window.location.href = data.url
    }
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-[#F9FAFB] px-6 lg:px-6 pt-16">
      <div className="w-full max-w-6xl bg-white rounded-3xl shadow-xl overflow-hidden flex">
        <div className="hidden lg:flex w-[45%] bg-gradient-to-br from-[#6366F1]/20 via-[#7C3AED]/15 to-[#EC4899]/20">
          <div className="flex flex-col px-12 pt-12 items-center">
            <img
              src="/logo/logo.png"
              alt="ALINO"
              className="w-40 h-40 mb-6"
            />
            <h1 className="text-3xl font-semibold text-[#1F2937] mb-3">
              Chào mừng tới với Alino
            </h1>
            <p className="text-[#6B7280] leading-relaxed">
              Nền tảng quản lý các dự án hợp tác chuyên nghiệp
            </p>
          </div>
        </div>

        <div className="w-full lg:w-[55%] px-10 py-8 flex items-center justify-center">
          <div className="w-full max-w-sm">
            <h2 className="text-2xl font-semibold mb-2">Đăng nhập</h2>
            <p className="text-sm text-[#6B7280] mb-6">
              Nhập thông tin để tiếp tục
            </p>

            {error && (
              <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm">
                {error}
              </div>
            )}

            <form onSubmit={handleSubmit} className="space-y-4">
              <input
                type="email"
                placeholder="Email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                className="w-full px-3 py-2.5 border rounded-lg"
                required
              />

              <input
                type="password"
                placeholder="Mật khẩu"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                className="w-full px-3 py-2.5 border rounded-lg"
                required
              />

              <button
                type="submit"
                disabled={loading}
                className="w-full py-2.5 rounded-lg text-white font-medium bg-gradient-to-r from-[#6366F1] to-[#EC4899] disabled:opacity-50"
              >
                {loading ? 'Đang đăng nhập...' : 'Đăng nhập'}
              </button>
            </form>

            <div className="my-5 text-center text-xs text-[#9CA3AF]">HOẶC</div>

            <button
              onClick={handleGoogleLogin}
              className="w-full py-2.5 border rounded-lg text-sm hover:bg-gray-50 flex items-center justify-center gap-3"
            >
              <svg className="w-5 h-5" viewBox="0 0 24 24">
                <path
                  fill="#4285F4"
                  d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                />
                <path
                  fill="#34A853"
                  d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                />
                <path
                  fill="#FBBC05"
                  d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                />
                <path
                  fill="#EA4335"
                  d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                />
              </svg>
              Đăng nhập với Google
            </button>

            <p className="mt-6 text-center text-sm text-[#6B7280]">
              Chưa có tài khoản?{' '}
              <Link to="/signup" className="text-[#6366F1] font-medium">
                Đăng ký
              </Link>
            </p>
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/public/PrivacyPage.tsx">
import { Link } from 'react-router-dom'
import Header from '../../components/layout/Header'
import Footer from '../../components/layout/Footer'

export default function PrivacyPage() {
  return (
    <div className="min-h-screen flex flex-col">
      <Header />
      <main className="flex-1 pt-24 pb-16">
        <div className="max-w-4xl mx-auto px-6">
          <div className="bg-white rounded-3xl p-8 md:p-10 shadow-xl border border-gray-200">
            <h1 className="text-4xl font-bold mb-4">Chính sách bảo mật</h1>
            <p className="text-sm text-gray-500 mb-8">
              Cập nhật lần cuối: {new Date().toLocaleDateString('vi-VN', { year: 'numeric', month: 'long', day: 'numeric' })}
            </p>

            <div className="prose prose-gray max-w-none">
              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">1. Giới thiệu</h2>
                <p className="text-gray-700 mb-4">
                  ALINO cam kết bảo vệ quyền riêng tư của người dùng. Chính sách này mô tả cách chúng tôi thu thập, sử dụng, 
                  và bảo vệ thông tin cá nhân của bạn khi sử dụng dịch vụ của chúng tôi.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">2. Thông tin chúng tôi thu thập</h2>
                <p className="text-gray-700 mb-4">
                  Chúng tôi thu thập các loại thông tin sau:
                </p>
                <ul className="list-disc pl-6 text-gray-700 mb-4">
                  <li><strong>Thông tin cá nhân:</strong> Tên, email, ngày sinh, địa chỉ</li>
                  <li><strong>Thông tin tài khoản:</strong> Thông tin đăng nhập, lịch sử hoạt động</li>
                  <li><strong>Thông tin hồ sơ:</strong> Thông tin công khai trên hồ sơ của bạn</li>
                  <li><strong>Thông tin kết nối:</strong> Dữ liệu từ các tài khoản mạng xã hội được kết nối (Google, Facebook, Instagram, TikTok)</li>
                  <li><strong>Dữ liệu sử dụng:</strong> Thông tin về cách bạn sử dụng nền tảng</li>
                </ul>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">3. Cách chúng tôi sử dụng thông tin</h2>
                <p className="text-gray-700 mb-4">
                  Chúng tôi sử dụng thông tin của bạn để:
                </p>
                <ul className="list-disc pl-6 text-gray-700 mb-4">
                  <li>Cung cấp và cải thiện dịch vụ</li>
                  <li>Kết nối bạn với các đối tác phù hợp (Creators với Brands)</li>
                  <li>Gửi thông báo và cập nhật về dịch vụ</li>
                  <li>Phân tích và cải thiện trải nghiệm người dùng</li>
                  <li>Tuân thủ các nghĩa vụ pháp lý</li>
                </ul>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">4. Kết nối tài khoản mạng xã hội</h2>
                <p className="text-gray-700 mb-4">
                  Khi bạn kết nối tài khoản mạng xã hội (Google, Facebook, Instagram, TikTok) với ALINO, chúng tôi có thể 
                  truy cập và lưu trữ một số thông tin từ các tài khoản đó để cung cấp dịch vụ tốt hơn, bao gồm thông tin hồ sơ 
                  công khai và dữ liệu cần thiết cho các tính năng của nền tảng.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">5. Chia sẻ thông tin</h2>
                <p className="text-gray-700 mb-4">
                  Chúng tôi không bán thông tin cá nhân của bạn. Chúng tôi có thể chia sẻ thông tin trong các trường hợp sau:
                </p>
                <ul className="list-disc pl-6 text-gray-700 mb-4">
                  <li>Với các đối tác phù hợp trên nền tảng (thông tin công khai từ hồ sơ của bạn)</li>
                  <li>Với các nhà cung cấp dịch vụ hỗ trợ hoạt động của chúng tôi</li>
                  <li>Khi được yêu cầu bởi pháp luật</li>
                </ul>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">6. Bảo mật dữ liệu</h2>
                <p className="text-gray-700 mb-4">
                  Chúng tôi sử dụng các biện pháp bảo mật kỹ thuật và tổ chức phù hợp để bảo vệ thông tin cá nhân của bạn khỏi 
                  truy cập trái phép, mất mát, hoặc phá hủy.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">7. Quyền của bạn</h2>
                <p className="text-gray-700 mb-4">
                  Bạn có quyền:
                </p>
                <ul className="list-disc pl-6 text-gray-700 mb-4">
                  <li>Truy cập và chỉnh sửa thông tin cá nhân của bạn</li>
                  <li>Yêu cầu xóa tài khoản và dữ liệu</li>
                  <li>Ngừng kết nối tài khoản mạng xã hội</li>
                  <li>Yêu cầu xuất dữ liệu của bạn</li>
                </ul>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">8. Cookie và công nghệ theo dõi</h2>
                <p className="text-gray-700 mb-4">
                  Chúng tôi sử dụng cookie và các công nghệ tương tự để cải thiện trải nghiệm người dùng và phân tích cách sử dụng dịch vụ.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">9. Thay đổi chính sách</h2>
                <p className="text-gray-700 mb-4">
                  Chúng tôi có thể cập nhật chính sách này theo thời gian. Chúng tôi sẽ thông báo cho bạn về các thay đổi quan trọng 
                  qua email hoặc thông báo trên nền tảng.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">10. Liên hệ</h2>
                <p className="text-gray-700 mb-4">
                  Nếu bạn có câu hỏi về chính sách bảo mật này, vui lòng liên hệ với chúng tôi qua email hoặc các kênh hỗ trợ được cung cấp.
                </p>
              </section>
            </div>
          </div>
        </div>
      </main>
      <Footer />
    </div>
  )
}
</file>

<file path="src/pages/public/TermsPage.tsx">
import { Link } from 'react-router-dom'
import Header from '../../components/layout/Header'
import Footer from '../../components/layout/Footer'

export default function TermsPage() {
  return (
    <div className="min-h-screen flex flex-col">
      <Header />
      <main className="flex-1 pt-24 pb-16">
        <div className="max-w-4xl mx-auto px-6">
          <div className="bg-white rounded-3xl p-8 md:p-10 shadow-xl border border-gray-200">
            <h1 className="text-4xl font-bold mb-4">Điều khoản sử dụng</h1>
            <p className="text-sm text-gray-500 mb-8">
              Cập nhật lần cuối: {new Date().toLocaleDateString('vi-VN', { year: 'numeric', month: 'long', day: 'numeric' })}
            </p>

            <div className="prose prose-gray max-w-none">
              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">1. Chấp nhận điều khoản</h2>
                <p className="text-gray-700 mb-4">
                  Bằng việc truy cập và sử dụng dịch vụ ALINO, bạn đồng ý tuân thủ và bị ràng buộc bởi các điều khoản sử dụng này. 
                  Nếu bạn không đồng ý với bất kỳ phần nào của các điều khoản này, bạn không được phép sử dụng dịch vụ.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">2. Mô tả dịch vụ</h2>
                <p className="text-gray-700 mb-4">
                  ALINO là một nền tảng kết nối giữa các nhà sáng tạo nội dung (Creators) và các thương hiệu (Brands) 
                  để tạo điều kiện cho các chiến dịch hợp tác và tiếp thị. Dịch vụ bao gồm nhưng không giới hạn ở việc 
                  quản lý hồ sơ, tìm kiếm đối tác, và quản lý các dự án hợp tác.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">3. Tài khoản người dùng</h2>
                <p className="text-gray-700 mb-4">
                  Để sử dụng một số tính năng của dịch vụ, bạn cần tạo tài khoản. Bạn có trách nhiệm:
                </p>
                <ul className="list-disc pl-6 text-gray-700 mb-4">
                  <li>Bảo mật thông tin đăng nhập của bạn</li>
                  <li>Cung cấp thông tin chính xác và cập nhật</li>
                  <li>Thông báo ngay cho chúng tôi về bất kỳ hoạt động đáng ngờ nào</li>
                </ul>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">4. Quyền và trách nhiệm</h2>
                <p className="text-gray-700 mb-4">
                  Người dùng có quyền sử dụng dịch vụ theo đúng mục đích và không được sử dụng dịch vụ cho các hoạt động 
                  bất hợp pháp hoặc vi phạm quyền của người khác.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">5. Sở hữu trí tuệ</h2>
                <p className="text-gray-700 mb-4">
                  Tất cả nội dung trên nền tảng ALINO, bao gồm logo, thiết kế, văn bản, và phần mềm, đều thuộc quyền sở hữu 
                  của ALINO hoặc các bên cấp phép. Bạn không được phép sao chép, phân phối, hoặc sử dụng nội dung này mà không 
                  có sự cho phép bằng văn bản.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">6. Giới hạn trách nhiệm</h2>
                <p className="text-gray-700 mb-4">
                  ALINO không chịu trách nhiệm về bất kỳ thiệt hại trực tiếp, gián tiếp, ngẫu nhiên, hoặc hậu quả nào phát sinh 
                  từ việc sử dụng hoặc không thể sử dụng dịch vụ của chúng tôi.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">7. Thay đổi điều khoản</h2>
                <p className="text-gray-700 mb-4">
                  Chúng tôi có quyền cập nhật các điều khoản này bất cứ lúc nào. Việc tiếp tục sử dụng dịch vụ sau khi có thay đổi 
                  được coi là bạn đã chấp nhận các điều khoản mới.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">8. Liên hệ</h2>
                <p className="text-gray-700 mb-4">
                  Nếu bạn có bất kỳ câu hỏi nào về các điều khoản này, vui lòng liên hệ với chúng tôi qua email hoặc các kênh hỗ trợ 
                  được cung cấp trên nền tảng.
                </p>
              </section>
            </div>
          </div>
        </div>
      </main>
      <Footer />
    </div>
  )
}
</file>

<file path="src/pages/public/VerifyEmailPage.tsx">
import { useEffect } from 'react'
import { Link } from 'react-router-dom'
import { getSupabase } from '../../lib/supabase'

export default function VerifyEmailPage() {
  const supabase = getSupabase()

  useEffect(() => {
    // Sign out any existing session to prevent auto-login
    supabase.auth.signOut()
  }, [])

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-[#EEF1FF] via-[#F5F7FF] to-white py-20 px-6 pt-24">
      <div className="w-full max-w-md">
        <div className="bg-white/90 backdrop-blur-xl rounded-3xl p-8 shadow-xl border border-black/5 text-center">
          <div className="w-16 h-16 mx-auto mb-6 rounded-full bg-gradient-to-r from-[#6366F1] to-[#EC4899] flex items-center justify-center">
            <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>

          <h1 className="text-3xl font-semibold tracking-tight mb-4">
            Xác thực thành công
          </h1>

          <p className="text-[#6B7280] mb-8 leading-relaxed">
            Tài khoản đã được xác thực. Vui lòng đăng nhập để tiếp tục.
          </p>

          <Link
            to="/login"
            className="inline-block px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] hover:scale-105 transition-transform shadow-lg shadow-[#6366F1]/25"
          >
            Đăng nhập
          </Link>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/shared/ComingSoonPage.tsx">
/**
 * Placeholder page for unfinished dashboard features
 * Title and subtitle are shown in Header, this page shows feature content only
 */
export default function ComingSoonPage() {
  return (
    <div className="min-h-screen bg-white">
      <div className="max-w-6xl mx-auto p-8">
        <div className="text-center py-20">
          <p className="text-lg text-gray-600">
            Tính năng đang xây dựng
          </p>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/utils/cropImage.ts">
import { Area } from 'react-easy-crop'

export async function getCroppedImg(
  imageSrc: string,
  pixelCrop: Area
): Promise<Blob> {
  const image = await createImage(imageSrc)
  const canvas = document.createElement('canvas')
  const ctx = canvas.getContext('2d')

  if (!ctx) {
    throw new Error('No 2d context')
  }

  // Set canvas size to output size (circular crop)
  const outputSize = 400
  canvas.width = outputSize
  canvas.height = outputSize

  // Draw circular crop
  ctx.save()
  ctx.beginPath()
  ctx.arc(outputSize / 2, outputSize / 2, outputSize / 2, 0, Math.PI * 2)
  ctx.clip()

  // Draw cropped image
  ctx.drawImage(
    image,
    pixelCrop.x,
    pixelCrop.y,
    pixelCrop.width,
    pixelCrop.height,
    0,
    0,
    outputSize,
    outputSize
  )

  ctx.restore()

  return new Promise((resolve, reject) => {
    canvas.toBlob(
      (blob) => {
        if (!blob) {
          reject(new Error('Canvas is empty'))
          return
        }
        resolve(blob)
      },
      'image/jpeg',
      0.9
    )
  })
}

function createImage(url: string): Promise<HTMLImageElement> {
  return new Promise((resolve, reject) => {
    const image = new Image()
    image.addEventListener('load', () => resolve(image))
    image.addEventListener('error', (error) => reject(error))
    image.src = url
  })
}
</file>

<file path="postcss.config.cjs">
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="src/app/AppGate.tsx">
import { useEffect, useState, ReactNode } from 'react'
import { useNavigate, useLocation } from 'react-router-dom'
import { useAuth } from '../hooks/useAuth'
import { getSupabase } from '../lib/supabase'

export default function AppGate({ children }: { children: ReactNode }) {
  const { session, loading: authLoading } = useAuth()
  const navigate = useNavigate()
  const location = useLocation()
  const supabase = getSupabase()

  const [isProcessing, setIsProcessing] = useState(false)

  const isAppRoute = location.pathname.startsWith('/app')

  useEffect(() => {
    if (!isAppRoute) return
    if (authLoading) return
    if (isProcessing) return

    // Not logged in
    if (!session) {
      navigate('/login', { replace: true })
      return
    }

    // Email not confirmed
    if (!session.user.email_confirmed_at) {
      supabase.auth.signOut().finally(() => {
        navigate('/login', { replace: true })
      })
      return
    }

    runGate()
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [authLoading, session, isAppRoute])

  async function runGate() {
    if (!session) return

    setIsProcessing(true)

    try {
      const { data: profile, error } = await supabase
        .from('profiles')
        .select('role, onboarding_completed')
        .eq('id', session.user.id)
        .maybeSingle()

      if (error || !profile || !profile.role) {
        navigate('/role', { replace: true })
        return
      }

      if (!profile.onboarding_completed) {
        navigate(`/onboarding/${profile.role}`, { replace: true })
        return
      }

      const dashboardPath =
        profile.role === 'creator'
          ? '/dashboard/creator'
          : '/dashboard/brand'

      navigate(dashboardPath, { replace: true })
    } catch (err) {
      console.error('AppGate error:', err)
      navigate('/login', { replace: true })
    } finally {
      setIsProcessing(false)
    }
  }

  if (isAppRoute && (authLoading || isProcessing)) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-[#6B7280]">Đang tải...</div>
      </div>
    )
  }

  return <>{children}</>
}
</file>

<file path="src/app/router.tsx">
import { Routes, Route, Navigate } from 'react-router-dom'
import { useAuth } from '../hooks/useAuth'
import { useProfile } from '../hooks/useProfile'
import LandingPage from '../pages/public/LandingPage'
import LoginPage from '../pages/public/LoginPage'
import SignupPage from '../pages/public/SignupPage'
import VerifyEmailPage from '../pages/public/VerifyEmailPage'
import AppGate from './AppGate'
import RolePage from '../pages/onboarding/RolePage'
import OnboardingPage from '../pages/onboarding/OnboardingPage'
import TermsPage from '../pages/public/TermsPage'
import PrivacyPage from '../pages/public/PrivacyPage'
import { CreatorRoutes } from './creatorRoutes'
import { BrandRoutes } from './brandRoutes'
import DashboardRoutes from './dashboardRoutes'

/**
 * ProtectedRoute: Simple auth check - redirects to login if not authenticated
 * Used for routes that require authentication but don't need role/onboarding checks
 */
function ProtectedRoute({ children }: { children: React.ReactNode }) {
  const { session, loading } = useAuth()

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-[#6B7280]">Đang tải...</div>
      </div>
    )
  }

  if (!session) {
    return <Navigate to="/login" replace />
  }

  return <>{children}</>
}

/**
 * RoleBasedRoute: Protects routes that require a specific role
 * Only checks role match - no redirects to /app or dashboards
 */
function RoleBasedRoute({ children, requiredRole }: { children: React.ReactNode; requiredRole: 'creator' | 'brand' }) {
  const { session, loading: authLoading } = useAuth()
  const { profile, loading: profileLoading } = useProfile(
    session?.user?.id,
    !!(session && session.access_token && session.user.email_confirmed_at)
  )

  if (authLoading || profileLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-[#6B7280]">Đang tải...</div>
      </div>
    )
  }

  if (!session || !profile) {
    return <Navigate to="/login" replace />
  }

  if (profile.role !== requiredRole) {
    // Role mismatch - redirect to login (user should go through /app to get to correct route)
    return <Navigate to="/login" replace />
  }

  return <>{children}</>
}

/**
 * CatchAllRoute: Simple 404 handler
 * Just redirects to login if not authenticated, otherwise shows 404
 */
function CatchAllRoute() {
  const { session, loading } = useAuth()

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-[#6B7280]">Đang tải...</div>
      </div>
    )
  }

  if (!session) {
    return <Navigate to="/login" replace />
  }

  // Authenticated but unknown route - show 404
  return (
    <div className="min-h-screen flex items-center justify-center">
      <div className="text-center">
        <h1 className="text-4xl font-bold mb-4">404</h1>
        <p className="text-[#6B7280] mb-4">Trang không tồn tại</p>
        <Navigate to="/" replace />
      </div>
    </div>
  )
}

export function Router() {
  return (
    <Routes>
      {/* Public routes - no AppGate, always accessible */}
      <Route path="/" element={<LandingPage />} />
      <Route path="/login" element={<LoginPage />} />
      <Route path="/signup" element={<SignupPage />} />
      <Route path="/verify-email" element={<VerifyEmailPage />} />
      <Route path="/terms" element={<TermsPage />} />
      <Route path="/privacy" element={<PrivacyPage />} />

      {/* AppGate routes - /app is the ONLY decision gate */}
      {/* AppGate handles: auth check, role check, onboarding check, and redirects */}
      <Route
        path="/app"
        element={
          <AppGate>
            <div className="min-h-screen flex items-center justify-center">
              <div className="text-[#6B7280]">Đang tải...</div>
            </div>
          </AppGate>
        }
      />

      <Route
        path="/role"
        element={
          <AppGate>
            <ProtectedRoute>
              <RolePage />
            </ProtectedRoute>
          </AppGate>
        }
      />

      <Route
        path="/onboarding/:role?"
        element={
          <AppGate>
            <ProtectedRoute>
              <OnboardingPage />
            </ProtectedRoute>
          </AppGate>
        }
      />

      {/* Dashboard routes - OUTSIDE AppGate, stable final destinations */}
      {/* These routes never redirect on their own - they are the final destination */}
      <Route
        path="/dashboard/:role/*"
        element={
          <ProtectedRoute>
            <DashboardRoutes />
          </ProtectedRoute>
        }
      />

      {/* Legacy routes - keep for backward compatibility */}
      <Route
        path="/creator/*"
        element={
          <RoleBasedRoute requiredRole="creator">
            <CreatorRoutes />
          </RoleBasedRoute>
        }
      />

      <Route
        path="/brand/*"
        element={
          <RoleBasedRoute requiredRole="brand">
            <BrandRoutes />
          </RoleBasedRoute>
        }
      />

      {/* 404 handler */}
      <Route path="*" element={<CatchAllRoute />} />
    </Routes>
  )
}
</file>

<file path="src/components/dashboard/DashboardHeader.tsx">
import { Link, useNavigate, useLocation } from 'react-router-dom'
import { useState } from 'react'
import { FaBell } from 'react-icons/fa'
import { useAuth } from '../../hooks/useAuth'
import { useProfile } from '../../hooks/useProfile'
import UserMenu from '../layout/UserMenu'
import NotificationModal from '../shared/NotificationModal'

/**
 * DashboardHeader
 * - Fixed header for dashboard pages
 * - Height: h-16 (same as Landing Header)
 * - Left: w-64 (aligned with Sidebar) → Logo + ALINO centered
 * - Middle: Title + Subtitle (auto by route)
 * - Right: Notification + UserMenu (tight spacing)
 */
export default function DashboardHeader() {
  const { session } = useAuth()
  const { profile } = useProfile(
    session?.user?.id,
    !!(session && session.access_token && session.user.email_confirmed_at)
  )
  const navigate = useNavigate()
  const location = useLocation()
  const [isNotificationModalOpen, setIsNotificationModalOpen] = useState(false)

  const handleLogoClick = (e: React.MouseEvent) => {
    e.preventDefault()
    // Navigate to dashboard home based on role
    if (profile?.role === 'creator') {
      navigate('/dashboard/creator', { replace: false })
    } else if (profile?.role === 'brand') {
      navigate('/dashboard/brand', { replace: false })
    } else {
      // Fallback to /app if role not set
      navigate('/app', { replace: false })
    }
  }

  const fullName =
    (profile?.role === 'creator' ? (profile as any).full_name : profile?.role === 'brand' ? (profile as any).brand_name : null) ||
    session?.user?.user_metadata?.display_name ||
    ''

  const avatarUrl =
    (profile?.role === 'creator' ? (profile as any).avatar_url : null) ||
    session?.user?.user_metadata?.avatar_url ||
    undefined

  // 🔔 mock unread count
  const unreadNotificationCount = 4

  /* ------------------------------
   * Title & Subtitle by route
   * ------------------------------ */
  const pathname = location.pathname

  const getTitleAndSubtitle = () => {
    // Creator dashboard routes
    if (pathname === '/dashboard/creator') {
      const displayName = (profile?.role === 'creator' ? (profile as any).full_name : profile?.role === 'brand' ? (profile as any).brand_name : null) || session?.user?.user_metadata?.display_name || 'Creator'
      return {
        title: `Chào mừng, ${displayName}!`,
        subtitle: 'Tổng quan tài khoản ALINO của bạn hôm nay.',
      }
    }

    if (pathname.startsWith('/dashboard/creator/profile')) {
      return {
        title: 'Hồ sơ cá nhân',
        subtitle: 'Quản lý thông tin hiển thị của bạn với đối tác',
      }
    }

    if (pathname.startsWith('/dashboard/creator/settings')) {
      return {
        title: 'Cài đặt',
        subtitle: 'Quản lý cài đặt tài khoản và tùy chọn',
      }
    }

    if (pathname.startsWith('/dashboard/creator/services')) {
      return {
        title: 'Dịch vụ & Bảng giá',
        subtitle: 'Thiết lập dịch vụ và mức giá bạn cung cấp',
      }
    }

    if (pathname.startsWith('/dashboard/creator/discovery')) {
      return {
        title: 'Cơ hội hợp tác',
        subtitle: 'Khám phá các cơ hội phù hợp với bạn',
      }
    }

    if (pathname.startsWith('/dashboard/creator/proposals')) {
      return {
        title: 'Đề xuất',
        subtitle: 'Quản lý các đề xuất hợp tác đang diễn ra',
      }
    }

    if (pathname.startsWith('/dashboard/creator/workspace')) {
      return {
        title: 'Trung tâm làm việc',
        subtitle: 'Theo dõi và xử lý các hoạt động hợp tác',
      }
    }

    if (pathname.startsWith('/dashboard/creator/analytics')) {
      return {
        title: 'Phân tích',
        subtitle: 'Theo dõi hiệu suất và tăng trưởng của bạn',
      }
    }

    // Brand dashboard routes
    if (pathname === '/dashboard/brand') {
      return {
        title: 'Brand Dashboard',
        subtitle: 'Tổng quan chiến dịch và hiệu suất',
      }
    }

    if (pathname.startsWith('/dashboard/brand/discovery')) {
      return {
        title: 'Tìm kiếm Creator',
        subtitle: 'Khám phá và kết nối với các creator phù hợp',
      }
    }

    if (pathname.startsWith('/dashboard/brand/campaigns')) {
      return {
        title: 'Chiến dịch',
        subtitle: 'Quản lý các chiến dịch marketing của bạn',
      }
    }

    if (pathname.startsWith('/dashboard/brand/proposals')) {
      return {
        title: 'Hộp thư đề xuất',
        subtitle: 'Xem và quản lý các đề xuất từ creator',
      }
    }

    if (pathname.startsWith('/dashboard/brand/workspace')) {
      return {
        title: 'Không gian làm việc',
        subtitle: 'Theo dõi tiến độ và cộng tác với creator',
      }
    }

    if (pathname.startsWith('/dashboard/brand/analytics')) {
      return {
        title: 'Phân tích',
        subtitle: 'Theo dõi hiệu suất chiến dịch và ROI',
      }
    }

    if (pathname.startsWith('/dashboard/brand/settings')) {
      return {
        title: 'Cài đặt',
        subtitle: 'Quản lý cài đặt tài khoản và tùy chọn',
      }
    }

    return { title: '', subtitle: '' }
  }

  const { title, subtitle } = getTitleAndSubtitle()

  return (
    <>
      <header className="fixed top-0 inset-x-0 z-50 h-16 bg-white/80 backdrop-blur-xl border-b border-black/5">
  <div className="h-full flex">
    {/* LEFT: Sidebar-aligned block */}
    <div className="w-64 h-full flex items-center justify-center border-r border-gray-200 flex-shrink-0">
      <Link
        to="/"
        onClick={handleLogoClick}
        className="flex items-center gap-3"
      >
        <img src="/logo/logo.png" alt="ALINO" className="w-8 h-8" />
        <span className="font-bold text-2xl leading-none bg-gradient-to-r from-[#6366F1] to-[#EC4899] bg-clip-text text-transparent">
          ALINO
        </span>
      </Link>
    </div>

    {/* RIGHT AREA: SAME CONTAINER AS LANDING */}
    <div className="flex-1">
      <div className="max-w-7xl mx-auto px-6 h-full flex items-center justify-between">
        {/* Title */}
        <div className="flex flex-col justify-center">
          <h1 className="text-lg font-semibold text-gray-900 leading-tight">
            {title}
          </h1>
          {subtitle && (
            <p className="text-sm text-gray-500 leading-tight mt-0.5">
              {subtitle}
            </p>
          )}
        </div>

        {/* User actions – EXACT SAME POSITION AS LANDING */}
        {session && (
          <div className="flex items-center gap-2">
            <button
              onClick={() => setIsNotificationModalOpen(true)}
              className="relative p-2 rounded-lg text-gray-600 hover:text-[#6366F1] hover:bg-gray-100 transition"
            >
              <FaBell className="w-5 h-5" />
              {unreadNotificationCount > 0 && (
                <span className="absolute -top-1 -right-1 w-4 h-4 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white text-xs font-bold rounded-full flex items-center justify-center">
                  {unreadNotificationCount}
                </span>
              )}
            </button>

            <UserMenu
              userEmail={session.user.email || ''}
              displayName={fullName}
              avatarUrl={avatarUrl}
              role={profile?.role || null}
            />
          </div>
        )}
      </div>
    </div>
  </div>
</header>

      <NotificationModal
        isOpen={isNotificationModalOpen}
        onClose={() => setIsNotificationModalOpen(false)}
      />
    </>
  )
}
</file>

<file path="src/components/layout/Footer.tsx">
import { Link } from 'react-router-dom'
import { FaFacebook, FaInstagram, FaTiktok, FaYoutube, FaLinkedin, FaPhone, FaEnvelope, FaMapMarkerAlt } from 'react-icons/fa'

export default function Footer() {
  return (
    <footer className="relative pt-20 pb-8 bg-white border-t border-black/5">
      <div className="max-w-7xl mx-auto px-6">
        <div className="grid md:grid-cols-5 gap-12 mb-8">
          <div className="space-y-4">
            <div className="flex items-center gap-3">
              <img
                src="/logo/logo.png"
                alt="ALINO"
                className="w-7 h-7"
              />
              <span className="font-semibold text-lg tracking-tight bg-gradient-to-r from-[#6366F1] to-[#EC4899] bg-clip-text text-transparent">
                ALINO
              </span>
            </div>
            <p className="text-sm text-[#6B7280] leading-relaxed">
              Nền tảng hợp tác cho Creator và Brand chuyên nghiệp.
            </p>
            <div className="flex items-center gap-4 pt-2">
              <a
                href="https://facebook.com"
                target="_blank"
                rel="noopener noreferrer"
                className="text-[#9CA3AF] hover:text-[#1877F2] transition-colors hover:scale-110 transform duration-200"
              >
                <FaFacebook size={20} />
              </a>
              <a
                href="https://instagram.com"
                target="_blank"
                rel="noopener noreferrer"
                className="text-[#9CA3AF] hover:text-[#DD2A7B] transition-colors hover:scale-110 transform duration-200"
              >
                <FaInstagram size={20} />
              </a>
              <a
                href="https://tiktok.com"
                target="_blank"
                rel="noopener noreferrer"
                className="text-[#9CA3AF] hover:text-[#000000] transition-colors hover:scale-110 transform duration-200"
              >
                <FaTiktok size={20} />
              </a>
              <a
                href="https://youtube.com"
                target="_blank"
                rel="noopener noreferrer"
                className="text-[#9CA3AF] hover:text-[#FF0000] transition-colors hover:scale-110 transform duration-200"
              >
                <FaYoutube size={20} />
              </a>
              <a
                href="https://linkedin.com"
                target="_blank"
                rel="noopener noreferrer"
                className="text-[#9CA3AF] hover:text-[#0A66C2] transition-colors hover:scale-110 transform duration-200"
              >
                <FaLinkedin size={20} />
              </a>
            </div>
          </div>

          <div>
            <h4 className="font-semibold text-sm mb-4 tracking-tight">Sản phẩm</h4>
            <ul className="space-y-3 text-sm text-[#6B7280]">
              <li>
                <a href="#product" className="hover:text-[#6366F1] transition-colors">
                  Tính năng
                </a>
              </li>
              <li>
                <a href="#pricing" className="hover:text-[#6366F1] transition-colors">
                  Bảng giá
                </a>
              </li>
              <li>
                <a href="#how-it-works" className="hover:text-[#6366F1] transition-colors">
                  Cách hoạt động
                </a>
              </li>
            </ul>
          </div>

          <div>
            <h4 className="font-semibold text-sm mb-4 tracking-tight">Công ty</h4>
            <ul className="space-y-3 text-sm text-[#6B7280]">
              <li>
                <a href="#about" className="hover:text-[#6366F1] transition-colors">
                  Về chúng tôi
                </a>
              </li>
              <li>
                <a href="#news" className="hover:text-[#6366F1] transition-colors">
                  Tin tức
                </a>
              </li>
              <li>
                <a href="#contact" className="hover:text-[#6366F1] transition-colors">
                  Liên hệ
                </a>
              </li>
            </ul>
          </div>

          <div>
            <h4 className="font-semibold text-sm mb-4 tracking-tight">Pháp lý</h4>
            <ul className="space-y-3 text-sm text-[#6B7280]">
              <li>
                <Link to="/terms" className="hover:text-[#6366F1] transition-colors">
                  Điều khoản sử dụng
                </Link>
              </li>
              <li>
                <Link to="/privacy" className="hover:text-[#6366F1] transition-colors">
                  Chính sách bảo mật
                </Link>
              </li>
            </ul>
          </div>

          <div>
            <h4 className="font-semibold text-sm mb-4 tracking-tight">Liên hệ</h4>
            <ul className="space-y-3 text-sm text-[#6B7280]">
              <li className="flex items-start gap-3">
                <FaPhone className="mt-0.5 flex-shrink-0" size={16} />
                <a href="tel:+84707970216" className="hover:text-[#6366F1] transition-colors">
                  +84 707 970 216
                </a>
              </li>
              <li className="flex items-start gap-3">
                <FaEnvelope className="mt-0.5 flex-shrink-0" size={16} />
                <a href="mailto:contact@alino.net" className="hover:text-[#6366F1] transition-colors">
                  contact@alino.net
                </a>
              </li>
              <li className="flex items-start gap-3 leading-relaxed">
                <FaMapMarkerAlt className="mt-0.5 flex-shrink-0" size={16} />
                <span>
                  Landmark 81
                  <br />
                  720A Điện Biên Phủ, Phường 22, Quận Bình Thạnh, TP. Hồ Chí Minh, Việt Nam
                </span>
              </li>
            </ul>
          </div>
        </div>

        <div className="pt-8 border-t border-black/5 text-center text-sm text-[#9CA3AF]">
          © 2025 ALINO. All rights reserved.
        </div>
      </div>
    </footer>
  )
}
</file>

<file path="src/components/AvatarUpload.tsx">
import { useState, useRef } from 'react'
import Cropper, { Area } from 'react-easy-crop'
import { getSupabase } from '../lib/supabase'
import { getCroppedImg } from '../utils/cropImage'

interface AvatarUploadProps {
  currentAvatarUrl?: string
  onAvatarChange: (url: string) => void
  userId: string
}

const CROP_SIZE = 300 // Fixed crop circle size

export default function AvatarUpload({
  currentAvatarUrl,
  onAvatarChange,
  userId,
}: AvatarUploadProps) {
  const [imageSrc, setImageSrc] = useState<string | null>(null)
  const [showCropModal, setShowCropModal] = useState(false)
  const [crop, setCrop] = useState({ x: 0, y: 0 })
  const [zoom, setZoom] = useState(1)
  const [croppedAreaPixels, setCroppedAreaPixels] = useState<Area | null>(null)
  const [uploading, setUploading] = useState(false)

  const fileInputRef = useRef<HTMLInputElement>(null)

  /* ================= FILE SELECT ================= */

  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (!file) return

    if (!['image/jpeg', 'image/png', 'image/webp'].includes(file.type)) {
      alert('Chỉ hỗ trợ JPG, PNG, WEBP')
      return
    }

    if (file.size > 5 * 1024 * 1024) {
      alert('Ảnh tối đa 5MB')
      return
    }

    const reader = new FileReader()
    reader.onload = () => {
      setImageSrc(reader.result as string)
      setShowCropModal(true)
      setCrop({ x: 0, y: 0 })
      setZoom(1)
    }
    reader.readAsDataURL(file)
  }

  /* ================= CROP + UPLOAD ================= */

  const onCropComplete = (croppedArea: Area, croppedAreaPixels: Area) => {
    setCroppedAreaPixels(croppedAreaPixels)
  }

  const handleCrop = async () => {
    if (!imageSrc || !croppedAreaPixels) return

    setUploading(true)

    try {
      // Get cropped image blob
      const croppedImage = await getCroppedImg(imageSrc, croppedAreaPixels)
      
      if (!croppedImage) {
        throw new Error('Không thể crop ảnh')
      }

      // Upload to Supabase Storage
      const supabase = getSupabase()
      const timestamp = Date.now()
      const fileExt = 'jpg'
      const path = `${userId}/${timestamp}.${fileExt}`

      // Upload file to storage
      const { error: uploadError } = await supabase.storage
        .from('avatars')
        .upload(path, croppedImage, {
          upsert: true,
          contentType: 'image/jpeg',
        })

      if (uploadError) {
        throw new Error(`Upload failed: ${uploadError.message}`)
      }

      // Get public URL
      const { data: urlData } = supabase.storage
        .from('avatars')
        .getPublicUrl(path)

      if (!urlData?.publicUrl) {
        throw new Error('Failed to get public URL')
      }

      // Pass public URL to parent component
      onAvatarChange(urlData.publicUrl)

      // Close modal and reset
      setShowCropModal(false)
      setImageSrc(null)
      setCrop({ x: 0, y: 0 })
      setZoom(1)
      setCroppedAreaPixels(null)
    } catch (error: any) {
      console.error('Avatar upload error:', error)
      alert(error.message || 'Upload thất bại')
      // Reset state on error
      setShowCropModal(false)
      setImageSrc(null)
      setCrop({ x: 0, y: 0 })
      setZoom(1)
      setCroppedAreaPixels(null)
    } finally {
      setUploading(false)
    }
  }

  const handleCancel = () => {
    setShowCropModal(false)
    setImageSrc(null)
    setCrop({ x: 0, y: 0 })
    setZoom(1)
    setCroppedAreaPixels(null)
  }

  /* ================= RENDER ================= */

  return (
    <>
      {/* AVATAR */}
      <div className="flex flex-col items-center gap-2">
        <div
          onClick={() => fileInputRef.current?.click()}
          className="relative w-24 h-24 rounded-full overflow-hidden bg-gray-200 cursor-pointer group"
        >
          {currentAvatarUrl ? (
            <img src={currentAvatarUrl} alt="Avatar" className="w-full h-full object-cover" />
          ) : (
            <div className="w-full h-full flex items-center justify-center text-gray-400 text-4xl">
              👤
            </div>
          )}

          <div className="absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 flex items-center justify-center transition">
            <span className="text-white text-xs font-medium">Đổi avatar</span>
          </div>
        </div>
      </div>

      <input
        ref={fileInputRef}
        type="file"
        accept="image/*"
        hidden
        onChange={handleFileSelect}
      />

      {/* MODAL */}
      {showCropModal && imageSrc && (
        <div className="fixed inset-0 z-50 bg-black/60 flex justify-center p-4">
          <div 
            className="bg-white rounded-xl p-5 w-full"
            style={{ 
              maxWidth: '400px',
              maxHeight: '80vh',
              display: 'flex',
              flexDirection: 'column',
            }}
          >
            <h3 className="font-semibold mb-4 flex-shrink-0">Chỉnh sửa avatar</h3>

            {/* Crop Area - Compact, centered */}
            <div
              className="relative mx-auto flex-shrink-0"
              style={{
                width: `${CROP_SIZE}px`,
                height: `${CROP_SIZE}px`,
                backgroundColor: '#000',
              }}
            >
              <Cropper
                image={imageSrc}
                crop={crop}
                zoom={zoom}
                aspect={1}
                cropShape="round"
                showGrid={true}
                onCropChange={setCrop}
                onZoomChange={setZoom}
                onCropComplete={onCropComplete}
                style={{
                  containerStyle: {
                    width: '100%',
                    height: '100%',
                  },
                }}
              />
            </div>

            {/* Zoom Control - Directly below crop */}
            <div className="mt-4 mb-4 flex-shrink-0" style={{ width: `${CROP_SIZE}px`, marginLeft: 'auto', marginRight: 'auto' }}>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Zoom
              </label>
              <input
                type="range"
                min="1"
                max="3"
                step="0.1"
                value={zoom}
                onChange={(e) => setZoom(parseFloat(e.target.value))}
                className="w-full"
              />
            </div>

            {/* Buttons - Always visible */}
            <div className="flex justify-end gap-2 mt-3 flex-shrink-0">
            <button
                onClick={handleCancel}
                disabled={uploading}
                className="px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium disabled:opacity-50"
              >
                Hủy
              </button>
              <button
                onClick={handleCrop}
                disabled={uploading}
                className="px-4 py-2 rounded-lg bg-gradient-to-r from-indigo-500 to-pink-500 text-white font-medium disabled:opacity-50"
              >
                {uploading ? 'Đang lưu…' : 'Lưu'}
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  )
}
</file>

<file path="src/hooks/useAuth.ts">
/**
 * useAuth: Re-export from AuthContext
 * 
 * This hook now reads from AuthContext (single source of truth).
 * All components should use this hook to access auth state.
 * 
 * IMPORTANT: signOut() does NOT handle navigation.
 * Components must handle redirects after signOut themselves.
 */
export { useAuth } from '../contexts/AuthContext'
</file>

<file path="src/pages/creator/profile/ProfilePage.tsx">
import { useState, useEffect, useRef } from 'react'
import { useAuth } from '../../../hooks/useAuth'
import { useProfile } from '../../../hooks/useProfile'
import { getSupabase } from '../../../lib/supabase'
import type { Profile, CreatorProfile, BrandProfile } from '../../../types/profile'
import AvatarUpload from '../../../components/AvatarUpload'
import Toast from '../../../components/shared/Toast'

export default function ProfilePage() {
  const { session } = useAuth()
  const { profile, loading: profileLoading, needsOnboarding } = useProfile(
    session?.user?.id,
    !!(session && session.access_token && session.user.email_confirmed_at)
  )
  const [loading, setLoading] = useState(false)
  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null)
  const [fieldErrors, setFieldErrors] = useState<Record<string, string>>({})
  const supabase = getSupabase()
  
  // Refs for field focus/scroll
  const fieldRefs = useRef<Record<string, HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement | null>>({})

  // Form state - matches FINAL schema exactly
  interface ProfileFormData {
    display_name?: string | null
    avatar_url?: string | null
    birth_year?: number | null
    country?: string | null
    city?: string | null
    // Creator fields
    creator_platforms?: string[] | null // TEXT[]
    content_categories?: string[] | null // TEXT[]
    followers_count?: number | null
    avg_views?: number | null
    collaboration_expectation?: string[] | null // TEXT[]
    // Brand fields
    brand_name?: string | null
    industry?: string | null
    company_size?: string | null
    monthly_marketing_budget?: number | null // NUMERIC
    target_platforms?: string[] | null // TEXT[]
    collaboration_goals?: string[] | null // TEXT[]
  }
  const [formData, setFormData] = useState<ProfileFormData>({})

  useEffect(() => {
    if (profile) {
      const isCreator = profile.role === 'creator'
      const isBrand = profile.role === 'brand'
      setFormData({
        display_name: isCreator ? (profile as any).full_name : (isBrand ? (profile as any).brand_name : undefined),
        avatar_url: isCreator ? (profile as any).avatar_url : undefined,
        birth_year: isCreator ? (profile as any).birth_year : undefined,
        country: isCreator ? (profile as any).country : undefined,
        city: isCreator ? (profile as any).city : undefined,
        // Creator fields
        creator_platforms: (profile as any).creator_platforms || undefined,
        content_categories: (profile as any).content_categories || undefined,
        followers_count: (profile as any).followers_count || undefined,
        avg_views: (profile as any).avg_views || undefined,
        collaboration_expectation: (profile as any).collaboration_expectation || undefined,
        // Brand fields
        brand_name: (profile as any).brand_name || undefined,
        industry: (profile as any).industry || undefined,
        company_size: (profile as any).company_size || undefined,
        monthly_marketing_budget: (profile as any).monthly_marketing_budget ? Number((profile as any).monthly_marketing_budget) : undefined,
        target_platforms: (profile as any).target_platforms || undefined,
        collaboration_goals: Array.isArray((profile as any).collaboration_goals) ? (profile as any).collaboration_goals : undefined,
      })
    }
  }, [profile])

  if (profileLoading) {
    return (
      <div className="flex items-center justify-center py-20">
        <div className="text-[#6B7280]">Đang tải...</div>
      </div>
    )
  }

  if (!profile) {
    if (needsOnboarding) {
      return (
        <div className="flex items-center justify-center py-20">
          <div className="text-[#6B7280]">Đang chuyển hướng đến onboarding...</div>
        </div>
      )
    }
    return (
      <div className="flex items-center justify-center py-20">
        <div className="text-[#6B7280]">Không tìm thấy hồ sơ</div>
      </div>
    )
  }

  const role = profile.role || 'creator'

  // Validation function
  const validateProfile = (): { isValid: boolean; firstInvalidField: string | null } => {
    const errors: Record<string, string> = {}

    // Core required fields
    if (!formData.display_name || formData.display_name.trim() === '') {
      errors.display_name = 'Vui lòng nhập tên hiển thị'
    }
    if (!formData.birth_year) {
      errors.birth_year = 'Vui lòng nhập năm sinh'
    }
    if (!formData.country || formData.country.trim() === '') {
      errors.country = 'Vui lòng nhập quốc gia'
    }
    if (!formData.city || formData.city.trim() === '') {
      errors.city = 'Vui lòng nhập thành phố'
    }

    if (role === 'creator') {
      // Creator required fields
      if (!formData.creator_platforms || formData.creator_platforms.length === 0) {
        errors.creator_platforms = 'Vui lòng chọn ít nhất một nền tảng'
      }
      if (!formData.content_categories || formData.content_categories.length === 0) {
        errors.content_categories = 'Vui lòng chọn ít nhất một danh mục nội dung'
      }
      if (!formData.collaboration_expectation || formData.collaboration_expectation.length === 0) {
        errors.collaboration_expectation = 'Vui lòng chọn ít nhất một kỳ vọng hợp tác'
      }
      if (!formData.followers_count || formData.followers_count <= 0) {
        errors.followers_count = 'Vui lòng nhập số lượng người theo dõi (lớn hơn 0)'
      }
      if (!formData.avg_views || formData.avg_views <= 0) {
        errors.avg_views = 'Vui lòng nhập lượt xem trung bình (lớn hơn 0)'
      }
    } else {
      // Brand required fields
      if (!formData.brand_name || formData.brand_name.trim() === '') {
        errors.brand_name = 'Vui lòng nhập tên công ty'
      }
      if (!formData.industry || formData.industry.trim() === '') {
        errors.industry = 'Vui lòng nhập ngành nghề'
      }
      if (!formData.company_size || formData.company_size.trim() === '') {
        errors.company_size = 'Vui lòng chọn quy mô công ty'
      }
      if (!formData.monthly_marketing_budget || formData.monthly_marketing_budget <= 0) {
        errors.monthly_marketing_budget = 'Vui lòng nhập ngân sách marketing (lớn hơn 0)'
      }
      if (!formData.target_platforms || formData.target_platforms.length === 0) {
        errors.target_platforms = 'Vui lòng chọn ít nhất một nền tảng mục tiêu'
      }
      if (!formData.collaboration_goals || formData.collaboration_goals.length === 0) {
        errors.collaboration_goals = 'Vui lòng chọn ít nhất một mục tiêu hợp tác'
      }
    }

    setFieldErrors(errors)

    if (Object.keys(errors).length > 0) {
      // Find first invalid field for scrolling
      const fieldOrder = role === 'creator'
        ? ['display_name', 'birth_year', 'country', 'city', 'creator_platforms', 'content_categories', 'followers_count', 'avg_views', 'collaboration_expectation']
        : ['display_name', 'birth_year', 'country', 'city', 'brand_name', 'industry', 'company_size', 'monthly_marketing_budget', 'target_platforms', 'collaboration_goals']
      
      const firstInvalidField = fieldOrder.find(field => errors[field]) || null
      return { isValid: false, firstInvalidField }
    }

    return { isValid: true, firstInvalidField: null }
  }

  const scrollToField = (fieldName: string) => {
    const field = fieldRefs.current[fieldName]
    if (field) {
      field.scrollIntoView({ behavior: 'smooth', block: 'center' })
      setTimeout(() => field.focus(), 300)
    }
  }

  const handleSave = async () => {
    if (!session || !session.access_token || !profile) return

    const validation = validateProfile()
    if (!validation.isValid) {
      setToast({ message: 'Vui lòng điền đầy đủ thông tin bắt buộc', type: 'error' })
      if (validation.firstInvalidField) {
        scrollToField(validation.firstInvalidField)
      }
      return
    }

    setLoading(true)
    setFieldErrors({})

    try {
      if (role === 'creator') {
        const creatorUpdateData: any = {
          full_name: formData.display_name || null,
          avatar_url: formData.avatar_url || null,
          birth_year: formData.birth_year || null,
          country: formData.country || null,
          city: formData.city || null,
          creator_platforms: formData.creator_platforms || null,
          content_categories: formData.content_categories || null,
          followers_count: formData.followers_count || null,
          avg_views: formData.avg_views || null,
          collaboration_expectation: formData.collaboration_expectation || null,
          updated_at: new Date().toISOString(),
        }

        const { error: creatorError } = await supabase
          .from('creator_profiles')
          .update(creatorUpdateData)
          .eq('user_id', session.user.id)

        if (creatorError) {
          if (creatorError.code === '42501' || creatorError.code === 'PGRST301') {
            setLoading(false)
            setToast({ message: 'Không thể truy cập dữ liệu. Vui lòng thử lại.', type: 'error' })
            return
          }
          throw creatorError
        }
      } else if (role === 'brand') {
        const brandUpdateData: any = {
          brand_name: formData.brand_name || null,
          industry: formData.industry || null,
          company_size: formData.company_size || null,
          monthly_marketing_budget: formData.monthly_marketing_budget !== undefined ? formData.monthly_marketing_budget : null,
          target_platforms: formData.target_platforms || null,
          collaboration_goals: formData.collaboration_goals || null,
          updated_at: new Date().toISOString(),
        }

        const { error: brandError } = await supabase
          .from('brand_profiles')
          .update(brandUpdateData)
          .eq('user_id', session.user.id)

        if (brandError) {
          if (brandError.code === '42501' || brandError.code === 'PGRST301') {
            setLoading(false)
            setToast({ message: 'Không thể truy cập dữ liệu. Vui lòng thử lại.', type: 'error' })
            return
          }
          throw brandError
        }
      }

      // Sync full_name and avatar_url to auth metadata (for creator only)
      const metadataUpdate: Record<string, any> = {}
      if (role === 'creator') {
        if (formData.display_name !== undefined) {
          metadataUpdate.display_name = formData.display_name
        }
        if (formData.avatar_url !== undefined) {
          metadataUpdate.avatar_url = formData.avatar_url
        }
      }

      if (Object.keys(metadataUpdate).length > 0) {
        const { error: authError } = await supabase.auth.updateUser({
          data: metadataUpdate,
        })
        if (authError) {
          console.warn('Failed to update auth metadata:', authError)
          // Don't throw - profile update succeeded
        }
      }

      setToast({ message: 'Lưu hồ sơ thành công', type: 'success' })
    } catch (err: any) {
      console.error('Profile save error:', err)
      setToast({ message: err.message || 'Có lỗi xảy ra, vui lòng thử lại', type: 'error' })
    } finally {
      setLoading(false)
    }
  }

  const handleAvatarChange = async (url: string) => {
    if (!session || !profile || !role) {
      console.error('Cannot save avatar: missing session or profile')
      return
    }

    setFormData((prev) => ({ ...prev, avatar_url: url }))

    try {
      if (role === 'creator') {
        const { error: creatorError } = await supabase
          .from('creator_profiles')
          .update({
            avatar_url: url,
            updated_at: new Date().toISOString(),
          })
          .eq('user_id', session.user.id)

        if (creatorError) {
          if (creatorError.code === '42501' || creatorError.code === 'PGRST301') {
            console.error('Permission denied updating avatar:', creatorError)
            return
          }
          console.error('Failed to update creator_profiles.avatar_url:', creatorError)
          throw creatorError
        }
      }

      // Sync to auth metadata (secondary, non-blocking)
      const { error: authError } = await supabase.auth.updateUser({
        data: { avatar_url: url },
      })
      if (authError) {
        console.warn('Failed to sync avatar_url to auth metadata (non-blocking):', authError)
        // Don't throw - profile update succeeded
      }

      setToast({ message: 'Đã lưu avatar thành công', type: 'success' })
    } catch (error: any) {
      console.error('Avatar save error:', error)
      // Revert optimistic update on error
      setFormData((prev) => ({ ...prev, avatar_url: profile.avatar_url || null }))
      setToast({ message: error.message || 'Có lỗi xảy ra khi lưu avatar', type: 'error' })
    }
  }

  return (
    <div className="bg-white py-8 px-6">
      <div className="max-w-4xl mx-auto">
        <div className="bg-white rounded-3xl p-8 md:p-10 shadow-xl border border-gray-200">

          <form onSubmit={(e) => { e.preventDefault(); handleSave(); }} className="space-y-6">
            {/* Basic Identity Section */}
            <div className="border-b pb-6">
              <h2 className="text-xl font-semibold mb-4">Thông tin cơ bản</h2>
              
              {role === 'creator' ? (
                <>
                  {/* Top Row: Display Name | Avatar */}
                  <div className="flex flex-col md:flex-row gap-6 mb-6 items-start">
                    {/* Left: Display Name */}
                    <div className="flex-1 space-y-4 w-full md:w-auto">
                      <div>
                        <label className="block text-sm font-medium text-[#374151] mb-2">
                          Tên hiển thị *
                        </label>
                        <input
                          ref={(el) => fieldRefs.current.display_name = el}
                          type="text"
                          value={formData.display_name || ''}
                          onChange={(e) => {
                            setFormData({ ...formData, display_name: e.target.value })
                            if (fieldErrors.display_name) {
                              setFieldErrors(prev => {
                                const next = { ...prev }
                                delete next.display_name
                                return next
                              })
                            }
                          }}
                          className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.display_name ? 'border-red-500' : ''}`}
                          placeholder="Nhập tên hiển thị"
                        />
                        {fieldErrors.display_name && (
                          <p className="mt-1 text-sm text-red-600">{fieldErrors.display_name}</p>
                        )}
                      </div>
                    </div>

                    {/* Right: Avatar */}
                    <div className="flex-shrink-0">
                      <AvatarUpload
                        currentAvatarUrl={formData.avatar_url ?? undefined}
                        onAvatarChange={handleAvatarChange}
                        userId={session?.user?.id || ''}
                      />
                    </div>
                  </div>

                  {/* 2-Column Grid: Birth Year | Country + City */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-[#374151] mb-2">
                        Năm sinh *
                      </label>
                      <input
                        ref={(el) => fieldRefs.current.birth_year = el}
                        type="number"
                        min="1950"
                        max={new Date().getFullYear()}
                        value={formData.birth_year || ''}
                        onChange={(e) => {
                          setFormData({ ...formData, birth_year: e.target.value ? parseInt(e.target.value) : undefined })
                          if (fieldErrors.birth_year) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.birth_year
                              return next
                            })
                          }
                        }}
                        className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.birth_year ? 'border-red-500' : ''}`}
                      />
                      {fieldErrors.birth_year && (
                        <p className="mt-1 text-sm text-red-600">{fieldErrors.birth_year}</p>
                      )}
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-[#374151] mb-2">
                        Quốc gia *
                      </label>
                      <input
                        ref={(el) => fieldRefs.current.country = el}
                        type="text"
                        value={formData.country || ''}
                        onChange={(e) => {
                          setFormData({ ...formData, country: e.target.value })
                          if (fieldErrors.country) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.country
                              return next
                            })
                          }
                        }}
                        className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.country ? 'border-red-500' : ''}`}
                      />
                      {fieldErrors.country && (
                        <p className="mt-1 text-sm text-red-600">{fieldErrors.country}</p>
                      )}
                    </div>
                    <div className="md:col-span-2">
                      <label className="block text-sm font-medium text-[#374151] mb-2">
                        Thành phố *
                      </label>
                      <input
                        ref={(el) => fieldRefs.current.city = el}
                        type="text"
                        value={formData.city || ''}
                        onChange={(e) => {
                          setFormData({ ...formData, city: e.target.value })
                          if (fieldErrors.city) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.city
                              return next
                            })
                          }
                        }}
                        className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.city ? 'border-red-500' : ''}`}
                      />
                      {fieldErrors.city && (
                        <p className="mt-1 text-sm text-red-600">{fieldErrors.city}</p>
                      )}
                    </div>
                  </div>
                </>
              ) : (
                <>
                  {/* Top Row: Company Name | Avatar */}
                  <div className="flex flex-col md:flex-row gap-6 mb-6 items-start">
                    {/* Left: Company Name */}
                    <div className="flex-1 space-y-4 w-full md:w-auto">
                      <div>
                        <label className="block text-sm font-medium text-[#374151] mb-2">
                          Tên công ty *
                        </label>
                        <input
                          ref={(el) => fieldRefs.current.brand_name = el}
                          type="text"
                          value={formData.brand_name || ''}
                          onChange={(e) => {
                            setFormData({ ...formData, brand_name: e.target.value })
                            if (fieldErrors.brand_name) {
                              setFieldErrors(prev => {
                                const next = { ...prev }
                                delete next.brand_name
                                return next
                              })
                            }
                          }}
                          className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.brand_name ? 'border-red-500' : ''}`}
                          placeholder="Nhập tên công ty"
                        />
                        {fieldErrors.brand_name && (
                          <p className="mt-1 text-sm text-red-600">{fieldErrors.brand_name}</p>
                        )}
                      </div>
                    </div>

                    {/* Right: Avatar */}
                    <div className="flex-shrink-0">
                      <AvatarUpload
                        currentAvatarUrl={formData.avatar_url ?? undefined}
                        onAvatarChange={handleAvatarChange}
                        userId={session?.user?.id || ''}
                      />
                    </div>
                  </div>

                  {/* 2-Column Grid: Industry | Country + City */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-[#374151] mb-2">
                        Ngành nghề *
                      </label>
                      <input
                        ref={(el) => fieldRefs.current.industry = el}
                        type="text"
                        value={formData.industry || ''}
                        onChange={(e) => {
                          setFormData({ ...formData, industry: e.target.value })
                          if (fieldErrors.industry) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.industry
                              return next
                            })
                          }
                        }}
                        className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.industry ? 'border-red-500' : ''}`}
                      />
                      {fieldErrors.industry && (
                        <p className="mt-1 text-sm text-red-600">{fieldErrors.industry}</p>
                      )}
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-[#374151] mb-2">
                        Quốc gia *
                      </label>
                      <input
                        ref={(el) => fieldRefs.current.country = el}
                        type="text"
                        value={formData.country || ''}
                        onChange={(e) => {
                          setFormData({ ...formData, country: e.target.value })
                          if (fieldErrors.country) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.country
                              return next
                            })
                          }
                        }}
                        className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.country ? 'border-red-500' : ''}`}
                      />
                      {fieldErrors.country && (
                        <p className="mt-1 text-sm text-red-600">{fieldErrors.country}</p>
                      )}
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-[#374151] mb-2">
                        Thành phố *
                      </label>
                      <input
                        ref={(el) => fieldRefs.current.city = el}
                        type="text"
                        value={formData.city || ''}
                        onChange={(e) => {
                          setFormData({ ...formData, city: e.target.value })
                          if (fieldErrors.city) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.city
                              return next
                            })
                          }
                        }}
                        className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.city ? 'border-red-500' : ''}`}
                      />
                      {fieldErrors.city && (
                        <p className="mt-1 text-sm text-red-600">{fieldErrors.city}</p>
                      )}
                    </div>
                  </div>
                </>
              )}
            </div>

            {/* Business/Creator Metrics Section */}
            {role === 'creator' && (
              <div className="border-b pb-6">
                <h2 className="text-xl font-semibold mb-4">Thông tin Creator</h2>

                <div className="mb-4">
                  <label className="block text-sm font-medium text-[#374151] mb-2">
                    Nền tảng *
                  </label>
                  <div className="flex flex-wrap gap-2">
                    {['TikTok', 'Instagram', 'YouTube', 'Facebook', 'Twitter', 'LinkedIn'].map((platform) => (
                      <button
                        key={platform}
                        type="button"
                        onClick={() => {
                          const current = formData.creator_platforms || []
                          const updated = current.includes(platform)
                            ? current.filter((p) => p !== platform)
                            : [...current, platform]
                          setFormData({ ...formData, creator_platforms: updated })
                          if (fieldErrors.creator_platforms && updated.length > 0) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.creator_platforms
                              return next
                            })
                          }
                        }}
                        className={`px-4 py-2.5 rounded-lg border text-sm font-medium transition-colors h-10 ${
                          formData.creator_platforms?.includes(platform)
                            ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                            : 'border-gray-300 hover:border-gray-400 text-gray-700'
                        }`}
                      >
                        {platform}
                      </button>
                    ))}
                  </div>
                  {fieldErrors.creator_platforms && (
                    <p className="mt-1 text-sm text-red-600">{fieldErrors.creator_platforms}</p>
                  )}
                </div>
                <div className="grid grid-cols-2 gap-4 mb-4">
                  <div>
                    <label className="block text-sm font-medium text-[#374151] mb-2">
                      Số lượng người theo dõi *
                    </label>
                    <input
                      ref={(el) => fieldRefs.current.followers_count = el}
                      type="number"
                      min="0"
                      value={formData.followers_count || ''}
                      onChange={(e) => {
                        setFormData({ ...formData, followers_count: e.target.value ? parseInt(e.target.value) : undefined })
                        if (fieldErrors.followers_count) {
                          setFieldErrors(prev => {
                            const next = { ...prev }
                            delete next.followers_count
                            return next
                          })
                        }
                      }}
                      className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.followers_count ? 'border-red-500' : ''}`}
                    />
                    {fieldErrors.followers_count && (
                      <p className="mt-1 text-sm text-red-600">{fieldErrors.followers_count}</p>
                    )}
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-[#374151] mb-2">
                      Lượt xem trung bình *
                    </label>
                    <input
                      ref={(el) => fieldRefs.current.avg_views = el}
                      type="number"
                      min="0"
                      value={formData.avg_views || ''}
                      onChange={(e) => {
                        setFormData({ ...formData, avg_views: e.target.value ? parseInt(e.target.value) : undefined })
                        if (fieldErrors.avg_views) {
                          setFieldErrors(prev => {
                            const next = { ...prev }
                            delete next.avg_views
                            return next
                          })
                        }
                      }}
                      className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.avg_views ? 'border-red-500' : ''}`}
                    />
                    {fieldErrors.avg_views && (
                      <p className="mt-1 text-sm text-red-600">{fieldErrors.avg_views}</p>
                    )}
                  </div>
                </div>
                <div className="mb-4">
                  <label className="block text-sm font-medium text-[#374151] mb-2">
                    Danh mục nội dung *
                  </label>
                  <div className="flex flex-wrap gap-2">
                    {['Beauty', 'Fashion', 'Food', 'Travel', 'Tech', 'Fitness', 'Lifestyle', 'Education'].map((category) => (
                      <button
                        key={category}
                        type="button"
                        onClick={() => {
                          const current = formData.content_categories || []
                          const updated = current.includes(category)
                            ? current.filter((c) => c !== category)
                            : [...current, category]
                          setFormData({ ...formData, content_categories: updated })
                          if (fieldErrors.content_categories && updated.length > 0) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.content_categories
                              return next
                            })
                          }
                        }}
                        className={`px-4 py-2.5 rounded-lg border text-sm font-medium transition-colors h-10 ${
                          formData.content_categories?.includes(category)
                            ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                            : 'border-gray-300 hover:border-gray-400 text-gray-700'
                        }`}
                      >
                        {category}
                      </button>
                    ))}
                  </div>
                  {fieldErrors.content_categories && (
                    <p className="mt-1 text-sm text-red-600">{fieldErrors.content_categories}</p>
                  )}
                </div>
              </div>
            )}

            {/* Brand Info Section */}
            {role === 'brand' && (
              <div className="border-b pb-6">
                <h2 className="text-xl font-semibold mb-4">Thông tin Brand</h2>

                <div className="mb-4">
                  <label className="block text-sm font-medium text-[#374151] mb-2">
                    Quy mô công ty *
                  </label>
                  <select
                    ref={(el) => fieldRefs.current.company_size = el}
                    value={formData.company_size || ''}
                    onChange={(e) => {
                      setFormData({ ...formData, company_size: e.target.value })
                      if (fieldErrors.company_size) {
                        setFieldErrors(prev => {
                          const next = { ...prev }
                          delete next.company_size
                          return next
                        })
                      }
                    }}
                    className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.company_size ? 'border-red-500' : ''}`}
                  >
                    <option value="">Chọn quy mô</option>
                    <option value="startup">Startup (1-10 nhân viên)</option>
                    <option value="small">Nhỏ (11-50 nhân viên)</option>
                    <option value="medium">Vừa (51-200 nhân viên)</option>
                    <option value="large">Lớn (201-1000 nhân viên)</option>
                    <option value="enterprise">Doanh nghiệp (1000+ nhân viên)</option>
                  </select>
                  {fieldErrors.company_size && (
                    <p className="mt-1 text-sm text-red-600">{fieldErrors.company_size}</p>
                  )}
                </div>
                <div className="mb-4">
                  <div>
                    <label className="block text-sm font-medium text-[#374151] mb-2">
                      Ngân sách marketing hàng tháng *
                    </label>
                    <input
                      ref={(el) => fieldRefs.current.monthly_marketing_budget = el}
                      type="number"
                      min="0"
                      step="0.01"
                      value={formData.monthly_marketing_budget || ''}
                      onChange={(e) => {
                        setFormData({ ...formData, monthly_marketing_budget: e.target.value ? parseFloat(e.target.value) : undefined })
                        if (fieldErrors.monthly_marketing_budget) {
                          setFieldErrors(prev => {
                            const next = { ...prev }
                            delete next.monthly_marketing_budget
                            return next
                          })
                        }
                      }}
                      className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.monthly_marketing_budget ? 'border-red-500' : ''}`}
                      placeholder="Ví dụ: 5000"
                    />
                    {fieldErrors.monthly_marketing_budget && (
                      <p className="mt-1 text-sm text-red-600">{fieldErrors.monthly_marketing_budget}</p>
                    )}
                  </div>
                </div>
                <div className="mb-4">
                  <label className="block text-sm font-medium text-[#374151] mb-2">
                    Nền tảng mục tiêu *
                  </label>
                  <div className="flex flex-wrap gap-2">
                    {['TikTok', 'Instagram', 'YouTube', 'Facebook', 'Twitter', 'LinkedIn'].map((platform) => (
                      <button
                        key={platform}
                        type="button"
                        onClick={() => {
                          const current = formData.target_platforms || []
                          const updated = current.includes(platform)
                            ? current.filter((p) => p !== platform)
                            : [...current, platform]
                          setFormData({ ...formData, target_platforms: updated })
                          if (fieldErrors.target_platforms && updated.length > 0) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.target_platforms
                              return next
                            })
                          }
                        }}
                        className={`px-4 py-2.5 rounded-lg border text-sm font-medium transition-colors h-10 ${
                          formData.target_platforms?.includes(platform)
                            ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                            : 'border-gray-300 hover:border-gray-400 text-gray-700'
                        }`}
                      >
                        {platform}
                      </button>
                    ))}
                  </div>
                  {fieldErrors.target_platforms && (
                    <p className="mt-1 text-sm text-red-600">{fieldErrors.target_platforms}</p>
                  )}
                </div>
              </div>
            )}

            {/* Collaboration Intent Section */}
            <div className="pb-6">
              <h2 className="text-xl font-semibold mb-4">Mục tiêu hợp tác</h2>
              {role === 'creator' ? (
                <div>
                  <label className="block text-sm font-medium text-[#374151] mb-2">
                    Kỳ vọng hợp tác *
                  </label>
                  <div className="grid grid-cols-3 gap-2">
                    {['paid', 'gift', 'affiliate'].map((type) => (
                      <button
                        key={type}
                        type="button"
                        onClick={() => {
                          const current = formData.collaboration_expectation || []
                          const updated = current.includes(type)
                            ? current.filter((t) => t !== type)
                            : [...current, type]
                          setFormData({ ...formData, collaboration_expectation: updated })
                          if (fieldErrors.collaboration_expectation && updated.length > 0) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.collaboration_expectation
                              return next
                            })
                          }
                        }}
                        className={`px-4 py-2.5 rounded-lg border text-sm font-medium transition-colors h-10 ${
                          formData.collaboration_expectation?.includes(type)
                            ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                            : 'border-gray-300 hover:border-gray-400 text-gray-700'
                        }`}
                      >
                        {type === 'paid' ? 'Trả phí' : type === 'gift' ? 'Quà tặng' : 'Affiliate'}
                      </button>
                    ))}
                  </div>
                  {fieldErrors.collaboration_expectation && (
                    <p className="mt-1 text-sm text-red-600">{fieldErrors.collaboration_expectation}</p>
                  )}
                </div>
              ) : (
                <div>
                  <label className="block text-sm font-medium text-[#374151] mb-2">
                    Mục tiêu hợp tác *
                  </label>
                  <div className="grid grid-cols-2 gap-2">
                    {['brand_awareness', 'sales', 'engagement', 'lead_generation', 'product_launch', 'community_building'].map((goal) => (
                      <button
                        key={goal}
                        type="button"
                        onClick={() => {
                          const current = formData.collaboration_goals || []
                          const updated = current.includes(goal)
                            ? current.filter((g) => g !== goal)
                            : [...current, goal]
                          setFormData({ ...formData, collaboration_goals: updated })
                          if (fieldErrors.collaboration_goals && updated.length > 0) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.collaboration_goals
                              return next
                            })
                          }
                        }}
                        className={`px-4 py-2.5 rounded-lg border text-sm font-medium transition-colors h-10 ${
                          formData.collaboration_goals?.includes(goal)
                            ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                            : 'border-gray-300 hover:border-gray-400 text-gray-700'
                        }`}
                      >
                        {goal === 'brand_awareness' ? 'Nhận diện thương hiệu' :
                         goal === 'sales' ? 'Bán hàng' :
                         goal === 'engagement' ? 'Tương tác' :
                         goal === 'lead_generation' ? 'Tạo lead' :
                         goal === 'product_launch' ? 'Ra mắt sản phẩm' :
                         'Xây dựng cộng đồng'}
                      </button>
                    ))}
                  </div>
                  {fieldErrors.collaboration_goals && (
                    <p className="mt-1 text-sm text-red-600">{fieldErrors.collaboration_goals}</p>
                  )}
                </div>
              )}
            </div>

            {/* Email (read-only) */}
            <div className="border-t pt-6">
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Email
              </label>
              <input
                type="email"
                value={session?.user?.email || ''}
                disabled
                className="w-full px-4 py-2.5 border rounded-lg bg-gray-50 text-gray-500"
              />
            </div>

            <button
              type="submit"
              disabled={loading}
              className="w-full px-6 py-2.5 rounded-xl font-medium text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] disabled:opacity-50"
            >
              {loading ? 'Đang lưu...' : 'Lưu thay đổi'}
            </button>
          </form>
        </div>
      </div>

      {/* Toast Notification */}
      {toast && (
        <Toast
          message={toast.message}
          type={toast.type}
          onClose={() => setToast(null)}
        />
      )}
    </div>
  )
}
</file>

<file path="src/pages/public/SignupPage.tsx">
import { useState } from 'react'
import { Link } from 'react-router-dom'
import { getSupabase } from '../../lib/supabase'

export default function SignupPage() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [confirmPassword, setConfirmPassword] = useState('')
  const [error, setError] = useState('')
  const [loading, setLoading] = useState(false)
  const [success, setSuccess] = useState(false)
  const supabase = getSupabase()

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')

    if (password !== confirmPassword) {
      setError('Mật khẩu xác nhận không khớp')
      return
    }

    if (password.length < 6) {
      setError('Mật khẩu phải có ít nhất 6 ký tự')
      return
    }

    setLoading(true)

    try {
      const { data, error } = await supabase.auth.signUp({
        email,
        password,
        options: {
          emailRedirectTo: `${window.location.origin}/verify-email`,
        },
      })
      
      if (error) {
        setError(error.message || 'Đăng ký thất bại')
        setLoading(false)
        return
      }
      
      setSuccess(true)
      setLoading(false)

    } catch (err) {
      setError('Có lỗi xảy ra')
      setLoading(false)
    }
  }

  const handleGoogleSignup = async () => {
    const { data, error } = await supabase.auth.signInWithOAuth({
      provider: 'google',
      options: {
        redirectTo: `${window.location.origin}/app`,
      },
    })

    if (error) {
      setError(error.message)
      return
    }

    if (data.url) {
      window.location.href = data.url
    }
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-[#F9FAFB] px-6 pt-16">
      <div className="w-full max-w-6xl bg-white rounded-3xl shadow-xl overflow-hidden flex">
        <div className="hidden lg:flex w-[45%] bg-gradient-to-br from-[#6366F1]/20 via-[#7C3AED]/15 to-[#EC4899]/20">
          <div className="flex flex-col px-12 pt-12 items-center">
            <img
              src="/logo/logo.png"
              alt="ALINO"
              className="w-40 h-40 mb-6"
            />
            <h1 className="text-3xl font-semibold text-[#1F2937] mb-3">
              Tạo tài khoản mới
            </h1>
            <p className="text-[#6B7280] leading-relaxed">
              Bắt đầu hành trình hợp tác với Alino
            </p>
          </div>
        </div>

        <div className="w-full lg:w-[55%] px-10 py-8 flex items-center justify-center">
          <div className="w-full max-w-sm">
            <h2 className="text-2xl font-semibold mb-2">Đăng ký</h2>
            <p className="text-sm text-[#6B7280] mb-6">
              Tạo tài khoản mới để bắt đầu
            </p>

            {error && (
              <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm">
                {error}
              </div>
            )}

            <div className="relative">
              <div className={`transition-opacity duration-200 ${success ? 'opacity-0 invisible' : 'opacity-100 visible'}`}>
                <form onSubmit={handleSubmit} className="space-y-4">
                  <input
                    type="email"
                    placeholder="Email"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    className="w-full px-3 py-2.5 border rounded-lg"
                    required
                  />

                  <input
                    type="password"
                    placeholder="Mật khẩu"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    className="w-full px-3 py-2.5 border rounded-lg"
                    required
                  />

                  <input
                    type="password"
                    placeholder="Xác nhận mật khẩu"
                    value={confirmPassword}
                    onChange={(e) => setConfirmPassword(e.target.value)}
                    className="w-full px-3 py-2.5 border rounded-lg"
                    required
                  />

                  <button
                    type="submit"
                    disabled={loading}
                    className="w-full py-2.5 rounded-lg text-white font-medium bg-gradient-to-r from-[#6366F1] to-[#EC4899] disabled:opacity-50"
                  >
                    {loading ? 'Đang tạo tài khoản...' : 'Đăng ký'}
                  </button>
                </form>

                <div className="my-5 text-center text-xs text-[#9CA3AF]">HOẶC</div>

                <button
                  onClick={handleGoogleSignup}
                  className="w-full py-2.5 border rounded-lg text-sm hover:bg-gray-50 flex items-center justify-center gap-3"
                >
                  <svg className="w-5 h-5" viewBox="0 0 24 24">
                    <path
                      fill="#4285F4"
                      d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                    />
                    <path
                      fill="#34A853"
                      d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                    />
                    <path
                      fill="#FBBC05"
                      d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                    />
                    <path
                      fill="#EA4335"
                      d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                    />
                  </svg>
                  Đăng ký với Google
                </button>
              </div>

              <div className={`absolute inset-0 flex items-center transition-opacity duration-200 ${success ? 'opacity-100 visible' : 'opacity-0 invisible'}`}>
                <div className="w-full p-4 bg-green-50 border border-green-200 rounded-lg text-green-700 text-sm">
                  <p className="font-medium mb-1">Tài khoản đã được tạo thành công.</p>
                  <p>Vui lòng kiểm tra email để xác thực tài khoản.</p>
                </div>
              </div>
            </div>

            <p className="mt-6 text-center text-sm text-[#6B7280]">
              {success ? (
                <Link to="/login" className="text-[#6366F1] font-medium">
                  Đăng nhập
                </Link>
              ) : (
                <>
                  Đã có tài khoản?{' '}
                  <Link to="/login" className="text-[#6366F1] font-medium">
                    Đăng nhập
                  </Link>
                </>
              )}
            </p>
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/onboarding/OnboardingPage.tsx">
import { useState, useEffect } from 'react'
import { useNavigate, Link, useParams } from 'react-router-dom'
import { useAuth } from '../../hooks/useAuth'
import { getSupabase } from '../../lib/supabase'

// Form state interfaces
interface CreatorFormData {
  display_name?: string
  country?: string
  city?: string
  birth_year?: number
  gender?: string
  creator_platforms?: string[]
  followers_count?: number
  avg_views?: number
  content_categories?: string[]
  collaboration_expectation?: ('paid' | 'gift' | 'affiliate')[]
}

interface BrandFormData {
  company_name?: string
  industry?: string
  country?: string
  city?: string
  company_size?: string
  budget?: number
  campaign_budget_range?: string
  target_platforms?: string[]
  campaign_goal?: string
  preferred_collaboration_type?: ('paid' | 'gift' | 'affiliate')[]
}

export default function OnboardingPage() {
  const { session, loading: authLoading } = useAuth()
  const navigate = useNavigate()
  const { role: roleParam } = useParams<{ role?: 'creator' | 'brand' }>()
  const supabase = getSupabase()
  const [currentStep, setCurrentStep] = useState(1)
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState('')
  const [role, setRole] = useState<'creator' | 'brand' | null>(roleParam || null)
  
  // Form state - separate for creator and brand
  const [creatorData, setCreatorData] = useState<CreatorFormData>({})
  const [brandData, setBrandData] = useState<BrandFormData>({})

  useEffect(() => {
    if (authLoading) return
    if (!session) return
    checkOnboardingStatus()
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [session, authLoading])

  async function checkOnboardingStatus() {
    if (!session || !session.access_token) return

    try {
      const { data, error } = await supabase
        .from('profiles')
        .select('onboarding_completed, role, onboarding_data')
        .eq('id', session.user.id)
        .single()

      if (error) {
        if (error.code === '42501' || error.code === 'PGRST301') {
          return
        }
        if (error.code !== 'PGRST116') throw error
      }

      if (data?.role) {
        setRole(data.role)
        loadExistingData(data.role, data?.onboarding_data)
      }
    } catch (err) {
      console.error('Error checking onboarding:', err)
    }
  }

  async function loadExistingData(userRole: 'creator' | 'brand', onboardingData: any) {
    if (!session) return

    try {
      // Read from onboarding_data JSON, not profile columns
      const data = onboardingData || {}

      if (userRole === 'creator') {
        const step2 = data.step2 || {}
        const step3 = data.step3 || {}
        const step4 = data.step4 || {}
        
        const cd: CreatorFormData = {
          display_name: step2.display_name || undefined,
          country: step2.country || undefined,
          city: step2.city || undefined,
          birth_year: step2.birth_year || undefined,
          gender: step2.gender || undefined,
          creator_platforms: step3.creator_platforms || undefined,
          followers_count: step3.followers_count || undefined,
          avg_views: step3.avg_views || undefined,
          content_categories: step3.content_categories || undefined,
          collaboration_expectation: step4.collaboration_expectation || undefined,
        }
        setCreatorData(cd)

        // Determine current step based on onboarding_data
        if (!step2.display_name) {
          setCurrentStep(2)
        } else if (!step3.creator_platforms || step3.creator_platforms.length === 0) {
          setCurrentStep(3)
        } else if (!step4.collaboration_expectation || step4.collaboration_expectation.length === 0) {
          setCurrentStep(4)
        } else {
          setCurrentStep(5)
        }
      } else {
        const step2 = data.step2 || {}
        const step3 = data.step3 || {}
        const step4 = data.step4 || {}
        
        const bd: BrandFormData = {
          company_name: step2.company_name || undefined,
          industry: step2.industry || undefined,
          country: step2.country || undefined,
          city: step2.city || undefined,
          company_size: step3.company_size || undefined,
          budget: step3.budget || undefined,
          campaign_budget_range: step3.campaign_budget_range || undefined,
          target_platforms: step3.target_platforms || undefined,
          campaign_goal: step4.campaign_goal || undefined,
          preferred_collaboration_type: step4.preferred_collaboration_type || undefined,
        }
        setBrandData(bd)

        // Determine current step based on onboarding_data
        if (!step2.company_name) {
          setCurrentStep(2)
        } else if (!step3.company_size) {
          setCurrentStep(3)
        } else if (!step4.campaign_goal) {
          setCurrentStep(4)
        } else {
          setCurrentStep(5)
        }
      }
    } catch (err) {
      console.error('Error loading existing data:', err)
    }
  }

  // Helper to merge onboarding_data JSON
  async function mergeOnboardingData(stepKey: string, stepData: any) {
    if (!session || !session.access_token) return null

    // Fetch current onboarding_data
    const { data: profile, error: fetchError } = await supabase
      .from('profiles')
      .select('onboarding_data')
      .eq('id', session.user.id)
      .single()

    if (fetchError) {
      if (fetchError.code === '42501' || fetchError.code === 'PGRST301') {
        return null
      }
      throw fetchError
    }

    // Merge new step data into existing onboarding_data
    const currentData = profile?.onboarding_data || {}
    const mergedData = {
      ...currentData,
      [stepKey]: stepData,
    }

    // Update only onboarding_data column
    const { error: updateError } = await supabase
      .from('profiles')
      .update({
        onboarding_data: mergedData,
        updated_at: new Date().toISOString(),
      })
      .eq('id', session.user.id)

    if (updateError) {
      if (updateError.code === '42501' || updateError.code === 'PGRST301') {
        return null
      }
      throw updateError
    }

    return mergedData
  }

  async function saveStep(stepData: CreatorFormData | BrandFormData, nextStep?: number) {
    if (!session || !role) return

    setLoading(true)
    setError('')

    try {
      // Determine step key based on current step
      const stepKey = `step${currentStep}`

      // Update local state
      if (role === 'creator') {
        const cd = { ...creatorData, ...stepData } as CreatorFormData
        setCreatorData(cd)
      } else {
        const bd = { ...brandData, ...stepData } as BrandFormData
        setBrandData(bd)
      }

      // Save to onboarding_data JSON (merge)
      await mergeOnboardingData(stepKey, stepData)

      if (nextStep) {
        setCurrentStep(nextStep)
      }
    } catch (err: any) {
      setError(err.message || 'Có lỗi xảy ra khi lưu dữ liệu')
    } finally {
      setLoading(false)
    }
  }

  async function handleComplete() {
    if (!session || !session.access_token || !role) {
      setError('Phiên đăng nhập không hợp lệ. Vui lòng đăng nhập lại.')
      return
    }

    setLoading(true)
    setError('')

    try {
      const { data: profile, error: fetchError } = await supabase
        .from('profiles')
        .select('onboarding_data')
        .eq('id', session.user.id)
        .single()

      if (fetchError) {
        if (fetchError.code === '42501' || fetchError.code === 'PGRST301') {
          setError('Không thể truy cập dữ liệu. Vui lòng thử lại.')
          setLoading(false)
          return
        }
        throw fetchError
      }

      const onboardingData = profile?.onboarding_data || {}

      // Validate required fields before completing
      if (role === 'creator') {
        const step2 = onboardingData.step2 || {}
        const step3 = onboardingData.step3 || {}
        const step4 = onboardingData.step4 || {}
        
        if (!step2.display_name?.trim() || !step2.birth_year || !step2.gender || !step2.country?.trim() || !step2.city?.trim()) {
          setError('Vui lòng điền đầy đủ thông tin cơ bản (tên, năm sinh, giới tính, quốc gia, thành phố)')
          setLoading(false)
          return
        }
        if (!step3.creator_platforms || step3.creator_platforms.length === 0) {
          setError('Vui lòng chọn ít nhất một nền tảng')
          setLoading(false)
          return
        }
        if (!step3.content_categories || step3.content_categories.length === 0) {
          setError('Vui lòng chọn ít nhất một danh mục nội dung')
          setLoading(false)
          return
        }
        if (!step4.collaboration_expectation || step4.collaboration_expectation.length === 0) {
          setError('Vui lòng chọn ít nhất một loại hợp tác')
          setLoading(false)
          return
        }
      } else {
        const step2 = onboardingData.step2 || {}
        const step3 = onboardingData.step3 || {}
        const step4 = onboardingData.step4 || {}
        
        if (!step2.company_name?.trim() || !step2.industry?.trim() || !step2.country?.trim() || !step2.city?.trim()) {
          setError('Vui lòng điền đầy đủ thông tin cơ bản (tên công ty, ngành nghề, quốc gia, thành phố)')
          setLoading(false)
          return
        }
        if (!step3.company_size) {
          setError('Vui lòng chọn quy mô công ty')
          setLoading(false)
          return
        }
        if (!step3.target_platforms || step3.target_platforms.length === 0) {
          setError('Vui lòng chọn ít nhất một nền tảng mục tiêu')
          setLoading(false)
          return
        }
        if (!step4.campaign_goal?.trim()) {
          setError('Vui lòng nhập mục tiêu chiến dịch')
          setLoading(false)
          return
        }
        if (!step4.preferred_collaboration_type || step4.preferred_collaboration_type.length === 0) {
          setError('Vui lòng chọn ít nhất một loại hợp tác')
          setLoading(false)
          return
        }
      }

      // Step 1: Create or update domain-specific profile FIRST
      if (role === 'creator') {
        const step2 = onboardingData.step2 || {}
        const step3 = onboardingData.step3 || {}
        const step4 = onboardingData.step4 || {}

        const creatorProfileData: any = {
          user_id: session.user.id,
          full_name: step2.display_name || null,
          birth_year: step2.birth_year || null,
          gender: step2.gender || null,
          country: step2.country || null,
          city: step2.city || null,
          creator_platforms: step3.creator_platforms || null,
          followers_count: step3.followers_count || null,
          avg_views: step3.avg_views || null,
          content_categories: step3.content_categories || null,
          collaboration_expectation: step4.collaboration_expectation || null,
          created_at: new Date().toISOString(),
          updated_at: new Date().toISOString(),
        }

        // Insert creator profile (if already exists, ignore duplicate)
        const { error: creatorError } = await supabase
          .from('creator_profiles')
          .insert(creatorProfileData)

        // Ignore duplicate key error (if profile already exists)
        if (creatorError && creatorError.code !== '23505') {
          throw creatorError
        }
      } else {
        const step2 = onboardingData.step2 || {}
        const step3 = onboardingData.step3 || {}
        const step4 = onboardingData.step4 || {}

        const brandProfileData: any = {
          user_id: session.user.id,
          brand_name: step2.company_name || null,
          industry: step2.industry || null,
          company_size: step3.company_size || null,
          monthly_marketing_budget: (() => {
            const budgetValue = step3.budget || step3.campaign_budget_range
            return budgetValue ? (typeof budgetValue === 'string' ? parseFloat(budgetValue.replace(/[^0-9.]/g, '')) || null : Number(budgetValue)) : null
          })(),
          target_platforms: step3.target_platforms || null,
          collaboration_goals: (() => {
            const goalValue = step4.campaign_goal || step4.collaboration_goal
            return Array.isArray(goalValue) ? goalValue : (goalValue ? [goalValue] : null)
          })(),
          created_at: new Date().toISOString(),
          updated_at: new Date().toISOString(),
        }

        // Insert brand profile (if already exists, do nothing)
        const { error: brandError } = await supabase
          .from('brand_profiles')
          .insert(brandProfileData)

        // Ignore duplicate key error (if profile already exists)
        if (brandError && brandError.code !== '23505') {
          throw brandError
        }
      }

      // Step 2: Update profiles.onboarding_completed and clear onboarding_data
      const { error: profileError } = await supabase
        .from('profiles')
        .update({
          onboarding_completed: true,
          onboarding_data: null,
          updated_at: new Date().toISOString(),
        })
        .eq('id', session.user.id)

      if (profileError) throw profileError

      // Insert consent record
      const { error: consentError } = await supabase
        .from('user_consents')
        .insert({
          user_id: session.user.id,
          policy_version: 'v1.0',
          accepted_via: 'onboarding',
          accepted_at: new Date().toISOString(),
        })

      if (consentError) {
        console.error('Error inserting consent:', consentError)
        // Don't block onboarding if consent insert fails
      }

      // Redirect directly to dashboard based on role (bypass /app to prevent loops)
      const dashboardPath = role === 'creator' ? '/dashboard/creator' : '/dashboard/brand'
      navigate(dashboardPath, { replace: true })
    } catch (err: any) {
      setError(err.message || 'Có lỗi xảy ra khi hoàn tất onboarding')
      setLoading(false)
    }
  }

  // Show loading while checking auth or fetching role
  if (authLoading || !session) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-[#6B7280]">Đang tải...</div>
      </div>
    )
  }

  if (!role) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-[#6B7280]">Đang tải thông tin...</div>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-[#EEF1FF] via-[#F5F7FF] to-white py-20 px-6 pt-24">
      <div className="max-w-3xl mx-auto">
        <div className="bg-white/90 backdrop-blur-xl rounded-3xl p-8 md:p-10 shadow-xl border border-black/5">
          {/* Progress indicator */}
          <div className="mb-8">
            <div className="flex items-center justify-between mb-2">
              <span className="text-sm text-[#6B7280]">
                Bước {currentStep} / 5
              </span>
              <span className="text-sm text-[#6B7280]">
                {Math.round((currentStep / 5) * 100)}%
              </span>
            </div>
            <div className="w-full bg-gray-200 rounded-full h-2">
              <div
                className="bg-gradient-to-r from-[#6366F1] to-[#EC4899] h-2 rounded-full transition-all"
                style={{ width: `${(currentStep / 5) * 100}%` }}
              />
            </div>
          </div>

          {error && (
            <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm">
              {error}
            </div>
          )}

          {/* Step 2: Basic Identity */}
          {currentStep === 2 && (
            <Step2BasicIdentity
              role={role}
              creatorData={creatorData}
              brandData={brandData}
              onSave={(data) => saveStep(data, 3)}
              loading={loading}
            />
          )}

          {/* Step 3: Business/Creator Metrics */}
          {currentStep === 3 && (
            <Step3Metrics
              role={role}
              creatorData={creatorData}
              brandData={brandData}
              onSave={(data) => saveStep(data, 4)}
              loading={loading}
            />
          )}

          {/* Step 4: Collaboration Intent */}
          {currentStep === 4 && (
            <Step4Collaboration
              role={role}
              creatorData={creatorData}
              brandData={brandData}
              onSave={(data) => saveStep(data, 5)}
              loading={loading}
            />
          )}

          {/* Step 5: Finalize */}
          {currentStep === 5 && (
            <Step5Finalize
              role={role}
              creatorData={creatorData}
              brandData={brandData}
              onComplete={handleComplete}
              loading={loading}
            />
          )}

          {/* Navigation buttons */}
          {currentStep > 2 && (
            <div className="mt-6 flex justify-between">
              <button
                onClick={() => setCurrentStep(currentStep - 1)}
                disabled={loading}
                className="px-6 py-2.5 rounded-xl font-medium text-[#6B7280] border border-gray-300 hover:bg-gray-50 disabled:opacity-50"
              >
                Quay lại
              </button>
            </div>
          )}
        </div>
      </div>
    </div>
  )
}

// Step 2: Basic Identity
function Step2BasicIdentity({
  role,
  creatorData,
  brandData,
  onSave,
  loading,
}: {
  role: 'creator' | 'brand'
  creatorData: CreatorFormData
  brandData: BrandFormData
  onSave: (data: CreatorFormData | BrandFormData) => void
  loading: boolean
}) {
  const [localData, setLocalData] = useState(
    role === 'creator'
      ? {
          display_name: creatorData.display_name || '',
          country: creatorData.country || '',
          city: creatorData.city || '',
          birth_year: creatorData.birth_year || undefined,
          gender: creatorData.gender || '',
        }
      : {
          company_name: brandData.company_name || '',
          industry: brandData.industry || '',
          country: brandData.country || '',
          city: brandData.city || '',
        }
  )
  const [errors, setErrors] = useState<Record<string, string>>({})

  const validateStep2 = () => {
    const newErrors: Record<string, string> = {}
    if (role === 'creator') {
      if (!localData.display_name?.trim()) newErrors.display_name = 'Vui lòng nhập tên hiển thị'
      if (!localData.birth_year) newErrors.birth_year = 'Vui lòng nhập năm sinh'
      if (!localData.gender) newErrors.gender = 'Vui lòng chọn giới tính'
      if (!localData.country?.trim()) newErrors.country = 'Vui lòng nhập quốc gia'
      if (!localData.city?.trim()) newErrors.city = 'Vui lòng nhập thành phố'
    } else {
      if (!localData.company_name?.trim()) newErrors.company_name = 'Vui lòng nhập tên công ty'
      if (!localData.industry?.trim()) newErrors.industry = 'Vui lòng nhập ngành nghề'
      if (!localData.country?.trim()) newErrors.country = 'Vui lòng nhập quốc gia'
      if (!localData.city?.trim()) newErrors.city = 'Vui lòng nhập thành phố'
    }
    setErrors(newErrors)
    return Object.keys(newErrors).length === 0
  }

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault()
    if (!validateStep2()) return
    
    if (role === 'creator') {
      onSave({
        display_name: localData.display_name,
        country: localData.country,
        city: localData.city,
        birth_year: localData.birth_year,
        gender: localData.gender,
      } as CreatorFormData)
    } else {
      onSave({
        company_name: localData.company_name,
        industry: localData.industry,
        country: localData.country,
        city: localData.city,
      } as BrandFormData)
    }
  }

  return (
    <form onSubmit={handleSubmit}>
      <h1 className="text-3xl font-semibold tracking-tight mb-4">
        Thông tin cơ bản
      </h1>
      <p className="text-[#6B7280] mb-8">
        {role === 'creator' ? 'Hãy cho chúng tôi biết về bạn' : 'Hãy cho chúng tôi biết về thương hiệu của bạn'}
      </p>

      <div className="space-y-4">
        {role === 'creator' ? (
          <>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Tên hiển thị *
              </label>
              <input
                type="text"
                value={localData.display_name}
                onChange={(e) => {
                  setLocalData({ ...localData, display_name: e.target.value } as any)
                  if (errors.display_name) {
                    setErrors({ ...errors, display_name: '' })
                  }
                }}
                className={`w-full px-4 py-2.5 border rounded-lg ${errors.display_name ? 'border-red-500' : ''}`}
                required
              />
              {errors.display_name && (
                <p className="mt-1 text-sm text-red-600">{errors.display_name}</p>
              )}
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Năm sinh *
              </label>
              <input
                type="number"
                min="1950"
                max={new Date().getFullYear()}
                value={localData.birth_year || ''}
                onChange={(e) => {
                  setLocalData({ ...localData, birth_year: e.target.value ? parseInt(e.target.value) : undefined } as any)
                  if (errors.birth_year) {
                    setErrors({ ...errors, birth_year: '' })
                  }
                }}
                className={`w-full px-4 py-2.5 border rounded-lg ${errors.birth_year ? 'border-red-500' : ''}`}
                required
              />
              {errors.birth_year && (
                <p className="mt-1 text-sm text-red-600">{errors.birth_year}</p>
              )}
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Giới tính *
              </label>
              <select
                value={localData.gender}
                onChange={(e) => {
                  setLocalData({ ...localData, gender: e.target.value } as any)
                  if (errors.gender) {
                    setErrors({ ...errors, gender: '' })
                  }
                }}
                className={`w-full px-4 py-2.5 border rounded-lg ${errors.gender ? 'border-red-500' : ''}`}
                required
              >
                <option value="">Chọn giới tính</option>
                <option value="male">Nam</option>
                <option value="female">Nữ</option>
                <option value="other">Khác</option>
              </select>
              {errors.gender && (
                <p className="mt-1 text-sm text-red-600">{errors.gender}</p>
              )}
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Quốc gia *
              </label>
              <input
                type="text"
                value={localData.country}
                onChange={(e) => {
                  setLocalData({ ...localData, country: e.target.value })
                  if (errors.country) {
                    setErrors({ ...errors, country: '' })
                  }
                }}
                className={`w-full px-4 py-2.5 border rounded-lg ${errors.country ? 'border-red-500' : ''}`}
                required
              />
              {errors.country && (
                <p className="mt-1 text-sm text-red-600">{errors.country}</p>
              )}
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Thành phố *
              </label>
              <input
                type="text"
                value={localData.city}
                onChange={(e) => {
                  setLocalData({ ...localData, city: e.target.value })
                  if (errors.city) {
                    setErrors({ ...errors, city: '' })
                  }
                }}
                className={`w-full px-4 py-2.5 border rounded-lg ${errors.city ? 'border-red-500' : ''}`}
                required
              />
              {errors.city && (
                <p className="mt-1 text-sm text-red-600">{errors.city}</p>
              )}
            </div>
          </>
        ) : (
          <>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Tên công ty *
              </label>
              <input
                type="text"
                value={localData.company_name}
                onChange={(e) => setLocalData({ ...localData, company_name: e.target.value } as any)}
                className="w-full px-4 py-2.5 border rounded-lg"
                required
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Ngành nghề *
              </label>
              <input
                type="text"
                value={localData.industry}
                onChange={(e) => setLocalData({ ...localData, industry: e.target.value } as any)}
                className="w-full px-4 py-2.5 border rounded-lg"
                required
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Quốc gia *
              </label>
              <input
                type="text"
                value={localData.country}
                onChange={(e) => setLocalData({ ...localData, country: e.target.value })}
                className="w-full px-4 py-2.5 border rounded-lg"
                required
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Thành phố *
              </label>
              <input
                type="text"
                value={localData.city}
                onChange={(e) => setLocalData({ ...localData, city: e.target.value })}
                className="w-full px-4 py-2.5 border rounded-lg"
                required
              />
            </div>
          </>
        )}

        <button
          type="submit"
          disabled={loading}
          className="w-full px-6 py-2.5 rounded-xl font-medium text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] disabled:opacity-50"
        >
          {loading ? 'Đang lưu...' : 'Tiếp tục'}
        </button>
      </div>
    </form>
  )
}

// Step 3: Business/Creator Metrics
function Step3Metrics({
  role,
  creatorData,
  brandData,
  onSave,
  loading,
}: {
  role: 'creator' | 'brand'
  creatorData: CreatorFormData
  brandData: BrandFormData
  onSave: (data: CreatorFormData | BrandFormData) => void
  loading: boolean
}) {
  const platforms = ['TikTok', 'Instagram', 'YouTube', 'Facebook', 'Twitter', 'LinkedIn']
  
  const [localData, setLocalData] = useState(
    role === 'creator'
      ? {
          creator_platforms: creatorData.creator_platforms || [],
          followers_count: creatorData.followers_count || undefined,
          avg_views: creatorData.avg_views || undefined,
          content_categories: creatorData.content_categories || [],
        }
      : {
          company_size: brandData.company_size || '',
          budget: brandData.budget || undefined,
          campaign_budget_range: brandData.campaign_budget_range || '',
          target_platforms: brandData.target_platforms || [],
        }
  )
  const [errors, setErrors] = useState<Record<string, string>>({})

  const validateStep3 = () => {
    const newErrors: Record<string, string> = {}
    if (role === 'creator') {
      if (!localData.creator_platforms || localData.creator_platforms.length === 0) {
        newErrors.creator_platforms = 'Vui lòng chọn ít nhất một nền tảng'
      }
      if (!localData.content_categories || localData.content_categories.length === 0) {
        newErrors.content_categories = 'Vui lòng chọn ít nhất một danh mục nội dung'
      }
    } else {
      if (!localData.company_size) {
        newErrors.company_size = 'Vui lòng chọn quy mô công ty'
      }
      if (!localData.target_platforms || localData.target_platforms.length === 0) {
        newErrors.target_platforms = 'Vui lòng chọn ít nhất một nền tảng mục tiêu'
      }
    }
    setErrors(newErrors)
    return Object.keys(newErrors).length === 0
  }

  const togglePlatform = (platform: string, type: 'creator' | 'target') => {
    if (type === 'creator') {
      const current = localData.creator_platforms || []
      const updated = current.includes(platform)
        ? current.filter((p) => p !== platform)
        : [...current, platform]
      setLocalData({ ...localData, creator_platforms: updated } as any)
    } else {
      const current = localData.target_platforms || []
      const updated = current.includes(platform)
        ? current.filter((p) => p !== platform)
        : [...current, platform]
      setLocalData({ ...localData, target_platforms: updated } as any)
    }
  }

  const toggleCategory = (category: string) => {
    const current = localData.content_categories || []
    const updated = current.includes(category)
      ? current.filter((c) => c !== category)
      : [...current, category]
      setLocalData({ ...localData, content_categories: updated } as any)
  }

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault()
    if (!validateStep3()) return
    
    if (role === 'creator') {
      onSave({
        creator_platforms: localData.creator_platforms,
        followers_count: localData.followers_count,
        avg_views: localData.avg_views,
        content_categories: localData.content_categories,
      } as CreatorFormData)
    } else {
      onSave({
        company_size: localData.company_size,
        budget: localData.budget,
        campaign_budget_range: localData.campaign_budget_range,
        target_platforms: localData.target_platforms,
      } as BrandFormData)
    }
  }

  const categories = ['Beauty', 'Fashion', 'Food', 'Travel', 'Tech', 'Fitness', 'Lifestyle', 'Education']

  return (
    <form onSubmit={handleSubmit}>
      <h1 className="text-3xl font-semibold tracking-tight mb-4">
        {role === 'creator' ? 'Thông tin Creator' : 'Thông tin Brand'}
      </h1>
      <p className="text-[#6B7280] mb-8">
        {role === 'creator' ? 'Chia sẻ về kênh và nội dung của bạn' : 'Chia sẻ về quy mô và ngân sách marketing'}
      </p>

      <div className="space-y-4">
        {role === 'creator' ? (
          <>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Nền tảng bạn sử dụng *
              </label>
              <div className="grid grid-cols-2 gap-2">
                {platforms.map((platform) => (
                  <button
                    key={platform}
                    type="button"
                    onClick={() => {
                      togglePlatform(platform, 'creator')
                      if (errors.creator_platforms) {
                        setErrors({ ...errors, creator_platforms: '' })
                      }
                    }}
                    className={`px-4 py-2 rounded-lg border text-sm ${
                      localData.creator_platforms?.includes(platform)
                        ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                        : 'border-gray-300 hover:border-gray-400'
                    }`}
                  >
                    {platform}
                  </button>
                ))}
              </div>
              {errors.creator_platforms && (
                <p className="mt-1 text-sm text-red-600">{errors.creator_platforms}</p>
              )}
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Số lượng người theo dõi
              </label>
              <input
                type="number"
                min="0"
                value={localData.followers_count || ''}
                onChange={(e) => setLocalData({ ...localData, followers_count: e.target.value ? parseInt(e.target.value) : undefined } as any)}
                className="w-full px-4 py-2.5 border rounded-lg"
                placeholder="Ví dụ: 100000"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Lượt xem trung bình
              </label>
              <input
                type="number"
                min="0"
                value={localData.avg_views || ''}
                onChange={(e) => setLocalData({ ...localData, avg_views: e.target.value ? parseInt(e.target.value) : undefined } as any)}
                className="w-full px-4 py-2.5 border rounded-lg"
                placeholder="Ví dụ: 50000"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Danh mục nội dung *
              </label>
              <div className="grid grid-cols-2 gap-2">
                {categories.map((category) => (
                  <button
                    key={category}
                    type="button"
                    onClick={() => {
                      toggleCategory(category)
                      if (errors.content_categories) {
                        setErrors({ ...errors, content_categories: '' })
                      }
                    }}
                    className={`px-4 py-2 rounded-lg border text-sm ${
                      localData.content_categories?.includes(category)
                        ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                        : 'border-gray-300 hover:border-gray-400'
                    }`}
                  >
                    {category}
                  </button>
                ))}
              </div>
              {errors.content_categories && (
                <p className="mt-1 text-sm text-red-600">{errors.content_categories}</p>
              )}
            </div>
          </>
        ) : (
          <>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Quy mô công ty *
              </label>
              <select
                value={localData.company_size}
                onChange={(e) => {
                  setLocalData({ ...localData, company_size: e.target.value } as any)
                  if (errors.company_size) {
                    setErrors({ ...errors, company_size: '' })
                  }
                }}
                className={`w-full px-4 py-2.5 border rounded-lg ${errors.company_size ? 'border-red-500' : ''}`}
                required
              >
                <option value="">Chọn quy mô</option>
                <option value="startup">Startup (1-10 nhân viên)</option>
                <option value="small">Nhỏ (11-50 nhân viên)</option>
                <option value="medium">Vừa (51-200 nhân viên)</option>
                <option value="large">Lớn (201-1000 nhân viên)</option>
                <option value="enterprise">Doanh nghiệp (1000+ nhân viên)</option>
              </select>
              {errors.company_size && (
                <p className="mt-1 text-sm text-red-600">{errors.company_size}</p>
              )}
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Ngân sách marketing (USD)
              </label>
              <input
                type="number"
                min="0"
                value={localData.budget || ''}
                onChange={(e) => setLocalData({ ...localData, budget: e.target.value ? parseInt(e.target.value) : undefined } as any)}
                className="w-full px-4 py-2.5 border rounded-lg"
                placeholder="Ví dụ: 5000"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Khoảng ngân sách chiến dịch
              </label>
              <input
                type="text"
                value={localData.campaign_budget_range}
                onChange={(e) => setLocalData({ ...localData, campaign_budget_range: e.target.value } as any)}
                className="w-full px-4 py-2.5 border rounded-lg"
                placeholder="Ví dụ: $1000 - $5000"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Nền tảng mục tiêu *
              </label>
              <div className="grid grid-cols-2 gap-2">
                {platforms.map((platform) => (
                  <button
                    key={platform}
                    type="button"
                    onClick={() => {
                      togglePlatform(platform, 'target')
                      if (errors.target_platforms) {
                        setErrors({ ...errors, target_platforms: '' })
                      }
                    }}
                    className={`px-4 py-2 rounded-lg border text-sm ${
                      localData.target_platforms?.includes(platform)
                        ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                        : 'border-gray-300 hover:border-gray-400'
                    }`}
                  >
                    {platform}
                  </button>
                ))}
              </div>
              {errors.target_platforms && (
                <p className="mt-1 text-sm text-red-600">{errors.target_platforms}</p>
              )}
            </div>
          </>
        )}

        <button
          type="submit"
          disabled={loading || Object.keys(errors).length > 0 || (role === 'creator' ? (!localData.creator_platforms || localData.creator_platforms.length === 0 || !localData.content_categories || localData.content_categories.length === 0) : (!localData.company_size || !localData.target_platforms || localData.target_platforms.length === 0))}
          className="w-full px-6 py-2.5 rounded-xl font-medium text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] disabled:opacity-50"
        >
          {loading ? 'Đang lưu...' : 'Tiếp tục'}
        </button>
      </div>
    </form>
  )
}

// Step 4: Collaboration Intent
function Step4Collaboration({
  role,
  creatorData,
  brandData,
  onSave,
  loading,
}: {
  role: 'creator' | 'brand'
  creatorData: CreatorFormData
  brandData: BrandFormData
  onSave: (data: CreatorFormData | BrandFormData) => void
  loading: boolean
}) {
  const collaborationTypes: ('paid' | 'gift' | 'affiliate')[] = ['paid', 'gift', 'affiliate']
  
  const [localData, setLocalData] = useState(
    role === 'creator'
      ? {
          collaboration_expectation: creatorData.collaboration_expectation || [],
        }
      : {
          campaign_goal: brandData.campaign_goal || '',
          preferred_collaboration_type: brandData.preferred_collaboration_type || [],
        }
  )
  const [errors, setErrors] = useState<Record<string, string>>({})

  const validateStep4 = () => {
    const newErrors: Record<string, string> = {}
    if (role === 'creator') {
      if (!localData.collaboration_expectation || localData.collaboration_expectation.length === 0) {
        newErrors.collaboration_expectation = 'Vui lòng chọn ít nhất một loại hợp tác'
      }
    } else {
      if (!localData.campaign_goal?.trim()) {
        newErrors.campaign_goal = 'Vui lòng nhập mục tiêu chiến dịch'
      }
      if (!localData.preferred_collaboration_type || localData.preferred_collaboration_type.length === 0) {
        newErrors.preferred_collaboration_type = 'Vui lòng chọn ít nhất một loại hợp tác'
      }
    }
    setErrors(newErrors)
    return Object.keys(newErrors).length === 0
  }

  const toggleCollaborationType = (type: 'paid' | 'gift' | 'affiliate') => {
    if (role === 'creator') {
      const current = localData.collaboration_expectation || []
      const updated = current.includes(type)
        ? current.filter((t) => t !== type)
        : [...current, type]
      setLocalData({ ...localData, collaboration_expectation: updated } as any)
    } else {
      const current = localData.preferred_collaboration_type || []
      const updated = current.includes(type)
        ? current.filter((t) => t !== type)
        : [...current, type]
      setLocalData({ ...localData, preferred_collaboration_type: updated } as any)
    }
  }

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault()
    if (!validateStep4()) return
    
    if (role === 'creator') {
      onSave({
        collaboration_expectation: localData.collaboration_expectation,
      } as CreatorFormData)
    } else {
      onSave({
        campaign_goal: localData.campaign_goal,
        preferred_collaboration_type: localData.preferred_collaboration_type,
      } as BrandFormData)
    }
  }

  return (
    <form onSubmit={handleSubmit}>
      <h1 className="text-3xl font-semibold tracking-tight mb-4">
        Mục tiêu hợp tác
      </h1>
      <p className="text-[#6B7280] mb-8">
        {role === 'creator' ? 'Bạn mong đợi gì từ các hợp tác?' : 'Mục tiêu hợp tác của thương hiệu là gì?'}
      </p>

      <div className="space-y-4">
        {role === 'creator' ? (
          <>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Loại hợp tác mong muốn *
              </label>
              <div className="grid grid-cols-3 gap-2">
                {collaborationTypes.map((type) => (
                  <button
                    key={type}
                    type="button"
                    onClick={() => {
                      toggleCollaborationType(type)
                      if (errors.collaboration_expectation) {
                        setErrors({ ...errors, collaboration_expectation: '' })
                      }
                    }}
                    className={`px-4 py-2 rounded-lg border text-sm ${
                      localData.collaboration_expectation?.includes(type)
                        ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                        : 'border-gray-300 hover:border-gray-400'
                    }`}
                  >
                    {type === 'paid' ? 'Trả phí' : type === 'gift' ? 'Quà tặng' : 'Affiliate'}
                  </button>
                ))}
              </div>
              {errors.collaboration_expectation && (
                <p className="mt-1 text-sm text-red-600">{errors.collaboration_expectation}</p>
              )}
            </div>
          </>
        ) : (
          <>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Mục tiêu chiến dịch *
              </label>
              <textarea
                value={localData.campaign_goal}
                onChange={(e) => {
                  setLocalData({ ...localData, campaign_goal: e.target.value } as any)
                  if (errors.campaign_goal) {
                    setErrors({ ...errors, campaign_goal: '' })
                  }
                }}
                rows={5}
                className={`w-full px-4 py-2.5 border rounded-lg ${errors.campaign_goal ? 'border-red-500' : ''}`}
                placeholder="Mô tả mục tiêu hợp tác của thương hiệu..."
                required
              />
              {errors.campaign_goal && (
                <p className="mt-1 text-sm text-red-600">{errors.campaign_goal}</p>
              )}
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Loại hợp tác ưa thích *
              </label>
              <div className="grid grid-cols-3 gap-2">
                {collaborationTypes.map((type) => (
                  <button
                    key={type}
                    type="button"
                    onClick={() => {
                      toggleCollaborationType(type)
                      if (errors.preferred_collaboration_type) {
                        setErrors({ ...errors, preferred_collaboration_type: '' })
                      }
                    }}
                    className={`px-4 py-2 rounded-lg border text-sm ${
                      localData.preferred_collaboration_type?.includes(type)
                        ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                        : 'border-gray-300 hover:border-gray-400'
                    }`}
                  >
                    {type === 'paid' ? 'Trả phí' : type === 'gift' ? 'Quà tặng' : 'Affiliate'}
                  </button>
                ))}
              </div>
              {errors.preferred_collaboration_type && (
                <p className="mt-1 text-sm text-red-600">{errors.preferred_collaboration_type}</p>
              )}
            </div>
          </>
        )}

        <button
          type="submit"
          disabled={loading || Object.keys(errors).length > 0 || (role === 'creator' ? (!localData.collaboration_expectation || localData.collaboration_expectation.length === 0) : (!localData.campaign_goal?.trim() || !localData.preferred_collaboration_type || localData.preferred_collaboration_type.length === 0))}
          className="w-full px-6 py-2.5 rounded-xl font-medium text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] disabled:opacity-50"
        >
          {loading ? 'Đang lưu...' : 'Tiếp tục'}
        </button>
      </div>
    </form>
  )
}

// Step 5: Finalize
function Step5Finalize({
  role,
  creatorData,
  brandData,
  onComplete,
  loading,
}: {
  role: 'creator' | 'brand'
  creatorData: CreatorFormData
  brandData: BrandFormData
  onComplete: () => void
  loading: boolean
}) {
  return (
    <div>
      <h1 className="text-3xl font-semibold tracking-tight mb-4">
        Hoàn tất thiết lập
      </h1>
      <p className="text-[#6B7280] mb-8">
        Bạn đã hoàn thành tất cả các bước thiết lập. Nhấn "Hoàn tất" để bắt đầu sử dụng ALINO.
      </p>

      <div className="bg-gray-50 rounded-lg p-4 mb-6">
        <h3 className="font-medium mb-2">Tóm tắt thông tin:</h3>
        <ul className="text-sm text-[#6B7280] space-y-1">
          {role === 'creator' && (
            <>
              <li>• Tên: {creatorData.display_name || 'Chưa có'}</li>
              <li>• Địa điểm: {creatorData.city && creatorData.country ? `${creatorData.city}, ${creatorData.country}` : 'Chưa có'}</li>
              <li>• Nền tảng: {creatorData.creator_platforms?.length || 0} nền tảng</li>
            </>
          )}
          {role === 'brand' && (
            <>
              <li>• Công ty: {brandData.company_name || 'Chưa có'}</li>
              <li>• Ngành: {brandData.industry || 'Chưa có'}</li>
              <li>• Quy mô: {brandData.company_size || 'Chưa có'}</li>
            </>
          )}
        </ul>
      </div>

      <p className="text-sm text-gray-600 mb-6 text-center">
        By clicking Continue, you agree to ALINO's{' '}
        <Link to="/terms" className="text-[#6366F1] hover:underline">
          Terms of Service
        </Link>
        {' '}and{' '}
        <Link to="/privacy" className="text-[#6366F1] hover:underline">
          Privacy Policy
        </Link>
        .
      </p>

      <button
        onClick={onComplete}
        disabled={loading}
        className="w-full px-6 py-2.5 rounded-xl font-medium text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] disabled:opacity-50"
      >
        {loading ? 'Đang xử lý...' : 'Hoàn tất'}
      </button>
    </div>
  )
}
</file>

<file path="src/vite-env.d.ts">
/// <reference types="vite/client" />
</file>

<file path="src/types/profile.ts">
// Core profile fields (matches FINAL schema)
export interface Profile {
  id: string
  role: 'creator' | 'brand' | null
  onboarding_completed: boolean
  onboarding_data?: any
  is_admin?: boolean
  created_at?: string
  updated_at?: string
}

// Creator-specific fields (matches FINAL schema)
export interface CreatorProfile extends Profile {
  role: 'creator'
  full_name?: string | null
  avatar_url?: string | null
  birth_year?: number | null
  gender?: string | null
  country?: string | null
  city?: string | null
  creator_platforms?: string[] | null // TEXT[]
  content_categories?: string[] | null // TEXT[]
  followers_count?: number | null
  avg_views?: number | null
  collaboration_expectation?: string[] | null // TEXT[]
}

// Brand-specific fields (matches FINAL schema)
export interface BrandProfile extends Profile {
  role: 'brand'
  brand_name?: string | null
  industry?: string | null
  company_size?: string | null
  monthly_marketing_budget?: number | null // NUMERIC
  target_platforms?: string[] | null // TEXT[]
  collaboration_goals?: string[] | null // TEXT[]
}

export type ProfileWithRole = CreatorProfile | BrandProfile
</file>

<file path="src/main.tsx">
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'
import './index.css'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)
</file>

<file path="index.html">
<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/logo/logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ALINO - Quản lý hợp tác Creator–Brand</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: ["./index.html", "./src/**/*.{js,ts,jsx,tsx}"],
  theme: {
    extend: {
      fontFamily: {
        sans: ['Inter', 'system-ui', 'sans-serif'],
      },
      colors: {
        background: '#FFFFFF',
        foreground: '#0A0A0A',
        border: '#E5E7EB',
      },
    },
  },
  plugins: [],
}
</file>

<file path="src/components/layout/UserMenu.tsx">
import { useState, useRef, useEffect } from 'react'
import { Link, useNavigate } from 'react-router-dom'
import { useAuth } from '../../hooks/useAuth'

interface UserMenuProps {
  userEmail: string
  displayName?: string
  avatarUrl?: string | null
  role?: string | null
}

export default function UserMenu({ userEmail, displayName, avatarUrl, role }: UserMenuProps) {
  const [isOpen, setIsOpen] = useState(false)
  const menuRef = useRef<HTMLDivElement>(null)
  const navigate = useNavigate()
  const { signOut } = useAuth()

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {
        setIsOpen(false)
      }
    }

    if (isOpen) {
      document.addEventListener('mousedown', handleClickOutside)
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside)
    }
  }, [isOpen])

  const handleLogout = async () => {
    setIsOpen(false)
    await signOut()
    // Redirect to landing page after sign out
    navigate('/')
  }

  const nameToShow = displayName || userEmail.split('@')[0]

  return (
    <div
      className="relative"
      ref={menuRef}
      onMouseEnter={() => setIsOpen(true)}
      onMouseLeave={() => setIsOpen(false)}
    >
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-2 px-0 py-0 text-[#6B7280] hover:text-[#6366F1] transition-colors group"
      >
        {avatarUrl ? (
          <img 
            src={avatarUrl} 
            alt={nameToShow}
            className="w-6 h-6 rounded-full object-cover flex-shrink-0"
          />
        ) : (
          <div className="w-6 h-6 rounded-full bg-gradient-to-r from-[#6366F1] to-[#EC4899] flex items-center justify-center text-white font-medium text-xs flex-shrink-0">
            {nameToShow.charAt(0).toUpperCase()}
          </div>
        )}
        <span className="text-sm whitespace-nowrap">
          {nameToShow}
        </span>
      </button>

      {isOpen && (
        <div className="absolute right-0 top-full pt-2 w-56 z-50">
          <div className="bg-white rounded-xl shadow-lg border border-gray-200 py-2">
            <Link
              to="/app"
              onClick={() => setIsOpen(false)}
              className="block px-4 py-2.5 text-sm text-[#374151] hover:bg-gray-50 transition-colors"
            >
              Quản lý dự án
            </Link>
            <div className="border-t border-gray-200 my-1" />
            <button
              onClick={handleLogout}
              className="block w-full text-left px-4 py-2.5 text-sm text-red-600 hover:bg-gray-50 transition-colors"
            >
              Đăng xuất
            </button>
          </div>
        </div>
      )}
    </div>
  )
}
</file>

<file path="src/hooks/useProfile.ts">
import { useEffect, useState, useRef } from 'react'
import { getSupabase } from '../lib/supabase'
import type { Profile, CreatorProfile, BrandProfile } from '../types/profile'

const PROFILE_FETCH_TIMEOUT = 3000 // 3 seconds

export function useProfile(
  userId: string | undefined,
  enabled: boolean
) {
  const [profile, setProfile] = useState<Profile | CreatorProfile | BrandProfile | null>(null)
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)
  const [needsOnboarding, setNeedsOnboarding] = useState(false)
  const timeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null)

  useEffect(() => {
    if (!enabled || !userId) {
      setProfile(null)
      setLoading(false)
      setError(null)
      setNeedsOnboarding(false)
      return
    }
  
    let mounted = true
  
    async function fetchProfile() {
      const supabaseInstance = getSupabase()
      const { data: { session } } = await supabaseInstance.auth.getSession()
      
      if (!session || !session.access_token || !session.user.email_confirmed_at) {
        if (mounted) {
          setProfile(null)
          setLoading(false)
          setError(null)
          setNeedsOnboarding(false)
        }
        return
      }

      setLoading(true)
      setError(null)
      setNeedsOnboarding(false)
  
      timeoutRef.current = setTimeout(() => {
        if (mounted) {
          setLoading(false)
          setError('Timeout loading profile')
        }
      }, PROFILE_FETCH_TIMEOUT)
  
      try {
        // Step 1: Fetch core profile (role, onboarding flags)
        const { data: coreProfile, error: coreError } = await supabaseInstance
          .from('profiles')
          .select('id, role, onboarding_completed, created_at, updated_at')
          .eq('id', userId)
          .single()
  
        if (timeoutRef.current) {
          clearTimeout(timeoutRef.current)
          timeoutRef.current = null
        }
  
        if (coreError) {
          if (mounted) {
            if (coreError.code === '42501' || coreError.code === 'PGRST301') {
              setLoading(false)
              return
            }
            setError(coreError.message)
            setLoading(false)
          }
          return
        }
  
        if (!coreProfile) {
          if (mounted) {
            setError('Profile not found')
            setLoading(false)
          }
          return
        }
  
        // Step 2: Fetch domain-specific profile based on role
        if (coreProfile.role === 'creator') {
          const { data: creatorProfile, error: creatorError } = await supabaseInstance
            .from('creator_profiles')
            .select('*')
            .eq('user_id', userId)
            .single()
  
          if (creatorError) {
            if (mounted) {
              if (creatorError.code === 'PGRST116') {
                setProfile(null)
                setNeedsOnboarding(true)
                setLoading(false)
                return
              }
              if (creatorError.code === '42501' || creatorError.code === 'PGRST301') {
                setLoading(false)
                return
              }
              setError(creatorError.message)
              setLoading(false)
            }
            return
          }
  
          if (mounted && creatorProfile) {
            // Merge core profile with creator profile
            setProfile({
              ...coreProfile,
              ...creatorProfile,
              role: 'creator',
            } as CreatorProfile)
            setLoading(false)
          }
        } else if (coreProfile.role === 'brand') {
          const { data: brandProfile, error: brandError } = await supabaseInstance
            .from('brand_profiles')
            .select('*')
            .eq('user_id', userId)
            .single()
  
          if (brandError && brandError.code === 'PGRST116') {
            // Brand profile not found - needs onboarding
            if (mounted) {
              setProfile(null)
              setNeedsOnboarding(true)
              setLoading(false)
            }
            return
          }
  
          if (brandError) {
            if (mounted) {
              if (brandError.code === '42501' || brandError.code === 'PGRST301') {
                setLoading(false)
                return
              }
              setError(brandError.message)
              setLoading(false)
            }
            return
          }
  
          if (mounted && brandProfile) {
            // Merge core profile with brand profile
            setProfile({
              ...coreProfile,
              ...brandProfile,
              role: 'brand',
            } as BrandProfile)
            setLoading(false)
          }
        } else {
          // No role set yet
          if (mounted) {
            setProfile(coreProfile)
            setLoading(false)
          }
        }
      } catch (err: any) {
        if (mounted) {
          setError(err.message || 'Failed to load profile')
          setLoading(false)
        }
      }
    }
  
    fetchProfile()
  
    return () => {
      mounted = false
      if (timeoutRef.current) {
        clearTimeout(timeoutRef.current)
      }
    }
  }, [userId, enabled])
  

  return { profile, loading, error, needsOnboarding }
}
</file>

<file path="vite.config.ts">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    host: true,
    port: 3000,
  },
})
</file>

<file path="src/components/layout/Header.tsx">
import { Link, useLocation, useNavigate } from 'react-router-dom'
import { useAuth } from '../../hooks/useAuth'
import { useProfile } from '../../hooks/useProfile'
import UserMenu from './UserMenu'

/**
 * Landing Page Header Component
 * - Used ONLY on landing pages (not dashboard)
 * - Contains: Logo | Navigation | UserMenu
 */
export default function Header() {
  const { session, loading: authLoading } = useAuth()
  const { profile } = useProfile(
    session?.user?.id,
    !!(session && session.access_token && session.user.email_confirmed_at)
  )
  const location = useLocation()
  const navigate = useNavigate()

  const handleLogoClick = (e: React.MouseEvent) => {
    e.preventDefault()
    if (location.pathname !== '/') navigate('/')
    window.scrollTo({ top: 0, behavior: 'smooth' })
  }

  const displayName =
    (profile?.role === 'creator' ? (profile as any).full_name : profile?.role === 'brand' ? (profile as any).brand_name : null) ||
    session?.user?.user_metadata?.display_name ||
    undefined

  const avatarUrl =
    (profile?.role === 'creator' ? (profile as any).avatar_url : null) ||
    session?.user?.user_metadata?.avatar_url ||
    undefined

  return (
    <header className="fixed top-0 inset-x-0 z-50 h-16 bg-white/80 backdrop-blur-xl border-b border-black/5">
      <div className="max-w-7xl mx-auto px-6 h-full flex items-center justify-between">
        {/* Logo */}
        <Link
          to="/"
          onClick={handleLogoClick}
          className="flex items-center gap-3"
        >
          <img src="/logo/logo.png" alt="ALINO" className="w-8 h-8" />
          <span className="font-bold text-2xl leading-tight bg-gradient-to-r from-[#6366F1] to-[#EC4899] bg-clip-text text-transparent">
            ALINO
          </span>
        </Link>

        {/* Navigation */}
        <nav className="hidden md:flex items-center gap-10 text-sm text-[#6B7280]">
          <a href="#about">Về chúng tôi</a>
          <a href="#features">Tính năng</a>
          <a href="#news">Tin tức</a>
          <a href="#contact">Liên hệ</a>
        </nav>

        {/* Actions */}
        <div className="flex items-center gap-4 text-sm">
          {authLoading ? null : session ? (
            <UserMenu
              userEmail={session.user.email || ''}
              displayName={displayName}
              avatarUrl={avatarUrl}
              role={profile?.role || null}
            />
          ) : (
            <>
              <Link to="/login">Đăng nhập</Link>
              <Link
                to="/signup"
                className="px-5 py-2.5 rounded-full text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899]"
              >
                Đăng ký
              </Link>
            </>
          )}
        </div>
      </div>
    </header>
  )
}
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "types": ["vite/client"],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"],
  "exclude": ["node_modules"]
}
</file>

<file path="src/index.css">
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  * {
    @apply border-border;
  }
  
  body {
    @apply bg-background text-foreground;
    font-family: 'Inter', system-ui, sans-serif;
  }
}

.underline-gradient {
  position: relative;
}

.underline-gradient::after {
  content: '';
  position: absolute;
  bottom: -4px;
  left: 0;
  width: 0;
  height: 2px;
  background: linear-gradient(90deg, #6366F1, #EC4899);
  transition: width 0.3s ease;
}

.underline-gradient:hover::after {
  width: 100%;
}

@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}
</file>

<file path=".env.example">
VITE_SUPABASE_URL=https://iralrlsuxoqbgcjzdpbb.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlyYWxybHN1eG9xYmdjanpkcGJiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1ODA5ODUsImV4cCI6MjA4MjE1Njk4NX0.e0x5keoaE0GlXehvTA05LlzGhZWh63FHROkAz9kPqZU
</file>

<file path=".gitignore">
# =====================
# Dependencies
# =====================
node_modules/
.pnp
.pnp.js

# =====================
# Next.js / Build
# =====================
.next/
out/
build/
dist/

# =====================
# Environment variables
# =====================
.env
.env.local
.env.*.local

# =====================
# Logs
# =====================
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# =====================
# OS / Editor
# =====================
.DS_Store

# =====================
# TypeScript
# =====================
*.tsbuildinfo
next-env.d.ts

# =====================
# Repomix (local only)
# =====================
repomix-output.*

# =====================
# MS Office temp files
# =====================
~$*.docx
~$*.xlsx
~$*.pptx
</file>

<file path="src/App.tsx">
import { BrowserRouter, useLocation } from 'react-router-dom'
import { Router } from './app/router'
import ScrollToTop from './components/shared/ScrollToTop'
import Header from './components/layout/Header'
import Footer from './components/layout/Footer'
import { AuthProvider } from './contexts/AuthContext'

function AppContent() {
  const location = useLocation()
  
  // Dashboard routes don't show header/footer
  const isDashboardMode = location.pathname.startsWith('/dashboard')
  
  return (
    <div className="min-h-screen flex flex-col">
      {!isDashboardMode && <Header />}
      <main className="flex-1">
        <Router />
      </main>
      {!isDashboardMode && <Footer />}
    </div>
  )
}

function App() {
  return (
    <BrowserRouter>
      <AuthProvider>
        <ScrollToTop />
        <AppContent />
      </AuthProvider>
    </BrowserRouter>
  )
}

export default App
</file>

<file path="package.json">
{
  "name": "alino-vite",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "backup": "git add -A && git commit -m \"backup\" || echo \"No changes to commit\" && git push"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.89.0",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.26.0",
    "react-icons": "^5.5.0",
    "react-easy-crop": "^5.0.5",
    "recharts": "^2.12.7"
  },
  "devDependencies": {
    "@types/react": "^18.3.3",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react": "^4.3.1",
    "autoprefixer": "^10.4.23",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.1",
    "typescript": "^5.5.4",
    "vite": "^5.4.0"
  }
}
</file>

</files>
