This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
migrations/
  001_cleanup_profiles.sql
public/
  logo/
    logo.png
src/
  components/
    dashboard/
      DashboardHeader.tsx
      DashboardLayout.tsx
      NotificationModal.tsx
    layout/
      Footer.tsx
      Header.tsx
      UserMenu.tsx
    AuthGate.tsx
    AvatarUpload.tsx
    ScrollToTop.tsx
    Toast.tsx
  hooks/
    useAuth.ts
    useProfile.ts
  lib/
    supabase.ts
  pages/
    AppGate.tsx
    BrandDashboard.tsx
    ComingSoonPage.tsx
    CreatorDashboard.tsx
    Dashboard.tsx
    DashboardHome.tsx
    LandingPage.tsx
    LoginPage.tsx
    NotificationsPage.tsx
    OnboardingPage.tsx
    PrivacyPage.tsx
    ProfilePage.tsx
    RolePage.tsx
    SettingsPage.tsx
    SignupPage.tsx
    TermsPage.tsx
    VerifyEmailPage.tsx
  types/
    profile.ts
  utils/
    cropImage.ts
  App.tsx
  index.css
  main.tsx
  router.tsx
  vite-env.d.ts
supabase/
  migrations/
    001_create_profiles.sql
.env.example
.gitignore
index.html
MIGRATION_GUIDE.md
package.json
postcss.config.cjs
PROFILES_IMPLEMENTATION.md
README_VITE.md
README.md
tailwind.config.js
TECHNICAL_SUMMARY.md
tsconfig.json
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="src/components/dashboard/DashboardHeader.tsx">
import { Link, useNavigate, useLocation } from 'react-router-dom'
import { useState } from 'react'
import { FaBell } from 'react-icons/fa'
import { useAuth } from '../../hooks/useAuth'
import { useProfile } from '../../hooks/useProfile'
import UserMenu from '../layout/UserMenu'
import NotificationModal from './NotificationModal'

/**
 * DashboardHeader
 * - Fixed header for dashboard pages
 * - Height: h-16 (same as Landing Header)
 * - Left: w-64 (aligned with Sidebar) ‚Üí Logo + ALINO centered
 * - Middle: Title + Subtitle (auto by route)
 * - Right: Notification + UserMenu (tight spacing)
 */
export default function DashboardHeader() {
  const { session } = useAuth()
  const { profile } = useProfile(session?.user?.id, !!session)
  const navigate = useNavigate()
  const location = useLocation()
  const [isNotificationModalOpen, setIsNotificationModalOpen] = useState(false)

  const handleLogoClick = (e: React.MouseEvent) => {
    e.preventDefault()
    navigate('/')
    window.scrollTo({ top: 0, behavior: 'smooth' })
  }

  const fullName =
    profile?.display_name ||
    session?.user?.user_metadata?.display_name ||
    ''

  const avatarUrl =
    profile?.avatar_url ||
    session?.user?.user_metadata?.avatar_url ||
    undefined

  // üîî mock unread count
  const unreadNotificationCount = 4

  /* ------------------------------
   * Title & Subtitle by route
   * ------------------------------ */
  const pathname = location.pathname

  const getTitleAndSubtitle = () => {
    if (pathname === '/dashboard') {
      return {
        title: `Xin ch√†o ${fullName}!`,
        subtitle: 'Ch√†o m·ª´ng b·∫°n quay tr·ªü l·∫°i üëã',
      }
    }

    if (pathname.startsWith('/dashboard/profile')) {
      return {
        title: 'H·ªì s∆° c√° nh√¢n',
        subtitle: 'Qu·∫£n l√Ω th√¥ng tin hi·ªÉn th·ªã c·ªßa b·∫°n v·ªõi ƒë·ªëi t√°c',
      }
    }

    if (pathname.startsWith('/dashboard/settings')) {
      return {
        title: 'C√†i ƒë·∫∑t',
        subtitle: 'Qu·∫£n l√Ω c√†i ƒë·∫∑t t√†i kho·∫£n v√† t√πy ch·ªçn',
      }
    }

    if (pathname.startsWith('/dashboard/services')) {
      return {
        title: 'D·ªãch v·ª• & B·∫£ng gi√°',
        subtitle: 'Thi·∫øt l·∫≠p d·ªãch v·ª• v√† m·ª©c gi√° b·∫°n cung c·∫•p',
      }
    }

    if (pathname.startsWith('/dashboard/opportunities')) {
      return {
        title: 'C∆° h·ªôi h·ª£p t√°c',
        subtitle: 'Kh√°m ph√° c√°c c∆° h·ªôi ph√π h·ª£p v·ªõi b·∫°n',
      }
    }

    if (pathname.startsWith('/dashboard/proposals')) {
      return {
        title: 'ƒê·ªÅ xu·∫•t',
        subtitle: 'Qu·∫£n l√Ω c√°c ƒë·ªÅ xu·∫•t h·ª£p t√°c ƒëang di·ªÖn ra',
      }
    }

    if (pathname.startsWith('/dashboard/workspace')) {
      return {
        title: 'Trung t√¢m l√†m vi·ªác',
        subtitle: 'Theo d√µi v√† x·ª≠ l√Ω c√°c ho·∫°t ƒë·ªông h·ª£p t√°c',
      }
    }

    if (pathname.startsWith('/dashboard/analytics')) {
      return {
        title: 'Ph√¢n t√≠ch',
        subtitle: 'Theo d√µi hi·ªáu su·∫•t v√† tƒÉng tr∆∞·ªüng c·ªßa b·∫°n',
      }
    }

    return { title: '', subtitle: '' }
  }

  const { title, subtitle } = getTitleAndSubtitle()

  return (
    <>
      <header className="fixed top-0 inset-x-0 z-50 h-16 bg-white/80 backdrop-blur-xl border-b border-black/5">
  <div className="h-full flex">
    {/* LEFT: Sidebar-aligned block */}
    <div className="w-64 h-full flex items-center justify-center border-r border-gray-200 flex-shrink-0">
      <Link
        to="/"
        onClick={handleLogoClick}
        className="flex items-center gap-3"
      >
        <img src="/logo/logo.png" alt="ALINO" className="w-8 h-8" />
        <span className="font-bold text-2xl leading-none bg-gradient-to-r from-[#6366F1] to-[#EC4899] bg-clip-text text-transparent">
          ALINO
        </span>
      </Link>
    </div>

    {/* RIGHT AREA: SAME CONTAINER AS LANDING */}
    <div className="flex-1">
      <div className="max-w-7xl mx-auto px-6 h-full flex items-center justify-between">
        {/* Title */}
        <div className="flex flex-col justify-center">
          <h1 className="text-lg font-semibold text-gray-900 leading-tight">
            {title}
          </h1>
          {subtitle && (
            <p className="text-sm text-gray-500 leading-tight mt-0.5">
              {subtitle}
            </p>
          )}
        </div>

        {/* User actions ‚Äì EXACT SAME POSITION AS LANDING */}
        {session && (
          <div className="flex items-center gap-2">
            <button
              onClick={() => setIsNotificationModalOpen(true)}
              className="relative p-2 rounded-lg text-gray-600 hover:text-[#6366F1] hover:bg-gray-100 transition"
            >
              <FaBell className="w-5 h-5" />
              {unreadNotificationCount > 0 && (
                <span className="absolute -top-1 -right-1 w-4 h-4 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white text-xs font-bold rounded-full flex items-center justify-center">
                  {unreadNotificationCount}
                </span>
              )}
            </button>

            <UserMenu
              userEmail={session.user.email || ''}
              displayName={fullName}
              avatarUrl={avatarUrl}
            />
          </div>
        )}
      </div>
    </div>
  </div>
</header>

      <NotificationModal
        isOpen={isNotificationModalOpen}
        onClose={() => setIsNotificationModalOpen(false)}
      />
    </>
  )
}
</file>

<file path="src/pages/PrivacyPage.tsx">
import { Link } from 'react-router-dom'
import Header from '../components/layout/Header'
import Footer from '../components/layout/Footer'

export default function PrivacyPage() {
  return (
    <div className="min-h-screen flex flex-col">
      <Header />
      <main className="flex-1 pt-24 pb-16">
        <div className="max-w-4xl mx-auto px-6">
          <div className="bg-white rounded-3xl p-8 md:p-10 shadow-xl border border-gray-200">
            <h1 className="text-4xl font-bold mb-4">Ch√≠nh s√°ch b·∫£o m·∫≠t</h1>
            <p className="text-sm text-gray-500 mb-8">
              C·∫≠p nh·∫≠t l·∫ßn cu·ªëi: {new Date().toLocaleDateString('vi-VN', { year: 'numeric', month: 'long', day: 'numeric' })}
            </p>

            <div className="prose prose-gray max-w-none">
              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">1. Gi·ªõi thi·ªáu</h2>
                <p className="text-gray-700 mb-4">
                  ALINO cam k·∫øt b·∫£o v·ªá quy·ªÅn ri√™ng t∆∞ c·ªßa ng∆∞·ªùi d√πng. Ch√≠nh s√°ch n√†y m√¥ t·∫£ c√°ch ch√∫ng t√¥i thu th·∫≠p, s·ª≠ d·ª•ng, 
                  v√† b·∫£o v·ªá th√¥ng tin c√° nh√¢n c·ªßa b·∫°n khi s·ª≠ d·ª•ng d·ªãch v·ª• c·ªßa ch√∫ng t√¥i.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">2. Th√¥ng tin ch√∫ng t√¥i thu th·∫≠p</h2>
                <p className="text-gray-700 mb-4">
                  Ch√∫ng t√¥i thu th·∫≠p c√°c lo·∫°i th√¥ng tin sau:
                </p>
                <ul className="list-disc pl-6 text-gray-700 mb-4">
                  <li><strong>Th√¥ng tin c√° nh√¢n:</strong> T√™n, email, ng√†y sinh, ƒë·ªãa ch·ªâ</li>
                  <li><strong>Th√¥ng tin t√†i kho·∫£n:</strong> Th√¥ng tin ƒëƒÉng nh·∫≠p, l·ªãch s·ª≠ ho·∫°t ƒë·ªông</li>
                  <li><strong>Th√¥ng tin h·ªì s∆°:</strong> Th√¥ng tin c√¥ng khai tr√™n h·ªì s∆° c·ªßa b·∫°n</li>
                  <li><strong>Th√¥ng tin k·∫øt n·ªëi:</strong> D·ªØ li·ªáu t·ª´ c√°c t√†i kho·∫£n m·∫°ng x√£ h·ªôi ƒë∆∞·ª£c k·∫øt n·ªëi (Google, Facebook, Instagram, TikTok)</li>
                  <li><strong>D·ªØ li·ªáu s·ª≠ d·ª•ng:</strong> Th√¥ng tin v·ªÅ c√°ch b·∫°n s·ª≠ d·ª•ng n·ªÅn t·∫£ng</li>
                </ul>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">3. C√°ch ch√∫ng t√¥i s·ª≠ d·ª•ng th√¥ng tin</h2>
                <p className="text-gray-700 mb-4">
                  Ch√∫ng t√¥i s·ª≠ d·ª•ng th√¥ng tin c·ªßa b·∫°n ƒë·ªÉ:
                </p>
                <ul className="list-disc pl-6 text-gray-700 mb-4">
                  <li>Cung c·∫•p v√† c·∫£i thi·ªán d·ªãch v·ª•</li>
                  <li>K·∫øt n·ªëi b·∫°n v·ªõi c√°c ƒë·ªëi t√°c ph√π h·ª£p (Creators v·ªõi Brands)</li>
                  <li>G·ª≠i th√¥ng b√°o v√† c·∫≠p nh·∫≠t v·ªÅ d·ªãch v·ª•</li>
                  <li>Ph√¢n t√≠ch v√† c·∫£i thi·ªán tr·∫£i nghi·ªám ng∆∞·ªùi d√πng</li>
                  <li>Tu√¢n th·ªß c√°c nghƒ©a v·ª• ph√°p l√Ω</li>
                </ul>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">4. K·∫øt n·ªëi t√†i kho·∫£n m·∫°ng x√£ h·ªôi</h2>
                <p className="text-gray-700 mb-4">
                  Khi b·∫°n k·∫øt n·ªëi t√†i kho·∫£n m·∫°ng x√£ h·ªôi (Google, Facebook, Instagram, TikTok) v·ªõi ALINO, ch√∫ng t√¥i c√≥ th·ªÉ 
                  truy c·∫≠p v√† l∆∞u tr·ªØ m·ªôt s·ªë th√¥ng tin t·ª´ c√°c t√†i kho·∫£n ƒë√≥ ƒë·ªÉ cung c·∫•p d·ªãch v·ª• t·ªët h∆°n, bao g·ªìm th√¥ng tin h·ªì s∆° 
                  c√¥ng khai v√† d·ªØ li·ªáu c·∫ßn thi·∫øt cho c√°c t√≠nh nƒÉng c·ªßa n·ªÅn t·∫£ng.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">5. Chia s·∫ª th√¥ng tin</h2>
                <p className="text-gray-700 mb-4">
                  Ch√∫ng t√¥i kh√¥ng b√°n th√¥ng tin c√° nh√¢n c·ªßa b·∫°n. Ch√∫ng t√¥i c√≥ th·ªÉ chia s·∫ª th√¥ng tin trong c√°c tr∆∞·ªùng h·ª£p sau:
                </p>
                <ul className="list-disc pl-6 text-gray-700 mb-4">
                  <li>V·ªõi c√°c ƒë·ªëi t√°c ph√π h·ª£p tr√™n n·ªÅn t·∫£ng (th√¥ng tin c√¥ng khai t·ª´ h·ªì s∆° c·ªßa b·∫°n)</li>
                  <li>V·ªõi c√°c nh√† cung c·∫•p d·ªãch v·ª• h·ªó tr·ª£ ho·∫°t ƒë·ªông c·ªßa ch√∫ng t√¥i</li>
                  <li>Khi ƒë∆∞·ª£c y√™u c·∫ßu b·ªüi ph√°p lu·∫≠t</li>
                </ul>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">6. B·∫£o m·∫≠t d·ªØ li·ªáu</h2>
                <p className="text-gray-700 mb-4">
                  Ch√∫ng t√¥i s·ª≠ d·ª•ng c√°c bi·ªán ph√°p b·∫£o m·∫≠t k·ªπ thu·∫≠t v√† t·ªï ch·ª©c ph√π h·ª£p ƒë·ªÉ b·∫£o v·ªá th√¥ng tin c√° nh√¢n c·ªßa b·∫°n kh·ªèi 
                  truy c·∫≠p tr√°i ph√©p, m·∫•t m√°t, ho·∫∑c ph√° h·ªßy.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">7. Quy·ªÅn c·ªßa b·∫°n</h2>
                <p className="text-gray-700 mb-4">
                  B·∫°n c√≥ quy·ªÅn:
                </p>
                <ul className="list-disc pl-6 text-gray-700 mb-4">
                  <li>Truy c·∫≠p v√† ch·ªânh s·ª≠a th√¥ng tin c√° nh√¢n c·ªßa b·∫°n</li>
                  <li>Y√™u c·∫ßu x√≥a t√†i kho·∫£n v√† d·ªØ li·ªáu</li>
                  <li>Ng·ª´ng k·∫øt n·ªëi t√†i kho·∫£n m·∫°ng x√£ h·ªôi</li>
                  <li>Y√™u c·∫ßu xu·∫•t d·ªØ li·ªáu c·ªßa b·∫°n</li>
                </ul>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">8. Cookie v√† c√¥ng ngh·ªá theo d√µi</h2>
                <p className="text-gray-700 mb-4">
                  Ch√∫ng t√¥i s·ª≠ d·ª•ng cookie v√† c√°c c√¥ng ngh·ªá t∆∞∆°ng t·ª± ƒë·ªÉ c·∫£i thi·ªán tr·∫£i nghi·ªám ng∆∞·ªùi d√πng v√† ph√¢n t√≠ch c√°ch s·ª≠ d·ª•ng d·ªãch v·ª•.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">9. Thay ƒë·ªïi ch√≠nh s√°ch</h2>
                <p className="text-gray-700 mb-4">
                  Ch√∫ng t√¥i c√≥ th·ªÉ c·∫≠p nh·∫≠t ch√≠nh s√°ch n√†y theo th·ªùi gian. Ch√∫ng t√¥i s·∫Ω th√¥ng b√°o cho b·∫°n v·ªÅ c√°c thay ƒë·ªïi quan tr·ªçng 
                  qua email ho·∫∑c th√¥ng b√°o tr√™n n·ªÅn t·∫£ng.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">10. Li√™n h·ªá</h2>
                <p className="text-gray-700 mb-4">
                  N·∫øu b·∫°n c√≥ c√¢u h·ªèi v·ªÅ ch√≠nh s√°ch b·∫£o m·∫≠t n√†y, vui l√≤ng li√™n h·ªá v·ªõi ch√∫ng t√¥i qua email ho·∫∑c c√°c k√™nh h·ªó tr·ª£ ƒë∆∞·ª£c cung c·∫•p.
                </p>
              </section>
            </div>
          </div>
        </div>
      </main>
      <Footer />
    </div>
  )
}
</file>

<file path="src/pages/TermsPage.tsx">
import { Link } from 'react-router-dom'
import Header from '../components/layout/Header'
import Footer from '../components/layout/Footer'

export default function TermsPage() {
  return (
    <div className="min-h-screen flex flex-col">
      <Header />
      <main className="flex-1 pt-24 pb-16">
        <div className="max-w-4xl mx-auto px-6">
          <div className="bg-white rounded-3xl p-8 md:p-10 shadow-xl border border-gray-200">
            <h1 className="text-4xl font-bold mb-4">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</h1>
            <p className="text-sm text-gray-500 mb-8">
              C·∫≠p nh·∫≠t l·∫ßn cu·ªëi: {new Date().toLocaleDateString('vi-VN', { year: 'numeric', month: 'long', day: 'numeric' })}
            </p>

            <div className="prose prose-gray max-w-none">
              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">1. Ch·∫•p nh·∫≠n ƒëi·ªÅu kho·∫£n</h2>
                <p className="text-gray-700 mb-4">
                  B·∫±ng vi·ªác truy c·∫≠p v√† s·ª≠ d·ª•ng d·ªãch v·ª• ALINO, b·∫°n ƒë·ªìng √Ω tu√¢n th·ªß v√† b·ªã r√†ng bu·ªôc b·ªüi c√°c ƒëi·ªÅu kho·∫£n s·ª≠ d·ª•ng n√†y. 
                  N·∫øu b·∫°n kh√¥ng ƒë·ªìng √Ω v·ªõi b·∫•t k·ª≥ ph·∫ßn n√†o c·ªßa c√°c ƒëi·ªÅu kho·∫£n n√†y, b·∫°n kh√¥ng ƒë∆∞·ª£c ph√©p s·ª≠ d·ª•ng d·ªãch v·ª•.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">2. M√¥ t·∫£ d·ªãch v·ª•</h2>
                <p className="text-gray-700 mb-4">
                  ALINO l√† m·ªôt n·ªÅn t·∫£ng k·∫øt n·ªëi gi·ªØa c√°c nh√† s√°ng t·∫°o n·ªôi dung (Creators) v√† c√°c th∆∞∆°ng hi·ªáu (Brands) 
                  ƒë·ªÉ t·∫°o ƒëi·ªÅu ki·ªán cho c√°c chi·∫øn d·ªãch h·ª£p t√°c v√† ti·∫øp th·ªã. D·ªãch v·ª• bao g·ªìm nh∆∞ng kh√¥ng gi·ªõi h·∫°n ·ªü vi·ªác 
                  qu·∫£n l√Ω h·ªì s∆°, t√¨m ki·∫øm ƒë·ªëi t√°c, v√† qu·∫£n l√Ω c√°c d·ª± √°n h·ª£p t√°c.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">3. T√†i kho·∫£n ng∆∞·ªùi d√πng</h2>
                <p className="text-gray-700 mb-4">
                  ƒê·ªÉ s·ª≠ d·ª•ng m·ªôt s·ªë t√≠nh nƒÉng c·ªßa d·ªãch v·ª•, b·∫°n c·∫ßn t·∫°o t√†i kho·∫£n. B·∫°n c√≥ tr√°ch nhi·ªám:
                </p>
                <ul className="list-disc pl-6 text-gray-700 mb-4">
                  <li>B·∫£o m·∫≠t th√¥ng tin ƒëƒÉng nh·∫≠p c·ªßa b·∫°n</li>
                  <li>Cung c·∫•p th√¥ng tin ch√≠nh x√°c v√† c·∫≠p nh·∫≠t</li>
                  <li>Th√¥ng b√°o ngay cho ch√∫ng t√¥i v·ªÅ b·∫•t k·ª≥ ho·∫°t ƒë·ªông ƒë√°ng ng·ªù n√†o</li>
                </ul>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">4. Quy·ªÅn v√† tr√°ch nhi·ªám</h2>
                <p className="text-gray-700 mb-4">
                  Ng∆∞·ªùi d√πng c√≥ quy·ªÅn s·ª≠ d·ª•ng d·ªãch v·ª• theo ƒë√∫ng m·ª•c ƒë√≠ch v√† kh√¥ng ƒë∆∞·ª£c s·ª≠ d·ª•ng d·ªãch v·ª• cho c√°c ho·∫°t ƒë·ªông 
                  b·∫•t h·ª£p ph√°p ho·∫∑c vi ph·∫°m quy·ªÅn c·ªßa ng∆∞·ªùi kh√°c.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">5. S·ªü h·ªØu tr√≠ tu·ªá</h2>
                <p className="text-gray-700 mb-4">
                  T·∫•t c·∫£ n·ªôi dung tr√™n n·ªÅn t·∫£ng ALINO, bao g·ªìm logo, thi·∫øt k·∫ø, vƒÉn b·∫£n, v√† ph·∫ßn m·ªÅm, ƒë·ªÅu thu·ªôc quy·ªÅn s·ªü h·ªØu 
                  c·ªßa ALINO ho·∫∑c c√°c b√™n c·∫•p ph√©p. B·∫°n kh√¥ng ƒë∆∞·ª£c ph√©p sao ch√©p, ph√¢n ph·ªëi, ho·∫∑c s·ª≠ d·ª•ng n·ªôi dung n√†y m√† kh√¥ng 
                  c√≥ s·ª± cho ph√©p b·∫±ng vƒÉn b·∫£n.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">6. Gi·ªõi h·∫°n tr√°ch nhi·ªám</h2>
                <p className="text-gray-700 mb-4">
                  ALINO kh√¥ng ch·ªãu tr√°ch nhi·ªám v·ªÅ b·∫•t k·ª≥ thi·ªát h·∫°i tr·ª±c ti·∫øp, gi√°n ti·∫øp, ng·∫´u nhi√™n, ho·∫∑c h·∫≠u qu·∫£ n√†o ph√°t sinh 
                  t·ª´ vi·ªác s·ª≠ d·ª•ng ho·∫∑c kh√¥ng th·ªÉ s·ª≠ d·ª•ng d·ªãch v·ª• c·ªßa ch√∫ng t√¥i.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">7. Thay ƒë·ªïi ƒëi·ªÅu kho·∫£n</h2>
                <p className="text-gray-700 mb-4">
                  Ch√∫ng t√¥i c√≥ quy·ªÅn c·∫≠p nh·∫≠t c√°c ƒëi·ªÅu kho·∫£n n√†y b·∫•t c·ª© l√∫c n√†o. Vi·ªác ti·∫øp t·ª•c s·ª≠ d·ª•ng d·ªãch v·ª• sau khi c√≥ thay ƒë·ªïi 
                  ƒë∆∞·ª£c coi l√† b·∫°n ƒë√£ ch·∫•p nh·∫≠n c√°c ƒëi·ªÅu kho·∫£n m·ªõi.
                </p>
              </section>

              <section className="mb-8">
                <h2 className="text-2xl font-semibold mb-4">8. Li√™n h·ªá</h2>
                <p className="text-gray-700 mb-4">
                  N·∫øu b·∫°n c√≥ b·∫•t k·ª≥ c√¢u h·ªèi n√†o v·ªÅ c√°c ƒëi·ªÅu kho·∫£n n√†y, vui l√≤ng li√™n h·ªá v·ªõi ch√∫ng t√¥i qua email ho·∫∑c c√°c k√™nh h·ªó tr·ª£ 
                  ƒë∆∞·ª£c cung c·∫•p tr√™n n·ªÅn t·∫£ng.
                </p>
              </section>
            </div>
          </div>
        </div>
      </main>
      <Footer />
    </div>
  )
}
</file>

<file path="migrations/001_cleanup_profiles.sql">
-- Migration: Clean up profiles table structure
-- Remove unused columns and ensure proper schema

-- Step 1: Remove unused columns
ALTER TABLE public.profiles
  DROP COLUMN IF EXISTS role_selected_at,
  DROP COLUMN IF EXISTS onboarding_completed_at;

-- Step 2: Ensure all required columns exist with correct types
-- Core fields
ALTER TABLE public.profiles
  ADD COLUMN IF NOT EXISTS display_name TEXT,
  ADD COLUMN IF NOT EXISTS avatar_url TEXT,
  ADD COLUMN IF NOT EXISTS country TEXT,
  ADD COLUMN IF NOT EXISTS city TEXT,
  ADD COLUMN IF NOT EXISTS birth_year INTEGER,
  ADD COLUMN IF NOT EXISTS updated_at TIMESTAMPTZ DEFAULT NOW();

-- Creator fields
ALTER TABLE public.profiles
  ADD COLUMN IF NOT EXISTS bio TEXT,
  ADD COLUMN IF NOT EXISTS creator_platforms JSONB DEFAULT '[]'::jsonb,
  ADD COLUMN IF NOT EXISTS followers_count INTEGER,
  ADD COLUMN IF NOT EXISTS avg_views INTEGER,
  ADD COLUMN IF NOT EXISTS content_categories JSONB DEFAULT '[]'::jsonb,
  ADD COLUMN IF NOT EXISTS success_collaboration_rate INTEGER CHECK (success_collaboration_rate >= 0 AND success_collaboration_rate <= 100),
  ADD COLUMN IF NOT EXISTS preferred_collaboration_type JSONB DEFAULT '[]'::jsonb;

-- Brand fields
ALTER TABLE public.profiles
  ADD COLUMN IF NOT EXISTS company_name TEXT,
  ADD COLUMN IF NOT EXISTS website TEXT,
  ADD COLUMN IF NOT EXISTS industry TEXT,
  ADD COLUMN IF NOT EXISTS company_size TEXT,
  ADD COLUMN IF NOT EXISTS campaign_budget_range TEXT,
  ADD COLUMN IF NOT EXISTS campaign_goal TEXT,
  ADD COLUMN IF NOT EXISTS target_platforms JSONB DEFAULT '[]'::jsonb,
  ADD COLUMN IF NOT EXISTS target_creator_size TEXT,
  ADD COLUMN IF NOT EXISTS contact_person_name TEXT,
  ADD COLUMN IF NOT EXISTS contact_person_phone TEXT;

-- Step 3: Remove old columns that are no longer needed
ALTER TABLE public.profiles
  DROP COLUMN IF EXISTS collaboration_expectation,
  DROP COLUMN IF EXISTS collaboration_success_rate,
  DROP COLUMN IF EXISTS budget,
  DROP COLUMN IF EXISTS contact_person_email;

-- Step 4: Create function to upsert profile on first login
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.profiles (id, role, onboarding_completed)
  VALUES (NEW.id, NULL, false)
  ON CONFLICT (id) DO NOTHING;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- Step 5: Create trigger (if not exists)
DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW
  EXECUTE FUNCTION public.handle_new_user();

-- Step 6: Update RLS policies
-- Users can read their own profile
DROP POLICY IF EXISTS "Users can read own profile" ON public.profiles;
CREATE POLICY "Users can read own profile"
  ON public.profiles
  FOR SELECT
  USING (auth.uid() = id);

-- Users can update their own profile
DROP POLICY IF EXISTS "Users can update own profile" ON public.profiles;
CREATE POLICY "Users can update own profile"
  ON public.profiles
  FOR UPDATE
  USING (auth.uid() = id);

-- Users can insert their own profile
DROP POLICY IF EXISTS "Users can insert own profile" ON public.profiles;
CREATE POLICY "Users can insert own profile"
  ON public.profiles
  FOR INSERT
  WITH CHECK (auth.uid() = id);

-- Step 7: Ensure updated_at is updated on change
CREATE OR REPLACE FUNCTION public.update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS update_profiles_updated_at ON public.profiles;
CREATE TRIGGER update_profiles_updated_at
  BEFORE UPDATE ON public.profiles
  FOR EACH ROW
  EXECUTE FUNCTION public.update_updated_at_column();
</file>

<file path="src/components/dashboard/DashboardLayout.tsx">
import { Link, useLocation } from 'react-router-dom'
import { 
  FaTh, 
  FaUser, 
  FaDollarSign, 
  FaLightbulb, 
  FaFileAlt, 
  FaCheckCircle, 
  FaChartBar,
  FaCog,
  FaSignOutAlt,
} from 'react-icons/fa'
import { useAuth } from '../../hooks/useAuth'
import DashboardHeader from './DashboardHeader'

interface DashboardLayoutProps {
  children: React.ReactNode
}

export default function DashboardLayout({ children }: DashboardLayoutProps) {
  const location = useLocation()
  const { signOut } = useAuth()

  // Main navigation items
  const mainNavItems = [
    { path: '/dashboard', label: 'B·∫£ng ƒëi·ªÅu khi·ªÉn', icon: FaTh },
    { path: '/dashboard/profile', label: 'H·ªì s∆° c√° nh√¢n', icon: FaUser },
    { path: '/dashboard/services', label: 'D·ªãch v·ª• & B·∫£ng gi√°', icon: FaDollarSign },
    { path: '/dashboard/opportunities', label: 'C∆° h·ªôi', icon: FaLightbulb },
    { path: '/dashboard/proposals', label: 'ƒê·ªÅ xu·∫•t', icon: FaFileAlt },
    { path: '/dashboard/workspace', label: 'Trung t√¢m l√†m vi·ªác', icon: FaCheckCircle },
    { path: '/dashboard/analytics', label: 'Ph√¢n t√≠ch', icon: FaChartBar },
  ]

  // Account section items
  const accountItems = [
    { path: '/dashboard/settings', label: 'C√†i ƒë·∫∑t', icon: FaCog },
  ]

  const isActive = (path: string) => {
    if (path === '/dashboard') {
      return location.pathname === '/dashboard'
    }
    return location.pathname.startsWith(path)
  }

  return (
    <>
      <DashboardHeader />
      <div className="min-h-screen bg-gray-50 pt-16">
        <div className="flex">
          {/* Sidebar */}
          <aside className="fixed left-0 top-16 bottom-0 w-64 bg-white border-r border-gray-200 overflow-y-auto">
            <div className="p-4 h-full flex flex-col">
              {/* Main Navigation Items */}
              <nav className="space-y-1">
                {mainNavItems.map((item) => {
                  const Icon = item.icon
                  const active = isActive(item.path)

                  return (
                    <Link
                      key={item.path}
                      to={item.path}
                      className={`
                        flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors
                        ${active 
                          ? 'bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white' 
                          : 'text-gray-700 hover:bg-gray-100'
                        }
                      `}
                    >
                      <Icon className="w-5 h-5" />
                      <span>{item.label}</span>
                    </Link>
                  )
                })}
              </nav>

              {/* Account Section - Pinned to Bottom */}
              <div className="mt-auto pt-4 border-t border-gray-200">
                <nav className="space-y-1">
                  {accountItems.map((item) => {
                    const Icon = item.icon
                    const active = isActive(item.path)

                    return (
                      <Link
                        key={item.path}
                        to={item.path}
                        className={`
                          flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors
                          ${active
                            ? 'bg-gray-100 text-[#6366F1]'
                            : 'text-gray-700 hover:bg-gray-100'
                          }
                        `}
                      >
                        <Icon className="w-5 h-5" />
                        <span>{item.label}</span>
                      </Link>
                    )})}
                  <button
                    onClick={async () => {
                      await signOut()
                    }}
                    className="flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-red-600 hover:bg-red-50 hover:text-red-700 transition-colors w-full text-left"
                  >
                    <FaSignOutAlt className="w-5 h-5 text-red-600" />
                    <span>ƒêƒÉng xu·∫•t</span>
                  </button>
                </nav>
              </div>
            </div>
          </aside>

          {/* Main Content */}
          <main className="flex-1 ml-64">
            {children}
          </main>
        </div>
      </div>
    </>
  )
}
</file>

<file path="src/components/dashboard/NotificationModal.tsx">
import { useState, useEffect } from 'react'
import { FaCheck, FaCheckCircle, FaTimes } from 'react-icons/fa'

// Mock notification data - replace with real API data later
interface Notification {
  id: string
  type: 'proposal' | 'booking' | 'approval' | 'comment' | 'campaign' | 'profile' | 'collaboration'
  avatar: string
  content: string
  time: string
  timeAgo: string
  read: boolean
  ctaLabel: string
  ctaAction?: () => void
  section: 'new' | 'thisWeek' | 'earlier'
}

const MOCK_NOTIFICATIONS: Notification[] = [
  {
    id: '1',
    type: 'proposal',
    avatar: 'https://ui-avatars.com/api/?name=Brand+X&background=6366F1&color=fff',
    content: 'Brand X ƒë√£ g·ª≠i cho b·∫°n m·ªôt ƒë·ªÅ xu·∫•t m·ªõi cho ƒë·ªÅ xu·∫•t Winter Car c·ªßa h·ªç',
    time: '2025-01-20T10:00:00Z',
    timeAgo: '5 ph√∫t tr∆∞·ªõc',
    read: false,
    ctaLabel: 'Xem ƒë·ªÅ xu·∫•t',
    section: 'new'
  },
  {
    id: '2',
    type: 'booking',
    avatar: 'https://ui-avatars.com/api/?name=Sarah+Chen&background=EC4899&color=fff',
    content: 'Sarah Chen ƒë√£ ch·∫•p nh·∫≠n y√™u c·∫ßu ƒë·∫∑t l·ªãch c·ªßa b·∫°n cho bu·ªïi ch·ª•p ·∫£nh',
    time: '2025-01-20T09:00:00Z',
    timeAgo: '1 gi·ªù tr∆∞·ªõc',
    read: false,
    ctaLabel: 'Qu·∫£n l√Ω l·ªãch',
    section: 'new'
  },
  {
    id: '3',
    type: 'profile',
    avatar: 'https://ui-avatars.com/api/?name=Profile&background=8B5CF6&color=fff',
    content: 'H·ªì s∆° c·ªßa b·∫°n ƒë√£ ƒë·∫°t 1000 l∆∞·ª£t xem trong tu·∫ßn n√†y! H√£y ti·∫øp t·ª•c ph√°t huy.',
    time: '2025-01-20T07:00:00Z',
    timeAgo: '3 gi·ªù tr∆∞·ªõc',
    read: false,
    ctaLabel: '',
    section: 'new'
  },
  {
    id: '4',
    type: 'approval',
    avatar: 'https://ui-avatars.com/api/?name=Alpha+Corp&background=6366F1&color=fff',
    content: 'Alpha Corp c·∫ßn b·∫°n ph√™ duy·ªát b·∫£n nh√°p m·ªõi nh·∫•t cho "Project Zenith"',
    time: '2025-01-19T15:00:00Z',
    timeAgo: 'H√¥m qua',
    read: true,
    ctaLabel: 'Ph√™ duy·ªát b·∫£n nh√°p',
    section: 'thisWeek'
  },
  {
    id: '5',
    type: 'comment',
    avatar: 'https://ui-avatars.com/api/?name=Emily+White&background=EC4899&color=fff',
    content: 'Emily White ƒë√£ b√¨nh lu·∫≠n v·ªÅ b·∫£n nh√°p b·∫°n v·ª´a t·∫£i l√™n',
    time: '2025-01-19T10:00:00Z',
    timeAgo: 'H√¥m qua',
    read: true,
    ctaLabel: 'Xem b√¨nh lu·∫≠n',
    section: 'thisWeek'
  },
  {
    id: '6',
    type: 'campaign',
    avatar: 'https://ui-avatars.com/api/?name=Global+Brands&background=6366F1&color=fff',
    content: 'Global Brands Inc. ƒë√£ ƒëƒÉng c∆° h·ªôi chi·∫øn d·ªãch m·ªõi: "Summer Collec Campaign"',
    time: '2025-01-18T14:00:00Z',
    timeAgo: '2 ng√†y tr∆∞·ªõc',
    read: true,
    ctaLabel: 'Xem chi·∫øn d·ªãch',
    section: 'thisWeek'
  },
  {
    id: '7',
    type: 'approval',
    avatar: 'https://ui-avatars.com/api/?name=Creative+Studio&background=8B5CF6&color=fff',
    content: 'Creative Studio ƒë√£ ph√™ duy·ªát s·∫£n ph·∫©m c·ªßa b·∫°n cho "Animated Explainer Project"',
    time: '2025-01-17T11:00:00Z',
    timeAgo: '3 ng√†y tr∆∞·ªõc',
    read: true,
    ctaLabel: 'Xem th·ªèa thu·∫≠n',
    section: 'thisWeek'
  },
  {
    id: '8',
    type: 'collaboration',
    avatar: 'https://ui-avatars.com/api/?name=Jessica+Lee&background=EC4899&color=fff',
    content: 'Jessica Lee ƒë√£ m·ªùi b·∫°n c·ªông t√°c trong "Brand Launch Event"',
    time: '2025-01-13T09:00:00Z',
    timeAgo: '1 tu·∫ßn tr∆∞·ªõc',
    read: true,
    ctaLabel: 'Ch·∫•p nh·∫≠n l·ªùi m·ªùi',
    section: 'earlier'
  },
]

const FILTER_TABS = [
  { id: 'all', label: 'T·∫•t c·∫£' },
  { id: 'unread', label: 'Ch∆∞a ƒë·ªçc' },
  { id: 'proposals', label: 'ƒê·ªÅ xu·∫•t' },
  { id: 'bookings', label: 'ƒê·∫∑t l·ªãch' },
  { id: 'drafts', label: 'B·∫£n nh√°p' },
  { id: 'approvals', label: 'Ph√™ duy·ªát' },
] as const

type FilterTab = typeof FILTER_TABS[number]['id']

interface NotificationModalProps {
  isOpen: boolean
  onClose: () => void
}

export default function NotificationModal({ isOpen, onClose }: NotificationModalProps) {
  const [activeFilter, setActiveFilter] = useState<FilterTab>('all')
  const [notifications, setNotifications] = useState<Notification[]>(MOCK_NOTIFICATIONS)

  // Handle Esc key to close modal
  useEffect(() => {
    if (!isOpen) return

    const handleEscKey = (event: KeyboardEvent) => {
      if (event.key === 'Escape') {
        onClose()
      }
    }

    document.addEventListener('keydown', handleEscKey)
    return () => {
      document.removeEventListener('keydown', handleEscKey)
    }
  }, [isOpen, onClose])

  const unreadCount = notifications.filter(n => !n.read).length

  const filteredNotifications = notifications.filter((notification) => {
    if (activeFilter === 'all') return true
    if (activeFilter === 'unread') return !notification.read
    if (activeFilter === 'proposals') return notification.type === 'proposal'
    if (activeFilter === 'bookings') return notification.type === 'booking'
    if (activeFilter === 'drafts') return notification.type === 'comment'
    if (activeFilter === 'approvals') return notification.type === 'approval'
    return true
  })

  const markAllAsRead = () => {
    setNotifications(prev => prev.map(n => ({ ...n, read: true })))
  }

  const markAsRead = (id: string) => {
    setNotifications(prev => prev.map(n => n.id === id ? { ...n, read: true } : n))
  }

  const newNotifications = filteredNotifications.filter(n => n.section === 'new')
  const thisWeekNotifications = filteredNotifications.filter(n => n.section === 'thisWeek')
  const earlierNotifications = filteredNotifications.filter(n => n.section === 'earlier')

  if (!isOpen) return null

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50" onClick={onClose}>
      <div 
        className="bg-white rounded-xl shadow-2xl w-[1000px] h-[80vh] flex flex-col mx-4"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Modal Header - Sticky */}
        <div className="flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0">
          <h2 className="text-xl font-bold text-gray-900">Th√¥ng b√°o</h2>
          <button
            onClick={onClose}
            className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
          >
            <FaTimes className="w-5 h-5 text-gray-500" />
          </button>
        </div>

        {/* Filter Tabs - Sticky */}
        <div className="flex items-center gap-2 p-4 border-b border-gray-200 flex-shrink-0 overflow-x-auto">
          {FILTER_TABS.map((tab) => (
            <button
              key={tab.id}
              onClick={() => setActiveFilter(tab.id)}
              className={`
                px-4 py-2 rounded-full text-sm font-medium transition-colors whitespace-nowrap flex items-center gap-2
                ${activeFilter === tab.id
                  ? 'bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white'
                  : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50'
                }
              `}
            >
              <span>{tab.label}</span>
              {tab.id === 'unread' && unreadCount > 0 && (
                <span className={`
                  w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold
                  ${activeFilter === tab.id 
                    ? 'bg-white text-[#6366F1]' 
                    : 'bg-[#6366F1] text-white'
                  }
                `}>
                  {unreadCount}
                </span>
              )}
            </button>
          ))}

          {/* Mark all as read button */}
          <button
            onClick={markAllAsRead}
            className="ml-auto flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:text-[#6366F1] transition-colors border-2 border-gray-300 rounded-lg hover:border-[#6366F1] hover:bg-gray-50 active:bg-gray-100 whitespace-nowrap"
          >
            <FaCheckCircle className="w-4 h-4" />
            <span>ƒê√°nh d·∫•u t·∫•t c·∫£ l√† ƒë√£ ƒë·ªçc</span>
          </button>
        </div>

        {/* Scrollable Notification List */}
        <div className="flex-1 overflow-y-auto p-4">
          <div className="space-y-6">
            {/* New Section */}
            {newNotifications.length > 0 && (
              <div>
                <h3 className="text-xs font-semibold text-gray-500 mb-3 uppercase tracking-wide">M·ªõi</h3>
                <div className="space-y-3">
                  {newNotifications.map((notification) => (
                    <NotificationCard
                      key={notification.id}
                      notification={notification}
                      onMarkAsRead={() => markAsRead(notification.id)}
                    />
                  ))}
                </div>
              </div>
            )}

            {/* This Week Section */}
            {thisWeekNotifications.length > 0 && (
              <div>
                <h3 className="text-xs font-semibold text-gray-500 mb-3 uppercase tracking-wide">Tu·∫ßn n√†y</h3>
                <div className="space-y-3">
                  {thisWeekNotifications.map((notification) => (
                    <NotificationCard
                      key={notification.id}
                      notification={notification}
                      onMarkAsRead={() => markAsRead(notification.id)}
                    />
                  ))}
                </div>
              </div>
            )}

            {/* Earlier Section */}
            {earlierNotifications.length > 0 && (
              <div>
                <h3 className="text-xs font-semibold text-gray-500 mb-3 uppercase tracking-wide">Tr∆∞·ªõc ƒë√≥</h3>
                <div className="space-y-3">
                  {earlierNotifications.map((notification) => (
                    <NotificationCard
                      key={notification.id}
                      notification={notification}
                      onMarkAsRead={() => markAsRead(notification.id)}
                    />
                  ))}
                </div>
              </div>
            )}

            {/* Empty State */}
            {filteredNotifications.length === 0 && (
              <div className="text-center py-12">
                <p className="text-gray-500">Kh√¥ng c√≥ th√¥ng b√°o n√†o</p>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  )
}

interface NotificationCardProps {
  notification: Notification
  onMarkAsRead: () => void
}

function NotificationCard({ notification, onMarkAsRead }: NotificationCardProps) {
  return (
    <div
      className={`
        flex items-start gap-4 p-4 rounded-xl border transition-colors
        ${notification.read 
          ? 'bg-white border-gray-200' 
          : 'bg-blue-50 border-blue-200'
        }
        hover:shadow-md
      `}
    >
      {/* Avatar */}
      <img
        src={notification.avatar}
        alt=""
        className="w-12 h-12 rounded-full flex-shrink-0"
      />

      {/* Content */}
      <div className="flex-1 min-w-0">
        <p className={`text-sm ${notification.read ? 'text-gray-700' : 'text-gray-900 font-medium'}`}>
          {notification.content}
        </p>
        <p className="text-xs text-gray-500 mt-1">{notification.timeAgo}</p>
      </div>

      {/* Actions */}
      <div className="flex items-start gap-3 flex-shrink-0">
        {notification.ctaLabel && (
          <button
            onClick={onMarkAsRead}
            className="px-4 py-2 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white text-sm font-medium rounded-lg hover:opacity-90 transition-opacity whitespace-nowrap"
          >
            {notification.ctaLabel}
          </button>
        )}
        <button
          onClick={onMarkAsRead}
          className={`
            p-2 rounded-lg transition-colors
            ${notification.read 
              ? 'text-gray-400 hover:bg-gray-100' 
              : 'text-[#6366F1] hover:bg-blue-100'
            }
          `}
          title={notification.read ? 'ƒê√£ ƒë·ªçc' : 'ƒê√°nh d·∫•u l√† ƒë√£ ƒë·ªçc'}
        >
          <FaCheck className="w-4 h-4" />
        </button>
      </div>
    </div>
  )
}
</file>

<file path="src/components/layout/Footer.tsx">
import { Link } from 'react-router-dom'
import { FaFacebook, FaInstagram, FaTiktok, FaYoutube, FaLinkedin, FaPhone, FaEnvelope, FaMapMarkerAlt } from 'react-icons/fa'

export default function Footer() {
  return (
    <footer className="relative pt-20 pb-8 bg-white border-t border-black/5">
      <div className="max-w-7xl mx-auto px-6">
        <div className="grid md:grid-cols-5 gap-12 mb-8">
          <div className="space-y-4">
            <div className="flex items-center gap-3">
              <img
                src="/logo/logo.png"
                alt="ALINO"
                className="w-7 h-7"
              />
              <span className="font-semibold text-lg tracking-tight bg-gradient-to-r from-[#6366F1] to-[#EC4899] bg-clip-text text-transparent">
                ALINO
              </span>
            </div>
            <p className="text-sm text-[#6B7280] leading-relaxed">
              N·ªÅn t·∫£ng h·ª£p t√°c cho Creator v√† Brand chuy√™n nghi·ªáp.
            </p>
            <div className="flex items-center gap-4 pt-2">
              <a
                href="https://facebook.com"
                target="_blank"
                rel="noopener noreferrer"
                className="text-[#9CA3AF] hover:text-[#1877F2] transition-colors hover:scale-110 transform duration-200"
              >
                <FaFacebook size={20} />
              </a>
              <a
                href="https://instagram.com"
                target="_blank"
                rel="noopener noreferrer"
                className="text-[#9CA3AF] hover:text-[#DD2A7B] transition-colors hover:scale-110 transform duration-200"
              >
                <FaInstagram size={20} />
              </a>
              <a
                href="https://tiktok.com"
                target="_blank"
                rel="noopener noreferrer"
                className="text-[#9CA3AF] hover:text-[#000000] transition-colors hover:scale-110 transform duration-200"
              >
                <FaTiktok size={20} />
              </a>
              <a
                href="https://youtube.com"
                target="_blank"
                rel="noopener noreferrer"
                className="text-[#9CA3AF] hover:text-[#FF0000] transition-colors hover:scale-110 transform duration-200"
              >
                <FaYoutube size={20} />
              </a>
              <a
                href="https://linkedin.com"
                target="_blank"
                rel="noopener noreferrer"
                className="text-[#9CA3AF] hover:text-[#0A66C2] transition-colors hover:scale-110 transform duration-200"
              >
                <FaLinkedin size={20} />
              </a>
            </div>
          </div>

          <div>
            <h4 className="font-semibold text-sm mb-4 tracking-tight">S·∫£n ph·∫©m</h4>
            <ul className="space-y-3 text-sm text-[#6B7280]">
              <li>
                <a href="#product" className="hover:text-[#6366F1] transition-colors">
                  T√≠nh nƒÉng
                </a>
              </li>
              <li>
                <a href="#pricing" className="hover:text-[#6366F1] transition-colors">
                  B·∫£ng gi√°
                </a>
              </li>
              <li>
                <a href="#how-it-works" className="hover:text-[#6366F1] transition-colors">
                  C√°ch ho·∫°t ƒë·ªông
                </a>
              </li>
            </ul>
          </div>

          <div>
            <h4 className="font-semibold text-sm mb-4 tracking-tight">C√¥ng ty</h4>
            <ul className="space-y-3 text-sm text-[#6B7280]">
              <li>
                <a href="#about" className="hover:text-[#6366F1] transition-colors">
                  V·ªÅ ch√∫ng t√¥i
                </a>
              </li>
              <li>
                <a href="#news" className="hover:text-[#6366F1] transition-colors">
                  Tin t·ª©c
                </a>
              </li>
              <li>
                <a href="#contact" className="hover:text-[#6366F1] transition-colors">
                  Li√™n h·ªá
                </a>
              </li>
            </ul>
          </div>

          <div>
            <h4 className="font-semibold text-sm mb-4 tracking-tight">Ph√°p l√Ω</h4>
            <ul className="space-y-3 text-sm text-[#6B7280]">
              <li>
                <Link to="/terms" className="hover:text-[#6366F1] transition-colors">
                  ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng
                </Link>
              </li>
              <li>
                <Link to="/privacy" className="hover:text-[#6366F1] transition-colors">
                  Ch√≠nh s√°ch b·∫£o m·∫≠t
                </Link>
              </li>
            </ul>
          </div>

          <div>
            <h4 className="font-semibold text-sm mb-4 tracking-tight">Li√™n h·ªá</h4>
            <ul className="space-y-3 text-sm text-[#6B7280]">
              <li className="flex items-start gap-3">
                <FaPhone className="mt-0.5 flex-shrink-0" size={16} />
                <a href="tel:+84707970216" className="hover:text-[#6366F1] transition-colors">
                  +84 707 970 216
                </a>
              </li>
              <li className="flex items-start gap-3">
                <FaEnvelope className="mt-0.5 flex-shrink-0" size={16} />
                <a href="mailto:contact@alino.net" className="hover:text-[#6366F1] transition-colors">
                  contact@alino.net
                </a>
              </li>
              <li className="flex items-start gap-3 leading-relaxed">
                <FaMapMarkerAlt className="mt-0.5 flex-shrink-0" size={16} />
                <span>
                  Landmark 81
                  <br />
                  720A ƒêi·ªán Bi√™n Ph·ªß, Ph∆∞·ªùng 22, Qu·∫≠n B√¨nh Th·∫°nh, TP. H·ªì Ch√≠ Minh, Vi·ªát Nam
                </span>
              </li>
            </ul>
          </div>
        </div>

        <div className="pt-8 border-t border-black/5 text-center text-sm text-[#9CA3AF]">
          ¬© 2025 ALINO. All rights reserved.
        </div>
      </div>
    </footer>
  )
}
</file>

<file path="src/components/ScrollToTop.tsx">
import { useEffect } from 'react'
import { useLocation } from 'react-router-dom'

/**
 * ScrollToTop component that scrolls to top on every route change.
 * This ensures that navigating between pages always starts at the top.
 */
export default function ScrollToTop() {
  const { pathname } = useLocation()

  useEffect(() => {
    window.scrollTo(0, 0)
  }, [pathname])

  return null
}
</file>

<file path="src/components/Toast.tsx">
import { useEffect } from 'react'

interface ToastProps {
  message: string
  type: 'success' | 'error'
  onClose: () => void
  duration?: number
}

export default function Toast({ message, type, onClose, duration = 3000 }: ToastProps) {
  useEffect(() => {
    const timer = setTimeout(() => {
      onClose()
    }, duration)

    return () => clearTimeout(timer)
  }, [duration, onClose])

  return (
    <div className="fixed top-4 right-4 z-50" style={{ animation: 'slideIn 0.3s ease-out' }}>
      <div
        className={`px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 min-w-[300px] ${
          type === 'success'
            ? 'bg-green-50 border border-green-200 text-green-800'
            : 'bg-red-50 border border-red-200 text-red-800'
        }`}
      >
        {type === 'success' ? (
          <svg className="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        ) : (
          <svg className="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        )}
        <span className="text-sm font-medium">{message}</span>
      </div>
    </div>
  )
}
</file>

<file path="src/lib/supabase.ts">
import { createClient } from '@supabase/supabase-js'
import type { SupabaseClient } from '@supabase/supabase-js'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables')
}

let supabaseClient: SupabaseClient | null = null

export function getSupabase() {
  if (!supabaseClient) {
    supabaseClient = createClient(supabaseUrl, supabaseAnonKey, {
      auth: {
        persistSession: true,
        autoRefreshToken: true,
        detectSessionInUrl: true,
      },
    })
  }

  return supabaseClient
}
</file>

<file path="src/pages/BrandDashboard.tsx">
export default function BrandDashboard() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-[#EEF1FF] via-[#F5F7FF] to-white py-20 px-6 pt-24">
      <div className="max-w-7xl mx-auto">
        <div className="bg-white/90 backdrop-blur-xl rounded-3xl p-12 shadow-xl border border-black/5 text-center">
          <h1 className="text-4xl font-semibold tracking-tight mb-4">
            Brand Dashboard
          </h1>
          <p className="text-lg text-[#6B7280]">
            Trang n√†y ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn
          </p>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/ComingSoonPage.tsx">
/**
 * Placeholder page for unfinished dashboard features
 * Title and subtitle are shown in Header, this page shows feature content only
 */
export default function ComingSoonPage() {
  return (
    <div className="min-h-screen bg-white">
      <div className="max-w-6xl mx-auto p-8">
        <div className="text-center py-20">
          <p className="text-lg text-gray-600">
            T√≠nh nƒÉng ƒëang x√¢y d·ª±ng
          </p>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/CreatorDashboard.tsx">
export default function CreatorDashboard() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-[#EEF1FF] via-[#F5F7FF] to-white py-20 px-6 pt-24">
      <div className="max-w-7xl mx-auto">
        <div className="bg-white/90 backdrop-blur-xl rounded-3xl p-12 shadow-xl border border-black/5 text-center">
          <h1 className="text-4xl font-semibold tracking-tight mb-4">
            Creator Dashboard
          </h1>
          <p className="text-lg text-[#6B7280]">
            Trang n√†y ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn
          </p>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/Dashboard.tsx">
import { useLocation } from 'react-router-dom'
import DashboardLayout from '../components/dashboard/DashboardLayout'
import DashboardHome from './DashboardHome'
import ComingSoonPage from './ComingSoonPage'
import ProfilePage from './ProfilePage'
import SettingsPage from './SettingsPage'

/**
 * Unified Dashboard component that works for both Creator and Brand roles.
 * Routes to appropriate page based on current pathname.
 */
export default function Dashboard() {
  const location = useLocation()
  
  // Dashboard home - show greeting
  if (location.pathname === '/dashboard') {
    return (
      <DashboardLayout>
        <DashboardHome />
      </DashboardLayout>
    )
  }
  
  // Profile page
  if (location.pathname === '/dashboard/profile') {
    return (
      <DashboardLayout>
        <ProfilePage />
      </DashboardLayout>
    )
  }
  
  // Settings page
  if (location.pathname === '/dashboard/settings') {
    return (
      <DashboardLayout>
        <SettingsPage />
      </DashboardLayout>
    )
  }
  
  // All other dashboard routes show coming soon
  return (
    <DashboardLayout>
      <ComingSoonPage />
    </DashboardLayout>
  )
}
</file>

<file path="src/pages/DashboardHome.tsx">
/**
 * Dashboard Home page - shown when user clicks "B·∫£ng ƒëi·ªÅu khi·ªÉn"
 * Title and subtitle are shown in Header, this page contains feature content only
 */
export default function DashboardHome() {
  return (
    <div className="min-h-screen bg-white">
      <div className="max-w-6xl mx-auto p-8">
        {/* Feature content goes here - title/subtitle are in Header */}
      </div>
    </div>
  )
}
</file>

<file path="src/pages/NotificationsPage.tsx">
import { useState } from 'react'
import { FaCheck, FaCheckCircle } from 'react-icons/fa'

// Mock notification data - replace with real API data later
interface Notification {
  id: string
  type: 'proposal' | 'booking' | 'approval' | 'comment' | 'campaign' | 'profile' | 'collaboration'
  avatar: string
  content: string
  time: string
  timeAgo: string
  read: boolean
  ctaLabel: string
  ctaAction?: () => void
  section: 'new' | 'thisWeek' | 'earlier'
}

const MOCK_NOTIFICATIONS: Notification[] = [
  {
    id: '1',
    type: 'proposal',
    avatar: 'https://ui-avatars.com/api/?name=Brand+X&background=6366F1&color=fff',
    content: 'Brand X ƒë√£ g·ª≠i cho b·∫°n m·ªôt ƒë·ªÅ xu·∫•t m·ªõi cho ƒë·ªÅ xu·∫•t Winter Car c·ªßa h·ªç',
    time: '2025-01-20T10:00:00Z',
    timeAgo: '5 ph√∫t tr∆∞·ªõc',
    read: false,
    ctaLabel: 'Xem ƒë·ªÅ xu·∫•t',
    section: 'new'
  },
  {
    id: '2',
    type: 'booking',
    avatar: 'https://ui-avatars.com/api/?name=Sarah+Chen&background=EC4899&color=fff',
    content: 'Sarah Chen ƒë√£ ch·∫•p nh·∫≠n y√™u c·∫ßu ƒë·∫∑t l·ªãch c·ªßa b·∫°n cho bu·ªïi ch·ª•p ·∫£nh',
    time: '2025-01-20T09:00:00Z',
    timeAgo: '1 gi·ªù tr∆∞·ªõc',
    read: false,
    ctaLabel: 'Qu·∫£n l√Ω l·ªãch',
    section: 'new'
  },
  {
    id: '3',
    type: 'profile',
    avatar: 'https://ui-avatars.com/api/?name=Profile&background=8B5CF6&color=fff',
    content: 'H·ªì s∆° c·ªßa b·∫°n ƒë√£ ƒë·∫°t 1000 l∆∞·ª£t xem trong tu·∫ßn n√†y! H√£y ti·∫øp t·ª•c ph√°t huy.',
    time: '2025-01-20T07:00:00Z',
    timeAgo: '3 gi·ªù tr∆∞·ªõc',
    read: false,
    ctaLabel: '',
    section: 'new'
  },
  {
    id: '4',
    type: 'approval',
    avatar: 'https://ui-avatars.com/api/?name=Alpha+Corp&background=6366F1&color=fff',
    content: 'Alpha Corp c·∫ßn b·∫°n ph√™ duy·ªát b·∫£n nh√°p m·ªõi nh·∫•t cho "Project Zenith"',
    time: '2025-01-19T15:00:00Z',
    timeAgo: 'H√¥m qua',
    read: true,
    ctaLabel: 'Ph√™ duy·ªát b·∫£n nh√°p',
    section: 'thisWeek'
  },
  {
    id: '5',
    type: 'comment',
    avatar: 'https://ui-avatars.com/api/?name=Emily+White&background=EC4899&color=fff',
    content: 'Emily White ƒë√£ b√¨nh lu·∫≠n v·ªÅ b·∫£n nh√°p b·∫°n v·ª´a t·∫£i l√™n',
    time: '2025-01-19T10:00:00Z',
    timeAgo: 'H√¥m qua',
    read: true,
    ctaLabel: 'Xem b√¨nh lu·∫≠n',
    section: 'thisWeek'
  },
  {
    id: '6',
    type: 'campaign',
    avatar: 'https://ui-avatars.com/api/?name=Global+Brands&background=6366F1&color=fff',
    content: 'Global Brands Inc. ƒë√£ ƒëƒÉng c∆° h·ªôi chi·∫øn d·ªãch m·ªõi: "Summer Collec Campaign"',
    time: '2025-01-18T14:00:00Z',
    timeAgo: '2 ng√†y tr∆∞·ªõc',
    read: true,
    ctaLabel: 'Xem chi·∫øn d·ªãch',
    section: 'thisWeek'
  },
  {
    id: '7',
    type: 'approval',
    avatar: 'https://ui-avatars.com/api/?name=Creative+Studio&background=8B5CF6&color=fff',
    content: 'Creative Studio ƒë√£ ph√™ duy·ªát s·∫£n ph·∫©m c·ªßa b·∫°n cho "Animated Explainer Project"',
    time: '2025-01-17T11:00:00Z',
    timeAgo: '3 ng√†y tr∆∞·ªõc',
    read: true,
    ctaLabel: 'Xem th·ªèa thu·∫≠n',
    section: 'thisWeek'
  },
  {
    id: '8',
    type: 'collaboration',
    avatar: 'https://ui-avatars.com/api/?name=Jessica+Lee&background=EC4899&color=fff',
    content: 'Jessica Lee ƒë√£ m·ªùi b·∫°n c·ªông t√°c trong "Brand Launch Event"',
    time: '2025-01-13T09:00:00Z',
    timeAgo: '1 tu·∫ßn tr∆∞·ªõc',
    read: true,
    ctaLabel: 'Ch·∫•p nh·∫≠n l·ªùi m·ªùi',
    section: 'earlier'
  },
]

const FILTER_TABS = [
  { id: 'all', label: 'T·∫•t c·∫£' },
  { id: 'unread', label: 'Ch∆∞a ƒë·ªçc' },
  { id: 'proposals', label: 'ƒê·ªÅ xu·∫•t' },
  { id: 'bookings', label: 'ƒê·∫∑t l·ªãch' },
  { id: 'drafts', label: 'B·∫£n nh√°p' },
  { id: 'approvals', label: 'Ph√™ duy·ªát' },
] as const

type FilterTab = typeof FILTER_TABS[number]['id']

export default function NotificationsPage() {
  const [activeFilter, setActiveFilter] = useState<FilterTab>('all')
  const [notifications, setNotifications] = useState<Notification[]>(MOCK_NOTIFICATIONS)

  const unreadCount = notifications.filter(n => !n.read).length

  const filteredNotifications = notifications.filter((notification) => {
    if (activeFilter === 'all') return true
    if (activeFilter === 'unread') return !notification.read
    if (activeFilter === 'proposals') return notification.type === 'proposal'
    if (activeFilter === 'bookings') return notification.type === 'booking'
    if (activeFilter === 'drafts') return notification.type === 'comment'
    if (activeFilter === 'approvals') return notification.type === 'approval'
    return true
  })

  const markAllAsRead = () => {
    setNotifications(prev => prev.map(n => ({ ...n, read: true })))
  }

  const markAsRead = (id: string) => {
    setNotifications(prev => prev.map(n => n.id === id ? { ...n, read: true } : n))
  }

  const newNotifications = filteredNotifications.filter(n => n.section === 'new')
  const thisWeekNotifications = filteredNotifications.filter(n => n.section === 'thisWeek')
  const earlierNotifications = filteredNotifications.filter(n => n.section === 'earlier')

  return (
    <div className="min-h-screen bg-white">
      <div className="max-w-6xl mx-auto p-8">
        {/* Header */}
        <div className="mb-6">
          <h1 className="text-3xl font-bold text-gray-900 mb-6">Th√¥ng b√°o</h1>

          {/* Filter Tabs */}
          <div className="flex items-center gap-2 mb-4 flex-wrap">
            {FILTER_TABS.map((tab) => (
              <button
                key={tab.id}
                onClick={() => setActiveFilter(tab.id)}
                className={`
                  px-4 py-2 rounded-full text-sm font-medium transition-colors relative
                  ${activeFilter === tab.id
                    ? 'bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white'
                    : 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50'
                  }
                `}
              >
                {tab.label}
                {tab.id === 'unread' && unreadCount > 0 && (
                  <span className="ml-2 w-5 h-5 bg-white text-[#6366F1] rounded-full flex items-center justify-center text-xs font-bold">
                    {unreadCount}
                  </span>
                )}
              </button>
            ))}

            {/* Mark all as read button */}
            <button
              onClick={markAllAsRead}
              className="ml-auto flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:text-[#6366F1] transition-colors"
            >
              <FaCheckCircle className="w-4 h-4" />
              <span>ƒê√°nh d·∫•u t·∫•t c·∫£ l√† ƒë√£ ƒë·ªçc</span>
            </button>
          </div>
        </div>

        {/* Notifications List */}
        <div className="space-y-8">
          {/* New Section */}
          {newNotifications.length > 0 && (
            <div>
              <h2 className="text-sm font-semibold text-gray-500 mb-4 uppercase tracking-wide">M·ªõi</h2>
              <div className="space-y-3">
                {newNotifications.map((notification) => (
                  <NotificationCard
                    key={notification.id}
                    notification={notification}
                    onMarkAsRead={() => markAsRead(notification.id)}
                  />
                ))}
              </div>
            </div>
          )}

          {/* This Week Section */}
          {thisWeekNotifications.length > 0 && (
            <div>
              <h2 className="text-sm font-semibold text-gray-500 mb-4 uppercase tracking-wide">Tu·∫ßn n√†y</h2>
              <div className="space-y-3">
                {thisWeekNotifications.map((notification) => (
                  <NotificationCard
                    key={notification.id}
                    notification={notification}
                    onMarkAsRead={() => markAsRead(notification.id)}
                  />
                ))}
              </div>
            </div>
          )}

          {/* Earlier Section */}
          {earlierNotifications.length > 0 && (
            <div>
              <h2 className="text-sm font-semibold text-gray-500 mb-4 uppercase tracking-wide">Tr∆∞·ªõc ƒë√≥</h2>
              <div className="space-y-3">
                {earlierNotifications.map((notification) => (
                  <NotificationCard
                    key={notification.id}
                    notification={notification}
                    onMarkAsRead={() => markAsRead(notification.id)}
                  />
                ))}
              </div>
            </div>
          )}

          {/* Empty State */}
          {filteredNotifications.length === 0 && (
            <div className="text-center py-12">
              <p className="text-gray-500">Kh√¥ng c√≥ th√¥ng b√°o n√†o</p>
            </div>
          )}
        </div>
      </div>
    </div>
  )
}

interface NotificationCardProps {
  notification: Notification
  onMarkAsRead: () => void
}

function NotificationCard({ notification, onMarkAsRead }: NotificationCardProps) {
  return (
    <div
      className={`
        flex items-start gap-4 p-4 rounded-xl border transition-colors
        ${notification.read 
          ? 'bg-white border-gray-200' 
          : 'bg-blue-50 border-blue-200'
        }
        hover:shadow-md
      `}
    >
      {/* Avatar */}
      <img
        src={notification.avatar}
        alt=""
        className="w-12 h-12 rounded-full flex-shrink-0"
      />

      {/* Content */}
      <div className="flex-1 min-w-0">
        <p className={`text-sm ${notification.read ? 'text-gray-700' : 'text-gray-900 font-medium'}`}>
          {notification.content}
        </p>
        <p className="text-xs text-gray-500 mt-1">{notification.timeAgo}</p>
      </div>

      {/* Actions */}
      <div className="flex items-start gap-3 flex-shrink-0">
        {notification.ctaLabel && (
          <button
            onClick={onMarkAsRead}
            className="px-4 py-2 bg-gradient-to-r from-[#6366F1] to-[#EC4899] text-white text-sm font-medium rounded-lg hover:opacity-90 transition-opacity whitespace-nowrap"
          >
            {notification.ctaLabel}
          </button>
        )}
        <button
          onClick={onMarkAsRead}
          className={`
            p-2 rounded-lg transition-colors
            ${notification.read 
              ? 'text-gray-400 hover:bg-gray-100' 
              : 'text-[#6366F1] hover:bg-blue-100'
            }
          `}
          title={notification.read ? 'ƒê√£ ƒë·ªçc' : 'ƒê√°nh d·∫•u l√† ƒë√£ ƒë·ªçc'}
        >
          <FaCheck className="w-4 h-4" />
        </button>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/SettingsPage.tsx">
import { useState } from 'react'
import { Link } from 'react-router-dom'
import { useAuth } from '../hooks/useAuth'
import { useProfile } from '../hooks/useProfile'
import { FaGoogle, FaFacebook, FaInstagram, FaTiktok, FaCheckCircle, FaTimesCircle } from 'react-icons/fa'

export default function SettingsPage() {
  const { session } = useAuth()
  const { profile } = useProfile(session?.user?.id, !!session)
  const [currentPassword, setCurrentPassword] = useState('')
  const [newPassword, setNewPassword] = useState('')
  const [confirmPassword, setConfirmPassword] = useState('')
  const [passwordError, setPasswordError] = useState('')
  const [passwordLoading, setPasswordLoading] = useState(false)

  // Check if user is OAuth-only (no email/password)
  // Check if user has email provider or if all providers are OAuth
  const userProviders = session?.user?.app_metadata?.providers || []
  const hasEmailProvider = userProviders.includes('email') || session?.user?.email
  const isOAuthOnly = !hasEmailProvider && userProviders.length > 0

  // Get account created date
  const accountCreatedDate = session?.user?.created_at 
    ? new Date(session.user.created_at).toLocaleDateString('vi-VN', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      })
    : 'N/A'

  // Mock connected accounts - replace with real data later
  const connectedAccounts = [
    { name: 'Google', provider: 'google', connected: true, icon: FaGoogle },
    { name: 'Facebook', provider: 'facebook', connected: false, icon: FaFacebook },
    { name: 'Instagram', provider: 'instagram', connected: false, icon: FaInstagram },
    { name: 'TikTok', provider: 'tiktok', connected: false, icon: FaTiktok },
  ]

  const handleChangePassword = async () => {
    if (!currentPassword || !newPassword || !confirmPassword) {
      setPasswordError('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin')
      return
    }

    if (newPassword !== confirmPassword) {
      setPasswordError('M·∫≠t kh·∫©u m·ªõi kh√¥ng kh·ªõp')
      return
    }

    if (newPassword.length < 6) {
      setPasswordError('M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±')
      return
    }

    setPasswordError('')
    setPasswordLoading(true)

    try {
      // TODO: Implement password change logic
      // This would typically involve:
      // 1. Verify current password
      // 2. Update password via Supabase auth
      await new Promise(resolve => setTimeout(resolve, 1000))
      setPasswordError('')
      setCurrentPassword('')
      setNewPassword('')
      setConfirmPassword('')
      alert('ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng')
    } catch (error: any) {
      setPasswordError(error.message || 'C√≥ l·ªói x·∫£y ra khi ƒë·ªïi m·∫≠t kh·∫©u')
    } finally {
      setPasswordLoading(false)
    }
  }

  return (
    <div className="bg-gray-50 py-8 px-6">
      <div className="max-w-7xl mx-auto">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          
          {/* CARD 1: Account Information */}
          <div className="bg-white rounded-xl border border-gray-200 p-6">
            <h2 className="text-2xl font-semibold text-[#374151] mb-6">Th√¥ng tin t√†i kho·∫£n</h2>
            
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Email
                </label>
                <input
                  type="email"
                  value={session?.user?.email || ''}
                  disabled
                  className="w-full px-4 py-2.5 rounded-lg border border-gray-300 bg-gray-50 text-gray-600 cursor-not-allowed"
                />
                <p className="text-xs text-gray-500 mt-1">Email kh√¥ng th·ªÉ thay ƒë·ªïi</p>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ng√†y t·∫°o t√†i kho·∫£n
                </label>
                <p className="text-gray-700">{accountCreatedDate}</p>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-3">
                  T√†i kho·∫£n ƒë√£ k·∫øt n·ªëi
                </label>
                <div className="space-y-2">
                  {connectedAccounts.map((account) => {
                    const Icon = account.icon
                    return (
                      <div
                        key={account.provider}
                        className="flex items-center justify-between p-3 rounded-lg border border-gray-200"
                      >
                        <div className="flex items-center gap-3">
                          <Icon className="w-5 h-5 text-gray-600" />
                          <span className="text-sm font-medium text-gray-700">{account.name}</span>
                        </div>
                        <div className="flex items-center gap-2">
                          {account.connected ? (
                            <>
                              <FaCheckCircle className="w-4 h-4 text-green-600" />
                              <span className="text-sm text-green-600">ƒê√£ k·∫øt n·ªëi</span>
                            </>
                          ) : (
                            <>
                              <FaTimesCircle className="w-4 h-4 text-gray-400" />
                              <span className="text-sm text-gray-500">Ch∆∞a k·∫øt n·ªëi</span>
                            </>
                          )}
                        </div>
                      </div>
                    )
                  })}
                </div>
              </div>
            </div>
          </div>

          {/* CARD 2: Change Password */}
          <div className="bg-white rounded-xl border border-gray-200 p-6">
            <h2 className="text-2xl font-semibold text-[#374151] mb-6">ƒê·ªïi m·∫≠t kh·∫©u</h2>
            
            {isOAuthOnly ? (
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <p className="text-sm text-blue-800">
                  T√†i kho·∫£n c·ªßa b·∫°n ƒë∆∞·ª£c ƒëƒÉng nh·∫≠p qua OAuth. T√≠nh nƒÉng ƒë·ªïi m·∫≠t kh·∫©u kh√¥ng kh·∫£ d·ª•ng cho t√†i kho·∫£n n√†y.
                </p>
              </div>
            ) : (
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    M·∫≠t kh·∫©u hi·ªán t·∫°i
                  </label>
                  <input
                    type="password"
                    value={currentPassword}
                    onChange={(e) => setCurrentPassword(e.target.value)}
                    className="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#6366F1] focus:border-transparent"
                    placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    M·∫≠t kh·∫©u m·ªõi
                  </label>
                  <input
                    type="password"
                    value={newPassword}
                    onChange={(e) => setNewPassword(e.target.value)}
                    className="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#6366F1] focus:border-transparent"
                    placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi
                  </label>
                  <input
                    type="password"
                    value={confirmPassword}
                    onChange={(e) => setConfirmPassword(e.target.value)}
                    className="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#6366F1] focus:border-transparent"
                    placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi"
                  />
                </div>

                {passwordError && (
                  <div className="text-sm text-red-600 bg-red-50 border border-red-200 rounded-lg p-3">
                    {passwordError}
                  </div>
                )}

                <button
                  onClick={handleChangePassword}
                  disabled={passwordLoading}
                  className="px-6 py-2.5 rounded-xl font-medium text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] hover:opacity-90 disabled:opacity-50 transition-opacity"
                >
                  {passwordLoading ? 'ƒêang x·ª≠ l√Ω...' : 'ƒê·ªïi m·∫≠t kh·∫©u'}
                </button>
              </div>
            )}
          </div>

          {/* CARD 3: Subscription */}
          <div className="bg-white rounded-xl border border-gray-200 p-6">
            <h2 className="text-2xl font-semibold text-[#374151] mb-6">G√≥i ƒëƒÉng k√Ω</h2>
            
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  G√≥i hi·ªán t·∫°i
                </label>
                <p className="text-gray-700">Mi·ªÖn ph√≠</p>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Ng√†y h·∫øt h·∫°n
                </label>
                <p className="text-gray-700">Kh√¥ng gi·ªõi h·∫°n</p>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Tr·∫°ng th√°i
                </label>
                <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                  ƒêang ho·∫°t ƒë·ªông
                </span>
              </div>

              <button
                disabled
                className="px-6 py-2.5 rounded-xl font-medium text-[#6366F1] border border-[#6366F1] opacity-50 cursor-not-allowed"
              >
                N√¢ng c·∫•p g√≥i (Coming soon)
              </button>
            </div>
          </div>

          {/* CARD 4: Security & Data Usage (READ-ONLY) */}
          <div className="bg-white rounded-xl border border-gray-200 p-6">
            <h2 className="text-2xl font-semibold text-[#374151] mb-6">B·∫£o m·∫≠t & S·ª≠ d·ª•ng d·ªØ li·ªáu</h2>
            
            <div className="space-y-4 text-gray-700">
              <div>
                <h3 className="font-semibold mb-2">D·ªØ li·ªáu ch√∫ng t√¥i thu th·∫≠p</h3>
                <p className="text-sm mb-4">
                  ALINO thu th·∫≠p th√¥ng tin c√° nh√¢n c·ªßa b·∫°n ƒë·ªÉ cung c·∫•p v√† c·∫£i thi·ªán d·ªãch v·ª•, bao g·ªìm:
                </p>
                <ul className="list-disc pl-6 text-sm space-y-1 mb-4">
                  <li>Th√¥ng tin t√†i kho·∫£n (email, t√™n, ng√†y sinh, ƒë·ªãa ch·ªâ)</li>
                  <li>Th√¥ng tin h·ªì s∆° c√¥ng khai</li>
                  <li>D·ªØ li·ªáu t·ª´ c√°c t√†i kho·∫£n m·∫°ng x√£ h·ªôi ƒë∆∞·ª£c k·∫øt n·ªëi (Google, Facebook, Instagram, TikTok)</li>
                  <li>Th√¥ng tin v·ªÅ c√°ch b·∫°n s·ª≠ d·ª•ng n·ªÅn t·∫£ng</li>
                </ul>
              </div>

              <div>
                <h3 className="font-semibold mb-2">M·ª•c ƒë√≠ch s·ª≠ d·ª•ng</h3>
                <p className="text-sm mb-4">
                  Ch√∫ng t√¥i s·ª≠ d·ª•ng d·ªØ li·ªáu c·ªßa b·∫°n ƒë·ªÉ:
                </p>
                <ul className="list-disc pl-6 text-sm space-y-1 mb-4">
                  <li>K·∫øt n·ªëi b·∫°n v·ªõi c√°c ƒë·ªëi t√°c ph√π h·ª£p (Creators v·ªõi Brands)</li>
                  <li>C·∫£i thi·ªán tr·∫£i nghi·ªám ng∆∞·ªùi d√πng v√† t√≠nh nƒÉng c·ªßa n·ªÅn t·∫£ng</li>
                  <li>G·ª≠i th√¥ng b√°o v√† c·∫≠p nh·∫≠t v·ªÅ d·ªãch v·ª•</li>
                  <li>Ph√¢n t√≠ch v√† t·ªëi ∆∞u h√≥a hi·ªáu su·∫•t</li>
                </ul>
              </div>

              <div>
                <h3 className="font-semibold mb-2">K·∫øt n·ªëi m·∫°ng x√£ h·ªôi</h3>
                <p className="text-sm mb-4">
                  Khi b·∫°n k·∫øt n·ªëi t√†i kho·∫£n m·∫°ng x√£ h·ªôi v·ªõi ALINO, ch√∫ng t√¥i c√≥ th·ªÉ truy c·∫≠p v√† l∆∞u tr·ªØ 
                  th√¥ng tin c√¥ng khai t·ª´ c√°c t√†i kho·∫£n ƒë√≥ ƒë·ªÉ cung c·∫•p d·ªãch v·ª• t·ªët h∆°n v√† t·∫°o ƒëi·ªÅu ki·ªán 
                  cho c√°c t√≠nh nƒÉng c·ªßa n·ªÅn t·∫£ng.
                </p>
              </div>

              <div className="bg-gray-50 border border-gray-200 rounded-lg p-4">
                <p className="text-sm text-gray-700">
                  ƒê·ªÉ bi·∫øt th√™m chi ti·∫øt v·ªÅ c√°ch ch√∫ng t√¥i x·ª≠ l√Ω d·ªØ li·ªáu c·ªßa b·∫°n, vui l√≤ng xem{' '}
                  <Link to="/privacy" className="text-[#6366F1] hover:underline">
                    Ch√≠nh s√°ch b·∫£o m·∫≠t
                  </Link>
                  {' '}c·ªßa ch√∫ng t√¥i.
                </p>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/utils/cropImage.ts">
import { Area } from 'react-easy-crop'

export async function getCroppedImg(
  imageSrc: string,
  pixelCrop: Area
): Promise<Blob> {
  const image = await createImage(imageSrc)
  const canvas = document.createElement('canvas')
  const ctx = canvas.getContext('2d')

  if (!ctx) {
    throw new Error('No 2d context')
  }

  // Set canvas size to output size (circular crop)
  const outputSize = 400
  canvas.width = outputSize
  canvas.height = outputSize

  // Draw circular crop
  ctx.save()
  ctx.beginPath()
  ctx.arc(outputSize / 2, outputSize / 2, outputSize / 2, 0, Math.PI * 2)
  ctx.clip()

  // Draw cropped image
  ctx.drawImage(
    image,
    pixelCrop.x,
    pixelCrop.y,
    pixelCrop.width,
    pixelCrop.height,
    0,
    0,
    outputSize,
    outputSize
  )

  ctx.restore()

  return new Promise((resolve, reject) => {
    canvas.toBlob(
      (blob) => {
        if (!blob) {
          reject(new Error('Canvas is empty'))
          return
        }
        resolve(blob)
      },
      'image/jpeg',
      0.9
    )
  })
}

function createImage(url: string): Promise<HTMLImageElement> {
  return new Promise((resolve, reject) => {
    const image = new Image()
    image.addEventListener('load', () => resolve(image))
    image.addEventListener('error', (error) => reject(error))
    image.src = url
  })
}
</file>

<file path="supabase/migrations/001_create_profiles.sql">
-- Create profiles table
CREATE TABLE IF NOT EXISTS public.profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  role TEXT CHECK (role IN ('creator', 'brand')),
  onboarding_completed BOOLEAN DEFAULT FALSE,
  onboarding_data JSONB DEFAULT '{}'::jsonb,
  
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Enable RLS
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;

-- RLS Policy: Users can read their own profile
CREATE POLICY "Users can read their own profile"
  ON public.profiles
  FOR SELECT
  USING (auth.uid() = id);

-- RLS Policy: Users can update their own profile
CREATE POLICY "Users can update their own profile"
  ON public.profiles
  FOR UPDATE
  USING (auth.uid() = id)
  WITH CHECK (auth.uid() = id);

-- RLS Policy: Users can insert their own profile
CREATE POLICY "Users can insert their own profile"
  ON public.profiles
  FOR INSERT
  WITH CHECK (auth.uid() = id);

-- RLS Policy: Admin users (email ends with @alino.net) can read all profiles
CREATE POLICY "Admin users can read all profiles"
  ON public.profiles
  FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM auth.users
      WHERE auth.users.id = auth.uid()
      AND auth.users.email LIKE '%@alino.net'
    )
  );

-- RLS Policy: Admin users can update all profiles
CREATE POLICY "Admin users can update all profiles"
  ON public.profiles
  FOR UPDATE
  USING (
    EXISTS (
      SELECT 1 FROM auth.users
      WHERE auth.users.id = auth.uid()
      AND auth.users.email LIKE '%@alino.net'
    )
  )
  WITH CHECK (
    EXISTS (
      SELECT 1 FROM auth.users
      WHERE auth.users.id = auth.uid()
      AND auth.users.email LIKE '%@alino.net'
    )
  );

-- Function to automatically update updated_at timestamp
CREATE OR REPLACE FUNCTION public.handle_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Trigger to update updated_at on profile updates
CREATE TRIGGER set_updated_at
  BEFORE UPDATE ON public.profiles
  FOR EACH ROW
  EXECUTE FUNCTION public.handle_updated_at();

-- Create index on role for faster queries
CREATE INDEX IF NOT EXISTS idx_profiles_role ON public.profiles(role);

-- Create index on onboarding_completed for faster queries
CREATE INDEX IF NOT EXISTS idx_profiles_onboarding_completed ON public.profiles(onboarding_completed);
</file>

<file path="MIGRATION_GUIDE.md">
# Migration Guide: Next.js to Vite + React

## Overview
This project has been migrated from Next.js App Router to Vite + React for simplicity and predictability.

## Key Changes

### 1. Project Structure
- **Old**: `app/` directory with Next.js App Router
- **New**: `src/` directory with standard React structure

### 2. Routing
- **Old**: Next.js file-based routing (`app/page.tsx`, `app/login/page.tsx`)
- **New**: React Router with `src/router.tsx`

### 3. Authentication
- **Old**: Server-side auth with cookies, API routes
- **New**: Client-side only with Supabase client, localStorage persistence

### 4. No More Server Components
- All components are now client-side React components
- No SSR, no hydration issues

## Setup Instructions

1. **Install dependencies:**
```bash
npm install
```

2. **Create `.env` file:**
```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

3. **Start development server:**
```bash
npm run dev
```

## File Mapping

| Next.js | Vite + React |
|---------|--------------|
| `app/page.tsx` | `src/pages/LandingPage.tsx` |
| `app/login/page.tsx` | `src/pages/LoginPage.tsx` |
| `app/signup/page.tsx` | `src/pages/SignupPage.tsx` |
| `app/creator/page.tsx` | `src/pages/CreatorDashboard.tsx` |
| `app/brand/page.tsx` | `src/pages/BrandDashboard.tsx` |
| `app/profile/page.tsx` | `src/pages/ProfilePage.tsx` |
| `app/settings/page.tsx` | `src/pages/SettingsPage.tsx` |
| `app/components/layout/Header.tsx` | `src/components/layout/Header.tsx` |
| `lib/hooks/useAuth.ts` | `src/hooks/useAuth.ts` |
| `lib/supabase-client.ts` | `src/lib/supabase.ts` |

## Removed Concepts

- ‚ùå Server Components
- ‚ùå Route Handlers (`app/api/`)
- ‚ùå Server-side auth guards
- ‚ùå AuthGate component
- ‚ùå Middleware
- ‚ùå `layout.tsx`
- ‚ùå `next/image` (use `<img>`)
- ‚ùå `next/link` (use React Router `Link`)

## What Works Now

‚úÖ Simple client-side routing
‚úÖ Supabase auth with localStorage
‚úÖ No navigation blocking
‚úÖ Predictable behavior
‚úÖ Easy to understand and modify

## Next Steps

1. Copy `vite-package.json` to `package.json`
2. Copy `vite.config.ts` to root
3. Copy `vite-tailwind.config.js` to `tailwind.config.js`
4. Copy `vite-postcss.config.js` to `postcss.config.js`
5. Copy `vite-tsconfig.json` to `tsconfig.json`
6. Copy `vite-tsconfig.node.json` to `tsconfig.node.json`
7. Move `src/` directory to root
8. Move `index.html` to root
9. Update environment variables to use `VITE_` prefix
10. Run `npm install` and `npm run dev`
</file>

<file path="postcss.config.cjs">
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="PROFILES_IMPLEMENTATION.md">
# Profiles Implementation Guide

## Overview
This implementation creates `public.profiles` as the single source of truth for user data, with proper RLS policies for admin vs user access control.

## SQL Migration

Run the SQL migration file to create the profiles table and RLS policies:

**File:** `supabase/migrations/001_create_profiles.sql`

Execute this SQL in your Supabase SQL Editor or via Supabase CLI.

## Key Features

1. **Profiles Table**: Stores all user data including role, onboarding completion status, and all onboarding survey data
2. **RLS Policies**:
   - Users can read/update their own profile
   - Admin users (email ends with `@alino.net`) can read/update all profiles
3. **Data Flow**:
   - Role selection ‚Üí Creates/updates profile in `profiles` table
   - Onboarding completion ‚Üí Updates profile with survey data
   - Dashboards ‚Üí Read from `profiles` table (via `/api/profile`)

## API Endpoints

### POST `/api/auth/role`
- Creates/updates profile with role
- Sets `onboarding_completed = false`

### POST `/api/auth/onboarding`
- Updates profile with onboarding survey data
- Sets `onboarding_completed = true`

### GET `/api/profile`
- Users: Returns their own profile
- Admins: Returns all profiles

## Admin Detection

Admin users are identified by email ending with `@alino.net` (checked in `lib/supabase-helpers.ts`).

## Notes

- `user_metadata` is still updated for AuthGate compatibility (role, onboardingCompleted flags)
- `profiles` table is the source of truth for all user data
- RLS policies enforce data access restrictions automatically
</file>

<file path="README_VITE.md">
# Vite + React Migration Complete

## Quick Start

1. **Install dependencies:**
```bash
npm install
```

2. **Set up environment variables:**
Create `.env` file:
```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

3. **Start development:**
```bash
npm run dev
```

## Project Structure

```
src/
  ‚îú‚îÄ‚îÄ main.tsx              # Entry point
  ‚îú‚îÄ‚îÄ App.tsx               # Root component with Router
  ‚îú‚îÄ‚îÄ router.tsx            # React Router configuration
  ‚îú‚îÄ‚îÄ index.css             # Global styles (Tailwind)
  ‚îú‚îÄ‚îÄ components/
  ‚îÇ   ‚îî‚îÄ‚îÄ layout/
  ‚îÇ       ‚îú‚îÄ‚îÄ Header.tsx    # Navigation header
  ‚îÇ       ‚îú‚îÄ‚îÄ UserMenu.tsx  # User dropdown menu
  ‚îÇ       ‚îî‚îÄ‚îÄ Footer.tsx    # Footer component
  ‚îú‚îÄ‚îÄ pages/
  ‚îÇ   ‚îú‚îÄ‚îÄ LandingPage.tsx
  ‚îÇ   ‚îú‚îÄ‚îÄ LoginPage.tsx
  ‚îÇ   ‚îú‚îÄ‚îÄ SignupPage.tsx
  ‚îÇ   ‚îú‚îÄ‚îÄ VerifyEmailPage.tsx
  ‚îÇ   ‚îú‚îÄ‚îÄ RolePage.tsx
  ‚îÇ   ‚îú‚îÄ‚îÄ OnboardingPage.tsx
  ‚îÇ   ‚îú‚îÄ‚îÄ CreatorDashboard.tsx
  ‚îÇ   ‚îú‚îÄ‚îÄ BrandDashboard.tsx
  ‚îÇ   ‚îú‚îÄ‚îÄ ProfilePage.tsx
  ‚îÇ   ‚îî‚îÄ‚îÄ SettingsPage.tsx
  ‚îú‚îÄ‚îÄ hooks/
  ‚îÇ   ‚îî‚îÄ‚îÄ useAuth.ts        # Auth hook (client-side only)
  ‚îî‚îÄ‚îÄ lib/
      ‚îî‚îÄ‚îÄ supabase.ts       # Supabase client setup
```

## Key Features

‚úÖ **Simple Client-Side Auth**
- Supabase client with localStorage persistence
- No server-side auth checks
- Session persists across page refreshes

‚úÖ **React Router**
- Clean, predictable routing
- Protected routes with simple guards
- No navigation blocking

‚úÖ **No SSR Complexity**
- All components are client-side
- No hydration issues
- Easy to understand and modify

## Migration Notes

- All Next.js concepts removed (App Router, Server Components, Route Handlers)
- Auth is now 100% client-side
- Navigation always works - no redirect loops
- Profile/role checks happen in router, not on every navigation

## Next Steps

1. Copy all `vite-*` files to root (remove `vite-` prefix)
2. Move `src/` directory to root
3. Move `index.html` to root
4. Update environment variables
5. Run `npm install` and `npm run dev`
</file>

<file path="TECHNICAL_SUMMARY.md">
# ALINO APP - TECHNICAL SUMMARY

> **T√†i li·ªáu handover & review**  
> **Ng√†y c·∫≠p nh·∫≠t:** 26/12/2025  
> **Version:** Phase 1-3 Complete

---

## 1. PROJECT OVERVIEW

### M·ª•c ti√™u
N·ªÅn t·∫£ng k·∫øt n·ªëi **Creators** v√† **Brands** ƒë·ªÉ t·∫°o tƒÉng tr∆∞·ªüng th√¥ng qua Creator Marketing.

- **Creator**: T·∫°o profile chuy√™n nghi·ªáp, qu·∫£n l√Ω booking, h·ª£p ƒë·ªìng, nh·∫≠n thanh to√°n
- **Brand**: T√¨m creator ph√π h·ª£p, qu·∫£n l√Ω campaign, tracking, b√°o c√°o

### Tech Stack
- **Frontend**: React 18.2 + TypeScript
- **Build Tool**: Vite 5.0
- **Styling**: TailwindCSS 3.4
- **Routing**: React Router DOM v7.11
- **Backend**: Supabase (Auth + Database + Storage)
- **State**: React Query (profile data) + React Context (auth)
- **Deployment**: Vercel

### Bundle Size
- **Total**: 645KB (gzip: 184KB)
- **Acceptable** cho SaaS app v·ªõi nhi·ªÅu t√≠nh nƒÉng

---

## 2. KI·∫æN TR√öC HI·ªÜN T·∫†I

### Folder Structure
```
src/
‚îú‚îÄ‚îÄ app/providers/         # Context providers (Auth)
‚îú‚îÄ‚îÄ components/            # Shared UI (Layout, Skeleton, Toast, ErrorBoundary)
‚îú‚îÄ‚îÄ features/              # Feature modules (auth, dashboard, landing, onboarding)
‚îú‚îÄ‚îÄ lib/                   # Utils (supabase, queries, errors, env)
‚îú‚îÄ‚îÄ pages/                 # Route entry points
‚îî‚îÄ‚îÄ shared/                # Types, routes, constants, enums
```

### Data Flow
```
Component ‚Üí React Query (useProfile) ‚Üí Supabase Client ‚Üí PostgreSQL
                ‚Üì (cache 5min)
            Query Cache ‚Üí Auto sync khi update
```

### Auth Flow
```
Login/Signup ‚Üí Supabase Auth ‚Üí Session ‚Üí AuthProvider ‚Üí RequireAuth ‚Üí Pages
                                              ‚Üì
                                        AppGate (check role + onboarding)
                                              ‚Üì
                                    Dashboard (Creator/Brand)
```

### Core Components
- **ErrorBoundary**: B·∫Øt l·ªói to√†n app, hi·ªÉn th·ªã fallback UI
- **AuthProvider**: Qu·∫£n l√Ω session/user, subscribe auth changes
- **RequireAuth**: Guard cho protected routes, check email verification
- **AppGate**: Logic routing theo role + onboarding status
- **Onboarding**: Chia th√†nh CreatorOnboarding + BrandOnboarding
- **Profile**: Dynamic render theo role (Creator/Brand)

---

## 3. QUY·∫æT ƒê·ªäNH K·ª∏ THU·∫¨T QUAN TR·ªåNG

### ‚úÖ Phase 1: Critical Fixes

#### 1.1. Refactor Onboarding (657 lines ‚Üí 3 files)
**L√Ω do**: Component qu√° l·ªõn, kh√≥ maintain  
**Gi·∫£i ph√°p**:
- `Onboarding.tsx`: Router (fetch + route theo role)
- `CreatorOnboarding.tsx`: Form ri√™ng cho creator
- `BrandOnboarding.tsx`: Form ri√™ng cho brand

**Trade-off**: C√≥ duplicate code (avatar, validation) nh∆∞ng d·ªÖ extend ƒë·ªôc l·∫≠p.

#### 1.2. ErrorBoundary
**L√Ω do**: App crash ‚Üí white screen, UX t·ªá  
**Gi·∫£i ph√°p**: Class component b·ªçc to√†n app, catch errors, show fallback UI

#### 1.3. Fix Race Conditions
**V·∫•n ƒë·ªÅ**: Navigate tr∆∞·ªõc khi data ready ‚Üí query null  
**Gi·∫£i ph√°p**:
- AuthProvider: Check `mounted` trong callbacks
- AuthCallback/AppGate: Th√™m delay 100ms sau upsert tr∆∞·ªõc khi navigate
- **Trade-off**: Delay nh·ªè (100ms) nh∆∞ng ƒë·∫£m b·∫£o data consistency

---

### ‚úÖ Phase 2: React Query

#### 2.1. T·∫°i sao d√πng React Query?
**V·∫•n ƒë·ªÅ**:
- Profile fetch nhi·ªÅu l·∫ßn (AppGate, Profile, Settings)
- Kh√¥ng c√≥ cache ‚Üí l√£ng ph√≠ bandwidth
- Update profile ‚Üí ph·∫£i refetch th·ªß c√¥ng

**Gi·∫£i ph√°p**:
- `useProfile()`: Fetch + cache 5 ph√∫t
- `useUpdateProfile()`: Mutation + auto invalidate cache
- **Scope**: CH·ªà profile data (kh√¥ng migrate to√†n b·ªô)

**L·ª£i √≠ch**:
- Gi·∫£m API calls ~70%
- Data sync t·ª± ƒë·ªông across components
- Loading/error states nh·∫•t qu√°n

#### 2.2. T·∫°i sao kh√¥ng d√πng Redux/Zustand?
- **Profile data**: Server state ‚Üí React Query ph√π h·ª£p
- **Auth state**: Simple context ƒë·ªß (session + user)
- **Kh√¥ng c√≥ complex client state** c·∫ßn global store

---

### ‚úÖ Phase 3: Code Quality

#### 3.1. Enums thay Magic Strings
**Tr∆∞·ªõc**:
```tsx
const checks = [['fullName', !fullName.trim()], ...];
if (profile.role === 'creator') { ... }
```

**Sau**:
```tsx
const checks = [[ProfileField.FULL_NAME, !fullName.trim()], ...];
if (profile.role === Role.CREATOR) { ... }
```

**L·ª£i √≠ch**: Type safety, autocomplete, kh√¥ng typo

#### 3.2. Structured Error Handling
**Tr∆∞·ªõc**: `catch (err) { setError('L·ªói...') }`  
**Sau**: `catch (err) { setError(handleError(new AppError(...))) }`

**L·ª£i √≠ch**:
- Error codes cho debugging
- User-friendly messages (Ti·∫øng Vi·ªát)
- Severity levels (info/warning/error/critical)
- D·ªÖ t√≠ch h·ª£p Sentry sau n√†y

#### 3.3. Loading Skeletons
**Tr∆∞·ªõc**: Spinner ho·∫∑c text "ƒêang t·∫£i..."  
**Sau**: Skeleton UI (gi·ªëng content layout)

**L·ª£i √≠ch**: Professional UX, perceived performance t·ªët h∆°n

---

## 4. NH·ªÆNG TH·ª® C·ªê T√åNH CH∆ØA L√ÄM

### ‚ùå React Hook Form + Zod
**L√Ω do**: 
- Form hi·ªán t·∫°i ƒë∆°n gi·∫£n, validation th·ªß c√¥ng ƒë·ªß
- Th√™m dependency ~50KB, ch∆∞a c·∫ßn thi·∫øt
- **Khi n√†o c·∫ßn**: Khi c√≥ form ph·ª©c t·∫°p (dynamic fields, nested validation)

### ‚ùå Form Validation Refactor
**L√Ω do**:
- Logic validation ƒëang work, kh√¥ng c√≥ bug
- Refactor = high risk, low reward
- **Khi n√†o c·∫ßn**: Khi scale form (th√™m 10+ fields m·ªõi)

### ‚ùå Dashboard Implementation
**L√Ω do**: 
- Ch·ªâ placeholder, ch·ªù business confirm features
- Kh√¥ng r√µ data model, workflow c·ª• th·ªÉ
- **ƒê√∫ng quy·∫øt ƒë·ªãnh**: Kh√¥ng build blind

### ‚ùå Unit Tests
**L√Ω do**:
- MVP phase, focus stability tr∆∞·ªõc
- Manual test ƒë·ªß cho core flows
- **Khi n√†o c·∫ßn**: Sau khi c√≥ 2-3 features n·ªØa, setup CI/CD

### ‚ùå i18n (Internationalization)
**L√Ω do**:
- Target th·ªã tr∆∞·ªùng Vi·ªát Nam
- Th√™m i18n = overhead, ch·∫≠m development
- **Khi n√†o c·∫ßn**: Khi expand sang th·ªã tr∆∞·ªùng n∆∞·ªõc ngo√†i

### ‚ùå Analytics/Monitoring
**L√Ω do**: Ch∆∞a c√≥ traffic, ch∆∞a c·∫ßn optimize
- **Khi n√†o c·∫ßn**: Sau khi launch public (100+ users)

---

## 5. H∆Ø·ªöNG M·ªû R·ªòNG TI·∫æP THEO

### üéØ Business Priority

#### Ng·∫Øn h·∫°n (1-2 th√°ng)
1. **Dashboard th·ª±c t·∫ø**
   - Creator: Deal management, content calendar, payment tracking
   - Brand: Campaign creation, creator discovery, analytics

2. **Booking Flow**
   - Brand g·ª≠i booking request
   - Creator accept/reject
   - Contract generation

3. **Payment Integration**
   - Escrow system
   - Invoice management
   - Payment history

#### Trung h·∫°n (3-6 th√°ng)
4. **Messaging System** (Creator ‚Üî Brand communication)
5. **Content Review Flow** (upload ‚Üí feedback ‚Üí approve)
6. **Analytics Dashboard** (campaign performance, ROI)

#### D√†i h·∫°n (6-12 th√°ng)
7. **Marketplace** (public creator profiles, search/filter)
8. **AI Matching** (recommend creator based on brand needs)
9. **Mobile App** (React Native ho·∫∑c PWA)

---

### üõ†Ô∏è Tech Improvements

#### High Priority
1. **Unit Tests cho Critical Flows**
   - Auth (login, signup, password reset)
   - Onboarding (validation, data save)
   - Profile (update, avatar upload)
   - **Tool**: Vitest + React Testing Library

2. **Bundle Optimization**
   - Code splitting (React.lazy + Suspense)
   - Dynamic imports cho landing sections
   - Target: 645KB ‚Üí 400KB
   - **Tool**: Vite rollupOptions

3. **Error Monitoring**
   - Integrate Sentry
   - Track errors v·ªõi context (user, page, action)
   - Alert cho critical errors

#### Medium Priority
4. **Performance Monitoring**
   - Web Vitals (LCP, FID, CLS)
   - Custom metrics (API latency, query cache hit rate)
   - **Tool**: Vercel Analytics ho·∫∑c Google Analytics

5. **CI/CD Pipeline**
   - GitHub Actions
   - Auto test ‚Üí build ‚Üí deploy on PR
   - Branch previews

6. **Database Optimization**
   - Add indexes cho queries th∆∞·ªùng d√πng
   - Setup RLS (Row Level Security) policies
   - Backup strategy

#### Nice to Have
7. **Design System** (Storybook for components)
8. **Accessibility Audit** (a11y compliance)
9. **PWA Support** (offline capability, push notifications)

---

## üìä CURRENT STATUS

### ‚úÖ ƒê√£ ho√†n th√†nh
- Auth flow (email/password + Google OAuth)
- Email verification
- Onboarding (Creator + Brand)
- Profile management
- Settings (account, security, password)
- Error handling
- Loading states
- Responsive design

### üöß ƒêang ph√°t tri·ªÉn
- Dashboard (placeholder s·∫µn s√†ng)
- Business features (ch·ªù spec)

### üìã Technical Debt
- **Minimal** - Code quality cao, technical decisions ƒë√∫ng
- Ch·ªâ c√≥ duplicate code nh·ªè ·ªü validation logic
- Kh√¥ng c√≥ major refactor c·∫ßn thi·∫øt

---

## üéì LEARNING & BEST PRACTICES

### Quy·∫øt ƒë·ªãnh ƒë√∫ng
‚úÖ D√πng Vite (fast build)  
‚úÖ Supabase (kh√¥ng c·∫ßn backend ri√™ng)  
‚úÖ React Query (ch·ªâ cho server state)  
‚úÖ TypeScript strict mode (catch bugs s·ªõm)  
‚úÖ Feature-based folder structure (d·ªÖ scale)  
‚úÖ ErrorBoundary (stability)  

### Trade-offs H·ª£p l√Ω
‚öñÔ∏è Delay 100ms (race condition fix) vs UX impact ‚Üí OK  
‚öñÔ∏è Manual validation vs library ‚Üí OK cho form ƒë∆°n gi·∫£n  
‚öñÔ∏è Client-side routing vs SSR ‚Üí OK cho SaaS app  

### Patterns N√™n Gi·ªØ
üîÅ Gate pattern (AppGate cho routing logic)  
üîÅ Provider pattern (AuthProvider)  
üîÅ Feature modules (landing, auth, dashboard)  
üîÅ Shared UI components (components/ui)  

---

## üìû CONTACT & HANDOVER

### Codebase Ready
- ‚úÖ Build th√†nh c√¥ng
- ‚úÖ TypeScript no errors
- ‚úÖ Git history s·∫°ch (3 commits cho 3 phases)
- ‚úÖ Comments r√µ r√†ng trong code

### Knowledge Transfer
- ƒê·ªçc file n√†y tr∆∞·ªõc
- Review 3 commits: Phase 1, 2, 3
- Ch·∫°y local: `npm install` ‚Üí `npm run dev`
- Check `.env.example` cho env vars

### Next Developer Should Know
1. **Auth flow** ph·ª©c t·∫°p (email verify, OAuth, role selection)
2. **Profile data** d√πng React Query ‚Üí check cache khi debug
3. **Validation logic** ·ªü onboarding/profile ‚Üí extend carefully
4. **AppGate** l√† single source of truth cho routing logic

---

**END OF DOCUMENT**
</file>

<file path="src/components/AuthGate.tsx">
import { useEffect } from 'react'
import { useNavigate } from 'react-router-dom'
import { useAuth } from '../hooks/useAuth'
import { useProfile } from '../hooks/useProfile'

export default function AuthGate({ children }: { children: React.ReactNode }) {
  const { session, loading: authLoading, isAuthenticated } = useAuth()
  const { profile, loading: profileLoading } = useProfile(
    session?.user?.id,
    isAuthenticated
  )
  const navigate = useNavigate()

  useEffect(() => {
    if (authLoading || profileLoading) return

    if (!session) {
      navigate('/login', { replace: true })
      return
    }

    if (!profile) return

    if (!profile.role) {
      navigate('/role', { replace: true })
      return
    }

    if (!profile.onboarding_completed) {
      navigate('/onboarding', { replace: true })
      return
    }
  }, [session, profile, authLoading, profileLoading, navigate])

  if (authLoading || profileLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        ƒêang t·∫£i...
      </div>
    )
  }

  return <>{children}</>
}
</file>

<file path="src/components/AvatarUpload.tsx">
import { useState, useRef } from 'react'
import Cropper, { Area } from 'react-easy-crop'
import { getSupabase } from '../lib/supabase'
import { getCroppedImg } from '../utils/cropImage'

interface AvatarUploadProps {
  currentAvatarUrl?: string
  onAvatarChange: (url: string) => void
  userId: string
}

const CROP_SIZE = 300 // Fixed crop circle size

export default function AvatarUpload({
  currentAvatarUrl,
  onAvatarChange,
  userId,
}: AvatarUploadProps) {
  const [imageSrc, setImageSrc] = useState<string | null>(null)
  const [showCropModal, setShowCropModal] = useState(false)
  const [crop, setCrop] = useState({ x: 0, y: 0 })
  const [zoom, setZoom] = useState(1)
  const [croppedAreaPixels, setCroppedAreaPixels] = useState<Area | null>(null)
  const [uploading, setUploading] = useState(false)

  const fileInputRef = useRef<HTMLInputElement>(null)

  /* ================= FILE SELECT ================= */

  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (!file) return

    if (!['image/jpeg', 'image/png', 'image/webp'].includes(file.type)) {
      alert('Ch·ªâ h·ªó tr·ª£ JPG, PNG, WEBP')
      return
    }

    if (file.size > 5 * 1024 * 1024) {
      alert('·∫¢nh t·ªëi ƒëa 5MB')
      return
    }

    const reader = new FileReader()
    reader.onload = () => {
      setImageSrc(reader.result as string)
      setShowCropModal(true)
      setCrop({ x: 0, y: 0 })
      setZoom(1)
    }
    reader.readAsDataURL(file)
  }

  /* ================= CROP + UPLOAD ================= */

  const onCropComplete = (croppedArea: Area, croppedAreaPixels: Area) => {
    setCroppedAreaPixels(croppedAreaPixels)
  }

  const handleCrop = async () => {
    if (!imageSrc || !croppedAreaPixels) return

    setUploading(true)

    try {
      // Get cropped image blob
      const croppedImage = await getCroppedImg(imageSrc, croppedAreaPixels)
      
      if (!croppedImage) {
        throw new Error('Kh√¥ng th·ªÉ crop ·∫£nh')
      }

      // Upload to Supabase Storage
      const supabase = getSupabase()
      const timestamp = Date.now()
      const fileExt = 'jpg'
      const path = `${userId}/${timestamp}.${fileExt}`

      // Upload file to storage
      const { error: uploadError } = await supabase.storage
        .from('avatars')
        .upload(path, croppedImage, {
          upsert: true,
          contentType: 'image/jpeg',
        })

      if (uploadError) {
        throw new Error(`Upload failed: ${uploadError.message}`)
      }

      // Get public URL
      const { data: urlData } = supabase.storage
        .from('avatars')
        .getPublicUrl(path)

      if (!urlData?.publicUrl) {
        throw new Error('Failed to get public URL')
      }

      // Pass public URL to parent component
      onAvatarChange(urlData.publicUrl)

      // Close modal and reset
      setShowCropModal(false)
      setImageSrc(null)
      setCrop({ x: 0, y: 0 })
      setZoom(1)
      setCroppedAreaPixels(null)
    } catch (error: any) {
      console.error('Avatar upload error:', error)
      alert(error.message || 'Upload th·∫•t b·∫°i')
      // Reset state on error
      setShowCropModal(false)
      setImageSrc(null)
      setCrop({ x: 0, y: 0 })
      setZoom(1)
      setCroppedAreaPixels(null)
    } finally {
      setUploading(false)
    }
  }

  const handleCancel = () => {
    setShowCropModal(false)
    setImageSrc(null)
    setCrop({ x: 0, y: 0 })
    setZoom(1)
    setCroppedAreaPixels(null)
  }

  /* ================= RENDER ================= */

  return (
    <>
      {/* AVATAR */}
      <div className="flex flex-col items-center gap-2">
        <div
          onClick={() => fileInputRef.current?.click()}
          className="relative w-24 h-24 rounded-full overflow-hidden bg-gray-200 cursor-pointer group"
        >
          {currentAvatarUrl ? (
            <img src={currentAvatarUrl} alt="Avatar" className="w-full h-full object-cover" />
          ) : (
            <div className="w-full h-full flex items-center justify-center text-gray-400 text-4xl">
              üë§
            </div>
          )}

          <div className="absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 flex items-center justify-center transition">
            <span className="text-white text-xs font-medium">ƒê·ªïi avatar</span>
          </div>
        </div>
      </div>

      <input
        ref={fileInputRef}
        type="file"
        accept="image/*"
        hidden
        onChange={handleFileSelect}
      />

      {/* MODAL */}
      {showCropModal && imageSrc && (
        <div className="fixed inset-0 z-50 bg-black/60 flex justify-center p-4">
          <div 
            className="bg-white rounded-xl p-5 w-full"
            style={{ 
              maxWidth: '400px',
              maxHeight: '80vh',
              display: 'flex',
              flexDirection: 'column',
            }}
          >
            <h3 className="font-semibold mb-4 flex-shrink-0">Ch·ªânh s·ª≠a avatar</h3>

            {/* Crop Area - Compact, centered */}
            <div
              className="relative mx-auto flex-shrink-0"
              style={{
                width: `${CROP_SIZE}px`,
                height: `${CROP_SIZE}px`,
                backgroundColor: '#000',
              }}
            >
              <Cropper
                image={imageSrc}
                crop={crop}
                zoom={zoom}
                aspect={1}
                cropShape="round"
                showGrid={true}
                onCropChange={setCrop}
                onZoomChange={setZoom}
                onCropComplete={onCropComplete}
                style={{
                  containerStyle: {
                    width: '100%',
                    height: '100%',
                  },
                }}
              />
            </div>

            {/* Zoom Control - Directly below crop */}
            <div className="mt-4 mb-4 flex-shrink-0" style={{ width: `${CROP_SIZE}px`, marginLeft: 'auto', marginRight: 'auto' }}>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Zoom
              </label>
              <input
                type="range"
                min="1"
                max="3"
                step="0.1"
                value={zoom}
                onChange={(e) => setZoom(parseFloat(e.target.value))}
                className="w-full"
              />
            </div>

            {/* Buttons - Always visible */}
            <div className="flex justify-end gap-2 mt-3 flex-shrink-0">
            <button
                onClick={handleCancel}
                disabled={uploading}
                className="px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium disabled:opacity-50"
              >
                H·ªßy
              </button>
              <button
                onClick={handleCrop}
                disabled={uploading}
                className="px-4 py-2 rounded-lg bg-gradient-to-r from-indigo-500 to-pink-500 text-white font-medium disabled:opacity-50"
              >
                {uploading ? 'ƒêang l∆∞u‚Ä¶' : 'L∆∞u'}
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  )
}
</file>

<file path="src/hooks/useAuth.ts">
import { useEffect, useState } from 'react'
import { useNavigate } from 'react-router-dom'
import type { Session } from '@supabase/supabase-js'
import { getSupabase } from '../lib/supabase'

export function useAuth() {
  const [session, setSession] = useState<Session | null>(null)
  const [loading, setLoading] = useState(true)
  const navigate = useNavigate()
  const supabase = getSupabase()

  useEffect(() => {
    let mounted = true

    // Get initial session
    supabase.auth.getSession().then(({ data: { session } }) => {
      if (!mounted) return
      setSession(session)
      setLoading(false)
    })

    // Listen for auth changes
    const {
      data: { subscription },
    } = supabase.auth.onAuthStateChange((event, session) => {
      if (!mounted) return
      setSession(session)
      setLoading(false)
    })

    return () => {
      mounted = false
      subscription.unsubscribe()
    }
  }, [])

  const signOut = async () => {
    await supabase.auth.signOut()
    setSession(null)
    navigate('/')
  }

  return {
    session,
    user: session?.user ?? null,
    loading,
    signOut,
    isAuthenticated: !!session,
  }
}
</file>

<file path="src/pages/AppGate.tsx">
import { useEffect, useState, useRef } from 'react'
import { useNavigate, useSearchParams } from 'react-router-dom'
import { useAuth } from '../hooks/useAuth'
import { getSupabase } from '../lib/supabase'

const GATE_TIMEOUT = 3000 // 3 seconds

export default function AppGate() {
  const { session, loading: authLoading } = useAuth()
  const navigate = useNavigate()
  const [searchParams] = useSearchParams()
  const supabase = getSupabase()
  const [loading, setLoading] = useState(true)
  const timeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null)
  const hasRedirected = useRef(false)

  useEffect(() => {
    // a) If not authenticated ‚Üí do nothing (let other routes handle it)
    if (authLoading) return
    if (!session) return

    // b) If already redirected ‚Üí do nothing
    if (hasRedirected.current) return

    // c) Email NOT verified ‚Üí sign out ‚Üí redirect to /
    if (!session.user.email_confirmed_at) {
      hasRedirected.current = true
      supabase.auth.signOut().finally(() => {
        navigate('/', { replace: true })
      })
      return
    }

    // d) Fetch profile DIRECTLY from Supabase (no cached hook)
    runGate()
  }, [authLoading, session, navigate, supabase])

  async function runGate() {
    if (!session) return

    // b) If already redirected ‚Üí do nothing
    if (hasRedirected.current) return

    setLoading(true)

    // Set timeout fallback
    timeoutRef.current = setTimeout(() => {
      if (hasRedirected.current) return
      console.error('AppGate timeout')
      hasRedirected.current = true
      navigate('/', { replace: true })
    }, GATE_TIMEOUT)

    try {
      // Fetch existing profile
      const { data: profile, error: fetchError } = await supabase
        .from('profiles')
        .select('id, role, onboarding_completed')
        .eq('id', session.user.id)
        .single()

      // b) If already redirected ‚Üí do nothing
      if (hasRedirected.current) return

      if (fetchError && fetchError.code === 'PGRST116') {
        // Profile doesn't exist, create it
        const { error: insertError } = await supabase
          .from('profiles')
          .insert({
            id: session.user.id,
            role: null,
            onboarding_completed: false,
          })

        if (insertError) {
          throw insertError
        }

        // After creating, redirect to role selection
        if (!hasRedirected.current) {
          hasRedirected.current = true
          navigate('/role', { replace: true })
        }
        return
      }

      if (fetchError) throw fetchError

      // b) If already redirected ‚Üí do nothing
      if (hasRedirected.current) return

      // Profile exists, handle redirect based on state
      if (profile) {
        handleProfileRedirect(profile)
      }
    } catch (error) {
      // b) If already redirected ‚Üí do nothing
      if (hasRedirected.current) return
      console.error('AppGate error:', error)
      hasRedirected.current = true
      navigate('/', { replace: true })
    } finally {
      if (timeoutRef.current) {
        clearTimeout(timeoutRef.current)
        timeoutRef.current = null
      }
      setLoading(false)
    }
  }

  function handleProfileRedirect(profile: { role: string | null; onboarding_completed: boolean }) {
    // b) If already redirected ‚Üí do nothing
    if (hasRedirected.current) return

    // d) If no role ‚Üí redirect to /role
    if (!profile.role) {
      hasRedirected.current = true
      navigate('/role', { replace: true })
      return
    }

    // e) If onboarding_completed = false ‚Üí redirect to /onboarding
    if (!profile.onboarding_completed) {
      hasRedirected.current = true
      navigate('/onboarding', { replace: true })
      return
    }

    // f) Else ‚Üí redirect to /dashboard (or next param)
    hasRedirected.current = true
    const next = searchParams.get('next')
    if (next === 'projects' || next === 'profile' || next === 'settings') {
      navigate(`/${next}`, { replace: true })
    } else {
      navigate('/dashboard', { replace: true })
    }
  }

  if (authLoading || loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-[#6B7280]">ƒêang t·∫£i...</div>
      </div>
    )
  }

  return null
}
</file>

<file path="src/pages/LoginPage.tsx">
import { useState } from 'react'
import { Link, useNavigate } from 'react-router-dom'
import { getSupabase } from '../lib/supabase'

export default function LoginPage() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [error, setError] = useState('')
  const [loading, setLoading] = useState(false)
  const navigate = useNavigate()
  const supabase = getSupabase()

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')
    setLoading(true)

    try {
      const { error } = await supabase.auth.signInWithPassword({
        email,
        password,
      })

      if (error) {
        // Map error messages to Vietnamese
        if (error.message === 'Email not confirmed') {
          setError('T√†i kho·∫£n ch∆∞a ƒë∆∞·ª£c x√°c th·ª±c')
        } else {
          setError('Email ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng')
        }
        setLoading(false)
        return
      }

      navigate('/app')
    } catch (err) {
      setError('C√≥ l·ªói x·∫£y ra')
      setLoading(false)
    }
  }

  const handleGoogleLogin = async () => {
    const { data, error } = await supabase.auth.signInWithOAuth({
      provider: 'google',
      options: {
        redirectTo: `${window.location.origin}/app`,
      },
    })

    if (error) {
      setError(error.message)
      return
    }

    if (data.url) {
      window.location.href = data.url
    }
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-[#F9FAFB] px-6 lg:px-6 pt-16">
      <div className="w-full max-w-6xl bg-white rounded-3xl shadow-xl overflow-hidden flex">
        <div className="hidden lg:flex w-[45%] bg-gradient-to-br from-[#6366F1]/20 via-[#7C3AED]/15 to-[#EC4899]/20">
          <div className="flex flex-col px-12 pt-12 items-center">
            <img
              src="/logo/logo.png"
              alt="ALINO"
              className="w-40 h-40 mb-6"
            />
            <h1 className="text-3xl font-semibold text-[#1F2937] mb-3">
              Ch√†o m·ª´ng t·ªõi v·ªõi Alino
            </h1>
            <p className="text-[#6B7280] leading-relaxed">
              N·ªÅn t·∫£ng qu·∫£n l√Ω c√°c d·ª± √°n h·ª£p t√°c chuy√™n nghi·ªáp
            </p>
          </div>
        </div>

        <div className="w-full lg:w-[55%] px-10 py-8 flex items-center justify-center">
          <div className="w-full max-w-sm">
            <h2 className="text-2xl font-semibold mb-2">ƒêƒÉng nh·∫≠p</h2>
            <p className="text-sm text-[#6B7280] mb-6">
              Nh·∫≠p th√¥ng tin ƒë·ªÉ ti·∫øp t·ª•c
            </p>

            {error && (
              <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm">
                {error}
              </div>
            )}

            <form onSubmit={handleSubmit} className="space-y-4">
              <input
                type="email"
                placeholder="Email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                className="w-full px-3 py-2.5 border rounded-lg"
                required
              />

              <input
                type="password"
                placeholder="M·∫≠t kh·∫©u"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                className="w-full px-3 py-2.5 border rounded-lg"
                required
              />

              <button
                type="submit"
                disabled={loading}
                className="w-full py-2.5 rounded-lg text-white font-medium bg-gradient-to-r from-[#6366F1] to-[#EC4899] disabled:opacity-50"
              >
                {loading ? 'ƒêang ƒëƒÉng nh·∫≠p...' : 'ƒêƒÉng nh·∫≠p'}
              </button>
            </form>

            <div className="my-5 text-center text-xs text-[#9CA3AF]">HO·∫∂C</div>

            <button
              onClick={handleGoogleLogin}
              className="w-full py-2.5 border rounded-lg text-sm hover:bg-gray-50 flex items-center justify-center gap-3"
            >
              <svg className="w-5 h-5" viewBox="0 0 24 24">
                <path
                  fill="#4285F4"
                  d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                />
                <path
                  fill="#34A853"
                  d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                />
                <path
                  fill="#FBBC05"
                  d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                />
                <path
                  fill="#EA4335"
                  d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                />
              </svg>
              ƒêƒÉng nh·∫≠p v·ªõi Google
            </button>

            <p className="mt-6 text-center text-sm text-[#6B7280]">
              Ch∆∞a c√≥ t√†i kho·∫£n?{' '}
              <Link to="/signup" className="text-[#6366F1] font-medium">
                ƒêƒÉng k√Ω
              </Link>
            </p>
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/SignupPage.tsx">
import { useState } from 'react'
import { Link, useNavigate } from 'react-router-dom'
import { getSupabase } from '../lib/supabase'

export default function SignupPage() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [confirmPassword, setConfirmPassword] = useState('')
  const [error, setError] = useState('')
  const [loading, setLoading] = useState(false)
  const navigate = useNavigate()
  const supabase = getSupabase()

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')

    if (password !== confirmPassword) {
      setError('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp')
      return
    }

    if (password.length < 6) {
      setError('M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±')
      return
    }

    setLoading(true)

    try {
      const { error } = await supabase.auth.signUp({
        email,
        password,
        options: {
          emailRedirectTo: `${window.location.origin}/verify-email`,
        },
      })

      if (error) {
        setError(error.message || 'ƒêƒÉng k√Ω th·∫•t b·∫°i')
        setLoading(false)
        return
      }

      navigate('/?signup=success', { replace: true })
    } catch (err) {
      setError('C√≥ l·ªói x·∫£y ra')
      setLoading(false)
    }
  }

  const handleGoogleSignup = async () => {
    const { data, error } = await supabase.auth.signInWithOAuth({
      provider: 'google',
      options: {
        redirectTo: `${window.location.origin}/app`,
      },
    })

    if (error) {
      setError(error.message)
      return
    }

    if (data.url) {
      window.location.href = data.url
    }
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-[#F9FAFB] px-6 pt-16">
      <div className="w-full max-w-6xl bg-white rounded-3xl shadow-xl overflow-hidden flex">
        <div className="hidden lg:flex w-[45%] bg-gradient-to-br from-[#6366F1]/20 via-[#7C3AED]/15 to-[#EC4899]/20">
          <div className="flex flex-col px-12 pt-12 items-center">
            <img
              src="/logo/logo.png"
              alt="ALINO"
              className="w-40 h-40 mb-6"
            />
            <h1 className="text-3xl font-semibold text-[#1F2937] mb-3">
              T·∫°o t√†i kho·∫£n m·ªõi
            </h1>
            <p className="text-[#6B7280] leading-relaxed">
              B·∫Øt ƒë·∫ßu h√†nh tr√¨nh h·ª£p t√°c v·ªõi Alino
            </p>
          </div>
        </div>

        <div className="w-full lg:w-[55%] px-10 py-8 flex items-center justify-center">
          <div className="w-full max-w-sm">
            <h2 className="text-2xl font-semibold mb-2">ƒêƒÉng k√Ω</h2>
            <p className="text-sm text-[#6B7280] mb-6">
              T·∫°o t√†i kho·∫£n m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu
            </p>

            {error && (
              <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm">
                {error}
              </div>
            )}

            <form onSubmit={handleSubmit} className="space-y-4">
              <input
                type="email"
                placeholder="Email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                className="w-full px-3 py-2.5 border rounded-lg"
                required
              />

              <input
                type="password"
                placeholder="M·∫≠t kh·∫©u"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                className="w-full px-3 py-2.5 border rounded-lg"
                required
              />

              <input
                type="password"
                placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u"
                value={confirmPassword}
                onChange={(e) => setConfirmPassword(e.target.value)}
                className="w-full px-3 py-2.5 border rounded-lg"
                required
              />

              <button
                type="submit"
                disabled={loading}
                className="w-full py-2.5 rounded-lg text-white font-medium bg-gradient-to-r from-[#6366F1] to-[#EC4899] disabled:opacity-50"
              >
                {loading ? 'ƒêang t·∫°o t√†i kho·∫£n...' : 'ƒêƒÉng k√Ω'}
              </button>
            </form>

            <div className="my-5 text-center text-xs text-[#9CA3AF]">HO·∫∂C</div>

            <button
              onClick={handleGoogleSignup}
              className="w-full py-2.5 border rounded-lg text-sm hover:bg-gray-50 flex items-center justify-center gap-3"
            >
              <svg className="w-5 h-5" viewBox="0 0 24 24">
                <path
                  fill="#4285F4"
                  d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                />
                <path
                  fill="#34A853"
                  d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                />
                <path
                  fill="#FBBC05"
                  d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                />
                <path
                  fill="#EA4335"
                  d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                />
              </svg>
              ƒêƒÉng k√Ω v·ªõi Google
            </button>

            <p className="mt-6 text-center text-sm text-[#6B7280]">
              ƒê√£ c√≥ t√†i kho·∫£n?{' '}
              <Link to="/login" className="text-[#6366F1] font-medium">
                ƒêƒÉng nh·∫≠p
              </Link>
            </p>
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/VerifyEmailPage.tsx">
import { useEffect } from 'react'
import { Link } from 'react-router-dom'
import { getSupabase } from '../lib/supabase'

export default function VerifyEmailPage() {
  const supabase = getSupabase()

  useEffect(() => {
    // Sign out any existing session to prevent auto-login
    supabase.auth.signOut()
  }, [])

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-[#EEF1FF] via-[#F5F7FF] to-white py-20 px-6 pt-24">
      <div className="w-full max-w-md">
        <div className="bg-white/90 backdrop-blur-xl rounded-3xl p-8 shadow-xl border border-black/5 text-center">
          <div className="w-16 h-16 mx-auto mb-6 rounded-full bg-gradient-to-r from-[#6366F1] to-[#EC4899] flex items-center justify-center">
            <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>

          <h1 className="text-3xl font-semibold tracking-tight mb-4">
            X√°c th·ª±c th√†nh c√¥ng
          </h1>

          <p className="text-[#6B7280] mb-8 leading-relaxed">
            T√†i kho·∫£n ƒë√£ ƒë∆∞·ª£c x√°c th·ª±c. Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c.
          </p>

          <Link
            to="/login"
            className="inline-block px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] hover:scale-105 transition-transform shadow-lg shadow-[#6366F1]/25"
          >
            ƒêƒÉng nh·∫≠p
          </Link>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/components/layout/UserMenu.tsx">
import { useState, useRef, useEffect } from 'react'
import { Link, useNavigate } from 'react-router-dom'
import { useAuth } from '../../hooks/useAuth'

interface UserMenuProps {
  userEmail: string
  displayName?: string
  avatarUrl?: string | null
  role?: string | null
}

export default function UserMenu({ userEmail, displayName, avatarUrl, role }: UserMenuProps) {
  const [isOpen, setIsOpen] = useState(false)
  const menuRef = useRef<HTMLDivElement>(null)
  const navigate = useNavigate()
  const { signOut } = useAuth()

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {
        setIsOpen(false)
      }
    }

    if (isOpen) {
      document.addEventListener('mousedown', handleClickOutside)
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside)
    }
  }, [isOpen])

  const handleLogout = async () => {
    setIsOpen(false)
    await signOut()
  }

  const nameToShow = displayName || userEmail.split('@')[0]

  return (
    <div
      className="relative"
      ref={menuRef}
      onMouseEnter={() => setIsOpen(true)}
      onMouseLeave={() => setIsOpen(false)}
    >
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-2 px-0 py-0 text-[#6B7280] hover:text-[#6366F1] transition-colors group"
      >
        {avatarUrl ? (
          <img 
            src={avatarUrl} 
            alt={nameToShow}
            className="w-6 h-6 rounded-full object-cover flex-shrink-0"
          />
        ) : (
          <div className="w-6 h-6 rounded-full bg-gradient-to-r from-[#6366F1] to-[#EC4899] flex items-center justify-center text-white font-medium text-xs flex-shrink-0">
            {nameToShow.charAt(0).toUpperCase()}
          </div>
        )}
        <span className="text-sm whitespace-nowrap">
          {nameToShow}
        </span>
      </button>

      {isOpen && (
        <div className="absolute right-0 top-full pt-2 w-56 z-50">
          <div className="bg-white rounded-xl shadow-lg border border-gray-200 py-2">
            <Link
              to="/dashboard"
              onClick={() => setIsOpen(false)}
              className="block px-4 py-2.5 text-sm text-[#374151] hover:bg-gray-50 transition-colors"
            >
              Qu·∫£n l√Ω d·ª± √°n
            </Link>
            <div className="border-t border-gray-200 my-1" />
            <button
              onClick={handleLogout}
              className="block w-full text-left px-4 py-2.5 text-sm text-red-600 hover:bg-gray-50 transition-colors"
            >
              ƒêƒÉng xu·∫•t
            </button>
          </div>
        </div>
      )}
    </div>
  )
}
</file>

<file path="src/pages/LandingPage.tsx">
import { useEffect, useState } from 'react'
import { Link, useSearchParams } from 'react-router-dom'

export default function LandingPage() {
  const [searchParams, setSearchParams] = useSearchParams()
  const [showMessage, setShowMessage] = useState(false)

  useEffect(() => {
    if (searchParams.get('signup') === 'success') {
      setShowMessage(true)
      // Remove query param from URL
      setSearchParams({}, { replace: true })
    }
  }, [searchParams, setSearchParams])

  return (
    <div className="relative overflow-x-hidden bg-white pt-16">
      <div className="min-h-screen">
        <section className="max-w-7xl mx-auto px-6 py-20">
          <div className="text-center">
            {showMessage && (
              <div className="mb-8 max-w-2xl mx-auto">
                <div className="bg-green-50 border border-green-200 rounded-xl p-4 text-green-700">
                  <p className="font-medium">
                    Vui l√≤ng ki·ªÉm tra email ƒë·ªÉ x√°c th·ª±c t√†i kho·∫£n.
                  </p>
                </div>
              </div>
            )}
            <h1 className="text-5xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-[#6366F1] to-[#EC4899] bg-clip-text text-transparent">
              Qu·∫£n l√Ω h·ª£p t√°c Creator - Brand
            </h1>
            <p className="text-xl text-[#6B7280] mb-8 max-w-2xl mx-auto">
              N·ªÅn t·∫£ng qu·∫£n l√Ω h·ª£p t√°c chuy√™n nghi·ªáp gi·ªØa Creator v√† Brand
            </p>
            <div className="flex gap-4 justify-center">
              <Link
                to="/signup"
                className="px-8 py-3 rounded-full font-semibold text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] hover:scale-105 transition-transform shadow-lg shadow-[#6366F1]/25"
              >
                B·∫Øt ƒë·∫ßu ngay
              </Link>
              <Link
                to="/login"
                className="px-8 py-3 rounded-full font-semibold text-[#6366F1] border-2 border-[#6366F1] hover:bg-[#6366F1] hover:text-white transition-colors"
              >
                ƒêƒÉng nh·∫≠p
              </Link>
            </div>
          </div>
        </section>
      </div>
    </div>
  )
}
</file>

<file path="src/pages/RolePage.tsx">
import { useState } from 'react'
import { useNavigate } from 'react-router-dom'
import { useAuth } from '../hooks/useAuth'
import { getSupabase } from '../lib/supabase'

export default function RolePage() {
  const { session } = useAuth()
  const [loading, setLoading] = useState(false)
  const navigate = useNavigate()
  const supabase = getSupabase()

  const handleSelectRole = async (role: 'creator' | 'brand') => {
    if (!session) return

    setLoading(true)

    try {
      // Update role directly to profiles table
      const { error } = await supabase
        .from('profiles')
        .update({
          role,
          updated_at: new Date().toISOString(),
        })
        .eq('id', session.user.id)

      if (error) throw error

      // After success ‚Üí navigate('/app')
      navigate('/app', { replace: true })
    } catch (err: any) {
      setLoading(false)
      alert(err.message || 'C√≥ l·ªói x·∫£y ra khi ch·ªçn vai tr√≤')
    }
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-[#EEF1FF] via-[#F5F7FF] to-white py-20 px-6 pt-24">
      <div className="w-full max-w-4xl">
        <div className="text-center mb-12">
          <h1 className="text-4xl md:text-5xl font-semibold tracking-tight mb-4">
            Ch·ªçn vai tr√≤ c·ªßa b·∫°n
          </h1>
          <p className="text-lg text-[#6B7280] max-w-2xl mx-auto">
            Ch·ªçn vai tr√≤ ph√π h·ª£p v·ªõi c√°ch b·∫°n s·ª≠ d·ª•ng ALINO. B·∫°n c√≥ th·ªÉ thay ƒë·ªïi sau.
          </p>
        </div>

        <div className="grid md:grid-cols-2 gap-6">
          <button
            onClick={() => handleSelectRole('creator')}
            disabled={loading}
            className="p-8 bg-white rounded-2xl border-2 border-gray-200 hover:border-[#6366F1] transition-colors text-left disabled:opacity-50"
          >
            <h3 className="text-2xl font-semibold mb-2">Creator</h3>
            <p className="text-[#6B7280]">
              T√¥i l√† Creator mu·ªën h·ª£p t√°c v·ªõi c√°c Brand
            </p>
          </button>

          <button
            onClick={() => handleSelectRole('brand')}
            disabled={loading}
            className="p-8 bg-white rounded-2xl border-2 border-gray-200 hover:border-[#6366F1] transition-colors text-left disabled:opacity-50"
          >
            <h3 className="text-2xl font-semibold mb-2">Brand</h3>
            <p className="text-[#6B7280]">
              T√¥i l√† Brand mu·ªën h·ª£p t√°c v·ªõi c√°c Creator
            </p>
          </button>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="src/types/profile.ts">
// Core profile fields (matches FINAL schema)
export interface Profile {
  id: string
  role: 'creator' | 'brand' | null
  display_name?: string | null
  avatar_url?: string | null
  bio?: string | null
  birth_year?: number | null
  country?: string | null
  city?: string | null
  onboarding_completed: boolean
  onboarding_data?: any
  is_admin?: boolean
  created_at?: string
  updated_at?: string
}

// Creator-specific fields (matches FINAL schema)
export interface CreatorProfile extends Profile {
  role: 'creator'
  creator_platforms?: string[] | null // TEXT[]
  content_categories?: string[] | null // TEXT[]
  followers_count?: number | null
  avg_views?: number | null
  collaboration_expectation?: string[] | null // TEXT[]
}

// Brand-specific fields (matches FINAL schema)
export interface BrandProfile extends Profile {
  role: 'brand'
  brand_name?: string | null
  industry?: string | null
  company_size?: string | null
  monthly_marketing_budget?: number | null // NUMERIC
  target_platforms?: string[] | null // TEXT[]
  collaboration_goal?: string[] | null // TEXT[]
}

export type ProfileWithRole = CreatorProfile | BrandProfile
</file>

<file path="src/vite-env.d.ts">
/// <reference types="vite/client" />
</file>

<file path="src/components/layout/Header.tsx">
import { Link, useLocation, useNavigate } from 'react-router-dom'
import { useAuth } from '../../hooks/useAuth'
import { useProfile } from '../../hooks/useProfile'
import UserMenu from './UserMenu'

/**
 * Landing Page Header Component
 * - Used ONLY on landing pages (not dashboard)
 * - Contains: Logo | Navigation | UserMenu
 */
export default function Header() {
  const { session, loading: authLoading } = useAuth()
  const { profile } = useProfile(session?.user?.id, !!session)
  const location = useLocation()
  const navigate = useNavigate()

  const handleLogoClick = (e: React.MouseEvent) => {
    e.preventDefault()
    if (location.pathname !== '/') navigate('/')
    window.scrollTo({ top: 0, behavior: 'smooth' })
  }

  const displayName =
    profile?.display_name ||
    session?.user?.user_metadata?.display_name ||
    undefined

  const avatarUrl =
    profile?.avatar_url ||
    session?.user?.user_metadata?.avatar_url ||
    undefined

  return (
    <header className="fixed top-0 inset-x-0 z-50 h-16 bg-white/80 backdrop-blur-xl border-b border-black/5">
      <div className="max-w-7xl mx-auto px-6 h-full flex items-center justify-between">
        {/* Logo */}
        <Link
          to="/"
          onClick={handleLogoClick}
          className="flex items-center gap-3"
        >
          <img src="/logo/logo.png" alt="ALINO" className="w-8 h-8" />
          <span className="font-bold text-2xl leading-tight bg-gradient-to-r from-[#6366F1] to-[#EC4899] bg-clip-text text-transparent">
            ALINO
          </span>
        </Link>

        {/* Navigation */}
        <nav className="hidden md:flex items-center gap-10 text-sm text-[#6B7280]">
          <a href="#about">V·ªÅ ch√∫ng t√¥i</a>
          <a href="#features">T√≠nh nƒÉng</a>
          <a href="#news">Tin t·ª©c</a>
          <a href="#contact">Li√™n h·ªá</a>
        </nav>

        {/* Actions */}
        <div className="flex items-center gap-4 text-sm">
          {authLoading ? null : session ? (
            <UserMenu
              userEmail={session.user.email || ''}
              displayName={displayName}
              avatarUrl={avatarUrl}
            />
          ) : (
            <>
              <Link to="/login">ƒêƒÉng nh·∫≠p</Link>
              <Link
                to="/signup"
                className="px-5 py-2.5 rounded-full text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899]"
              >
                ƒêƒÉng k√Ω
              </Link>
            </>
          )}
        </div>
      </div>
    </header>
  )
}
</file>

<file path="src/hooks/useProfile.ts">
import { useEffect, useState, useRef } from 'react'
import { getSupabase } from '../lib/supabase'
import type { Profile } from '../types/profile'

const PROFILE_FETCH_TIMEOUT = 3000 // 3 seconds

export function useProfile(
  userId: string | undefined,
  enabled: boolean
) {
  const [profile, setProfile] = useState<Profile | null>(null)
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)
  const supabase = getSupabase()
  const timeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null)

  useEffect(() => {
    if (!enabled || !userId) {
      setProfile(null)
      setLoading(false)
      setError(null)
      return
    }
  
    let mounted = true
  
    async function fetchProfile() {
      setLoading(true)
      setError(null)
  
      timeoutRef.current = setTimeout(() => {
        if (mounted) {
          setLoading(false)
          setError('Timeout loading profile')
        }
      }, PROFILE_FETCH_TIMEOUT)
  
      try {
        const { data, error: fetchError } = await supabase
  .from('profiles')
  .select(`
    id,
    role,
    onboarding_completed,
    avatar_url,
    display_name,
    bio,
    birth_year,
    country,
    city,
    followers_count,
    avg_views,
    creator_platforms,
    content_categories,
    collaboration_expectation,
    brand_name,
    industry,
    company_size,
    monthly_marketing_budget,
    target_platforms,
    collaboration_goal,
    created_at,
    updated_at
  `)
  .eq('id', userId)
  .single()
  
        if (timeoutRef.current) {
          clearTimeout(timeoutRef.current)
          timeoutRef.current = null
        }
  
        if (fetchError) {
          if (mounted) {
            setError(fetchError.message)
            setLoading(false)
          }
          return
        }
  
        if (mounted && data) {
          setProfile(data)
          setLoading(false)
        }
      } catch (err: any) {
        if (mounted) {
          setError(err.message || 'Failed to load profile')
          setLoading(false)
        }
      }
    }
  
    fetchProfile()
  
    return () => {
      mounted = false
      if (timeoutRef.current) {
        clearTimeout(timeoutRef.current)
      }
    }
  }, [userId, enabled, supabase])
  

  return { profile, loading, error }
}
</file>

<file path="src/pages/OnboardingPage.tsx">
import { useState, useEffect } from 'react'
import { useNavigate, Link } from 'react-router-dom'
import { useAuth } from '../hooks/useAuth'
import { getSupabase } from '../lib/supabase'

// Form state interfaces
interface CreatorFormData {
  display_name?: string
  country?: string
  city?: string
  birth_year?: number
  creator_platforms?: string[]
  followers_count?: number
  avg_views?: number
  content_categories?: string[]
  collaboration_expectation?: ('paid' | 'gift' | 'affiliate')[]
}

interface BrandFormData {
  company_name?: string
  industry?: string
  country?: string
  city?: string
  company_size?: string
  budget?: number
  campaign_budget_range?: string
  target_platforms?: string[]
  campaign_goal?: string
  preferred_collaboration_type?: ('paid' | 'gift' | 'affiliate')[]
}

export default function OnboardingPage() {
  const { session } = useAuth()
  const navigate = useNavigate()
  const supabase = getSupabase()
  const [currentStep, setCurrentStep] = useState(1)
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState('')
  const [role, setRole] = useState<'creator' | 'brand' | null>(null)
  
  // Form state - separate for creator and brand
  const [creatorData, setCreatorData] = useState<CreatorFormData>({})
  const [brandData, setBrandData] = useState<BrandFormData>({})

  useEffect(() => {
    if (!session) return
    checkOnboardingStatus()
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [session])

  async function checkOnboardingStatus() {
    if (!session) return

    try {
      const { data, error } = await supabase
        .from('profiles')
        .select('onboarding_completed, role, onboarding_data')
        .eq('id', session.user.id)
        .single()

      if (error && error.code !== 'PGRST116') throw error

      // Let AppGate handle redirects - don't redirect here
      if (data?.role) {
        setRole(data.role)
        loadExistingData(data.role, data.onboarding_data)
      }
    } catch (err) {
      console.error('Error checking onboarding:', err)
    }
  }

  async function loadExistingData(userRole: 'creator' | 'brand', onboardingData: any) {
    if (!session) return

    try {
      // Read from onboarding_data JSON, not profile columns
      const data = onboardingData || {}

      if (userRole === 'creator') {
        const step2 = data.step2 || {}
        const step3 = data.step3 || {}
        const step4 = data.step4 || {}
        
        const cd: CreatorFormData = {
          display_name: step2.display_name || undefined,
          country: step2.country || undefined,
          city: step2.city || undefined,
          birth_year: step2.birth_year || undefined,
          creator_platforms: step3.creator_platforms || undefined,
          followers_count: step3.followers_count || undefined,
          avg_views: step3.avg_views || undefined,
          content_categories: step3.content_categories || undefined,
          collaboration_expectation: step4.collaboration_expectation || undefined,
        }
        setCreatorData(cd)

        // Determine current step based on onboarding_data
        if (!step2.display_name) {
          setCurrentStep(2)
        } else if (!step3.creator_platforms || step3.creator_platforms.length === 0) {
          setCurrentStep(3)
        } else if (!step4.collaboration_expectation || step4.collaboration_expectation.length === 0) {
          setCurrentStep(4)
        } else {
          setCurrentStep(5)
        }
      } else {
        const step2 = data.step2 || {}
        const step3 = data.step3 || {}
        const step4 = data.step4 || {}
        
        const bd: BrandFormData = {
          company_name: step2.company_name || undefined,
          industry: step2.industry || undefined,
          country: step2.country || undefined,
          city: step2.city || undefined,
          company_size: step3.company_size || undefined,
          budget: step3.budget || undefined,
          campaign_budget_range: step3.campaign_budget_range || undefined,
          target_platforms: step3.target_platforms || undefined,
          campaign_goal: step4.campaign_goal || undefined,
          preferred_collaboration_type: step4.preferred_collaboration_type || undefined,
        }
        setBrandData(bd)

        // Determine current step based on onboarding_data
        if (!step2.company_name) {
          setCurrentStep(2)
        } else if (!step3.company_size) {
          setCurrentStep(3)
        } else if (!step4.campaign_goal) {
          setCurrentStep(4)
        } else {
          setCurrentStep(5)
        }
      }
    } catch (err) {
      console.error('Error loading existing data:', err)
    }
  }

  // Helper to merge onboarding_data JSON
  async function mergeOnboardingData(stepKey: string, stepData: any) {
    if (!session) return null

    // Fetch current onboarding_data
    const { data: profile, error: fetchError } = await supabase
      .from('profiles')
      .select('onboarding_data')
      .eq('id', session.user.id)
      .single()

    if (fetchError) throw fetchError

    // Merge new step data into existing onboarding_data
    const currentData = profile?.onboarding_data || {}
    const mergedData = {
      ...currentData,
      [stepKey]: stepData,
    }

    // Update only onboarding_data column
    const { error: updateError } = await supabase
      .from('profiles')
      .update({
        onboarding_data: mergedData,
        updated_at: new Date().toISOString(),
      })
      .eq('id', session.user.id)

    if (updateError) throw updateError

    return mergedData
  }

  async function saveStep(stepData: CreatorFormData | BrandFormData, nextStep?: number) {
    if (!session || !role) return

    setLoading(true)
    setError('')

    try {
      // Determine step key based on current step
      const stepKey = `step${currentStep}`

      // Update local state
      if (role === 'creator') {
        const cd = { ...creatorData, ...stepData } as CreatorFormData
        setCreatorData(cd)
      } else {
        const bd = { ...brandData, ...stepData } as BrandFormData
        setBrandData(bd)
      }

      // Save to onboarding_data JSON (merge)
      await mergeOnboardingData(stepKey, stepData)

      if (nextStep) {
        setCurrentStep(nextStep)
      }
    } catch (err: any) {
      setError(err.message || 'C√≥ l·ªói x·∫£y ra khi l∆∞u d·ªØ li·ªáu')
    } finally {
      setLoading(false)
    }
  }

  async function handleComplete() {
    if (!session || !role) return

    setLoading(true)
    setError('')

    try {
      // Fetch onboarding_data
      const { data: profile, error: fetchError } = await supabase
        .from('profiles')
        .select('onboarding_data')
        .eq('id', session.user.id)
        .single()

      if (fetchError) throw fetchError

      const onboardingData = profile?.onboarding_data || {}

      // Map onboarding_data to profile columns
      const updateData: any = {
        onboarding_completed: true,
        updated_at: new Date().toISOString(),
      }

      if (role === 'creator') {
        const step2 = onboardingData.step2 || {}
        const step3 = onboardingData.step3 || {}
        const step4 = onboardingData.step4 || {}

        updateData.display_name = step2.display_name || null
        updateData.country = step2.country || null
        updateData.city = step2.city || null
        updateData.birth_year = step2.birth_year || null
        updateData.creator_platforms = step3.creator_platforms || null
        updateData.followers_count = step3.followers_count || null
        updateData.avg_views = step3.avg_views || null
        updateData.content_categories = step3.content_categories || null
        updateData.collaboration_expectation = step4.collaboration_expectation || null
      } else {
        const step2 = onboardingData.step2 || {}
        const step3 = onboardingData.step3 || {}
        const step4 = onboardingData.step4 || {}

        updateData.brand_name = step2.company_name || null
        updateData.industry = step2.industry || null
        updateData.country = step2.country || null
        updateData.city = step2.city || null
        updateData.company_size = step3.company_size || null
        // monthly_marketing_budget must be NUMERIC (convert to number)
        const budgetValue = step3.budget || step3.campaign_budget_range
        updateData.monthly_marketing_budget = budgetValue ? (typeof budgetValue === 'string' ? parseFloat(budgetValue.replace(/[^0-9.]/g, '')) || null : Number(budgetValue)) : null
        updateData.target_platforms = step3.target_platforms || null
        // collaboration_goal must be TEXT[] (array), convert string to array if needed
        const goalValue = step4.campaign_goal || step4.collaboration_goal
        updateData.collaboration_goal = Array.isArray(goalValue) ? goalValue : (goalValue ? [goalValue] : null)
      }

      // Update profile columns and set onboarding_completed = true
      const { error } = await supabase
        .from('profiles')
        .update(updateData)
        .eq('id', session.user.id)

      if (error) throw error

      // Insert consent record
      const { error: consentError } = await supabase
        .from('user_consents')
        .insert({
          user_id: session.user.id,
          policy_version: 'v1.0',
          accepted_via: 'onboarding',
          accepted_at: new Date().toISOString(),
        })

      if (consentError) {
        console.error('Error inserting consent:', consentError)
        // Don't block onboarding if consent insert fails
      }

      // Redirect to /app - AppGate will handle routing
      navigate('/app', { replace: true })
    } catch (err: any) {
      setError(err.message || 'C√≥ l·ªói x·∫£y ra khi ho√†n t·∫•t onboarding')
      setLoading(false)
    }
  }

  if (!role) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-[#6B7280]">ƒêang t·∫£i...</div>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-[#EEF1FF] via-[#F5F7FF] to-white py-20 px-6 pt-24">
      <div className="max-w-3xl mx-auto">
        <div className="bg-white/90 backdrop-blur-xl rounded-3xl p-8 md:p-10 shadow-xl border border-black/5">
          {/* Progress indicator */}
          <div className="mb-8">
            <div className="flex items-center justify-between mb-2">
              <span className="text-sm text-[#6B7280]">
                B∆∞·ªõc {currentStep} / 5
              </span>
              <span className="text-sm text-[#6B7280]">
                {Math.round((currentStep / 5) * 100)}%
              </span>
            </div>
            <div className="w-full bg-gray-200 rounded-full h-2">
              <div
                className="bg-gradient-to-r from-[#6366F1] to-[#EC4899] h-2 rounded-full transition-all"
                style={{ width: `${(currentStep / 5) * 100}%` }}
              />
            </div>
          </div>

          {error && (
            <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm">
              {error}
            </div>
          )}

          {/* Step 2: Basic Identity */}
          {currentStep === 2 && (
            <Step2BasicIdentity
              role={role}
              creatorData={creatorData}
              brandData={brandData}
              onSave={(data) => saveStep(data, 3)}
              loading={loading}
            />
          )}

          {/* Step 3: Business/Creator Metrics */}
          {currentStep === 3 && (
            <Step3Metrics
              role={role}
              creatorData={creatorData}
              brandData={brandData}
              onSave={(data) => saveStep(data, 4)}
              loading={loading}
            />
          )}

          {/* Step 4: Collaboration Intent */}
          {currentStep === 4 && (
            <Step4Collaboration
              role={role}
              creatorData={creatorData}
              brandData={brandData}
              onSave={(data) => saveStep(data, 5)}
              loading={loading}
            />
          )}

          {/* Step 5: Finalize */}
          {currentStep === 5 && (
            <Step5Finalize
              role={role}
              creatorData={creatorData}
              brandData={brandData}
              onComplete={handleComplete}
              loading={loading}
            />
          )}

          {/* Navigation buttons */}
          {currentStep > 2 && (
            <div className="mt-6 flex justify-between">
              <button
                onClick={() => setCurrentStep(currentStep - 1)}
                disabled={loading}
                className="px-6 py-2.5 rounded-xl font-medium text-[#6B7280] border border-gray-300 hover:bg-gray-50 disabled:opacity-50"
              >
                Quay l·∫°i
              </button>
            </div>
          )}
        </div>
      </div>
    </div>
  )
}

// Step 2: Basic Identity
function Step2BasicIdentity({
  role,
  creatorData,
  brandData,
  onSave,
  loading,
}: {
  role: 'creator' | 'brand'
  creatorData: CreatorFormData
  brandData: BrandFormData
  onSave: (data: CreatorFormData | BrandFormData) => void
  loading: boolean
}) {
  const [localData, setLocalData] = useState(
    role === 'creator'
      ? {
          display_name: creatorData.display_name || '',
          country: creatorData.country || '',
          city: creatorData.city || '',
          birth_year: creatorData.birth_year || undefined,
        }
      : {
          company_name: brandData.company_name || '',
          industry: brandData.industry || '',
          country: brandData.country || '',
          city: brandData.city || '',
        }
  )

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault()
    if (role === 'creator') {
      onSave({
        display_name: localData.display_name,
        country: localData.country,
        city: localData.city,
        birth_year: localData.birth_year,
      } as CreatorFormData)
    } else {
      onSave({
        company_name: localData.company_name,
        industry: localData.industry,
        country: localData.country,
        city: localData.city,
      } as BrandFormData)
    }
  }

  return (
    <form onSubmit={handleSubmit}>
      <h1 className="text-3xl font-semibold tracking-tight mb-4">
        Th√¥ng tin c∆° b·∫£n
      </h1>
      <p className="text-[#6B7280] mb-8">
        {role === 'creator' ? 'H√£y cho ch√∫ng t√¥i bi·∫øt v·ªÅ b·∫°n' : 'H√£y cho ch√∫ng t√¥i bi·∫øt v·ªÅ th∆∞∆°ng hi·ªáu c·ªßa b·∫°n'}
      </p>

      <div className="space-y-4">
        {role === 'creator' ? (
          <>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                T√™n hi·ªÉn th·ªã *
              </label>
              <input
                type="text"
                value={localData.display_name}
                onChange={(e) => setLocalData({ ...localData, display_name: e.target.value } as any)}
                className="w-full px-4 py-2.5 border rounded-lg"
                required
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Qu·ªëc gia *
              </label>
              <input
                type="text"
                value={localData.country}
                onChange={(e) => setLocalData({ ...localData, country: e.target.value })}
                className="w-full px-4 py-2.5 border rounded-lg"
                required
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Th√†nh ph·ªë *
              </label>
              <input
                type="text"
                value={localData.city}
                onChange={(e) => setLocalData({ ...localData, city: e.target.value })}
                className="w-full px-4 py-2.5 border rounded-lg"
                required
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                NƒÉm sinh
              </label>
              <input
                type="number"
                min="1950"
                max={new Date().getFullYear()}
                value={localData.birth_year || ''}
                onChange={(e) => setLocalData({ ...localData, birth_year: e.target.value ? parseInt(e.target.value) : undefined } as any)}
                className="w-full px-4 py-2.5 border rounded-lg"
              />
            </div>
          </>
        ) : (
          <>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                T√™n c√¥ng ty *
              </label>
              <input
                type="text"
                value={localData.company_name}
                onChange={(e) => setLocalData({ ...localData, company_name: e.target.value } as any)}
                className="w-full px-4 py-2.5 border rounded-lg"
                required
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Ng√†nh ngh·ªÅ *
              </label>
              <input
                type="text"
                value={localData.industry}
                onChange={(e) => setLocalData({ ...localData, industry: e.target.value } as any)}
                className="w-full px-4 py-2.5 border rounded-lg"
                required
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Qu·ªëc gia *
              </label>
              <input
                type="text"
                value={localData.country}
                onChange={(e) => setLocalData({ ...localData, country: e.target.value })}
                className="w-full px-4 py-2.5 border rounded-lg"
                required
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Th√†nh ph·ªë *
              </label>
              <input
                type="text"
                value={localData.city}
                onChange={(e) => setLocalData({ ...localData, city: e.target.value })}
                className="w-full px-4 py-2.5 border rounded-lg"
                required
              />
            </div>
          </>
        )}

        <button
          type="submit"
          disabled={loading}
          className="w-full px-6 py-2.5 rounded-xl font-medium text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] disabled:opacity-50"
        >
          {loading ? 'ƒêang l∆∞u...' : 'Ti·∫øp t·ª•c'}
        </button>
      </div>
    </form>
  )
}

// Step 3: Business/Creator Metrics
function Step3Metrics({
  role,
  creatorData,
  brandData,
  onSave,
  loading,
}: {
  role: 'creator' | 'brand'
  creatorData: CreatorFormData
  brandData: BrandFormData
  onSave: (data: CreatorFormData | BrandFormData) => void
  loading: boolean
}) {
  const platforms = ['TikTok', 'Instagram', 'YouTube', 'Facebook', 'Twitter', 'LinkedIn']
  
  const [localData, setLocalData] = useState(
    role === 'creator'
      ? {
          creator_platforms: creatorData.creator_platforms || [],
          followers_count: creatorData.followers_count || undefined,
          avg_views: creatorData.avg_views || undefined,
          content_categories: creatorData.content_categories || [],
        }
      : {
          company_size: brandData.company_size || '',
          budget: brandData.budget || undefined,
          campaign_budget_range: brandData.campaign_budget_range || '',
          target_platforms: brandData.target_platforms || [],
        }
  )

  const togglePlatform = (platform: string, type: 'creator' | 'target') => {
    if (type === 'creator') {
      const current = localData.creator_platforms || []
      const updated = current.includes(platform)
        ? current.filter((p) => p !== platform)
        : [...current, platform]
      setLocalData({ ...localData, creator_platforms: updated } as any)
    } else {
      const current = localData.target_platforms || []
      const updated = current.includes(platform)
        ? current.filter((p) => p !== platform)
        : [...current, platform]
      setLocalData({ ...localData, target_platforms: updated } as any)
    }
  }

  const toggleCategory = (category: string) => {
    const current = localData.content_categories || []
    const updated = current.includes(category)
      ? current.filter((c) => c !== category)
      : [...current, category]
      setLocalData({ ...localData, content_categories: updated } as any)
  }

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault()
    if (role === 'creator') {
      onSave({
        creator_platforms: localData.creator_platforms,
        followers_count: localData.followers_count,
        avg_views: localData.avg_views,
        content_categories: localData.content_categories,
      } as CreatorFormData)
    } else {
      onSave({
        company_size: localData.company_size,
        budget: localData.budget,
        campaign_budget_range: localData.campaign_budget_range,
        target_platforms: localData.target_platforms,
      } as BrandFormData)
    }
  }

  const categories = ['Beauty', 'Fashion', 'Food', 'Travel', 'Tech', 'Fitness', 'Lifestyle', 'Education']

  return (
    <form onSubmit={handleSubmit}>
      <h1 className="text-3xl font-semibold tracking-tight mb-4">
        {role === 'creator' ? 'Th√¥ng tin Creator' : 'Th√¥ng tin Brand'}
      </h1>
      <p className="text-[#6B7280] mb-8">
        {role === 'creator' ? 'Chia s·∫ª v·ªÅ k√™nh v√† n·ªôi dung c·ªßa b·∫°n' : 'Chia s·∫ª v·ªÅ quy m√¥ v√† ng√¢n s√°ch marketing'}
      </p>

      <div className="space-y-4">
        {role === 'creator' ? (
          <>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                N·ªÅn t·∫£ng b·∫°n s·ª≠ d·ª•ng *
              </label>
              <div className="grid grid-cols-2 gap-2">
                {platforms.map((platform) => (
                  <button
                    key={platform}
                    type="button"
                    onClick={() => togglePlatform(platform, 'creator')}
                    className={`px-4 py-2 rounded-lg border text-sm ${
                      localData.creator_platforms?.includes(platform)
                        ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                        : 'border-gray-300 hover:border-gray-400'
                    }`}
                  >
                    {platform}
                  </button>
                ))}
              </div>
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                S·ªë l∆∞·ª£ng ng∆∞·ªùi theo d√µi
              </label>
              <input
                type="number"
                min="0"
                value={localData.followers_count || ''}
                onChange={(e) => setLocalData({ ...localData, followers_count: e.target.value ? parseInt(e.target.value) : undefined } as any)}
                className="w-full px-4 py-2.5 border rounded-lg"
                placeholder="V√≠ d·ª•: 100000"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                L∆∞·ª£t xem trung b√¨nh
              </label>
              <input
                type="number"
                min="0"
                value={localData.avg_views || ''}
                onChange={(e) => setLocalData({ ...localData, avg_views: e.target.value ? parseInt(e.target.value) : undefined } as any)}
                className="w-full px-4 py-2.5 border rounded-lg"
                placeholder="V√≠ d·ª•: 50000"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Danh m·ª•c n·ªôi dung
              </label>
              <div className="grid grid-cols-2 gap-2">
                {categories.map((category) => (
                  <button
                    key={category}
                    type="button"
                    onClick={() => toggleCategory(category)}
                    className={`px-4 py-2 rounded-lg border text-sm ${
                      localData.content_categories?.includes(category)
                        ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                        : 'border-gray-300 hover:border-gray-400'
                    }`}
                  >
                    {category}
                  </button>
                ))}
              </div>
            </div>
          </>
        ) : (
          <>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Quy m√¥ c√¥ng ty *
              </label>
              <select
                value={localData.company_size}
                onChange={(e) => setLocalData({ ...localData, company_size: e.target.value } as any)}
                className="w-full px-4 py-2.5 border rounded-lg"
                required
              >
                <option value="">Ch·ªçn quy m√¥</option>
                <option value="startup">Startup (1-10 nh√¢n vi√™n)</option>
                <option value="small">Nh·ªè (11-50 nh√¢n vi√™n)</option>
                <option value="medium">V·ª´a (51-200 nh√¢n vi√™n)</option>
                <option value="large">L·ªõn (201-1000 nh√¢n vi√™n)</option>
                <option value="enterprise">Doanh nghi·ªáp (1000+ nh√¢n vi√™n)</option>
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Ng√¢n s√°ch marketing (USD)
              </label>
              <input
                type="number"
                min="0"
                value={localData.budget || ''}
                onChange={(e) => setLocalData({ ...localData, budget: e.target.value ? parseInt(e.target.value) : undefined } as any)}
                className="w-full px-4 py-2.5 border rounded-lg"
                placeholder="V√≠ d·ª•: 5000"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Kho·∫£ng ng√¢n s√°ch chi·∫øn d·ªãch
              </label>
              <input
                type="text"
                value={localData.campaign_budget_range}
                onChange={(e) => setLocalData({ ...localData, campaign_budget_range: e.target.value } as any)}
                className="w-full px-4 py-2.5 border rounded-lg"
                placeholder="V√≠ d·ª•: $1000 - $5000"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                N·ªÅn t·∫£ng m·ª•c ti√™u *
              </label>
              <div className="grid grid-cols-2 gap-2">
                {platforms.map((platform) => (
                  <button
                    key={platform}
                    type="button"
                    onClick={() => togglePlatform(platform, 'target')}
                    className={`px-4 py-2 rounded-lg border text-sm ${
                      localData.target_platforms?.includes(platform)
                        ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                        : 'border-gray-300 hover:border-gray-400'
                    }`}
                  >
                    {platform}
                  </button>
                ))}
              </div>
            </div>
          </>
        )}

        <button
          type="submit"
          disabled={loading}
          className="w-full px-6 py-2.5 rounded-xl font-medium text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] disabled:opacity-50"
        >
          {loading ? 'ƒêang l∆∞u...' : 'Ti·∫øp t·ª•c'}
        </button>
      </div>
    </form>
  )
}

// Step 4: Collaboration Intent
function Step4Collaboration({
  role,
  creatorData,
  brandData,
  onSave,
  loading,
}: {
  role: 'creator' | 'brand'
  creatorData: CreatorFormData
  brandData: BrandFormData
  onSave: (data: CreatorFormData | BrandFormData) => void
  loading: boolean
}) {
  const collaborationTypes: ('paid' | 'gift' | 'affiliate')[] = ['paid', 'gift', 'affiliate']
  
  const [localData, setLocalData] = useState(
    role === 'creator'
      ? {
          collaboration_expectation: creatorData.collaboration_expectation || [],
        }
      : {
          campaign_goal: brandData.campaign_goal || '',
          preferred_collaboration_type: brandData.preferred_collaboration_type || [],
        }
  )

  const toggleCollaborationType = (type: 'paid' | 'gift' | 'affiliate') => {
    if (role === 'creator') {
      const current = localData.collaboration_expectation || []
      const updated = current.includes(type)
        ? current.filter((t) => t !== type)
        : [...current, type]
      setLocalData({ ...localData, collaboration_expectation: updated } as any)
    } else {
      const current = localData.preferred_collaboration_type || []
      const updated = current.includes(type)
        ? current.filter((t) => t !== type)
        : [...current, type]
      setLocalData({ ...localData, preferred_collaboration_type: updated } as any)
    }
  }

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault()
    if (role === 'creator') {
      onSave({
        collaboration_expectation: localData.collaboration_expectation,
      } as CreatorFormData)
    } else {
      onSave({
        campaign_goal: localData.campaign_goal,
        preferred_collaboration_type: localData.preferred_collaboration_type,
      } as BrandFormData)
    }
  }

  return (
    <form onSubmit={handleSubmit}>
      <h1 className="text-3xl font-semibold tracking-tight mb-4">
        M·ª•c ti√™u h·ª£p t√°c
      </h1>
      <p className="text-[#6B7280] mb-8">
        {role === 'creator' ? 'B·∫°n mong ƒë·ª£i g√¨ t·ª´ c√°c h·ª£p t√°c?' : 'M·ª•c ti√™u h·ª£p t√°c c·ªßa th∆∞∆°ng hi·ªáu l√† g√¨?'}
      </p>

      <div className="space-y-4">
        {role === 'creator' ? (
          <>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Lo·∫°i h·ª£p t√°c mong mu·ªën *
              </label>
              <div className="grid grid-cols-3 gap-2">
                {collaborationTypes.map((type) => (
                  <button
                    key={type}
                    type="button"
                    onClick={() => toggleCollaborationType(type)}
                    className={`px-4 py-2 rounded-lg border text-sm ${
                      localData.collaboration_expectation?.includes(type)
                        ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                        : 'border-gray-300 hover:border-gray-400'
                    }`}
                  >
                    {type === 'paid' ? 'Tr·∫£ ph√≠' : type === 'gift' ? 'Qu√† t·∫∑ng' : 'Affiliate'}
                  </button>
                ))}
              </div>
            </div>
          </>
        ) : (
          <>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                M·ª•c ti√™u chi·∫øn d·ªãch *
              </label>
              <textarea
                value={localData.campaign_goal}
                onChange={(e) => setLocalData({ ...localData, campaign_goal: e.target.value } as any)}
                rows={5}
                className="w-full px-4 py-2.5 border rounded-lg"
                placeholder="M√¥ t·∫£ m·ª•c ti√™u h·ª£p t√°c c·ªßa th∆∞∆°ng hi·ªáu..."
                required
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Lo·∫°i h·ª£p t√°c ∆∞a th√≠ch *
              </label>
              <div className="grid grid-cols-3 gap-2">
                {collaborationTypes.map((type) => (
                  <button
                    key={type}
                    type="button"
                    onClick={() => toggleCollaborationType(type)}
                    className={`px-4 py-2 rounded-lg border text-sm ${
                      localData.preferred_collaboration_type?.includes(type)
                        ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                        : 'border-gray-300 hover:border-gray-400'
                    }`}
                  >
                    {type === 'paid' ? 'Tr·∫£ ph√≠' : type === 'gift' ? 'Qu√† t·∫∑ng' : 'Affiliate'}
                  </button>
                ))}
              </div>
            </div>
          </>
        )}

        <button
          type="submit"
          disabled={loading}
          className="w-full px-6 py-2.5 rounded-xl font-medium text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] disabled:opacity-50"
        >
          {loading ? 'ƒêang l∆∞u...' : 'Ti·∫øp t·ª•c'}
        </button>
      </div>
    </form>
  )
}

// Step 5: Finalize
function Step5Finalize({
  role,
  creatorData,
  brandData,
  onComplete,
  loading,
}: {
  role: 'creator' | 'brand'
  creatorData: CreatorFormData
  brandData: BrandFormData
  onComplete: () => void
  loading: boolean
}) {
  return (
    <div>
      <h1 className="text-3xl font-semibold tracking-tight mb-4">
        Ho√†n t·∫•t thi·∫øt l·∫≠p
      </h1>
      <p className="text-[#6B7280] mb-8">
        B·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£ c√°c b∆∞·ªõc thi·∫øt l·∫≠p. Nh·∫•n "Ho√†n t·∫•t" ƒë·ªÉ b·∫Øt ƒë·∫ßu s·ª≠ d·ª•ng ALINO.
      </p>

      <div className="bg-gray-50 rounded-lg p-4 mb-6">
        <h3 className="font-medium mb-2">T√≥m t·∫Øt th√¥ng tin:</h3>
        <ul className="text-sm text-[#6B7280] space-y-1">
          {role === 'creator' && (
            <>
              <li>‚Ä¢ T√™n: {creatorData.display_name || 'Ch∆∞a c√≥'}</li>
              <li>‚Ä¢ ƒê·ªãa ƒëi·ªÉm: {creatorData.city && creatorData.country ? `${creatorData.city}, ${creatorData.country}` : 'Ch∆∞a c√≥'}</li>
              <li>‚Ä¢ N·ªÅn t·∫£ng: {creatorData.creator_platforms?.length || 0} n·ªÅn t·∫£ng</li>
            </>
          )}
          {role === 'brand' && (
            <>
              <li>‚Ä¢ C√¥ng ty: {brandData.company_name || 'Ch∆∞a c√≥'}</li>
              <li>‚Ä¢ Ng√†nh: {brandData.industry || 'Ch∆∞a c√≥'}</li>
              <li>‚Ä¢ Quy m√¥: {brandData.company_size || 'Ch∆∞a c√≥'}</li>
            </>
          )}
        </ul>
      </div>

      <p className="text-sm text-gray-600 mb-6 text-center">
        By clicking Continue, you agree to ALINO's{' '}
        <Link to="/terms" className="text-[#6366F1] hover:underline">
          Terms of Service
        </Link>
        {' '}and{' '}
        <Link to="/privacy" className="text-[#6366F1] hover:underline">
          Privacy Policy
        </Link>
        .
      </p>

      <button
        onClick={onComplete}
        disabled={loading}
        className="w-full px-6 py-2.5 rounded-xl font-medium text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] disabled:opacity-50"
      >
        {loading ? 'ƒêang x·ª≠ l√Ω...' : 'Ho√†n t·∫•t'}
      </button>
    </div>
  )
}
</file>

<file path="src/pages/ProfilePage.tsx">
import { useState, useEffect, useRef } from 'react'
import { useAuth } from '../hooks/useAuth'
import { useProfile } from '../hooks/useProfile'
import { getSupabase } from '../lib/supabase'
import type { Profile, CreatorProfile, BrandProfile } from '../types/profile'
import AvatarUpload from '../components/AvatarUpload'
import Toast from '../components/Toast'

export default function ProfilePage() {
  const { session, isAuthenticated } = useAuth()
  const { profile, loading: profileLoading } = useProfile(session?.user?.id, isAuthenticated)
  const [loading, setLoading] = useState(false)
  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null)
  const [fieldErrors, setFieldErrors] = useState<Record<string, string>>({})
  const supabase = getSupabase()
  
  // Refs for field focus/scroll
  const fieldRefs = useRef<Record<string, HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement | null>>({})

  // Form state - matches FINAL schema exactly
  interface ProfileFormData {
    // Core fields
    display_name?: string | null
    avatar_url?: string | null
    bio?: string | null
    birth_year?: number | null
    country?: string | null
    city?: string | null
    // Creator fields
    creator_platforms?: string[] | null // TEXT[]
    content_categories?: string[] | null // TEXT[]
    followers_count?: number | null
    avg_views?: number | null
    collaboration_expectation?: string[] | null // TEXT[]
    // Brand fields
    brand_name?: string | null
    industry?: string | null
    company_size?: string | null
    monthly_marketing_budget?: number | null // NUMERIC
    target_platforms?: string[] | null // TEXT[]
    collaboration_goal?: string[] | null // TEXT[]
  }
  const [formData, setFormData] = useState<ProfileFormData>({})

  useEffect(() => {
    if (profile) {
      // Load all fields directly from profile columns (matches FINAL schema)
      setFormData({
        display_name: profile.display_name || undefined,
        avatar_url: profile.avatar_url || undefined,
        bio: profile.bio || undefined,
        birth_year: profile.birth_year || undefined,
        country: profile.country || undefined,
        city: profile.city || undefined,
        // Creator fields
        creator_platforms: (profile as any).creator_platforms || undefined,
        content_categories: (profile as any).content_categories || undefined,
        followers_count: (profile as any).followers_count || undefined,
        avg_views: (profile as any).avg_views || undefined,
        collaboration_expectation: (profile as any).collaboration_expectation || undefined,
        // Brand fields
        brand_name: (profile as any).brand_name || undefined,
        industry: (profile as any).industry || undefined,
        company_size: (profile as any).company_size || undefined,
        monthly_marketing_budget: (profile as any).monthly_marketing_budget ? Number((profile as any).monthly_marketing_budget) : undefined,
        target_platforms: (profile as any).target_platforms || undefined,
        collaboration_goal: Array.isArray((profile as any).collaboration_goal) ? (profile as any).collaboration_goal : undefined,
      })
    }
  }, [profile])

  if (profileLoading) {
    return (
      <div className="flex items-center justify-center py-20">
        <div className="text-[#6B7280]">ƒêang t·∫£i...</div>
      </div>
    )
  }

  if (!profile) {
    return (
      <div className="flex items-center justify-center py-20">
        <div className="text-[#6B7280]">Kh√¥ng t√¨m th·∫•y h·ªì s∆°</div>
      </div>
    )
  }

  const role = profile.role || 'creator'

  // Validation function
  const validateProfile = (): { isValid: boolean; firstInvalidField: string | null } => {
    const errors: Record<string, string> = {}

    // Core required fields
    if (!formData.display_name || formData.display_name.trim() === '') {
      errors.display_name = 'Vui l√≤ng nh·∫≠p t√™n hi·ªÉn th·ªã'
    }
    if (!formData.birth_year) {
      errors.birth_year = 'Vui l√≤ng nh·∫≠p nƒÉm sinh'
    }
    if (!formData.country || formData.country.trim() === '') {
      errors.country = 'Vui l√≤ng nh·∫≠p qu·ªëc gia'
    }
    if (!formData.city || formData.city.trim() === '') {
      errors.city = 'Vui l√≤ng nh·∫≠p th√†nh ph·ªë'
    }

    if (role === 'creator') {
      // Creator required fields
      if (!formData.creator_platforms || formData.creator_platforms.length === 0) {
        errors.creator_platforms = 'Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt n·ªÅn t·∫£ng'
      }
      if (!formData.content_categories || formData.content_categories.length === 0) {
        errors.content_categories = 'Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt danh m·ª•c n·ªôi dung'
      }
      if (!formData.collaboration_expectation || formData.collaboration_expectation.length === 0) {
        errors.collaboration_expectation = 'Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt k·ª≥ v·ªçng h·ª£p t√°c'
      }
      if (!formData.followers_count || formData.followers_count <= 0) {
        errors.followers_count = 'Vui l√≤ng nh·∫≠p s·ªë l∆∞·ª£ng ng∆∞·ªùi theo d√µi (l·ªõn h∆°n 0)'
      }
      if (!formData.avg_views || formData.avg_views <= 0) {
        errors.avg_views = 'Vui l√≤ng nh·∫≠p l∆∞·ª£t xem trung b√¨nh (l·ªõn h∆°n 0)'
      }
    } else {
      // Brand required fields
      if (!formData.brand_name || formData.brand_name.trim() === '') {
        errors.brand_name = 'Vui l√≤ng nh·∫≠p t√™n c√¥ng ty'
      }
      if (!formData.industry || formData.industry.trim() === '') {
        errors.industry = 'Vui l√≤ng nh·∫≠p ng√†nh ngh·ªÅ'
      }
      if (!formData.company_size || formData.company_size.trim() === '') {
        errors.company_size = 'Vui l√≤ng ch·ªçn quy m√¥ c√¥ng ty'
      }
      if (!formData.monthly_marketing_budget || formData.monthly_marketing_budget <= 0) {
        errors.monthly_marketing_budget = 'Vui l√≤ng nh·∫≠p ng√¢n s√°ch marketing (l·ªõn h∆°n 0)'
      }
      if (!formData.target_platforms || formData.target_platforms.length === 0) {
        errors.target_platforms = 'Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt n·ªÅn t·∫£ng m·ª•c ti√™u'
      }
      if (!formData.collaboration_goal || formData.collaboration_goal.length === 0) {
        errors.collaboration_goal = 'Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt m·ª•c ti√™u h·ª£p t√°c'
      }
    }

    setFieldErrors(errors)

    if (Object.keys(errors).length > 0) {
      // Find first invalid field for scrolling
      const fieldOrder = role === 'creator'
        ? ['display_name', 'birth_year', 'country', 'city', 'creator_platforms', 'content_categories', 'followers_count', 'avg_views', 'collaboration_expectation']
        : ['display_name', 'birth_year', 'country', 'city', 'brand_name', 'industry', 'company_size', 'monthly_marketing_budget', 'target_platforms', 'collaboration_goal']
      
      const firstInvalidField = fieldOrder.find(field => errors[field]) || null
      return { isValid: false, firstInvalidField }
    }

    return { isValid: true, firstInvalidField: null }
  }

  const scrollToField = (fieldName: string) => {
    const field = fieldRefs.current[fieldName]
    if (field) {
      field.scrollIntoView({ behavior: 'smooth', block: 'center' })
      setTimeout(() => field.focus(), 300)
    }
  }

  const handleSave = async () => {
    if (!session || !profile) return

    // Validate before saving
    const validation = validateProfile()
    if (!validation.isValid) {
      setToast({ message: 'Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc', type: 'error' })
      if (validation.firstInvalidField) {
        scrollToField(validation.firstInvalidField)
      }
      return
    }

    setLoading(true)
    setFieldErrors({})

    try {
      // Build update object with only columns (no onboarding_data)
      const updateData: any = {}

      // Core fields (matches FINAL schema)
      updateData.display_name = formData.display_name || null
      updateData.avatar_url = formData.avatar_url || null
      updateData.bio = formData.bio || null
      updateData.birth_year = formData.birth_year || null
      updateData.country = formData.country || null
      updateData.city = formData.city || null

      if (role === 'creator') {
        // Creator-specific fields (matches FINAL schema - TEXT[] are arrays)
        updateData.creator_platforms = formData.creator_platforms || null
        updateData.content_categories = formData.content_categories || null
        updateData.followers_count = formData.followers_count || null
        updateData.avg_views = formData.avg_views || null
        updateData.collaboration_expectation = formData.collaboration_expectation || null
      } else {
        // Brand-specific fields (matches FINAL schema)
        updateData.brand_name = formData.brand_name || null
        updateData.industry = formData.industry || null
        updateData.company_size = formData.company_size || null
        updateData.monthly_marketing_budget = formData.monthly_marketing_budget !== undefined ? formData.monthly_marketing_budget : null // NUMERIC
        updateData.target_platforms = formData.target_platforms || null
        updateData.collaboration_goal = formData.collaboration_goal || null // TEXT[]
      }

      // Explicitly remove any invalid columns (safety check)
      // These columns do NOT exist in the database schema
      const {
        preferred_collaboration_type,
        success_collaboration_rate,
        company_name,
        website,
        campaign_budget_range,
        campaign_goal,
        target_creator_size,
        contact_person_name,
        contact_person_phone,
        ...safeUpdateData
      } = updateData as any
      
      // Update profile (only with valid columns)
      const { error: profileError } = await supabase
        .from('profiles')
        .update(safeUpdateData)
        .eq('id', session.user.id)

      if (profileError) throw profileError

      // Sync display_name and avatar_url to auth metadata
      const metadataUpdate: Record<string, any> = {}
      if (formData.display_name !== undefined) {
        metadataUpdate.display_name = formData.display_name
      }
      if (formData.avatar_url !== undefined) {
        metadataUpdate.avatar_url = formData.avatar_url
      }

      if (Object.keys(metadataUpdate).length > 0) {
        const { error: authError } = await supabase.auth.updateUser({
          data: metadataUpdate,
        })
        if (authError) {
          console.warn('Failed to update auth metadata:', authError)
          // Don't throw - profile update succeeded
        }
      }

      setToast({ message: 'L∆∞u h·ªì s∆° th√†nh c√¥ng', type: 'success' })
    } catch (err: any) {
      console.error('Profile save error:', err)
      setToast({ message: err.message || 'C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i', type: 'error' })
    } finally {
      setLoading(false)
    }
  }

  const handleAvatarChange = async (url: string) => {
    // URL is already a public URL from AvatarUpload component (after successful storage upload)
    if (!session || !profile) {
      console.error('Cannot save avatar: missing session or profile')
      return
    }

    // Optimistically update form state
    setFormData((prev) => ({ ...prev, avatar_url: url }))

    try {
      // Update profiles.avatar_url with public URL (primary source)
      const { error: profileError } = await supabase
        .from('profiles')
        .update({
          avatar_url: url,
          updated_at: new Date().toISOString(),
        })
        .eq('id', session.user.id)

      if (profileError) {
        console.error('Failed to update profiles.avatar_url:', profileError)
        throw profileError
      }

      // Sync to auth metadata (secondary, non-blocking)
      const { error: authError } = await supabase.auth.updateUser({
        data: { avatar_url: url },
      })
      if (authError) {
        console.warn('Failed to sync avatar_url to auth metadata (non-blocking):', authError)
        // Don't throw - profile update succeeded
      }

      setToast({ message: 'ƒê√£ l∆∞u avatar th√†nh c√¥ng', type: 'success' })
    } catch (error: any) {
      console.error('Avatar save error:', error)
      // Revert optimistic update on error
      setFormData((prev) => ({ ...prev, avatar_url: profile.avatar_url || null }))
      setToast({ message: error.message || 'C√≥ l·ªói x·∫£y ra khi l∆∞u avatar', type: 'error' })
    }
  }

  return (
    <div className="bg-white py-8 px-6">
      <div className="max-w-4xl mx-auto">
        <div className="bg-white rounded-3xl p-8 md:p-10 shadow-xl border border-gray-200">

          <form onSubmit={(e) => { e.preventDefault(); handleSave(); }} className="space-y-6">
            {/* Basic Identity Section */}
            <div className="border-b pb-6">
              <h2 className="text-xl font-semibold mb-4">Th√¥ng tin c∆° b·∫£n</h2>
              
              {role === 'creator' ? (
                <>
                  {/* Top Row: Display Name | Avatar */}
                  <div className="flex flex-col md:flex-row gap-6 mb-6 items-start">
                    {/* Left: Display Name */}
                    <div className="flex-1 space-y-4 w-full md:w-auto">
                      <div>
                        <label className="block text-sm font-medium text-[#374151] mb-2">
                          T√™n hi·ªÉn th·ªã *
                        </label>
                        <input
                          ref={(el) => fieldRefs.current.display_name = el}
                          type="text"
                          value={formData.display_name || ''}
                          onChange={(e) => {
                            setFormData({ ...formData, display_name: e.target.value })
                            if (fieldErrors.display_name) {
                              setFieldErrors(prev => {
                                const next = { ...prev }
                                delete next.display_name
                                return next
                              })
                            }
                          }}
                          className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.display_name ? 'border-red-500' : ''}`}
                          placeholder="Nh·∫≠p t√™n hi·ªÉn th·ªã"
                        />
                        {fieldErrors.display_name && (
                          <p className="mt-1 text-sm text-red-600">{fieldErrors.display_name}</p>
                        )}
                      </div>
                    </div>

                    {/* Right: Avatar */}
                    <div className="flex-shrink-0">
                      <AvatarUpload
                        currentAvatarUrl={formData.avatar_url ?? undefined}
                        onAvatarChange={handleAvatarChange}
                        userId={session?.user?.id || ''}
                      />
                    </div>
                  </div>

                  {/* 2-Column Grid: Birth Year | Country + City */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-[#374151] mb-2">
                        NƒÉm sinh *
                      </label>
                      <input
                        ref={(el) => fieldRefs.current.birth_year = el}
                        type="number"
                        min="1950"
                        max={new Date().getFullYear()}
                        value={formData.birth_year || ''}
                        onChange={(e) => {
                          setFormData({ ...formData, birth_year: e.target.value ? parseInt(e.target.value) : undefined })
                          if (fieldErrors.birth_year) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.birth_year
                              return next
                            })
                          }
                        }}
                        className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.birth_year ? 'border-red-500' : ''}`}
                      />
                      {fieldErrors.birth_year && (
                        <p className="mt-1 text-sm text-red-600">{fieldErrors.birth_year}</p>
                      )}
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-[#374151] mb-2">
                        Qu·ªëc gia *
                      </label>
                      <input
                        ref={(el) => fieldRefs.current.country = el}
                        type="text"
                        value={formData.country || ''}
                        onChange={(e) => {
                          setFormData({ ...formData, country: e.target.value })
                          if (fieldErrors.country) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.country
                              return next
                            })
                          }
                        }}
                        className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.country ? 'border-red-500' : ''}`}
                      />
                      {fieldErrors.country && (
                        <p className="mt-1 text-sm text-red-600">{fieldErrors.country}</p>
                      )}
                    </div>
                    <div className="md:col-span-2">
                      <label className="block text-sm font-medium text-[#374151] mb-2">
                        Th√†nh ph·ªë *
                      </label>
                      <input
                        ref={(el) => fieldRefs.current.city = el}
                        type="text"
                        value={formData.city || ''}
                        onChange={(e) => {
                          setFormData({ ...formData, city: e.target.value })
                          if (fieldErrors.city) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.city
                              return next
                            })
                          }
                        }}
                        className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.city ? 'border-red-500' : ''}`}
                      />
                      {fieldErrors.city && (
                        <p className="mt-1 text-sm text-red-600">{fieldErrors.city}</p>
                      )}
                    </div>
                  </div>
                </>
              ) : (
                <>
                  {/* Top Row: Company Name | Avatar */}
                  <div className="flex flex-col md:flex-row gap-6 mb-6 items-start">
                    {/* Left: Company Name */}
                    <div className="flex-1 space-y-4 w-full md:w-auto">
                      <div>
                        <label className="block text-sm font-medium text-[#374151] mb-2">
                          T√™n c√¥ng ty *
                        </label>
                        <input
                          ref={(el) => fieldRefs.current.brand_name = el}
                          type="text"
                          value={formData.brand_name || ''}
                          onChange={(e) => {
                            setFormData({ ...formData, brand_name: e.target.value })
                            if (fieldErrors.brand_name) {
                              setFieldErrors(prev => {
                                const next = { ...prev }
                                delete next.brand_name
                                return next
                              })
                            }
                          }}
                          className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.brand_name ? 'border-red-500' : ''}`}
                          placeholder="Nh·∫≠p t√™n c√¥ng ty"
                        />
                        {fieldErrors.brand_name && (
                          <p className="mt-1 text-sm text-red-600">{fieldErrors.brand_name}</p>
                        )}
                      </div>
                    </div>

                    {/* Right: Avatar */}
                    <div className="flex-shrink-0">
                      <AvatarUpload
                        currentAvatarUrl={formData.avatar_url ?? undefined}
                        onAvatarChange={handleAvatarChange}
                        userId={session?.user?.id || ''}
                      />
                    </div>
                  </div>

                  {/* 2-Column Grid: Industry | Country + City */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-[#374151] mb-2">
                        Ng√†nh ngh·ªÅ *
                      </label>
                      <input
                        ref={(el) => fieldRefs.current.industry = el}
                        type="text"
                        value={formData.industry || ''}
                        onChange={(e) => {
                          setFormData({ ...formData, industry: e.target.value })
                          if (fieldErrors.industry) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.industry
                              return next
                            })
                          }
                        }}
                        className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.industry ? 'border-red-500' : ''}`}
                      />
                      {fieldErrors.industry && (
                        <p className="mt-1 text-sm text-red-600">{fieldErrors.industry}</p>
                      )}
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-[#374151] mb-2">
                        Qu·ªëc gia *
                      </label>
                      <input
                        ref={(el) => fieldRefs.current.country = el}
                        type="text"
                        value={formData.country || ''}
                        onChange={(e) => {
                          setFormData({ ...formData, country: e.target.value })
                          if (fieldErrors.country) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.country
                              return next
                            })
                          }
                        }}
                        className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.country ? 'border-red-500' : ''}`}
                      />
                      {fieldErrors.country && (
                        <p className="mt-1 text-sm text-red-600">{fieldErrors.country}</p>
                      )}
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-[#374151] mb-2">
                        Th√†nh ph·ªë *
                      </label>
                      <input
                        ref={(el) => fieldRefs.current.city = el}
                        type="text"
                        value={formData.city || ''}
                        onChange={(e) => {
                          setFormData({ ...formData, city: e.target.value })
                          if (fieldErrors.city) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.city
                              return next
                            })
                          }
                        }}
                        className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.city ? 'border-red-500' : ''}`}
                      />
                      {fieldErrors.city && (
                        <p className="mt-1 text-sm text-red-600">{fieldErrors.city}</p>
                      )}
                    </div>
                  </div>
                </>
              )}
            </div>

            {/* Business/Creator Metrics Section */}
            {role === 'creator' && (
              <div className="border-b pb-6">
                <h2 className="text-xl font-semibold mb-4">Th√¥ng tin Creator</h2>

                <div className="mb-4">
                  <label className="block text-sm font-medium text-[#374151] mb-2">
                    Gi·ªõi thi·ªáu
                  </label>
                  <textarea
                    value={formData.bio || ''}
                    onChange={(e) => setFormData({ ...formData, bio: e.target.value })}
                    rows={3}
                    className="w-full px-4 py-2.5 border rounded-lg"
                    placeholder="Gi·ªõi thi·ªáu v·ªÅ b·∫£n th√¢n..."
                  />
                </div>

                <div className="mb-4">
                  <label className="block text-sm font-medium text-[#374151] mb-2">
                    N·ªÅn t·∫£ng *
                  </label>
                  <div className="flex flex-wrap gap-2">
                    {['TikTok', 'Instagram', 'YouTube', 'Facebook', 'Twitter', 'LinkedIn'].map((platform) => (
                      <button
                        key={platform}
                        type="button"
                        onClick={() => {
                          const current = formData.creator_platforms || []
                          const updated = current.includes(platform)
                            ? current.filter((p) => p !== platform)
                            : [...current, platform]
                          setFormData({ ...formData, creator_platforms: updated })
                          if (fieldErrors.creator_platforms && updated.length > 0) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.creator_platforms
                              return next
                            })
                          }
                        }}
                        className={`px-4 py-2.5 rounded-lg border text-sm font-medium transition-colors h-10 ${
                          formData.creator_platforms?.includes(platform)
                            ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                            : 'border-gray-300 hover:border-gray-400 text-gray-700'
                        }`}
                      >
                        {platform}
                      </button>
                    ))}
                  </div>
                  {fieldErrors.creator_platforms && (
                    <p className="mt-1 text-sm text-red-600">{fieldErrors.creator_platforms}</p>
                  )}
                </div>
                <div className="grid grid-cols-2 gap-4 mb-4">
                  <div>
                    <label className="block text-sm font-medium text-[#374151] mb-2">
                      S·ªë l∆∞·ª£ng ng∆∞·ªùi theo d√µi *
                    </label>
                    <input
                      ref={(el) => fieldRefs.current.followers_count = el}
                      type="number"
                      min="0"
                      value={formData.followers_count || ''}
                      onChange={(e) => {
                        setFormData({ ...formData, followers_count: e.target.value ? parseInt(e.target.value) : undefined })
                        if (fieldErrors.followers_count) {
                          setFieldErrors(prev => {
                            const next = { ...prev }
                            delete next.followers_count
                            return next
                          })
                        }
                      }}
                      className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.followers_count ? 'border-red-500' : ''}`}
                    />
                    {fieldErrors.followers_count && (
                      <p className="mt-1 text-sm text-red-600">{fieldErrors.followers_count}</p>
                    )}
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-[#374151] mb-2">
                      L∆∞·ª£t xem trung b√¨nh *
                    </label>
                    <input
                      ref={(el) => fieldRefs.current.avg_views = el}
                      type="number"
                      min="0"
                      value={formData.avg_views || ''}
                      onChange={(e) => {
                        setFormData({ ...formData, avg_views: e.target.value ? parseInt(e.target.value) : undefined })
                        if (fieldErrors.avg_views) {
                          setFieldErrors(prev => {
                            const next = { ...prev }
                            delete next.avg_views
                            return next
                          })
                        }
                      }}
                      className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.avg_views ? 'border-red-500' : ''}`}
                    />
                    {fieldErrors.avg_views && (
                      <p className="mt-1 text-sm text-red-600">{fieldErrors.avg_views}</p>
                    )}
                  </div>
                </div>
                <div className="mb-4">
                  <label className="block text-sm font-medium text-[#374151] mb-2">
                    Danh m·ª•c n·ªôi dung *
                  </label>
                  <div className="flex flex-wrap gap-2">
                    {['Beauty', 'Fashion', 'Food', 'Travel', 'Tech', 'Fitness', 'Lifestyle', 'Education'].map((category) => (
                      <button
                        key={category}
                        type="button"
                        onClick={() => {
                          const current = formData.content_categories || []
                          const updated = current.includes(category)
                            ? current.filter((c) => c !== category)
                            : [...current, category]
                          setFormData({ ...formData, content_categories: updated })
                          if (fieldErrors.content_categories && updated.length > 0) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.content_categories
                              return next
                            })
                          }
                        }}
                        className={`px-4 py-2.5 rounded-lg border text-sm font-medium transition-colors h-10 ${
                          formData.content_categories?.includes(category)
                            ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                            : 'border-gray-300 hover:border-gray-400 text-gray-700'
                        }`}
                      >
                        {category}
                      </button>
                    ))}
                  </div>
                  {fieldErrors.content_categories && (
                    <p className="mt-1 text-sm text-red-600">{fieldErrors.content_categories}</p>
                  )}
                </div>
              </div>
            )}

            {/* Brand Info Section */}
            {role === 'brand' && (
              <div className="border-b pb-6">
                <h2 className="text-xl font-semibold mb-4">Th√¥ng tin Brand</h2>

                <div className="mb-4">
                  <label className="block text-sm font-medium text-[#374151] mb-2">
                    Quy m√¥ c√¥ng ty *
                  </label>
                  <select
                    ref={(el) => fieldRefs.current.company_size = el}
                    value={formData.company_size || ''}
                    onChange={(e) => {
                      setFormData({ ...formData, company_size: e.target.value })
                      if (fieldErrors.company_size) {
                        setFieldErrors(prev => {
                          const next = { ...prev }
                          delete next.company_size
                          return next
                        })
                      }
                    }}
                    className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.company_size ? 'border-red-500' : ''}`}
                  >
                    <option value="">Ch·ªçn quy m√¥</option>
                    <option value="startup">Startup (1-10 nh√¢n vi√™n)</option>
                    <option value="small">Nh·ªè (11-50 nh√¢n vi√™n)</option>
                    <option value="medium">V·ª´a (51-200 nh√¢n vi√™n)</option>
                    <option value="large">L·ªõn (201-1000 nh√¢n vi√™n)</option>
                    <option value="enterprise">Doanh nghi·ªáp (1000+ nh√¢n vi√™n)</option>
                  </select>
                  {fieldErrors.company_size && (
                    <p className="mt-1 text-sm text-red-600">{fieldErrors.company_size}</p>
                  )}
                </div>
                <div className="mb-4">
                  <div>
                    <label className="block text-sm font-medium text-[#374151] mb-2">
                      Ng√¢n s√°ch marketing h√†ng th√°ng *
                    </label>
                    <input
                      ref={(el) => fieldRefs.current.monthly_marketing_budget = el}
                      type="number"
                      min="0"
                      step="0.01"
                      value={formData.monthly_marketing_budget || ''}
                      onChange={(e) => {
                        setFormData({ ...formData, monthly_marketing_budget: e.target.value ? parseFloat(e.target.value) : undefined })
                        if (fieldErrors.monthly_marketing_budget) {
                          setFieldErrors(prev => {
                            const next = { ...prev }
                            delete next.monthly_marketing_budget
                            return next
                          })
                        }
                      }}
                      className={`w-full px-4 py-2.5 border rounded-lg ${fieldErrors.monthly_marketing_budget ? 'border-red-500' : ''}`}
                      placeholder="V√≠ d·ª•: 5000"
                    />
                    {fieldErrors.monthly_marketing_budget && (
                      <p className="mt-1 text-sm text-red-600">{fieldErrors.monthly_marketing_budget}</p>
                    )}
                  </div>
                </div>
                <div className="mb-4">
                  <label className="block text-sm font-medium text-[#374151] mb-2">
                    N·ªÅn t·∫£ng m·ª•c ti√™u *
                  </label>
                  <div className="flex flex-wrap gap-2">
                    {['TikTok', 'Instagram', 'YouTube', 'Facebook', 'Twitter', 'LinkedIn'].map((platform) => (
                      <button
                        key={platform}
                        type="button"
                        onClick={() => {
                          const current = formData.target_platforms || []
                          const updated = current.includes(platform)
                            ? current.filter((p) => p !== platform)
                            : [...current, platform]
                          setFormData({ ...formData, target_platforms: updated })
                          if (fieldErrors.target_platforms && updated.length > 0) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.target_platforms
                              return next
                            })
                          }
                        }}
                        className={`px-4 py-2.5 rounded-lg border text-sm font-medium transition-colors h-10 ${
                          formData.target_platforms?.includes(platform)
                            ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                            : 'border-gray-300 hover:border-gray-400 text-gray-700'
                        }`}
                      >
                        {platform}
                      </button>
                    ))}
                  </div>
                  {fieldErrors.target_platforms && (
                    <p className="mt-1 text-sm text-red-600">{fieldErrors.target_platforms}</p>
                  )}
                </div>
              </div>
            )}

            {/* Collaboration Intent Section */}
            <div className="pb-6">
              <h2 className="text-xl font-semibold mb-4">M·ª•c ti√™u h·ª£p t√°c</h2>
              {role === 'creator' ? (
                <div>
                  <label className="block text-sm font-medium text-[#374151] mb-2">
                    K·ª≥ v·ªçng h·ª£p t√°c *
                  </label>
                  <div className="grid grid-cols-3 gap-2">
                    {['paid', 'gift', 'affiliate'].map((type) => (
                      <button
                        key={type}
                        type="button"
                        onClick={() => {
                          const current = formData.collaboration_expectation || []
                          const updated = current.includes(type)
                            ? current.filter((t) => t !== type)
                            : [...current, type]
                          setFormData({ ...formData, collaboration_expectation: updated })
                          if (fieldErrors.collaboration_expectation && updated.length > 0) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.collaboration_expectation
                              return next
                            })
                          }
                        }}
                        className={`px-4 py-2.5 rounded-lg border text-sm font-medium transition-colors h-10 ${
                          formData.collaboration_expectation?.includes(type)
                            ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                            : 'border-gray-300 hover:border-gray-400 text-gray-700'
                        }`}
                      >
                        {type === 'paid' ? 'Tr·∫£ ph√≠' : type === 'gift' ? 'Qu√† t·∫∑ng' : 'Affiliate'}
                      </button>
                    ))}
                  </div>
                  {fieldErrors.collaboration_expectation && (
                    <p className="mt-1 text-sm text-red-600">{fieldErrors.collaboration_expectation}</p>
                  )}
                </div>
              ) : (
                <div>
                  <label className="block text-sm font-medium text-[#374151] mb-2">
                    M·ª•c ti√™u h·ª£p t√°c *
                  </label>
                  <div className="grid grid-cols-2 gap-2">
                    {['brand_awareness', 'sales', 'engagement', 'lead_generation', 'product_launch', 'community_building'].map((goal) => (
                      <button
                        key={goal}
                        type="button"
                        onClick={() => {
                          const current = formData.collaboration_goal || []
                          const updated = current.includes(goal)
                            ? current.filter((g) => g !== goal)
                            : [...current, goal]
                          setFormData({ ...formData, collaboration_goal: updated })
                          if (fieldErrors.collaboration_goal && updated.length > 0) {
                            setFieldErrors(prev => {
                              const next = { ...prev }
                              delete next.collaboration_goal
                              return next
                            })
                          }
                        }}
                        className={`px-4 py-2.5 rounded-lg border text-sm font-medium transition-colors h-10 ${
                          formData.collaboration_goal?.includes(goal)
                            ? 'border-[#6366F1] bg-[#6366F1]/10 text-[#6366F1]'
                            : 'border-gray-300 hover:border-gray-400 text-gray-700'
                        }`}
                      >
                        {goal === 'brand_awareness' ? 'Nh·∫≠n di·ªán th∆∞∆°ng hi·ªáu' :
                         goal === 'sales' ? 'B√°n h√†ng' :
                         goal === 'engagement' ? 'T∆∞∆°ng t√°c' :
                         goal === 'lead_generation' ? 'T·∫°o lead' :
                         goal === 'product_launch' ? 'Ra m·∫Øt s·∫£n ph·∫©m' :
                         'X√¢y d·ª±ng c·ªông ƒë·ªìng'}
                      </button>
                    ))}
                  </div>
                  {fieldErrors.collaboration_goal && (
                    <p className="mt-1 text-sm text-red-600">{fieldErrors.collaboration_goal}</p>
                  )}
                </div>
              )}
            </div>

            {/* Email (read-only) */}
            <div className="border-t pt-6">
              <label className="block text-sm font-medium text-[#374151] mb-2">
                Email
              </label>
              <input
                type="email"
                value={session?.user?.email || ''}
                disabled
                className="w-full px-4 py-2.5 border rounded-lg bg-gray-50 text-gray-500"
              />
            </div>

            <button
              type="submit"
              disabled={loading}
              className="w-full px-6 py-2.5 rounded-xl font-medium text-white bg-gradient-to-r from-[#6366F1] to-[#EC4899] disabled:opacity-50"
            >
              {loading ? 'ƒêang l∆∞u...' : 'L∆∞u thay ƒë·ªïi'}
            </button>
          </form>
        </div>
      </div>

      {/* Toast Notification */}
      {toast && (
        <Toast
          message={toast.message}
          type={toast.type}
          onClose={() => setToast(null)}
        />
      )}
    </div>
  )
}
</file>

<file path="src/main.tsx">
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'
import './index.css'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)
</file>

<file path="src/router.tsx">
import { Routes, Route, Navigate } from 'react-router-dom'
import { useEffect, useState } from 'react'
import { useAuth } from './hooks/useAuth'
import { useProfile } from './hooks/useProfile'
import LandingPage from './pages/LandingPage'
import LoginPage from './pages/LoginPage'
import SignupPage from './pages/SignupPage'
import VerifyEmailPage from './pages/VerifyEmailPage'
import AppGate from './pages/AppGate'
import RolePage from './pages/RolePage'
import OnboardingPage from './pages/OnboardingPage'
import CreatorDashboard from './pages/CreatorDashboard'
import BrandDashboard from './pages/BrandDashboard'
import Dashboard from './pages/Dashboard'
import DashboardHome from './pages/DashboardHome'
import ComingSoonPage from './pages/ComingSoonPage'
import TermsPage from './pages/TermsPage'
import PrivacyPage from './pages/PrivacyPage'

function ProtectedRoute({ children }: { children: React.ReactNode }) {
  const { session, loading } = useAuth()

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-[#6B7280]">ƒêang t·∫£i...</div>
      </div>
    )
  }

  if (!session) {
    return <Navigate to="/login" replace />
  }

  return <>{children}</>
}

function PublicRoute({ children }: { children: React.ReactNode }) {
  const { session, loading } = useAuth()

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-[#6B7280]">ƒêang t·∫£i...</div>
      </div>
    )
  }

  if (session) {
    return <Navigate to="/app" replace />
  }

  return <>{children}</>
}

export function Router() {
  return (
    <Routes>
      <Route path="/" element={<LandingPage />} />
      
      <Route
        path="/login"
        element={
          <PublicRoute>
            <LoginPage />
          </PublicRoute>
        }
      />
      
      <Route
        path="/signup"
        element={
          <PublicRoute>
            <SignupPage />
          </PublicRoute>
        }
      />
      
      <Route path="/verify-email" element={<VerifyEmailPage />} />

      <Route path="/terms" element={<TermsPage />} />
      <Route path="/privacy" element={<PrivacyPage />} />

      <Route path="/app" element={<AppGate />} />

      <Route
        path="/role"
        element={
          <ProtectedRoute>
            <RolePage />
          </ProtectedRoute>
        }
      />

      <Route
        path="/onboarding"
        element={
          <ProtectedRoute>
            <OnboardingPage />
          </ProtectedRoute>
        }
      />

      <Route
        path="/dashboard"
        element={<DashboardEntry />}
      />

      <Route
        path="/dashboard/profile"
        element={<DashboardEntry />}
      />

      <Route
        path="/dashboard/services"
        element={<DashboardEntry />}
      />

      <Route
        path="/dashboard/opportunities"
        element={<DashboardEntry />}
      />

      <Route
        path="/dashboard/proposals"
        element={<DashboardEntry />}
      />

      <Route
        path="/dashboard/workspace"
        element={<DashboardEntry />}
      />

      <Route
        path="/dashboard/analytics"
        element={<DashboardEntry />}
      />

      <Route
        path="/dashboard/settings"
        element={<DashboardEntry />}
      />

      <Route
        path="/projects"
        element={<DashboardEntry />}
      />

      <Route path="*" element={<Navigate to="/" replace />} />
    </Routes>
  )
}

function DashboardEntry() {
  const { session, loading: authLoading, user, isAuthenticated } = useAuth()
  const { profile, loading: profileLoading, error: profileError } = useProfile(user?.id, isAuthenticated)

  // a) If not authenticated ‚Üí do nothing (let AppGate handle it)
  if (authLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-[#6B7280]">ƒêang t·∫£i...</div>
      </div>
    )
  }

  if (!session) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-[#6B7280]">ƒêang t·∫£i...</div>
      </div>
    )
  }

  // b) If profile is loading ‚Üí do nothing (show loading)
  if (profileLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-[#6B7280]">ƒêang t·∫£i...</div>
      </div>
    )
  }

  // c) If profile error or missing ‚Üí let AppGate handle redirect (don't redirect here)
  if (profileError || !profile) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-[#6B7280]">ƒêang t·∫£i...</div>
      </div>
    )
  }

  // Profile loaded successfully, render unified dashboard
  return <Dashboard />
}
</file>

<file path="index.html">
<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/logo/logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ALINO - Qu·∫£n l√Ω h·ª£p t√°c Creator‚ÄìBrand</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="README.md">
# MVP Codebase

A clean, modern, production-oriented MVP environment built with Next.js, TypeScript, and React.

## Tech Stack

- Node.js (LTS)
- TypeScript (strict mode)
- React
- Next.js (App Router)
- npm

## Getting Started

### Installation

```bash
npm install
```

### Development

```bash
npm run dev
```

This starts the development server at [http://localhost:3000](http://localhost:3000).

### Build

```bash
npm run build
```

### Production

```bash
npm start
```

### Backup

```bash
npm run backup
```

This script:
1. Runs repomix to bundle the entire codebase
2. Commits the repomix output
3. Pushes to the connected GitHub repository

## Project Structure

- `app/` - UI components and routes (Next.js App Router)
- `core/` - Domain models, types, and business logic
- `infra/` - Backend integration, auth, and external services
- `lib/` - Shared utilities and helpers
- `scripts/` - Build and utility scripts
- `public/` - Static assets

## Environment Variables

Copy `.env.example` to `.env.local` and fill in your values. Never commit `.env.local` or any files containing secrets.

## TypeScript

The project uses TypeScript in strict mode with absolute imports:
- `@/app` - App directory
- `@/core` - Core business logic
- `@/infra` - Infrastructure code
- `@/lib` - Shared utilities
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: ["./index.html", "./src/**/*.{js,ts,jsx,tsx}"],
  theme: {
    extend: {
      fontFamily: {
        sans: ['Inter', 'system-ui', 'sans-serif'],
      },
      colors: {
        background: '#FFFFFF',
        foreground: '#0A0A0A',
        border: '#E5E7EB',
      },
    },
  },
  plugins: [],
}
</file>

<file path="vite.config.ts">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    host: true,
    port: 3000,
  },
})
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "types": ["vite/client"],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"],
  "exclude": ["node_modules"]
}
</file>

<file path="src/index.css">
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  * {
    @apply border-border;
  }
  
  body {
    @apply bg-background text-foreground;
    font-family: 'Inter', system-ui, sans-serif;
  }
}

.underline-gradient {
  position: relative;
}

.underline-gradient::after {
  content: '';
  position: absolute;
  bottom: -4px;
  left: 0;
  width: 0;
  height: 2px;
  background: linear-gradient(90deg, #6366F1, #EC4899);
  transition: width 0.3s ease;
}

.underline-gradient:hover::after {
  width: 100%;
}

@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}
</file>

<file path=".env.example">
VITE_SUPABASE_URL=https://iralrlsuxoqbgcjzdpbb.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlyYWxybHN1eG9xYmdjanpkcGJiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1ODA5ODUsImV4cCI6MjA4MjE1Njk4NX0.e0x5keoaE0GlXehvTA05LlzGhZWh63FHROkAz9kPqZU
</file>

<file path=".gitignore">
# =====================
# Dependencies
# =====================
node_modules/
.pnp
.pnp.js

# =====================
# Next.js / Build
# =====================
.next/
out/
build/
dist/

# =====================
# Environment variables
# =====================
.env
.env.local
.env.*.local

# =====================
# Logs
# =====================
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# =====================
# OS / Editor
# =====================
.DS_Store

# =====================
# TypeScript
# =====================
*.tsbuildinfo
next-env.d.ts

# =====================
# Repomix (local only)
# =====================
repomix-output.*

# =====================
# MS Office temp files
# =====================
~$*.docx
~$*.xlsx
~$*.pptx
</file>

<file path="src/App.tsx">
import { BrowserRouter, useLocation } from 'react-router-dom'
import { Router } from './router'
import ScrollToTop from './components/ScrollToTop'
import Header from './components/layout/Header'
import Footer from './components/layout/Footer'

function AppContent() {
  const location = useLocation()
  
  // Check if we're in dashboard mode - hide Header and Footer
  const isDashboardMode = location.pathname.startsWith('/dashboard')
  
  return (
    <div className="min-h-screen flex flex-col">
      {!isDashboardMode && <Header />}
      <main className="flex-1">
        <Router />
      </main>
      {!isDashboardMode && <Footer />}
    </div>
  )
}

function App() {
  return (
    <BrowserRouter>
      <ScrollToTop />
      <AppContent />
    </BrowserRouter>
  )
}

export default App
</file>

<file path="package.json">
{
  "name": "alino-vite",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "backup": "git add -A && git commit -m \"backup\" || echo \"No changes to commit\" && git push"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.89.0",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.26.0",
    "react-icons": "^5.5.0",
    "react-easy-crop": "^5.0.5"
  },
  "devDependencies": {
    "@types/react": "^18.3.3",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react": "^4.3.1",
    "autoprefixer": "^10.4.23",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.1",
    "typescript": "^5.5.4",
    "vite": "^5.4.0"
  }
}
</file>

</files>
